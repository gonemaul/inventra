import{u as N,z as S,x as w,c as h,o as u,w as p,b as a,e as B,a as i,d as l,k as I,g as c,F,q as T,t as v,B as C,f as _}from"./app-DSv40uao.js";import{_ as U}from"./Modal-P8BHQgyt.js";import{P as D}from"./PrimaryButton-BnPLrvqI.js";import{_ as M}from"./SecondaryButton-nsAwBAw2.js";import{_ as f}from"./InputError-CGIiXMBH.js";import{_ as r}from"./TextInput-udOVDXCM.js";import{u as j}from"./useActionLoading-PoEUsbxM.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const q={class:"p-6"},L={class:"grid grid-cols-2 gap-4 mb-4"},$={class:"mb-4"},A=["value"],E={class:"mb-6"},P={class:"flex justify-end gap-3 pt-4 border-t"},Q={__name:"InvoiceForm",props:{show:Boolean,purchaseId:[Number,String],paymentStatuses:Array,editingInvoice:{type:Object,default:null}},emits:["close","invoice-saved"],setup(m,{emit:y}){const n=m,d=y,{isActionLoading:b}=j(),t=N({invoice_number:null,invoice_date:new Date().toISOString().split("T")[0],due_date:null,total_amount:0,invoice_image:null,payment_status:"unpaid"});S(()=>n.editingInvoice,s=>{s?(t.invoice_number=s.invoice_number,t.invoice_date=s.invoice_date,t.due_date=s.due_date,t.total_amount=s.total_amount,t.payment_status=s.payment_status):t.reset()},{immediate:!0});const x=w(null);function k(s){t.invoice_image=s.target.files[0]}const V=()=>{if(!t.invoice_number||t.total_amount<=0){alert("Nomor nota dan Total Nominal wajib diisi.");return}const s=!!n.editingInvoice,e=s?route("purchases.updateInvoice",{purchase:n.purchaseId,invoice:n.editingInvoice.id}):route("purchases.storeInvoice",n.purchaseId);b.value=!0,t.transform(o=>({...o,_method:s?"put":"post"})).post(e,{forceFormData:!0,preserveScroll:!0,onSuccess:()=>{t.reset(),d("invoice-saved"),d("close")},onError:o=>{toast.error(o.message||"Terjadi kesalahan saat menghapus data."),console.error("Gagal upload/update invoice:",o)},onFinish:()=>{b.value=!1}})};function g(){t.reset(),d("close")}return(s,e)=>(u(),h(U,{show:m.show,onClose:g,maxWidth:"xl"},{default:p(()=>[a("form",{onSubmit:B(V,["prevent"])},[a("div",q,[e[12]||(e[12]=a("h3",{class:"mb-4 text-xl font-bold dark:text-white"}," Upload Nota & Data Keuangan ",-1)),a("div",L,[a("div",null,[e[5]||(e[5]=a("label",{class:"block mb-1 text-sm font-medium dark:text-gray-300"},"Nomor Nota Supplier",-1)),i(r,{modelValue:l(t).invoice_number,"onUpdate:modelValue":e[0]||(e[0]=o=>l(t).invoice_number=o),required:""},null,8,["modelValue"]),i(f,{message:l(t).errors.invoice_number},null,8,["message"])]),a("div",null,[e[6]||(e[6]=a("label",{class:"block mb-1 text-sm font-medium dark:text-gray-300"},"Total Nominal Nota (IDR)",-1)),i(r,{modelValue:l(t).total_amount,"onUpdate:modelValue":e[1]||(e[1]=o=>l(t).total_amount=o),modelModifiers:{number:!0},type:"number",required:"",min:"1"},null,8,["modelValue"]),i(f,{message:l(t).errors.total_amount},null,8,["message"])]),a("div",null,[e[7]||(e[7]=a("label",{class:"block mb-1 text-sm font-medium dark:text-gray-300"},"Tanggal Nota",-1)),i(r,{modelValue:l(t).invoice_date,"onUpdate:modelValue":e[2]||(e[2]=o=>l(t).invoice_date=o),type:"date",required:""},null,8,["modelValue"])]),a("div",null,[e[8]||(e[8]=a("label",{class:"block mb-1 text-sm font-medium dark:text-gray-300"},"Tanggal Jatuh Tempo (Bon)",-1)),i(r,{modelValue:l(t).due_date,"onUpdate:modelValue":e[3]||(e[3]=o=>l(t).due_date=o),type:"date"},null,8,["modelValue"])])]),a("div",$,[e[9]||(e[9]=a("label",{class:"block mb-1 text-sm font-medium dark:text-gray-300"},"Status Pembayaran",-1)),I(a("select",{"onUpdate:modelValue":e[4]||(e[4]=o=>l(t).payment_status=o),class:"w-full border-gray-300 rounded-md shadow-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white"},[(u(!0),c(F,null,T(m.paymentStatuses,o=>(u(),c("option",{key:o,value:o},v(o.toUpperCase()),9,A))),128))],512),[[C,l(t).payment_status]])]),a("div",E,[e[10]||(e[10]=a("label",{class:"block mb-1 text-sm font-medium dark:text-gray-300"},"Foto Nota (Bukti Fisik)",-1)),a("input",{type:"file",onChange:k,ref_key:"fileInput",ref:x,class:"w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-lime-50 file:text-lime-700 hover:file:bg-lime-100 dark:file:bg-lime-900 dark:file:text-lime-300"},null,544),i(f,{message:l(t).errors.invoice_image},null,8,["message"])]),a("div",P,[i(M,{onClick:g,type:"button"},{default:p(()=>[...e[11]||(e[11]=[_("Batal",-1)])]),_:1}),i(D,{disabled:l(t).processing,type:"submit"},{default:p(()=>[_(v(l(t).processing?"Menyimpan...":"Simpan Nota & Lanjut Checking"),1)]),_:1},8,["disabled"])])])],32)]),_:1},8,["show"]))}};export{Q as default};
