import{q as u,I as H,J as $,C as D,l as c,o as d,e as g,g as j,i as N,w as h,f as t,m as q,F as b,H as I,n as E,t as r,d as S,B,V as G}from"./vendor-core-CTIsLlXR.js";import{d as L}from"./vendor-common-GpUWqhKr.js";import{_ as J}from"./AuthenticatedLayout-BfKFT1gl.js";import{_ as Q}from"./Filter-qWei0-r_.js";import U from"./modalFilter-R6aZ7SDI.js";import{B as W}from"./BottomSheet-Cz_QCYKv.js";import A from"./SalesStatsGrid-NX2mt5eT.js";import K from"./SalesTransactionList-Bo6HDvK3.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vendor-charts-Bw6UNgWf.js";import"./useSidebar-CS5Wldf6.js";import"./useActionLoading-C7V52Mi3.js";import"./TextInput-DJt4Y-5y.js";import"./PrimaryButton-DCtJfuoa.js";import"./BottomSheetFilter-B8PDmG-8.js";const Y={class:"w-full min-h-screen space-y-6 pb-20"},Z={class:"flex flex-col gap-4"},ee={class:"flex p-1 space-x-1 bg-gray-100 dark:bg-gray-800 rounded-xl overflow-x-auto"},te=["onClick"],se={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ae={class:"bg-gradient-to-br from-indigo-600 to-purple-700 rounded-xl p-4 text-white shadow-lg relative overflow-hidden"},le={class:"space-y-2 relative z-10"},oe={class:"w-5 h-5 flex items-center justify-center font-bold text-indigo-700 bg-white rounded-full text-xs shadow-sm"},ne={class:"flex-1 min-w-0"},re={class:"text-xs font-bold truncate group-hover:text-indigo-200 transition"},ie={class:"text-[10px] text-indigo-200/80"},de={class:"font-bold text-xs"},ue={class:"bg-gradient-to-br from-orange-500 to-red-600 rounded-xl p-4 text-white shadow-lg relative overflow-hidden"},ce={class:"space-y-2 relative z-10"},me={class:"w-5 h-5 flex items-center justify-center font-bold text-orange-700 bg-white rounded-full text-xs shadow-sm"},ge={class:"flex-1 min-w-0"},fe={class:"text-xs font-bold truncate group-hover:text-orange-200 transition"},ve={class:"font-bold text-xs bg-white/20 px-1.5 py-0.5 rounded"},pe={class:"mb-4 flex items-center justify-between"},xe={class:"text-xs text-gray-500"},he={key:0,class:"flex justify-center mt-8 gap-2"},be=["disabled"],ye={class:"px-4 py-2 text-gray-500 text-sm flex items-center"},_e=["disabled"],we={key:0,class:"flex-1 flex flex-col items-center justify-center min-h-[300px]"},ke={key:1,class:"overflow-hidden"},De={class:"flex-1 mb-4 border rounded overflow-hidden bg-gray-100 h-[300px]"},je=["srcdoc"],Ie={class:"grid grid-cols-2 gap-3 pt-2 mt-auto border-t"},Ce=["href"],Te={__name:"index",props:{filters:Object,sales:Object,summary:Object},setup(p){const l=p,y=u(l.filters.search||""),_=u(!1),w=u(!1),k=u(!1),f=u(""),C=u(null),T=u("-"),i=u("today"),F=[{id:"today",label:"Hari Ini"},{id:"week",label:"Minggu Ini"},{id:"month",label:"Bulan Ini"},{id:"all",label:"Semua Data"}],v=s=>{const e=new Date,a=o=>o.toISOString().split("T")[0];if(s==="today")return{min:a(e),max:a(e)};if(s==="week"){const o=new Date(e);return o.setDate(e.getDate()-6),{min:a(o),max:a(e)}}if(s==="month"){const o=new Date(e);return o.setDate(e.getDate()-29),{min:a(o),max:a(e)}}return{min:null,max:null}},M=s=>{i.value=s;const{min:e,max:a}=v(s);n.value.min_date=e,n.value.max_date=a,n.value.page=1},n=u({search:l.filters.search||"",sort:l.filters.sort||"transaction_date",order:l.filters.order||"desc",page:l.sales.current_page||1,min_date:l.filters.min_date||v("today").min,max_date:l.filters.max_date||v("today").max});(()=>{const{min_date:s,max_date:e}=l.filters;if(!s&&!e)return;const a=v("today"),o=v("week"),P=v("month");s===a.min&&e===a.max?i.value="today":s===o.min&&e===o.max?i.value="week":s===P.min&&e===P.max?i.value="month":i.value="all"})();const V=L.throttle(()=>{const s=Object.fromEntries(Object.entries(n.value).filter(([e,a])=>a!=null&&a!==""));H.get(route("sales.index"),s,{preserveState:!0,preserveScroll:!0,replace:!0,only:["sales","filters","summary"]})},300);$(n,V,{deep:!0}),$(y,s=>{n.value.search=s,n.value.page=1,s&&s.length>0&&(i.value="all",delete n.value.min_date,delete n.value.max_date)});const x=D(()=>{let s=[],e=[];return i.value==="today"?(s=l.summary.best_selling_revenue_today,e=l.summary.best_selling_qty_today):i.value==="week"?(s=l.summary.best_selling_revenue_week,e=l.summary.best_selling_qty_week):i.value==="month"&&(s=l.summary.best_selling_revenue_month,e=l.summary.best_selling_qty_month),{revenue:s,qty:e}}),O=async s=>{C.value=s.id,T.value=s.reference_no,w.value=!0,k.value=!0,f.value="";try{const e=await axios.get(`/sales/${s.id}/print`,{responseType:"text"});f.value=e.data}catch(e){console.error("Gagal load invoice:",e),f.value='<p class="text-center text-red-500 mt-10">Gagal memuat invoice.</p>'}finally{k.value=!1}},z=()=>{if(!f.value)return;const s=window.open("","","height=600,width=400");s.document.write("<html><head><title>Print</title><style>body { margin: 0; padding: 0; }</style></head><body>"),s.document.write(f.value),s.document.write("</body></html>"),s.document.close(),s.focus(),setTimeout(()=>{s.print(),s.close()},500)},R=D(()=>l.sales.data),m=D(()=>l.sales);return(s,e)=>(d(),c(b,null,[g(j(N),{title:"Riwayat Penjualan"}),g(J,{headerTitle:"Dashboard Penjualan"},{default:h(()=>[t("div",Y,[g(A,{summary:p.summary},null,8,["summary"]),t("div",Z,[t("div",ee,[(d(),c(b,null,I(F,a=>t("button",{key:a.id,onClick:o=>M(a.id),class:E(["px-4 py-2 text-sm font-bold rounded-lg transition-all whitespace-nowrap flex-1",i.value===a.id?"bg-white dark:bg-gray-700 text-blue-600 shadow-sm":"text-gray-500 hover:text-gray-700 dark:text-gray-400"])},r(a.label),11,te)),64))]),x.value.revenue?.length>0||x.value.qty?.length>0?(d(),c("div",se,[t("div",ae,[e[6]||(e[6]=t("div",{class:"flex items-center justify-between mb-3 relative z-10"},[t("div",{class:"flex items-center gap-2"},[t("div",{class:"p-1.5 bg-white/20 rounded-lg backdrop-blur-sm"},[t("span",{class:"text-sm"},"ðŸ’Ž")]),t("h3",{class:"font-bold text-base leading-tight"},"Top Omset")]),t("span",{class:"text-[10px] bg-white/20 px-2 py-0.5 rounded-full backdrop-blur-sm"},"Most Valuable")],-1)),t("div",le,[(d(!0),c(b,null,I(x.value.revenue,(a,o)=>(d(),S(j(B),{key:"rev-"+a.id,href:s.route("products.show",a.slug),class:"flex items-center gap-2 p-1.5 rounded-lg hover:bg-white/10 transition group"},{default:h(()=>[t("div",oe,r(o+1),1),t("div",ne,[t("p",re,r(a.name),1),t("p",ie,r(a.qty)+" items",1)]),t("div",de,r(new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(a.revenue)),1)]),_:2},1032,["href"]))),128))]),e[7]||(e[7]=t("div",{class:"absolute -right-6 -bottom-6 text-9xl opacity-5 pointer-events-none select-none"},"ðŸ’Ž",-1))]),t("div",ue,[e[8]||(e[8]=t("div",{class:"flex items-center justify-between mb-3 relative z-10"},[t("div",{class:"flex items-center gap-2"},[t("div",{class:"p-1.5 bg-white/20 rounded-lg backdrop-blur-sm"},[t("span",{class:"text-sm"},"ðŸ“¦")]),t("h3",{class:"font-bold text-base leading-tight"},"Terlaris (Qty)")]),t("span",{class:"text-[10px] bg-white/20 px-2 py-0.5 rounded-full backdrop-blur-sm"},"Most Popular")],-1)),t("div",ce,[(d(!0),c(b,null,I(x.value.qty,(a,o)=>(d(),S(j(B),{key:"qty-"+a.id,href:s.route("products.show",a.slug),class:"flex items-center gap-2 p-1.5 rounded-lg hover:bg-white/10 transition group"},{default:h(()=>[t("div",me,r(o+1),1),t("div",ge,[t("p",fe,r(a.name),1)]),t("div",ve,r(a.qty)+" items ",1)]),_:2},1032,["href"]))),128))]),e[9]||(e[9]=t("div",{class:"absolute -right-6 -bottom-6 text-9xl opacity-5 pointer-events-none select-none"},"ðŸ”¥",-1))])])):q("",!0),g(Q,{class:"w-full",filters:p.filters,modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=a=>y.value=a),onShowFilter:e[1]||(e[1]=a=>_.value=!0),filterCount:0,actions:[{route:s.route("sales.create"),buttonText:"+ Rekap Manual"}]},null,8,["filters","modelValue","actions"]),g(U,{show:_.value,onClose:e[2]||(e[2]=a=>_.value=!1),filters:p.filters},null,8,["show","filters"]),t("div",null,[t("div",pe,[e[10]||(e[10]=t("h2",{class:"text-lg font-bold text-gray-800 dark:text-white"}," Riwayat Transaksi ",-1)),t("span",xe," Total "+r(m.value.total)+" Data ",1)]),g(K,{sales:R.value,onPreviewInvoice:O},null,8,["sales"]),m.value.last_page>1?(d(),c("div",he,[t("button",G(m.value.links[0],{disabled:!m.value.prev_page_url,onClick:e[3]||(e[3]=a=>n.value.page--),class:"px-4 py-2 bg-white border rounded-lg disabled:opacity-50 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700"})," Prev ",16,be),t("span",ye," Hal "+r(m.value.current_page)+" / "+r(m.value.last_page),1),t("button",{disabled:!m.value.next_page_url,onClick:e[4]||(e[4]=a=>n.value.page++),class:"px-4 py-2 bg-white border rounded-lg disabled:opacity-50 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700"}," Next ",8,_e)])):q("",!0)])])])]),_:1}),g(W,{show:w.value,onClose:e[5]||(e[5]=a=>w.value=!1),title:"Preview Invoice #"+T.value},{default:h(()=>[k.value?(d(),c("div",we,[...e[11]||(e[11]=[t("svg",{class:"w-10 h-10 mb-3 text-blue-500 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})],-1),t("p",{class:"text-lime-500"},"Memuat Invoice...",-1)])])):(d(),c("div",ke,[t("div",De,[t("iframe",{srcdoc:f.value,class:"w-full h-full bg-white border-0",style:{display:"block"}},null,8,je)]),t("div",Ie,[t("a",{href:`/sales/${C.value}/print`,target:"_blank",class:"flex items-center justify-center gap-2 py-3 font-bold text-white transition bg-red-500 rounded-lg hover:bg-red-600"}," ðŸ“¥ Download PDF ",8,Ce),t("button",{onClick:z,class:"flex items-center justify-center gap-2 py-3 font-bold text-white transition bg-blue-600 rounded-lg hover:bg-blue-700"}," ðŸ–¨ Print Struk ")])]))]),_:1},8,["show","title"])],64))}},Je=X(Te,[["__scopeId","data-v-8de2d957"]]);export{Je as default};
