import{x as Y,y as x,u as W,J as X,z as Z,p as ee,_ as te,l as g,o as p,e as c,g as r,i as se,w as b,f as e,q as k,F as q,H as ae,t as n,K as re,A as S,m as E,B as oe,k as _,n as z,d as D,a0 as le,R as ie}from"./vendor-core-DNtFhSmw.js";import{_ as ne}from"./AuthenticatedLayout-BGPR84hi.js";import{u as de}from"./useActionLoading-5xNm3hIW.js";import{u as ue}from"./usePurchaseCart-F8GflAu0.js";import{P as R}from"./PrimaryButton-Bh5CQbrU.js";import{_ as pe}from"./SecondaryButton-AEAtjUlG.js";import ce from"./CatalogView-BrgPAX36.js";import me from"./PurchaseTable-BBJhScTR.js";import ge from"./recom-5uykTKoy.js";import"./vendor-common-pmZ7KOuE.js";import"./vendor-charts-Bw6UNgWf.js";import"./useSidebar-DWNS5Gp4.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DataTable-Zf20Q_p-.js";import"./BottomSheet-CdQ1fCHn.js";const fe={class:"w-full min-h-screen space-y-6"},be={class:"space-y-6"},ye={class:"flex flex-col w-full gap-4 md:flex-row"},ve={class:"flex flex-col gap-4 p-4 bg-gray-200 rounded-lg lg:w-1/2 dark:bg-customBg-tableDark"},he={class:"flex flex-col-reverse items-start gap-4 md:flex-row"},xe={class:"flex flex-col w-full gap-4"},ke={class:"grid grid-cols-1 gap-4 md:grid-cols-3"},_e={class:"md:col-span-2"},we=["disabled"],Se=["value"],Ie={class:"md:col-span-1"},je={class:"grid grid-cols-1 gap-4 md:grid-cols-3"},Be={class:"md:col-span-1"},Ce=["disabled"],Me={class:"md:col-span-2"},qe={class:"relative rounded-md shadow-sm"},Ee=["disabled"],ze={class:"flex-shrink-0 w-full md:w-32"},De={class:"relative w-full overflow-hidden bg-gray-100 border border-gray-300 rounded-lg aspect-square dark:bg-gray-700 dark:border-gray-600 group"},Re=["src"],Te={class:"flex flex-wrap justify-center gap-2 lg:justify-start"},Pe={class:"flex flex-col justify-between p-4 text-sm bg-gray-200 rounded-lg dark:bg-customBg-tableDark"},Ve={class:"text-base border-b-2 border-gray-400 text-semibold"},$e={class:"space-y-2"},Ae={class:"flex justify-between"},Ue={class:"grid grid-cols-3 gap-4 pt-2 border-t-2 border-gray-400"},He={class:"flex flex-col justify-between flex-1 w-full p-4 bg-gray-200 rounded-lg dark:bg-customBg-tableDark"},Ke={class:"flex justify-between"},Le={class:"text-lg font-bold"},Fe={class:"text-lg font-bold"},Ne={class:"mt-8 text-left"},Oe={class:"text-3xl font-extrabold"},Ge={class:"p-4 space-y-4 bg-white border border-gray-200 shadow-sm rounded-xl dark:bg-gray-800 dark:border-gray-700"},Je={class:"flex p-1 space-x-1 bg-gray-100 rounded-lg dark:bg-gray-700"},Qe={key:0,class:"ml-2 bg-lime-100 text-lime-700 py-0.5 px-2 rounded-full text-xs font-bold"},Ye=["disabled"],We={key:0},Xe={key:1},Ze={class:"min-h-[400px]"},T="inventra_draft_supplier_id",ft={__name:"create",props:{isEdit:{type:Boolean,default:!1},purchase:Object,dropdowns:Object},setup(y){const i=y;console.log(i.purchase);const d=Y(),{isActionLoading:I}=de(),m=x("table"),{cartItems:f,addToCart:P,updateCartItem:V,removeItem:$,clearCart:A,totalUnit:U,totalBelanja:H,totalMacam:K,addMultipleItems:L}=ue(i.isEdit,i.purchase),o=W({supplier_id:i.purchase?.supplier_id||"",transaction_date:i.purchase?.transaction_date||new Date().toISOString().split("T")[0],status:i.purchase?.status||"draft",notes:i.purchase?.notes||"",shipping_cost:i.purchase?.shipping_cost||0,other_costs:i.purchase?.other_costs||0}),w=x(!1);X(()=>{o.supplier_id}),Z(()=>{const s=localStorage.getItem(T);s&&!o.supplier_id&&(o.supplier_id=s)});const F=s=>{L(s),d.info(`${s.length} item rekomendasi ditambahkan ke keranjang.`)},v=x(!1),j={product_id:null,name:"",code:"",unit:"",size:"",category:"",brand:"",type:"",image_url:null,current_stock:0,quantity:1,purchase_price:0,restock_recommendation:0},a=x({...j}),B=ee({get:()=>a.value.purchase_price?h(a.value.purchase_price):0,set:s=>a.value.purchase_price=Q(s)}),C=()=>{a.value={...j},v.value=!1},N=s=>{M(s),m.value="catalog"},M=(s,t=1,u=null)=>{a.value={product_id:s.id||s.product_id,name:s.name,code:s.code,category:s.category?.name||s.category||"-",unit:s.unit?.name||s.unit||"-",size:s.size?.name||s.size||"-",brand:s.brand?.name||s.brand||"-",type:s.type_name||s.type_name||"-",image_url:s.image_url,current_stock:s.stock||s.current_stock,quantity:s.insights?.find(l=>l.type==="restock")?.payload?.suggested_qty||t,purchase_price:u!==null?u:s.purchase_price||0,restock_recommendation:s.insights?.find(l=>l.type==="restock")?.payload?.suggested_qty}},O=s=>{M(s,s.quantity,s.purchase_price),v.value=!0,m.value="table",window.scrollTo({top:0,behavior:"smooth"})},G=()=>{if(!a.value.product_id)return d.error("Mohon pilih produk dari katalog.");if(a.value.quantity<=0)return d.error("Kuantitas minimal harus 1.");console.log(i.purchase?.status),v.value&&i.purchase?.status==="draft"?(V({product_id:a.value.product_id,quantity:a.value.quantity,purchase_price:a.value.purchase_price}),d.success("Item diperbarui.")):(P(a.value,a.value.quantity,a.value.purchase_price,i.purchase?.status=="draft"),d.success("Item ditambahkan.")),C()},J=()=>{if(!o.supplier_id)return d.error("Pilih Supplier dulu!");if(f.value.length===0)return d.error("Keranjang kosong!");I.value=!0;const s=u=>({...u,items:f.value}),t={onSuccess:()=>{d.success(i.isEdit?"Transaksi berhasil diperbarui!":"Transaksi berhasil disimpan!"),i.isEdit||(A(),o.reset(),localStorage.removeItem(T))},onError:u=>{d.error("Gagal menyimpan. Periksa inputan merah."),console.error(u),d.error("Error : "+u[0])},onFinish:()=>{I.value=!1}};i.isEdit?(console.log(i.purchase),o.transform(s).put(route("purchases.update",i.purchase.id),t)):o.transform(s).post(route("purchases.store"),t)};function h(s){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(s)}function Q(s){return parseInt(String(s).replace(/[^0-9]/g,""))||0}return(s,t)=>{const u=te("InputError");return p(),g(q,null,[c(r(se),{title:"Rancangan Anggaran Belanja"}),c(ne,{headerTitle:"Rancangan Anggaran Belanja",showSidebar:!1},{default:b(()=>[c(ge,{show:w.value,supplierId:r(o).supplier_id,onClose:t[0]||(t[0]=l=>w.value=!1),onAddItems:F},null,8,["show","supplierId"]),e("div",fe,[e("div",be,[e("div",ye,[e("div",ve,[e("div",he,[e("div",xe,[e("div",ke,[e("div",_e,[t[9]||(t[9]=e("label",{class:"block mb-1 text-sm font-medium text-gray-700 dark:text-gray-300"},"Supplier",-1)),k(e("select",{disabled:y.isEdit,"onUpdate:modelValue":t[1]||(t[1]=l=>r(o).supplier_id=l),class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-lime-500 focus:border-lime-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white sm:text-sm"},[t[8]||(t[8]=e("option",{value:""}," Pilih Supplier ",-1)),(p(!0),g(q,null,ae(y.dropdowns.suppliers,l=>(p(),g("option",{key:l.id,value:l.id},n(l.name),9,Se))),128))],8,we),[[re,r(o).supplier_id]]),c(u,{message:r(o).errors.supplier_id,class:"mt-1"},null,8,["message"])]),e("div",Ie,[t[10]||(t[10]=e("label",{class:"block mb-1 text-sm font-medium text-gray-700 dark:text-gray-300"},"Tanggal",-1)),k(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>r(o).transaction_date=l),type:"date",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-lime-500 focus:border-lime-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white sm:text-sm"},null,512),[[S,r(o).transaction_date]]),c(u,{message:r(o).errors.transaction_date,class:"mt-1"},null,8,["message"])])]),e("div",je,[e("div",Be,[t[11]||(t[11]=e("label",{class:"block mb-1 text-sm font-medium text-gray-700 dark:text-gray-300"},"Qty",-1)),k(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>a.value.quantity=l),type:"number",min:"1",placeholder:"0",disabled:!a.value.product_id,class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-lime-500 focus:border-lime-500 disabled:bg-gray-100 disabled:text-gray-400 dark:bg-gray-700 dark:border-gray-600 dark:text-white sm:text-sm"},null,8,Ce),[[S,a.value.quantity,void 0,{number:!0}]])]),e("div",Me,[t[13]||(t[13]=e("label",{class:"block mb-1 text-sm font-medium text-gray-700 dark:text-gray-300"},"Harga Beli",-1)),e("div",qe,[t[12]||(t[12]=e("div",{class:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"},[e("span",{class:"text-gray-500 sm:text-sm"},"Rp")],-1)),k(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>B.value=l),type:"text",placeholder:"0",disabled:!a.value.product_id,class:"w-full px-3 py-2 pl-10 font-mono text-right border border-gray-300 rounded-md shadow-sm focus:ring-lime-500 focus:border-lime-500 disabled:bg-gray-100 disabled:text-gray-400 dark:bg-gray-700 dark:border-gray-600 dark:text-white sm:text-sm"},null,8,Ee),[[S,B.value]])])])])]),e("div",ze,[t[15]||(t[15]=e("label",{class:"block mb-1 text-sm font-medium text-center text-gray-700 dark:text-gray-300 md:text-left"}," Preview ",-1)),e("div",De,[t[14]||(t[14]=e("div",{class:"absolute inset-0 z-0 flex flex-col items-center justify-center w-full h-full transition-colors duration-300"},[e("svg",{class:"w-10 h-10 mb-1 text-gray-400 dark:text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})]),e("span",{class:"text-[10px] font-bold text-gray-400 dark:text-gray-500 tracking-wider"}," NO IMG ")],-1)),a.value.image_url?(p(),g("img",{key:0,src:a.value.image_url,alt:"Preview",loading:"lazy",class:"absolute inset-0 z-10 object-cover w-full h-full transition-opacity duration-300 opacity-0",onload:"this.classList.remove('opacity-0')",onerror:"this.style.display='none'"},null,8,Re)):E("",!0)])])]),e("div",Te,[c(r(oe),{href:s.route("purchases.index")},{default:b(()=>[c(pe,{type:"button"},{default:b(()=>[...t[16]||(t[16]=[_(" Kembali ",-1)])]),_:1})]),_:1},8,["href"]),c(R,{type:"button",onClick:G,disabled:!a.value.product_id},{default:b(()=>[_(n(v.value?"Update Item":"Tambah Item"),1)]),_:1},8,["disabled"]),e("button",{onClick:C,type:"button",class:"inline-flex items-center px-4 py-2 text-xs font-semibold tracking-widest text-white uppercase transition duration-150 ease-in-out bg-red-500 border border-transparent rounded-md hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2"}," Reset "),c(R,{type:"button",onClick:J,disabled:r(o).processing||r(f).length===0},{default:b(()=>[_(n(r(o).processing?"Menyimpan...":"Simpan"),1)]),_:1},8,["disabled"]),e("button",{onClick:t[5]||(t[5]=l=>w.value=!0),type:"button",class:"inline-flex items-center px-4 py-2 text-xs font-semibold tracking-widest text-white uppercase transition duration-150 ease-in-out bg-yellow-500 border border-transparent rounded-md hover:bg-yellow-600 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:ring-offset-2"}," Rekomendasi ")])]),e("div",Pe,[e("div",Ve,n(a.value.name?a.value.name+" ( "+a.value.code+" )":"Belum ada barang dipilih"),1),e("div",$e,[t[17]||(t[17]=e("div",{class:"flex justify-between"},[e("strong",null,"Kategori"),e("strong",null,"Satuan"),e("strong",null,"Ukuran")],-1)),e("div",Ae,[e("span",null,n(a.value.category||"-"),1),e("span",null,n(a.value.unit||"-"),1),e("span",null,n(a.value.size||"-"),1)])]),e("div",Ue,[e("div",null,[t[18]||(t[18]=e("p",{class:"font-semibold"},"Sisa Stok",-1)),e("p",null,n(a.value.current_stock||"0"),1)]),e("div",null,[t[19]||(t[19]=e("p",{class:"font-semibold"},"Rekom Restok",-1)),e("p",null,n(a.value.restock_recommendation||"0"),1)]),e("div",null,[t[20]||(t[20]=e("p",{class:"font-semibold"},"Stok Masuk",-1)),e("p",null,n(a.value.quantity||"0"),1)]),e("div",null,[t[21]||(t[21]=e("p",{class:"font-semibold"},"Total Stok",-1)),e("p",null,n((a.value.current_stock||0)+(a.value.quantity||0)),1)]),e("div",null,[t[22]||(t[22]=e("p",{class:"font-semibold"},"Harga Beli",-1)),e("p",null,n(h(a.value.purchase_price||0)),1)]),e("div",null,[t[23]||(t[23]=e("p",{class:"font-semibold"},"Total",-1)),e("p",null,n(h((a.value.quantity||0)*(a.value.purchase_price||0))),1)])])]),e("div",He,[e("div",Ke,[e("p",Le,n(r(U))+" Unit ",1),e("p",Fe,n(r(K))+" Macam ",1)]),e("div",Ne,[t[24]||(t[24]=e("p",{class:"text-gray-500 uppercase dark:text-gray-400"}," Total Belanja ",-1)),e("p",Oe,n(h(r(H))),1)])])])]),e("div",Ge,[e("div",Je,[e("button",{type:"button",onClick:t[6]||(t[6]=l=>m.value="table"),class:z(["flex items-center justify-center w-1/2 py-2.5 text-sm font-medium rounded-md transition-all duration-200 focus:outline-none",m.value==="table"?"bg-white text-gray-900 shadow dark:bg-gray-600 dark:text-white":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"])},[t[25]||(t[25]=e("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})],-1)),t[26]||(t[26]=_(" Daftar Belanja ",-1)),r(f).length>0?(p(),g("span",Qe,n(r(f).length),1)):E("",!0)],2),e("button",{type:"button",onClick:t[7]||(t[7]=l=>m.value="catalog"),disabled:!r(o).supplier_id,class:z(["flex items-center justify-center w-1/2 py-2.5 text-sm font-medium rounded-md transition-all duration-200 focus:outline-none",[m.value==="catalog"?"bg-white text-gray-900 shadow dark:bg-gray-600 dark:text-white":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",r(o).supplier_id?"":"opacity-50 cursor-not-allowed"]])},[t[27]||(t[27]=e("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})],-1)),r(o).supplier_id?(p(),g("span",Xe,"Katalog Produk")):(p(),g("span",We,"Pilih Supplier Dulu"))],10,Ye)]),e("div",Ze,[(p(),D(le,null,[(p(),D(ie(m.value==="table"?me:ce),{"supplier-id":r(o).supplier_id,items:r(f),isDraft:y.purchase?.status=="draft",onRemove:r($),onEdit:O,onSelectProduct:N},null,40,["supplier-id","items","isDraft","onRemove"]))],1024))])])])]),_:1})],64)}}};export{ft as default};
