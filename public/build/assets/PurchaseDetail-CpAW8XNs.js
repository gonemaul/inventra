import{_ as j}from"./AuthenticatedLayout-DqzYp9rK.js";import{s as r,G as D,j as I,g as d,o as m,a as t,d as b,h as E,w as i,b as o,i as w,l as N,f,t as B,n as P,F as V,q}from"./app-C_cXePOB.js";import{_ as F}from"./Tabs-DI-2IaJh.js";import{P as C}from"./PrimaryButton-D5q8Vryj.js";import{_ as z}from"./DeleteConfirm-4y6wL8wG.js";import R from"./FinalizeModal-DAJnX39H.js";import H from"./InvoiceForm-CCR0T2Xq.js";import O from"./invoiceTable-BmPItlSP.js";import T from"./productTable-BdusyyUi.js";import A from"./HeaderDetail-CBmpNrUO.js";import"./useActionLoading-Bvh_DZn-.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Modal-DR4Qf9lZ.js";import"./SecondaryButton-ClbDvNQj.js";import"./InputLabel-DZfIyXla.js";import"./TextInput-PROtXgwY.js";import"./InputError-BQi_HPBB.js";import"./DataTable-DQP4LpPT.js";import"./ImageModal-DbaHFI2H.js";import"./InfoCard-WCdMJXbR.js";const G={class:"flex items-center gap-2 mb-3 text-sm text-gray-500 dark:text-gray-300"},K={key:0,class:"flex justify-end mt-4"},J={class:"w-full mt-4 space-y-6"},L={key:0,class:"flex justify-end mb-4"},pe={__name:"PurchaseDetail",props:{purchase:Object,invoices:Object,invoice:Object,paymentStatuses:Array,isCheckingMode:Boolean},setup(s){const n=s,p=r(null),l=r(!1),u=r(null),c=r(!1);D(()=>{n.purchase.status==="diterima"&&!n.invoice.id&&k()});const _=r(n.purchase.items.map(a=>({...a,rejected_quantity:a.rejected_quantity||0,is_valid:a.quantity-(a.rejected_quantity||0)>0}))),v=I(()=>n.purchase.invoices.length>0&&n.purchase.status==="checking"),h=I(()=>["diterima","checking"].includes(n.purchase.status)),M=()=>{c.value=!0},k=()=>{u.value=null,l.value=!0},$=a=>{u.value=a,l.value=!0},x=a=>{const e={title:"Hapus Nota Keuangan",message:`Hapus Nota No. ${a.invoice_number}? Ini akan menghapus file foto dan mengembalikan status transaksi ke RECEIVED jika tidak ada nota lain.`,itemName:a.invoice_number,url:route("purchases.destroyInvoice",{purchase:n.purchase.id,invoice:a.id})};p.value.open(e)},y=()=>{l.value=!1,q.reload({only:["purchase","invoice","flash"],preserveScroll:!0})},S=[{key:"invoices",label:"Invoice & Pembayaran"},{key:"products",label:"Validasi Item"}];return(a,e)=>(m(),d(V,null,[t(b(E),{title:`Pembelian - ${s.purchase.reference_no}`},null,8,["title"]),t(z,{ref_key:"deleteModalRef",ref:p,onSuccess:y},null,512),t(R,{show:c.value,purchase:s.purchase,onClose:e[0]||(e[0]=g=>c.value=!1)},null,8,["show","purchase"]),t(j,{showSidebar:!1,showHeader:!1},{default:i(()=>[o("div",G,[t(b(N),{href:a.route("purchases.index"),class:"flex items-center transition hover:text-indigo-600"},{default:i(()=>[...e[3]||(e[3]=[o("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),f(" Riwayat ",-1)])]),_:1},8,["href"]),e[4]||(e[4]=o("span",null,"/",-1)),o("span",null,"Detail Pembelian # "+B(s.purchase.reference_no),1)]),t(A,{data:n.purchase,mode:a.type},null,8,["data","mode"]),t(H,{show:l.value,purchaseId:s.purchase.id,editingInvoice:u.value,paymentStatuses:s.paymentStatuses,onClose:e[1]||(e[1]=g=>l.value=!1),onInvoiceSaved:y},null,8,["show","purchaseId","editingInvoice","paymentStatuses"]),s.purchase.status==="checking"?(m(),d("div",K,[t(C,{disable:!v.value,onClick:M,class:P({"opacity-50 cursor-not-allowed":!v.value})},{default:i(()=>[...e[5]||(e[5]=[f(" Selesaikan & Masukkan Stok (Completed) ",-1)])]),_:1},8,["disable","class"])])):w("",!0),o("div",J,[t(F,{tabs:S,defaultTab:"invoices"},{invoices:i(()=>[h.value?(m(),d("div",L,[t(C,{onClick:k},{default:i(()=>[...e[6]||(e[6]=[f(" + Tambah Nota Baru ",-1)])]),_:1})])):w("",!0),t(O,{purchase:s.purchase,isCheckingMode:s.isCheckingMode,canEditDelete:h.value,onEditInvoice:$,onDeleteInvoice:e[2]||(e[2]=g=>x(s.invoice))},null,8,["purchase","isCheckingMode","canEditDelete"])]),products:i(()=>[t(T,{items:_.value},null,8,["items"])]),_:1})])]),_:1})],64))}};export{pe as default};
