import{G as O,E as w,L as j,H as A,p as D,u as L,l as n,o as i,e as F,g as a,i as U,w as $,f as t,k as P,q as h,X as T,I as k,n as N,F as C,C as V,t as m,m as S}from"./vendor-core-DyO1rNNh.js";import{_ as z}from"./AuthenticatedLayout-CgIIrXq6.js";import{_ as E}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vendor-common-pmZ7KOuE.js";import"./vendor-charts-Bw6UNgWf.js";import"./useSidebar-s_QNBP3G.js";import"./useActionLoading-b0yNxruX.js";function B(v){const d=O(),g="POS_RECAP_DRAFT_V2",c=w(""),u=w("all"),s=w([]),p=w(new Date().toISOString().slice(0,10));j(()=>{const e=localStorage.getItem(g);if(e)try{const r=JSON.parse(e);s.value=r.cart||[],p.value=r.date||new Date().toISOString().slice(0,10)}catch{localStorage.removeItem(g)}}),A([s,p],()=>{localStorage.setItem(g,JSON.stringify({cart:s.value,date:p.value}))},{deep:!0});const x=e=>{if(e.stock<=0){d.error(`Stok ${e.name} Habis!`);return}const r=s.value.find(l=>l.id===e.id);r?r.quantity<e.stock?r.quantity++:d.warning(`Stok maksimal tercapai (${e.stock})`):s.value.push({id:e.id,name:e.name,code:e.code,image:e.image_path,selling_price:e.selling_price,purchase_price:e.purchase_price,stock:e.stock,quantity:1})},I=e=>{s.value.splice(e,1)},R=()=>{confirm("Hapus semua data rekap?")&&(s.value=[],localStorage.removeItem(g))},_=D(()=>{let e=v.products||[];if(u.value!=="all"&&(e=e.filter(r=>r.category_id===u.value)),c.value){const r=c.value.toLowerCase();e=e.filter(l=>l.name.toLowerCase().includes(r)||l.code&&l.code.toLowerCase().includes(r))}return e}),b=D(()=>s.value.reduce((e,r)=>e+r.selling_price*r.quantity,0)),f=D(()=>s.value.reduce((e,r)=>{const l=r.selling_price-r.purchase_price;return e+l*r.quantity},0)),o=L({input_type:"recap",transaction_date:null,items:[],total_revenue:0,total_profit:0,payment_method:"cash",payment_amount:0,change_amount:0,customer_id:null,notes:""});return{searchQuery:c,selectedCategory:u,cart:s,transactionDate:p,form:o,filteredProducts:_,totalRevenue:b,totalProfit:f,addToCart:x,removeItem:I,clearCart:R,processRecap:()=>{if(s.value.length===0)return d.error("Data masih kosong!");if(!p.value)return d.error("Pilih tanggal rekap!");if(s.value.some(r=>r.quantity<=0))return d.error("Ada produk dengan jumlah 0!");o.transaction_date=p.value,o.items=s.value.map(r=>({product_id:r.id,quantity:r.quantity,selling_price:r.selling_price,purchase_price:r.purchase_price})),o.total_revenue=parseFloat(b.value),o.total_profit=parseFloat(f.value),o.payment_amount=parseFloat(b.value),o.change_amount=0,o.post(route("sales.pos.store"),{onSuccess:()=>{s.value=[],localStorage.removeItem(g),d.success("Rekap Berhasil Disimpan!")},onError:r=>{console.error(r),d.error("Gagal menyimpan rekap.")}})}}}const H={class:"flex flex-col w-full gap-4 lg:h-[85vh] h-[100vh] overflow-hidden lg:flex-row"},Q={class:"w-full lg:w-[40%] flex flex-col bg-white dark:bg-gray-800 rounded-2xl shadow-md border border-gray-300 dark:border-gray-700 overflow-hidden h-1/2 lg:h-full"},M={class:"z-10 p-3 space-y-3 bg-white border-b border-gray-100 dark:border-gray-700 shrink-0 dark:bg-gray-800"},G={class:"flex items-center justify-between"},J={class:"relative w-1/2"},K={class:"flex gap-2 pb-1 overflow-x-auto custom-scroll-x"},X=["onClick"],Y={class:"flex-1 p-3 overflow-y-auto custom-scroll bg-gray-50 dark:bg-gray-900/50"},W={key:0,class:"flex flex-col items-center justify-center h-40 text-sm text-gray-400"},Z={class:"grid grid-cols-2 gap-2 xl:grid-cols-3"},ee=["onClick"],te={class:"h-8 mb-1 text-xs font-bold leading-tight text-gray-700 dark:text-gray-200 line-clamp-2"},re={class:"flex items-end justify-between"},ae={class:"text-[10px] text-gray-400"},se={class:"text-xs font-black text-lime-600 dark:text-lime-400"},oe={class:"w-full lg:w-[60%] flex flex-col bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden h-1/2 lg:h-full relative"},le={class:"z-20 flex items-center justify-between p-3 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 shrink-0"},ne={class:"flex items-center gap-3"},ie={class:"flex items-center px-2 py-1 bg-white border border-gray-300 rounded-lg shadow-sm dark:bg-gray-700 dark:border-gray-600"},de={class:"relative flex-1 min-h-0 overflow-auto bg-white custom-scroll custom-scroll-x dark:bg-gray-800"},ge={class:"w-full text-left border-collapse"},ce={class:"text-sm divide-y divide-gray-100 dark:divide-gray-700"},ue={key:0},pe={class:"p-3 align-middle"},ye={class:"text-xs font-bold text-gray-800 dark:text-gray-200 sm:text-sm line-clamp-2"},me={class:"text-[10px] text-gray-400"},xe={class:"p-3 align-middle"},be=["onUpdate:modelValue"],fe={class:"p-3 text-right align-middle"},he=["onUpdate:modelValue"],ke={class:"p-3 text-xs font-bold text-right align-middle text-lime-600 dark:text-lime-400 sm:text-sm"},ve={class:"p-3 text-center align-middle"},_e=["onClick"],we={class:"items-center justify-between gap-4 p-4 border-t border-gray-200 lg:flex dark:border-gray-700 bg-gray-50 dark:bg-gray-900 shrink-0"},Ce={class:"mt-1 text-xl font-black leading-none text-gray-900 lg:text-2xl dark:text-white"},Se={class:"flex items-center gap-3 mt-2 lg:mt-0"},Ie={class:"w-full sm:flex-1"},Re={class:"relative"},qe=["disabled"],De={key:0,class:"w-4 h-4 border-2 border-white rounded-full animate-spin border-t-transparent"},Ve={__name:"form",props:{products:Array,categories:Array},setup(v){const d=v,{searchQuery:g,selectedCategory:c,cart:u,filteredProducts:s,totalRevenue:p,form:x,addToCart:I,removeItem:R,processRecap:_,clearCart:b,transactionDate:f}=B(d),o=q=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(q);return(q,e)=>(i(),n(C,null,[F(a(U),{title:"Input Rekap"}),F(z,null,{default:$(()=>[t("div",H,[t("div",Q,[t("div",M,[t("div",G,[e[9]||(e[9]=t("h2",{class:"flex items-center gap-2 text-lg font-bold text-gray-800 dark:text-white"},[t("span",{class:"text-lime-500"},"ðŸ“¦"),P(" Katalog ")],-1)),t("div",J,[h(t("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>T(g)?g.value=r:null),type:"text",placeholder:"Cari...",class:"w-full pl-8 pr-3 py-1.5 bg-gray-100 dark:bg-gray-900 border border-gray-200 rounded-lg text-sm focus:ring-1 focus:ring-lime-500"},null,512),[[k,a(g)]]),e[8]||(e[8]=t("span",{class:"absolute left-2.5 top-2 text-gray-400 text-xs"},"ðŸ”",-1))])]),t("div",K,[t("button",{onClick:e[1]||(e[1]=r=>c.value="all"),class:N([a(c)==="all"?"bg-lime-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300","px-3 py-1 rounded-md text-[11px] font-bold whitespace-nowrap transition-all"])}," Semua ",2),(i(!0),n(C,null,V(v.categories,r=>(i(),n("button",{key:r.id,onClick:l=>c.value=r.id,class:N([a(c)===r.id?"bg-lime-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300","px-3 py-1 rounded-md text-[11px] font-bold whitespace-nowrap transition-all"])},m(r.name),11,X))),128))])]),t("div",Y,[a(s).length===0?(i(),n("div",W,[...e[10]||(e[10]=[t("span",null,"Produk tidak ditemukan",-1)])])):S("",!0),t("div",Z,[(i(!0),n(C,null,V(a(s),r=>(i(),n("div",{key:r.id,onClick:l=>a(I)(r),class:"relative p-2 transition-all bg-white border border-gray-200 cursor-pointer dark:bg-gray-800 rounded-xl dark:border-gray-700 hover:border-lime-500 hover:shadow-md active:scale-95 group"},[t("div",te,m(r.name),1),t("div",re,[t("div",ae," Stok: "+m(r.stock),1),t("div",se,m(o(r.selling_price)),1)])],8,ee))),128))])])]),t("div",oe,[t("div",le,[t("div",ne,[e[12]||(e[12]=t("h3",{class:"hidden font-bold text-gray-800 dark:text-white sm:block"}," ðŸ“ Rekap ",-1)),t("div",ie,[e[11]||(e[11]=t("label",{class:"text-[10px] font-bold text-gray-500 dark:text-gray-300 uppercase mr-2"},"Tgl:",-1)),h(t("input",{type:"date","onUpdate:modelValue":e[2]||(e[2]=r=>T(f)?f.value=r:null),class:"h-5 p-0 text-sm font-bold text-gray-800 bg-transparent border-none cursor-pointer dark:text-white focus:ring-0"},null,512),[[k,a(f)]])])]),a(u).length?(i(),n("button",{key:0,onClick:e[3]||(e[3]=(...r)=>a(b)&&a(b)(...r)),class:"px-2 py-1 text-xs font-bold text-red-500 transition rounded hover:bg-red-50"}," Reset ")):S("",!0)]),t("div",de,[t("table",ge,[e[14]||(e[14]=t("thead",{class:"sticky top-0 z-10 bg-gray-100 dark:bg-gray-900 text-[10px] uppercase font-bold text-gray-500 dark:text-gray-400 tracking-wider shadow-sm"},[t("tr",null,[t("th",{class:"p-3 bg-gray-100 min-w-48 lg:min-w-1/2 dark:bg-gray-900"}," Produk "),t("th",{class:"w-20 p-3 text-center bg-gray-100 dark:bg-gray-900"}," Qty "),t("th",{class:"p-3 text-right bg-gray-100 w-28 dark:bg-gray-900"}," Harga "),t("th",{class:"p-3 text-right bg-gray-100 w-28 dark:bg-gray-900"}," Subtotal "),t("th",{class:"w-8 p-3 text-center bg-gray-100 dark:bg-gray-900"})])],-1)),t("tbody",ce,[a(u).length===0?(i(),n("tr",ue,[...e[13]||(e[13]=[t("td",{colspan:"5",class:"p-10 text-center text-gray-400"},[t("div",{class:"mb-2 text-4xl opacity-30"}," ðŸ“¥ "),P(" Pilih produk di katalog sebelah kiri. ")],-1)])])):S("",!0),(i(!0),n(C,null,V(a(u),(r,l)=>(i(),n("tr",{key:l,class:"transition group hover:bg-lime-50 dark:hover:bg-gray-700/50"},[t("td",pe,[t("div",ye,m(r.name),1),t("div",me,m(r.code),1)]),t("td",xe,[h(t("input",{type:"number","onUpdate:modelValue":y=>r.quantity=y,min:"1",class:"w-16 py-1 text-sm font-bold text-center text-gray-800 border border-gray-200 rounded-lg dark:text-white bg-gray-50 dark:bg-gray-900 dark:border-gray-600 focus:ring-lime-500 focus:border-lime-500",onFocus:e[4]||(e[4]=y=>y.target.select())},null,40,be),[[k,r.quantity]])]),t("td",fe,[h(t("input",{type:"number","onUpdate:modelValue":y=>r.selling_price=y,class:"w-24 p-0 text-sm font-medium text-right text-gray-600 bg-transparent border-b border-gray-300 border-dashed border-none dark:text-gray-300 focus:ring-0 hover:border-gray-400",onFocus:e[5]||(e[5]=y=>y.target.select())},null,40,he),[[k,r.selling_price]])]),t("td",ke,m(o(r.quantity*r.selling_price)),1),t("td",ve,[t("button",{onClick:y=>a(R)(l),class:"p-1 text-gray-300 hover:text-red-500"}," âœ• ",8,_e)])]))),128))])])]),t("div",we,[t("div",null,[e[15]||(e[15]=t("span",{class:"text-[10px] font-bold text-gray-500 uppercase"},"Total Omzet",-1)),t("div",Ce,m(o(a(p))),1)]),t("div",Se,[t("div",Ie,[t("div",Re,[h(t("input",{type:"text","onUpdate:modelValue":e[6]||(e[6]=r=>a(x).notes=r),placeholder:"Tambahkan Catatan Transaksi (Opsional)...",class:"w-full pl-9 pr-4 py-2.5 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl text-sm text-gray-800 dark:text-white placeholder-gray-400 focus:ring-2 focus:ring-lime-500 focus:border-transparent transition-all shadow-inner"},null,512),[[k,a(x).notes]]),e[16]||(e[16]=t("span",{class:"absolute text-gray-400 left-3 top-3"},[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})])],-1))])]),t("button",{onClick:e[7]||(e[7]=(...r)=>a(_)&&a(_)(...r)),disabled:!a(u).length||a(x).processing,class:"flex items-center gap-2 px-4 py-2 font-bold text-white transition shadow-lg lg:px-6 lg:py-3 bg-lime-500 hover:bg-lime-600 rounded-xl shadow-lime-500/30 disabled:opacity-50 active:scale-95"},[a(x).processing?(i(),n("span",De)):S("",!0),e[17]||(e[17]=t("span",null,"SIMPAN",-1))],8,qe)])])])])]),_:1})],64))}},Le=E(Ve,[["__scopeId","data-v-c1af717a"]]);export{Le as default};
