import{x as y,C as T,H as U,g,o as n,b as e,i as m,p as $,n as f,j as S,a as B,c as _,t as l,f as N,w as j,k as V,A as z}from"./app-XPyOtybP.js";import{B as O}from"./BottomSheet-sV61yNof.js";import{H as Q}from"./html5-qrcode-scanner-CqavF4mz.js";import E from"./UnlinkMobile-ii_9QanN.js";import D from"./LinkedMobile-CKb8Puuj.js";import K from"./SearchMobile-B7edaOi5.js";import G from"./HeaderMobile-KK-wh72x.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";const W={class:"fixed inset-0 z-[9999] bg-black flex flex-col justify-center"},X={key:0,class:"absolute inset-0 flex items-center justify-center bg-black z-[10000]"},Y={class:"absolute z-10 bottom-4 right-4"},Z={class:"absolute top-0 left-0 right-0 p-6 flex justify-between items-start z-[10001]"},ee={__name:"BarcodeScanner",emits:["result","close"],setup(d,{emit:p}){const v=p;let i=null;const c=y(!1),b=y(!1),x=async()=>{const u="global-reader";try{i=new Q(u);const s={fps:10,qrbox:{width:250,height:250},aspectRatio:1,disableFlip:!1},w={facingMode:"environment",focusMode:"continuous",width:{min:640,ideal:1920},height:{min:480,ideal:1080}};await i.start({facingMode:"environment"},{...s,videoConstraints:w},r,h),c.value=!0}catch(s){console.error("Error starting scanner:",s),alert("Gagal mengakses kamera. Pastikan izin diberikan."),v("close")}},r=(u,s)=>{k().then(()=>{v("result",u)})},h=u=>{},k=async()=>{if(i)try{i.isScanning&&await i.stop(),i.clear()}catch(u){console.error("Failed to stop scanner",u)}i=null,c.value=!1},C=()=>{const u=!b.value;i.applyVideoConstraints({advanced:[{torch:u}]}).then(()=>{b.value=u}).catch(s=>{console.error("Fitur Flash tidak didukung di device ini",s),alert("Flash tidak didukung di perangkat/browser ini.")})};return T(()=>{x()}),U(()=>{k()}),(u,s)=>(n(),g("div",W,[s[5]||(s[5]=e("div",{id:"global-reader",class:"w-full h-full bg-black"},null,-1)),c.value?m("",!0):(n(),g("div",X,[...s[1]||(s[1]=[$('<div class="text-center"><svg class="w-10 h-10 mx-auto mb-2 animate-spin text-lime-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg><p class="text-sm font-medium text-white">Membuka Kamera...</p></div>',1)])])),e("div",Y,[e("button",{onClick:C,class:f(["p-3 transition-colors rounded-full shadow-lg",b.value?"bg-yellow-400 text-black":"bg-white text-gray-800"])},[...s[2]||(s[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"})],-1)])],2)]),e("div",Z,[s[4]||(s[4]=e("div",{class:"px-4 py-2 text-sm font-medium text-white border rounded-full bg-black/50 backdrop-blur-sm border-white/20"}," Arahkan ke Barcode ",-1)),e("button",{onClick:s[0]||(s[0]=w=>u.$emit("close")),class:"flex items-center justify-center w-10 h-10 text-white transition rounded-full bg-white/20 backdrop-blur-md hover:bg-white/40"},[...s[3]||(s[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),s[6]||(s[6]=$('<div class="absolute inset-0 flex items-center justify-center pointer-events-none z-[10000]"><div class="relative w-64 h-64 border-2 border-lime-500/50 rounded-2xl"><div class="absolute top-0 left-0 w-5 h-5 border-t-4 border-l-4 border-lime-500 -mt-0.5 -ml-0.5 rounded-tl-lg"></div><div class="absolute top-0 right-0 w-5 h-5 border-t-4 border-r-4 border-lime-500 -mt-0.5 -mr-0.5 rounded-tr-lg"></div><div class="absolute bottom-0 left-0 w-5 h-5 border-b-4 border-l-4 border-lime-500 -mb-0.5 -ml-0.5 rounded-bl-lg"></div><div class="absolute bottom-0 right-0 w-5 h-5 border-b-4 border-r-4 border-lime-500 -mb-0.5 -mr-0.5 rounded-br-lg"></div><div class="absolute top-1/2 left-4 right-4 h-0.5 bg-red-500 shadow-[0_0_15px_rgba(239,68,68,0.8)] animate-scan"></div></div></div>',1))]))}},te={class:"relative min-h-screen font-sans bg-gray-50 dark:bg-gray-950 pb-28"},ae={class:"px-4 py-3 sticky top-[108px] z-20 bg-gray-50/95 dark:bg-gray-950/95 backdrop-blur-sm"},re={class:"flex p-1 bg-gray-200 rounded-lg dark:bg-gray-800"},oe={class:"px-4 space-y-3"},se={key:2,class:"fixed z-30 w-full max-w-xs px-4 -translate-x-1/2 bottom-6 left-1/2"},le={class:"flex gap-3"},ne={class:"space-y-5"},ie={class:"flex gap-4"},de={class:"flex items-center justify-center font-bold text-gray-400 bg-gray-100 border border-gray-200 rounded-lg w-14 h-14 dark:bg-gray-800 dark:border-gray-700 shrink-0"},ue={class:"flex-1"},ce={class:"text-lg font-bold leading-tight text-gray-800 dark:text-white"},pe={class:"text-xs text-gray-500"},ge={class:"p-1 border border-gray-200 bg-gray-50 dark:bg-gray-800/50 rounded-xl dark:border-gray-700"},ve={class:"grid items-center grid-cols-2 mb-4"},be={class:"text-center border-r border-gray-200 dark:border-gray-700"},me={key:0,class:"text-xl font-bold text-gray-400"},ye={key:1,class:"text-xl font-bold text-gray-300"},xe={class:"text-[10px] text-gray-400 block uppercase"},fe={class:"space-y-2 max-w-[75%]"},he={class:"flex items-center"},ke={class:"grid items-center grid-cols-2 pb-2"},we={class:"px-1 text-center border-r border-gray-200 dark:border-gray-700"},_e={key:0,class:"text-sm font-medium text-gray-500 dark:text-gray-400"},Ce={key:1,class:"text-sm font-medium text-gray-300"},qe={class:"space-y-2 max-w-[75%]"},Se={class:"relative"},Me={class:"text-[10px] text-right text-gray-400"},Ie={class:"flex items-center justify-between p-4 border border-gray-100 bg-gray-50 dark:bg-gray-800 rounded-xl dark:border-gray-700"},$e={class:"text-xs text-gray-500 mt-0.5"},Be={class:"flex-1 max-w-[180px]"},je={class:"relative"},Ve=["value"],ze={key:0,class:"text-[10px] text-gray-400 text-center italic"},Pe={class:"flex gap-3"},Ae={__name:"MobileChecking",props:{invoice:Object,unlinkedItems:Array,linkedItems:Array,products:Array,actions:Object},setup(d){const p=d,v=y("unlinked"),i=y(!1),c=y(!1),b=y(!1),x=y(""),r=y({type:"",id:null,product_id:null,name:"",code:"",unit:"",is_po_match:!1,po_qty:0,po_price:0,quantity:0,price:0,total:0}),h=a=>{r.value={type:"link",id:a.id,product_id:a.product_id,name:a.product_snapshot?.name,code:a.product_snapshot?.code,unit:a.product_snapshot.unit,is_po_match:!0,po_qty:a.product_snapshot.quantity,po_price:a.product_snapshot.purchase_price,quantity:a.quantity,price:a.purchase_price,total:a.subtotal,image_url:a.product.image_url},c.value=!0},k=a=>{const t=p.unlinkedItems.find(o=>o.product_id===a.id);t?h(t):(console.log(a),r.value={type:"create",id:null,product_id:a.id,name:a.name,code:a.code,unit:a.unit?.name||"Pcs",is_po_match:!1,po_qty:0,po_price:0,quantity:1,price:a.purchase_price,total:a.purchase_price},c.value=!0),b.value=!1,x.value=""},C=a=>{console.log(a),r.value={type:"edit",id:a.id,product_id:a.product_id,name:a.product?.name,code:a.product?.code,unit:a.unit?.name,is_po_match:a.product_snapshot.quantity>0,po_qty:a.product_snapshot.quantity,po_price:a.product_snapshot.purchase_price,quantity:a.quantity,price:a.purchase_price,total:a.subtotal},c.value=!0},u=()=>{console.log(r.value),r.value.type==="link"?s():r.value.type==="create"?w():r.value.type==="edit"&&P()},s=()=>{const a=r.value;p.actions.submitLinkage(a.id,a.quantity,a.price)},w=()=>{const a=r.value;p.actions.addNewSubstituteItem({id:a.product_id,newQty:a.quantity,newPrice:a.price})},P=()=>{const a=p.linkedItems.find(t=>t.id===r.value.id);a&&(a.quantity=r.value.quantity,a.purchase_price=r.value.price),p.actions.saveCorrections()},A=()=>{confirm("Lepaskan item ini dari invoice?")&&(p.actions.submitUnlinkage(r.value.id),c.value=!1)},H=S(()=>{if(x.value.length<2)return[];const a=x.value.toLowerCase();return p.products.filter(t=>t.name.toLowerCase().includes(a)||t.code.toLowerCase().includes(a)).slice(0,10)}),R=a=>{i.value=!1;const t=p.unlinkedItems.find(o=>o.code===a);if(t)h(t);else{const o=p.product.find(q=>q.code===a);r.value={type:"create",id:null,product_id:o.id,name:o.name,code:o.code,unit:o.unit?.name||"Pcs",is_po_match:!1,po_qty:0,po_price:0,quantity:1,price:o.purchase_price,total:o.purchase_price},c.value=!0}},M=S(()=>(r.value.quantity||0)*(r.value.price||0)),F=a=>{const t=parseFloat(a.target.value)||0,o=r.value.quantity||0;if(o>0){const q=t/o;r.value.price=Math.round(q)}else r.value.price=t,r.value.quantity=1;a.target.value=M.value},L=S(()=>{if(!r.value.is_po_match)return"border-gray-200 focus:border-lime-500";const a=r.value.quantity-r.value.po_qty;return a===0?"border-lime-500 bg-lime-50 text-lime-700":a<0?"border-red-300 bg-red-50 text-red-600":"border-yellow-300 bg-yellow-50 text-yellow-700"}),I=a=>{let t=(r.value.quantity||0)+a;t<0&&(t=0),r.value.quantity=t};return(a,t)=>(n(),g("div",te,[B(G,{invoice:d.invoice,"linked-items":d.linkedItems,validateInvoice:d.actions.validateInvoice},null,8,["invoice","linked-items","validateInvoice"]),e("div",ae,[e("div",re,[e("button",{onClick:t[0]||(t[0]=o=>v.value="unlinked"),class:f(["flex-1 py-2 text-xs font-bold rounded-md transition",v.value==="unlinked"?"bg-white dark:bg-gray-700 shadow text-gray-800 dark:text-white":"text-gray-500"])}," Sisa PO ("+l(d.unlinkedItems.length)+") ",3),e("button",{onClick:t[1]||(t[1]=o=>v.value="linked"),class:f(["flex-1 py-2 text-xs font-bold rounded-md transition",v.value==="linked"?"bg-white dark:bg-gray-700 shadow text-lime-600 dark:text-lime-400":"text-gray-500"])}," Sudah Masuk ("+l(d.linkedItems.length)+") ",3)])]),e("div",oe,[v.value==="unlinked"?(n(),_(E,{key:0,"unlinked-items":d.unlinkedItems,handleProductSelection:h},null,8,["unlinked-items"])):m("",!0),v.value==="linked"?(n(),_(D,{key:1,linkedItems:d.linkedItems,openEditModal:C},null,8,["linkedItems"])):m("",!0)]),b.value?(n(),_(K,{key:0,modelValue:x.value,"onUpdate:modelValue":t[2]||(t[2]=o=>x.value=o),"filtered-products":H.value,"unlinked-items":d.unlinkedItems,onClose:t[3]||(t[3]=o=>b.value=!1),onOnSelectSearch:k},null,8,["modelValue","filtered-products","unlinked-items"])):m("",!0),i.value?(n(),_(ee,{key:1,onResult:R,onClose:t[4]||(t[4]=o=>i.value=!1)})):m("",!0),!b.value&&!i.value?(n(),g("div",se,[e("div",le,[e("button",{onClick:t[5]||(t[5]=o=>b.value=!0),class:"flex-1 py-4 font-bold text-gray-800 bg-white border border-gray-100 rounded-full shadow-lg dark:bg-gray-800 dark:text-white dark:border-gray-700"}," CARI "),e("button",{onClick:t[6]||(t[6]=o=>i.value=!0),class:"flex-[2] flex items-center justify-center gap-2 bg-gray-900 dark:bg-white text-white dark:text-gray-900 py-4 rounded-full shadow-xl font-bold text-lg active:scale-95 transition"},[...t[13]||(t[13]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})],-1),N(" SCAN ",-1)])])])])):m("",!0),B(O,{show:c.value,onClose:t[12]||(t[12]=o=>c.value=!1),title:"Verifikasi Barang"},{footer:j(()=>[e("div",Pe,[r.value.type==="edit"?(n(),g("button",{key:0,onClick:A,class:"p-3.5 bg-red-50 text-red-600 rounded-xl border border-red-100 hover:bg-red-100 dark:bg-red-900/20 dark:border-red-800 dark:text-red-400"},[...t[21]||(t[21]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])])):m("",!0),e("button",{onClick:t[11]||(t[11]=o=>c.value=!1),class:"flex-1 py-3.5 bg-gray-100 text-gray-600 font-bold rounded-xl dark:bg-gray-800 dark:text-gray-300"}," Batal "),e("button",{onClick:u,class:"flex-[2] py-3.5 bg-lime-500 text-white font-bold rounded-xl shadow-lg shadow-lime-500/30 active:scale-[0.98] transition"},l(r.value.type==="edit"?"Simpan Perubahan":"Tautkan Barang"),1)])]),default:j(()=>[e("div",ne,[e("div",ie,[e("div",de,l(r.value.name.substring(0,2).toUpperCase()),1),e("div",ue,[e("span",{class:f(["text-[10px] px-2 py-0.5 rounded border font-bold uppercase inline-block mb-1",r.value.is_po_match?"bg-lime-50 text-lime-700 border-lime-200 dark:bg-lime-900/20 dark:text-lime-400":"bg-purple-50 text-purple-700 border-purple-200 dark:bg-purple-900/20 dark:text-purple-400"])},l(r.value.is_po_match?"Sesuai Purchase Order":"Produk Tambahan / Baru"),3),e("h3",ce,l(r.value.name),1),e("p",pe,l(r.value.code),1)])]),e("div",ge,[t[20]||(t[20]=e("div",{class:"grid grid-cols-2 text-center text-[10px] font-bold text-gray-400 border-b border-gray-200 dark:border-gray-700 pb-1 mb-2 tracking-wider"},[e("div",null,"DATA PO"),e("div",{class:"text-lime-600 dark:text-lime-400"}," INPUT FISIK ")],-1)),e("div",ve,[e("div",be,[r.value.is_po_match?(n(),g("span",me,l(r.value.po_qty),1)):(n(),g("span",ye,"-")),e("span",xe,l(r.value.unit),1)]),e("div",fe,[e("div",he,[e("button",{onClick:t[7]||(t[7]=o=>I(-1)),class:"flex items-center justify-center w-10 h-12 transition bg-gray-100 border-l border-gray-200 dark:bg-gray-800 rounded-l-xl border-y dark:border-gray-700 active:bg-gray-200"},[...t[14]||(t[14]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4 text-gray-500",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z","clip-rule":"evenodd"})],-1)])]),V(e("input",{"onUpdate:modelValue":t[8]||(t[8]=o=>r.value.quantity=o),type:"number",class:f(["w-full h-12 text-center font-bold text-xl border-y border-x-0 focus:ring-0",L.value])},null,2),[[z,r.value.quantity,void 0,{number:!0}]]),e("button",{onClick:t[9]||(t[9]=o=>I(1)),class:"flex items-center justify-center w-10 h-12 transition bg-gray-100 border-r border-gray-200 dark:bg-gray-800 rounded-r-xl border-y dark:border-gray-700 active:bg-lime-100 active:border-lime-200 active:text-lime-600"},[...t[15]||(t[15]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4 text-gray-500",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z","clip-rule":"evenodd"})],-1)])])]),r.value.is_po_match&&r.value.quantity-r.value.po_qty!==0?(n(),g("p",{key:0,class:f(["text-[10px] text-center font-medium",r.value.quantity-r.value.po_qty<0?"text-red-500":"text-yellow-600"])},l(r.value.quantity-r.value.po_qty>0?"Lebih":"Kurang")+" "+l(Math.abs(r.value.quantity-r.value.po_qty)),3)):m("",!0)])]),e("div",ke,[e("div",we,[r.value.is_po_match?(n(),g("span",_e,l(d.actions.formatRupiah(r.value.po_price)),1)):(n(),g("span",Ce,"-")),t[16]||(t[16]=e("span",{class:"text-[9px] text-gray-400 block uppercase"},"Harga Satuan",-1))]),e("div",qe,[e("div",Se,[t[17]||(t[17]=e("span",{class:"absolute text-xs font-bold text-gray-400 -translate-y-1/2 left-3 top-1/2"},"Rp",-1)),V(e("input",{"onUpdate:modelValue":t[10]||(t[10]=o=>r.value.price=o),type:"number",class:"w-full h-12 pr-3 text-lg font-bold text-right bg-white border border-gray-200 pl-9 dark:bg-gray-900 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-lime-500 focus:border-lime-500",placeholder:"0"},null,512),[[z,r.value.price,void 0,{number:!0}]])]),e("p",Me,l(d.actions.formatRupiah(r.value.price)),1)])]),e("div",Ie,[e("div",null,[t[18]||(t[18]=e("p",{class:"text-[10px] font-bold text-gray-400 uppercase tracking-wider"}," Subtotal Item ",-1)),e("p",$e,l(r.value.quantity)+" x "+l(d.actions.formatRupiah(r.value.price)),1)]),e("div",Be,[e("div",je,[t[19]||(t[19]=e("span",{class:"absolute text-xs font-bold text-gray-400 -translate-y-1/2 left-3 top-1/2"},"Rp",-1)),e("input",{value:M.value,onChange:F,type:"number",class:"w-full py-2 pr-3 text-xl font-black text-right text-gray-800 transition-all bg-white border border-gray-200 rounded-lg shadow-sm pl-9 dark:text-white dark:bg-gray-900 dark:border-gray-600 focus:ring-2 focus:ring-lime-500 focus:border-lime-500",placeholder:"0"},null,40,Ve)])])])]),r.value.type!=="edit"?(n(),g("p",ze," * Perubahan Qty/Harga untuk link baru akan disimpan. Anda bisa mengeditnya kembali di tab 'Sudah Masuk'. ")):m("",!0)])]),_:1},8,["show"])]))}},Qe=J(Ae,[["__scopeId","data-v-95b07a65"]]);export{Qe as default};
