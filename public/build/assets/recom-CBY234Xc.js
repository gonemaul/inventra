import{v as p,K as z,D as v,d as I,o as n,w as q,f as t,k as b,t as o,n as i,z as f,B as k,l as d,F as D,I as M,j as T,p as _,H as N,a as R}from"./vendor-core-By7Plnkm.js";import{B as V}from"./BottomSheet-CbDDnn2t.js";import"./vendor-common-GpUWqhKr.js";import"./vendor-charts-Bw6UNgWf.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const $={class:"flex flex-col h-full bg-gray-50 dark:bg-gray-900"},F={class:"px-6 py-4 bg-white border-b shadow-sm dark:bg-gray-800 dark:border-gray-700 shrink-0"},A={class:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between"},E={class:"text-sm text-gray-500 dark:text-gray-400"},H={class:"text-gray-800 dark:text-gray-200"},K={class:"flex items-center gap-2"},O={class:"flex-1 p-4 overflow-y-auto custom-scrollbar"},U={key:0,class:"flex flex-col items-center justify-center py-20 space-y-4"},G={key:1,class:"flex flex-col items-center justify-center py-20 text-center"},L={key:2,class:"space-y-3"},P={class:"flex flex-col overflow-hidden bg-white border border-gray-200 shadow-sm dark:bg-gray-900 rounded-xl dark:border-gray-800"},J=["onClick"],Q={class:"shrink-0"},W=["value"],X={class:"flex-1 min-w-0"},Y={class:"flex items-center gap-2 mb-1"},Z={key:0,class:"px-1.5 py-0.5 text-[9px] font-bold text-gray-500 bg-gray-100 rounded dark:bg-gray-800 dark:text-gray-400"},ee={class:"text-sm font-bold text-gray-800 truncate dark:text-gray-100"},te={class:"flex items-center gap-2 text-[10px] text-gray-400 mb-2"},se={class:"font-mono"},re={key:0,class:"ml-auto text-red-600 font-bold bg-red-50 px-1.5 rounded-sm"},ae={class:"flex items-center gap-2"},oe={class:"flex-1 h-1.5 bg-gray-100 rounded-full overflow-hidden dark:bg-gray-800"},le={class:"text-[9px] text-gray-400 whitespace-nowrap"},ne={class:"text-right pl-2 border-l border-dashed border-gray-200 dark:border-gray-700 min-w-[80px]"},de={class:"text-lg font-black leading-none text-blue-600 dark:text-blue-400 my-0.5"},ie={class:"text-[10px] text-gray-500 dark:text-gray-400 font-medium"},ce={class:"px-6 py-4 bg-white border-t shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)] dark:bg-gray-800 dark:border-gray-700 z-10 shrink-0"},ue={class:"flex items-center justify-between mb-3"},ge={class:"flex flex-col"},pe={class:"text-xs text-gray-500"},be={class:"text-lg font-black text-lime-600 dark:text-lime-400"},xe={class:"flex gap-3"},ye=["disabled"],_e={__name:"recom",props:{show:Boolean,supplierId:[Number,String]},emits:["close","add-items"],setup(x,{emit:w}){const c=x,y=w,l=p([]),u=p(!1),a=p([]),h=r=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(r);async function C(){if(c.supplierId){u.value=!0;try{const r=await R.get(route("purchases.recommendations",c.supplierId));l.value=r.data,a.value=r.data.filter(e=>e.is_critical).map(e=>e.product_id)}catch(r){console.error("Gagal fetch rekomendasi:",r),l.value=[],a.value=[]}finally{u.value=!1}}}z(()=>c.show,r=>{r?C():setTimeout(()=>{l.value=[],a.value=[]},300)});const g=v({get(){return l.value.length>0&&a.value.length===l.value.length},set(r){a.value=r?l.value.map(e=>e.product_id):[]}}),B=v(()=>l.value.filter(r=>a.value.includes(r.product_id)).reduce((r,e)=>r+e.purchase_price*e.quantity,0)),j=r=>{const e=a.value.indexOf(r);e===-1?a.value.push(r):a.value.splice(e,1)};function S(){const r=l.value.filter(e=>a.value.includes(e.product_id)).map(e=>({product_id:e.product_id,code:e.code,name:e.name,unit:e.unit,size:e.size,purchase_price:e.purchase_price,quantity:e.quantity,subtotal:e.purchase_price*e.quantity,current_stock:e.current_stock}));r.length!==0&&(y("add-items",r),y("close"))}return(r,e)=>(n(),I(V,{show:x.show,onClose:e[4]||(e[4]=s=>r.$emit("close")),title:"ðŸ’¡ Rekomendasi Restock Cerdas"},{default:q(()=>[t("div",$,[t("div",F,[t("div",A,[t("div",null,[t("p",E,[e[5]||(e[5]=b(" Sistem mendeteksi ",-1)),t("strong",H,o(l.value.length)+" barang",1),e[6]||(e[6]=b(" di bawah stok minimum atau diprediksi habis. ",-1))])]),t("div",K,[t("label",{class:i(["flex items-center gap-2 px-3 py-1.5 text-xs font-bold transition-colors border rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700",g.value?"bg-lime-50 border-lime-200 text-lime-700":"bg-white border-gray-200 text-gray-600 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-300"])},[f(t("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=s=>g.value=s),class:"w-4 h-4 border-gray-300 rounded text-lime-600 focus:ring-lime-500"},null,512),[[k,g.value]]),b(" Pilih Semua ("+o(l.value.length)+") ",1)],2)])])]),t("div",O,[u.value?(n(),d("div",U,[...e[7]||(e[7]=[t("div",{class:"relative w-12 h-12"},[t("div",{class:"absolute w-full h-full border-4 rounded-full border-lime-200 opacity-30"}),t("div",{class:"absolute w-full h-full border-4 border-l-4 rounded-full border-lime-500 animate-spin border-t-transparent border-r-transparent border-b-transparent"})],-1),t("span",{class:"text-sm font-medium text-gray-500 animate-pulse"},"Menganalisa data stok...",-1)])])):l.value.length===0?(n(),d("div",G,[...e[8]||(e[8]=[t("div",{class:"p-4 mb-4 bg-green-100 rounded-full dark:bg-green-900/30"},[t("svg",{class:"w-10 h-10 text-green-600 dark:text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1),t("h3",{class:"text-lg font-bold text-gray-800 dark:text-gray-100"}," Stok Aman! ",-1),t("p",{class:"max-w-xs mt-1 text-sm text-gray-500"}," Tidak ada barang dari supplier ini yang perlu di-restock saat ini. ",-1)])])):(n(),d("div",L,[t("div",P,[(n(!0),d(D,null,M(l.value,s=>(n(),d("div",{key:s.product_id,onClick:m=>j(s.product_id),class:i(["relative flex items-center gap-3 p-3 transition-colors border-b border-gray-100 cursor-pointer group last:border-0 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800/50",[a.value.includes(s.product_id)?"bg-lime-50 dark:bg-lime-900/10":"bg-white dark:bg-gray-900",s.is_critical?"border-l-4 border-l-red-500 pl-2":"border-l-4 border-l-transparent pl-2"]])},[t("div",Q,[f(t("input",{type:"checkbox",value:s.product_id,"onUpdate:modelValue":e[1]||(e[1]=m=>a.value=m),onClick:e[2]||(e[2]=T(()=>{},["stop"])),class:"w-5 h-5 border-gray-300 rounded cursor-pointer text-lime-600 focus:ring-lime-500"},null,8,W),[[k,a.value]])]),t("div",X,[t("div",Y,[s.brand?(n(),d("span",Z,o(s.brand),1)):_("",!0),t("h4",ee,o(s.name),1)]),t("div",te,[t("span",se,"#"+o(s.code),1),e[9]||(e[9]=t("span",null,"â€¢",-1)),t("span",null,o(s.size)+" / "+o(s.unit),1),s.is_critical?(n(),d("span",re,o(s.reason),1)):_("",!0)]),t("div",ae,[t("div",oe,[t("div",{class:i(["h-full rounded-full",s.is_critical?"bg-red-500":"bg-yellow-400"]),style:N({width:Math.min(s.current_stock/s.min_stock*100,100)+"%"})},null,6)]),t("span",le,o(s.current_stock)+" / "+o(s.min_stock),1)])]),t("div",ne,[e[10]||(e[10]=t("span",{class:"text-[9px] text-gray-400 uppercase font-medium"},"Order",-1)),t("div",de," +"+o(s.quantity),1),t("div",ie,o(h(s.purchase_price*s.quantity)),1)])],10,J))),128))])]))]),t("div",ce,[t("div",ue,[t("div",ge,[t("span",pe,"Total Estimasi ("+o(a.value.length)+" item)",1),t("span",be,o(h(B.value)),1)])]),t("div",xe,[t("button",{onClick:e[3]||(e[3]=s=>r.$emit("close")),class:"px-4 py-2.5 text-sm font-bold text-gray-600 bg-gray-100 rounded-xl hover:bg-gray-200 transition dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600"}," Batal "),t("button",{onClick:S,disabled:a.value.length===0,class:i(["flex-1 flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-bold text-white transition rounded-xl shadow-lg shadow-lime-500/30",a.value.length>0?"bg-lime-600 hover:bg-lime-700 active:scale-[0.98]":"bg-gray-300 cursor-not-allowed dark:bg-gray-700 text-gray-400 shadow-none"])},[...e[11]||(e[11]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),t("span",null,"Tambahkan ke Keranjang",-1)])],10,ye)])])])]),_:1},8,["show"]))}};export{_e as default};
