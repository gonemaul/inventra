const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/HeadRabMobile-DtYCJh-H.js","assets/vendor-core-By7Plnkm.js","assets/vendor-common-GpUWqhKr.js","assets/vendor-charts-Bw6UNgWf.js","assets/vendor-core-DnojJsHo.css","assets/InputError-DsZQubOd.js","assets/HeadRabDesktop-DbHGcOrS.js","assets/PrimaryButton-BZrDt8zt.js","assets/_plugin-vue_export-helper-DlAUqK2U.js","assets/SecondaryButton-MbOcpACd.js"])))=>i.map(i=>d[i]);
import{_ as $}from"./app-CWu9moJ_.js";import{_ as ie}from"./AuthenticatedLayout-BlgKae2S.js";import{q as ne,D as v,v as h,u as oe,K as le,x as ue,S as de,l as y,o as m,e as b,g as a,i as ce,w as me,f as o,d as k,G as q,n as O,k as pe,p as ge,t as ve,a3 as he,R as fe,F as _e}from"./vendor-core-By7Plnkm.js";import{u as ye}from"./useActionLoading-BREuot5v.js";import{u as be}from"./usePurchaseCart-DhLhC2K2.js";import ke from"./CatalogView-C3snUdmQ.js";import we from"./PurchaseTable-DXKf9XSy.js";import K from"./recom-DJZptrS2.js";import"./vendor-common-GpUWqhKr.js";import"./vendor-charts-Bw6UNgWf.js";import"./useSidebar-CpEDRVzi.js";import"./CatalogCard-CDk-Qd0H.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Se={class:"w-full min-h-screen space-y-6"},Ie={class:"p-4 space-y-4 bg-white border border-gray-200 shadow-sm rounded-xl dark:bg-gray-900 dark:border-gray-700"},xe={class:"flex p-1 space-x-1 bg-gray-100 rounded-lg dark:bg-gray-700"},Re={key:0,class:"ml-2 bg-lime-100 text-lime-700 py-0.5 px-2 rounded-full text-xs font-bold"},je=["disabled"],Ce={key:0},Me={key:1},De={class:"min-h-[400px]"},w="inventra_draft_supplier_id",He={__name:"create",props:{purchase:Object,dropdowns:Object,categories:Array,brands:Array},setup(g){const L=q(()=>$(()=>import("./HeadRabMobile-DtYCJh-H.js"),__vite__mapDeps([0,1,2,3,4,5]))),F=q(()=>$(()=>import("./HeadRabDesktop-DbHGcOrS.js"),__vite__mapDeps([6,1,2,3,4,7,8,9,5]))),n=g,l=ne(),{isActionLoading:x}=ye(),p=v(()=>!!n.purchase&&!!n.purchase.id),S=v(()=>n.purchase?.status||"draft"),H=v(()=>S.value==="draft"),N=v(()=>S.value==="dipesan"),R=h(window.innerWidth<1024),j=()=>{R.value=window.innerWidth<1024},u=h("table"),c=h(!1),{cartItems:d,addToCart:U,updateCartItem:G,removeItem:Q,clearCart:W,totalUnit:C,totalBelanja:M,totalMacam:D,addMultipleItems:A,removeMultipleItems:Y}=be(p.value,n.purchase),i=oe({supplier_id:n.purchase?.supplier_id||"",transaction_date:n.purchase?.transaction_date||new Date().toISOString().split("T")[0],status:S.value,notes:n.purchase?.notes||"",shipping_cost:n.purchase?.shipping_cost||0,other_costs:n.purchase?.other_costs||0}),f=h(!1),E={product_id:null,name:"",code:"",unit:"",size:"",category:"",brand:"",type:"",image_url:"",current_stock:0,quantity:1,purchase_price:0,restock_recommendation:0},r=h({...E}),_=v({get:()=>r.value.purchase_price?ae(r.value.purchase_price):0,set:e=>r.value.purchase_price=se(e)});le(()=>i.supplier_id,e=>{e?(localStorage.setItem(w,e),c.value=!0,u.value="catalog"):(localStorage.removeItem(w),c.value=!1,u.value="table")}),ue(()=>{window.addEventListener("resize",j);const e=localStorage.getItem(w);e&&!i.supplier_id&&!p.value&&(i.supplier_id=e)}),de(()=>{window.removeEventListener("resize",j)});const P=(e,t=1,s=null)=>{const V=e.insights?.find(re=>re.type==="restock")?.payload?.suggested_qty;r.value={product_id:e.product_id?e.product_id:e.id,name:e.name,code:e.code,category:e.category?.name||e.category||"-",unit:e.unit?.name||e.unit||"-",size:e.size?.name||e.size||"-",brand:e.brand?.name||e.brand||"-",type:e.type_name||e.type_name||"-",image_url:e.image_url,current_stock:e.stock||e.current_stock,quantity:V||t,purchase_price:s!==null?s:e.purchase_price||0,restock_recommendation:V}},I=()=>{r.value={...E},f.value=!1},J=e=>{P(e),u.value="catalog",window.scrollTo({top:0,behavior:"smooth"})},X=e=>{P(e,e.quantity,e.purchase_price),f.value=!0,u.value="table",window.scrollTo({top:0,behavior:"smooth"})},T=()=>{if(!r.value.product_id)return l.error("Mohon pilih produk dari katalog.");if(r.value.quantity<=0)return l.error("Kuantitas minimal harus 1.");d.value.find(t=>t.product_id===r.value.product_id)?(G({product_id:r.value.product_id,quantity:r.value.quantity,purchase_price:r.value.purchase_price}),l.success("Item diperbarui.")):(U(r.value,r.value.quantity,r.value.purchase_price),l.success("Item ditambahkan.")),I()},Z=e=>{if(N.value&&e.id)return l.warning("Item lama tidak boleh dihapus saat status Dipesan! Silakan edit Qty saja.");Q(e.product_id)},ee=e=>{A(e),l.info(`${e.length} item rekomendasi ditambahkan ke keranjang.`)},z=()=>{if(!i.supplier_id)return l.error("Pilih Supplier dulu!");if(d.value.length===0)return l.error("Keranjang kosong!");x.value=!0;const e=s=>({...s,items:d.value}),t={onSuccess:()=>{p.value||localStorage.removeItem(w);const s=p.value?`inventra_edit_${n.purchase.id}`:"inventra_create_draft";localStorage.removeItem(s),W(),i.reset()},onError:s=>{console.error(s);const B=Object.values(s)[0]||"Terjadi kesalahan";l.error("Gagal: "+B)},onFinish:()=>{x.value=!1}};p.value?i.transform(e).put(route("purchases.update",n.purchase.id),t):i.transform(e).post(route("purchases.store"),t)},te=e=>{Y(e)};function ae(e){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(e)}function se(e){return parseInt(String(e).replace(/[^0-9]/g,""))||0}return(e,t)=>(m(),y(_e,null,[b(a(ce),{title:"Rancangan Anggaran Belanja"}),b(ie,{headerTitle:"Rancangan Anggaran Belanja",showSidebar:!1},{default:me(()=>[b(K,{show:c.value,supplierId:a(i).supplier_id,onClose:t[0]||(t[0]=s=>c.value=!1),onAddItems:ee},null,8,["show","supplierId"]),o("div",Se,[R.value?(m(),k(a(L),{key:0,"form-header":a(i),dropdowns:g.dropdowns,"staging-item":r.value,"is-edit":p.value,"is-editing-mode":f.value,"cart-items":a(d),"total-unit":a(C),"total-macam":a(D),"total-belanja":a(M),"displayed-price":_.value,"onUpdate:displayedPrice":t[1]||(t[1]=s=>_.value=s),onSaveStaging:T,onResetStaging:I,onSubmitTransaction:z,onOpenRecommendation:t[2]||(t[2]=s=>c.value=!0)},null,8,["form-header","dropdowns","staging-item","is-edit","is-editing-mode","cart-items","total-unit","total-macam","total-belanja","displayed-price"])):(m(),k(a(F),{key:1,"form-header":a(i),dropdowns:g.dropdowns,"staging-item":r.value,"is-edit":p.value,"is-editing-mode":f.value,"cart-items":a(d),"total-unit":a(C),"total-macam":a(D),"total-belanja":a(M),"displayed-price":_.value,"onUpdate:displayedPrice":t[3]||(t[3]=s=>_.value=s),onSaveStaging:T,onResetStaging:I,onSubmitTransaction:z,onOpenRecommendation:t[4]||(t[4]=s=>c.value=!0)},null,8,["form-header","dropdowns","staging-item","is-edit","is-editing-mode","cart-items","total-unit","total-macam","total-belanja","displayed-price"])),o("div",Ie,[o("div",xe,[o("button",{type:"button",onClick:t[5]||(t[5]=s=>u.value="table"),class:O(["flex items-center justify-center w-1/2 py-2.5 text-sm font-medium rounded-md transition-all duration-200 focus:outline-none",u.value==="table"?"bg-white text-gray-900 shadow dark:bg-gray-600 dark:text-white":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"])},[t[8]||(t[8]=o("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})],-1)),t[9]||(t[9]=pe(" Daftar Belanja ",-1)),a(d).length>0?(m(),y("span",Re,ve(a(d).length),1)):ge("",!0)],2),o("button",{type:"button",onClick:t[6]||(t[6]=s=>u.value="catalog"),disabled:!a(i).supplier_id,class:O(["flex items-center justify-center w-1/2 py-2.5 text-sm font-medium rounded-md transition-all duration-200 focus:outline-none",[u.value==="catalog"?"bg-white text-gray-900 shadow dark:bg-gray-600 dark:text-white":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",a(i).supplier_id?"":"opacity-50 cursor-not-allowed"]])},[t[10]||(t[10]=o("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})],-1)),a(i).supplier_id?(m(),y("span",Me,"Katalog Produk")):(m(),y("span",Ce,"Pilih Supplier Dulu"))],10,je)]),o("div",De,[(m(),k(he,null,[(m(),k(fe(u.value==="table"?we:ke),{"supplier-id":a(i).supplier_id,items:a(d),stagingItem:r.value,isDraft:H.value,categories:g.categories,brands:g.brands,onRemove:Z,onRemoveMultiple:te,onEdit:X,onSelectProduct:J},null,40,["supplier-id","items","stagingItem","isDraft","categories","brands"]))],1024))])])]),b(K,{show:c.value,"supplier-id":a(i).supplier_id,"cart-items":a(d),onClose:t[7]||(t[7]=s=>c.value=!1),onAddItems:a(A)},null,8,["show","supplier-id","cart-items","onAddItems"])]),_:1})],64))}};export{He as default};
