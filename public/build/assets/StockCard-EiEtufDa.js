import{v as b,K as L,x as $,a4 as A,a as K,l as r,o as s,f as t,p as m,z as w,A as S,n as P,t as o,F as C,I as j,k as M,u as F,D as E,e as v,g,i as H,w as _,C as N}from"./vendor-core-B46KUNyc.js";import{_ as R}from"./AuthenticatedLayout-9yD8UcND.js";import{u as U}from"./useActionLoading-pomD9vky.js";import{j as I}from"./vendor-common-GpUWqhKr.js";import"./vendor-charts-Bw6UNgWf.js";import"./useSidebar-DSTl-7Rw.js";const O={class:"relative w-full"},q={class:"relative"},Q=["placeholder"],W={key:0,class:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none"},G={key:0,class:"mt-1 text-xs text-red-500"},J={class:"py-1"},X=["onClick"],Y={class:"flex flex-col"},Z={class:"font-bold text-sm"},tt={class:"text-xs text-gray-500 dark:text-gray-400"},et={key:0},at={key:1},rt={key:2,class:"absolute z-50 w-full mt-1 p-4 text-center text-sm text-gray-500 bg-white border border-gray-200 rounded-md shadow-lg dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400"},st={__name:"ProductSearchSelect",props:{modelValue:[String,Number],initialProduct:Object,placeholder:{type:String,default:"Cari Produk..."},error:String},emits:["update:modelValue","change"],setup(d,{emit:h}){const f=d,n=h,u=b(""),i=b([]),k=b(!1),y=b(!1),l=b(null),e=b(null),a=()=>{f.initialProduct&&(u.value=`${f.initialProduct.code} - ${f.initialProduct.name}`)};L(()=>f.initialProduct,a),$(a);const D=c=>{e.value&&!e.value.contains(c.target)&&l.value&&!l.value.contains(c.target)&&(y.value=!1)};$(()=>{document.addEventListener("click",D)}),A(()=>{document.removeEventListener("click",D)});const B=I(async c=>{if(!c){i.value=[];return}k.value=!0;try{const p=await K.get(route("products.searchProducts"),{params:{q:c,limit:10}});i.value=p.data,y.value=!0}catch(p){console.error("Search error:",p),i.value=[]}finally{k.value=!1}},300),V=()=>{if(u.value.length<2){i.value=[],y.value=!1;return}B(u.value)},z=c=>{u.value=`${c.code} - ${c.name}`,n("update:modelValue",c.id),n("change",c),y.value=!1,i.value=[]},T=()=>{u.value="",n("update:modelValue",null),n("change",null),y.value=!1,i.value=[],l.value&&l.value.focus()};return(c,p)=>(s(),r("div",O,[t("div",q,[w(t("input",{ref_key:"inputRef",ref:l,type:"text","onUpdate:modelValue":p[0]||(p[0]=x=>u.value=x),onInput:V,onFocus:V,class:P(["w-full border-gray-300 rounded-lg shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",{"border-red-500":d.error}]),placeholder:d.placeholder,autocomplete:"off"},null,42,Q),[[S,u.value]]),k.value?(s(),r("div",W,[...p[1]||(p[1]=[t("svg",{class:"w-5 h-5 text-gray-400 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])])):u.value&&!k.value?(s(),r("div",{key:1,class:"absolute inset-y-0 right-0 flex items-center pr-3 cursor-pointer",onClick:T},[...p[2]||(p[2]=[t("svg",{class:"w-5 h-5 text-gray-400 hover:text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])):m("",!0)]),d.error?(s(),r("p",G,o(d.error),1)):m("",!0),y.value&&i.value.length>0?(s(),r("div",{key:1,ref_key:"dropdownRef",ref:e,class:"absolute z-50 w-full mt-1 overflow-auto bg-white border border-gray-200 rounded-md shadow-lg max-h-60 dark:bg-gray-800 dark:border-gray-700"},[t("ul",J,[(s(!0),r(C,null,j(i.value,x=>(s(),r("li",{key:x.id,onClick:Nt=>z(x),class:"px-4 py-2 cursor-pointer hover:bg-indigo-50 dark:hover:bg-gray-700 dark:text-gray-200"},[t("div",Y,[t("span",Z,o(x.name),1),t("span",tt,[M(o(x.code)+" ",1),x.unit?(s(),r("span",et,"â€¢ "+o(x.unit.name),1)):m("",!0),x.category?(s(),r("span",at,"â€¢ "+o(x.category.name),1)):m("",!0)])])],8,X))),128))])],512)):m("",!0),y.value&&i.value.length===0&&!k.value&&u.value.length>=2?(s(),r("div",rt," Produk tidak ditemukan. ")):m("",!0)]))}},ot={class:"flex items-center gap-4"},lt={class:"flex gap-2"},nt={class:"space-y-6"},dt={class:"p-6 bg-white border border-gray-200 shadow-sm rounded-2xl dark:bg-gray-800 dark:border-gray-700"},it={class:"grid items-end grid-cols-1 gap-4 md:grid-cols-4"},ut={class:"md:col-span-2"},ct={class:"flex gap-2"},gt={class:"flex-1"},pt=["disabled"],xt={key:0,class:"overflow-hidden bg-white border border-gray-200 shadow-lg rounded-2xl dark:bg-gray-800 dark:border-gray-700"},yt={class:"flex items-center justify-between p-6 border-b border-gray-100 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-700/50"},ht={class:"text-2xl font-black text-gray-800 dark:text-white"},kt={class:"text-sm text-gray-500"},mt={class:"text-right"},ft={class:"text-3xl font-black text-lime-600 dark:text-lime-400"},bt={class:"text-sm font-normal text-gray-400"},vt={class:"overflow-x-auto"},_t={class:"w-full text-sm text-left"},wt={class:"divide-y divide-gray-100 dark:divide-gray-700"},St={class:"font-medium bg-yellow-50 dark:bg-yellow-900/10"},Ct={class:"px-6 py-3 text-yellow-700",colspan:"3"},Dt={class:"px-6 py-3 font-bold text-right text-yellow-700"},Vt={class:"px-6 py-3 text-xs text-gray-500 whitespace-nowrap"},$t={class:"px-6 py-3"},Pt={class:"flex flex-col gap-1"},jt={class:"font-mono text-xs font-bold text-gray-700 dark:text-gray-300"},Mt={class:"px-6 py-3 italic text-gray-600 dark:text-gray-400"},Bt={class:"px-6 py-3 text-center"},zt={key:0,class:"px-2 py-1 font-bold text-green-600 rounded bg-green-50"},Tt={key:1,class:"text-gray-300"},Lt={class:"px-6 py-3 text-center"},At={key:0,class:"px-2 py-1 font-bold text-red-600 rounded bg-red-50"},Kt={key:1,class:"text-gray-300"},Ft={class:"px-6 py-3 font-bold text-right text-gray-900 dark:text-white"},Et={key:0},Ht={key:1,class:"flex flex-col items-center justify-center border-2 border-gray-300 border-dashed h-96 bg-gray-50 rounded-2xl dark:bg-gray-800 dark:border-gray-700"},Wt={__name:"StockCard",props:{filters:Object,products:Array,reportData:Object},setup(d){const h=d,{isActionLoading:f}=U(),n=F({product_id:h.filters.product_id||"",start_date:h.filters.start_date,end_date:h.filters.end_date}),u=()=>{n.product_id&&(f.value=!0,n.get(route("reports.stock-card"),{preserveScroll:!0,preserveState:!0,onFinish:()=>{f.value=!1}}))},i=E(()=>{if(!h.reportData)return[];let l=h.reportData.opening_stock;return h.reportData.movements.map(e=>(l+=e.quantity,{...e,balance_after:l}))}),k=l=>new Date(l).toLocaleString("id-ID",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),y=l=>({initial:"bg-gray-100 text-gray-600",purchase:"bg-green-100 text-green-700",sale:"bg-blue-100 text-blue-700",adjustment_in:"bg-yellow-100 text-yellow-700",adjustment_out:"bg-red-100 text-red-700",return_in:"bg-purple-100 text-purple-700"})[l]||"bg-gray-100";return(l,e)=>(s(),r(C,null,[v(g(H),{title:"Kartu Stok"}),v(R,{headerTitle:"Laporan & Audit"},{header:_(()=>[t("div",ot,[v(g(N),{href:l.route("reports.index"),class:"p-2 transition rounded-full hover:bg-gray-200 dark:hover:bg-gray-700"},{default:_(()=>[...e[4]||(e[4]=[t("svg",{class:"w-6 h-6 text-gray-600 dark:text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1)])]),_:1},8,["href"]),e[5]||(e[5]=t("h2",{class:"text-xl font-semibold leading-tight text-gray-800 dark:text-gray-200"}," Kartu Stok ",-1))]),t("div",lt,[l.product?(s(),r("button",{key:0,onClick:e[0]||(e[0]=(...a)=>l.doExport&&l.doExport(...a)),class:"p-2 text-gray-600 transition hover:text-green-600 dark:text-gray-300",title:"Export CSV"},[...e[6]||(e[6]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)])])):m("",!0),e[7]||(e[7]=t("button",{onclick:"window.print()",class:"p-2 text-gray-600 transition hover:text-blue-600 dark:text-gray-300",title:"Print"},[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})])],-1))])]),default:_(()=>[t("div",nt,[t("div",dt,[e[11]||(e[11]=t("h3",{class:"mb-4 text-lg font-bold text-gray-800 dark:text-white"}," ðŸ” Filter Kartu Stok ",-1)),t("div",it,[t("div",ut,[e[8]||(e[8]=t("label",{class:"block mb-1 text-xs font-bold text-gray-500 uppercase"},"Pilih Produk",-1)),v(st,{modelValue:g(n).product_id,"onUpdate:modelValue":e[1]||(e[1]=a=>g(n).product_id=a),initialProduct:d.reportData?.product,placeholder:"Ketik Kode / Nama Produk...",onChange:u},null,8,["modelValue","initialProduct"])]),t("div",null,[e[9]||(e[9]=t("label",{class:"block mb-1 text-xs font-bold text-gray-500 uppercase"},"Dari Tanggal",-1)),w(t("input",{type:"date","onUpdate:modelValue":e[2]||(e[2]=a=>g(n).start_date=a),class:"w-full border-gray-300 rounded-lg dark:bg-gray-700 dark:text-white"},null,512),[[S,g(n).start_date]])]),t("div",ct,[t("div",gt,[e[10]||(e[10]=t("label",{class:"block mb-1 text-xs font-bold text-gray-500 uppercase"},"Sampai",-1)),w(t("input",{type:"date","onUpdate:modelValue":e[3]||(e[3]=a=>g(n).end_date=a),class:"w-full border-gray-300 rounded-lg dark:bg-gray-700 dark:text-white"},null,512),[[S,g(n).end_date]])]),t("button",{onClick:u,disabled:g(n).processing||!g(n).product_id,class:"flex items-center justify-center px-4 py-2 mt-auto font-bold text-white transition rounded-lg shadow-md bg-lime-500 hover:bg-lime-600 disabled:opacity-50 disabled:cursor-not-allowed"}," Tampilkan ",8,pt)])])]),d.reportData?(s(),r("div",xt,[t("div",yt,[t("div",null,[t("h2",ht,o(d.reportData.product.name),1),t("p",kt,o(d.reportData.product.code)+" â€¢ "+o(d.reportData.product.category?.name),1)]),t("div",mt,[e[12]||(e[12]=t("p",{class:"text-xs font-bold tracking-widest text-gray-400 uppercase"}," Saldo Akhir Periode ",-1)),t("p",ft,[M(o(i.value.length>0?i.value[i.value.length-1].balance_after:d.reportData.opening_stock)+" ",1),t("span",bt,o(d.reportData.product.unit?.name),1)])])]),t("div",vt,[t("table",_t,[e[15]||(e[15]=t("thead",{class:"text-xs text-gray-500 uppercase bg-gray-100 dark:bg-gray-900/50"},[t("tr",null,[t("th",{class:"px-6 py-3"},"Waktu"),t("th",{class:"px-6 py-3"},"Tipe & Ref"),t("th",{class:"px-6 py-3"},"Keterangan"),t("th",{class:"px-6 py-3 text-center text-green-600"}," Masuk "),t("th",{class:"px-6 py-3 text-center text-red-600"}," Keluar "),t("th",{class:"px-6 py-3 font-black text-right"}," Saldo ")])],-1)),t("tbody",wt,[t("tr",St,[t("td",Ct," âž¡ï¸ Saldo Awal (Sebelum "+o(k(g(n).start_date).split(",")[0])+") ",1),e[13]||(e[13]=t("td",{colspan:"2"},null,-1)),t("td",Dt,o(d.reportData.opening_stock),1)]),(s(!0),r(C,null,j(i.value,a=>(s(),r("tr",{key:a.id,class:"transition hover:bg-gray-50 dark:hover:bg-gray-700/30"},[t("td",Vt,o(k(a.created_at)),1),t("td",$t,[t("div",Pt,[t("span",{class:P(["px-2 py-0.5 rounded text-[10px] font-bold uppercase w-fit border",y(a.type)])},o(a.type),3),t("span",jt,o(a.reference_number||"-"),1)])]),t("td",Mt,o(a.description),1),t("td",Bt,[a.stock_after>a.stock_before?(s(),r("span",zt," +"+o(a.quantity),1)):(s(),r("span",Tt,"-"))]),t("td",Lt,[a.stock_after<a.stock_before?(s(),r("span",At," -"+o(a.quantity),1)):(s(),r("span",Kt,"-"))]),t("td",Ft,o(a.stock_after),1)]))),128)),i.value.length===0?(s(),r("tr",Et,[...e[14]||(e[14]=[t("td",{colspan:"6",class:"px-6 py-10 italic text-center text-gray-400"}," Tidak ada aktivitas transaksi pada rentang tanggal ini. ",-1)])])):m("",!0)])])])])):(s(),r("div",Ht,[...e[16]||(e[16]=[t("div",{class:"flex items-center justify-center w-20 h-20 mb-4 bg-gray-200 rounded-full dark:bg-gray-700 animate-pulse"},[t("svg",{class:"w-10 h-10 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})])],-1),t("h3",{class:"text-lg font-bold text-gray-700 dark:text-gray-300"}," Pilih Produk Terlebih Dahulu ",-1),t("p",{class:"text-sm text-gray-500"}," Silakan pilih produk di atas untuk melihat mutasi stok. ",-1)])]))])]),_:1})],64))}};export{Wt as default};
