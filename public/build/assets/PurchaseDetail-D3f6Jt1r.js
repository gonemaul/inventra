import{_ as q}from"./AuthenticatedLayout-i35sOfj5.js";import{y as K,x as i,c as A,o as u,w as c,b as a,g as m,i as b,t as S,f as k,a as n,d as D,s as O,E as Z,j as E,h as U,l as N,F as P,q as W,n as V}from"./app-16F72kvM.js";import{_ as Y}from"./Tabs-CDEDez9b.js";import{P as T}from"./PrimaryButton-BljTXkSw.js";import{_ as G}from"./DeleteConfirm-Ol_xf02g.js";import J from"./FinalizeModal-C7PG6fIJ.js";import Q from"./InvoiceForm-CpatPzWm.js";import X from"./invoiceTable-DEslnXmz.js";import ee from"./productTable-D-YqbGFr.js";import te from"./HeaderDetail-r0AQiQyR.js";import ae from"./OrderImageModal-Q2pYCT66.js";import{_ as se}from"./Modal-jQvc97r7.js";import{D as ne}from"./DangerButton-B9JlSalt.js";import{_ as ie}from"./SecondaryButton-TW8oaFJa.js";import{u as oe}from"./useActionLoading-CazrI_1u.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./InputLabel-hmYwaHPv.js";import"./TextInput-CM-Cfk38.js";import"./InputError-DJIdP35a.js";import"./DataTable-Bhy7nQuz.js";import"./ImageModal-B-T9iH0u.js";import"./InfoCard-CUC-ocyx.js";const le={class:"p-6"},re={class:"mb-4 text-xl font-bold text-red-600"},ue={class:"mb-4 text-gray-700 dark:text-gray-300"},de={key:0,class:"mb-6 text-lg font-semibold"},ce={class:"text-red-700 dark:text-red-400"},me={class:"flex justify-end gap-3 mt-4"},pe={key:0},he={key:1},ve={__name:"ConfirmModal",emits:["close","success"],setup(s,{expose:r,emit:y}){const{isActionLoading:p}=oe(),h=K(),f=i(!1),C=i("Konfirmasi Aksi"),w=i("Anda yakin ingin melanjutkan aksi ini?"),x=i(""),v=i(""),_=i("post"),$=i({});r({open:o=>{C.value=o.title||"Konfirmasi Penghapusan",w.value=o.message||"Anda yakin ingin menghapus data ini?",x.value=o.itemName||"",v.value=o.url||"",_.value=o.method||"post",$.value=o.data||{},f.value=!0}});const I=()=>{f.value=!1,M("close")},j=()=>{if(!v.value){h.error("URL aksi tidak terdefinisi.");return}p.value=!0;const o=_.value.toLowerCase();O[o](v.value,$.value||{},{preserveScroll:!0,onSuccess:()=>{I(),M("close")},onError:d=>{h.error(d.message||"Terjadi kesalahan saat menghapus data.")},onFinish:()=>{p.value=!1,v.value=""}})},M=y;return(o,d)=>(u(),A(se,{show:f.value,onClose:d[0]||(d[0]=H=>M("close")),maxWidth:"md"},{default:c(()=>[a("div",le,[a("h3",re,S(C.value),1),a("p",ue,S(w.value),1),x.value?(u(),m("p",de,[d[1]||(d[1]=k(" Item: ",-1)),a("span",ce,S(x.value),1)])):b("",!0),a("div",me,[n(ie,{onClick:I,type:"button"},{default:c(()=>[...d[2]||(d[2]=[k(" Batal ",-1)])]),_:1}),n(ne,{onClick:j,disabled:D(p)},{default:c(()=>[D(p)?(u(),m("span",pe,"Memproses...")):(u(),m("span",he,"Ya"))]),_:1},8,["disabled"])])])]),_:1},8,["show"]))}},fe={class:"flex items-center gap-2 mb-3 text-sm text-gray-500 dark:text-gray-300"},ge={class:"flex justify-end gap-2 mt-4"},ke=["onClick","title"],Ce=["href"],be={class:"w-full mt-4 space-y-6"},ye={key:0,class:"flex justify-end mb-4"},qe={__name:"PurchaseDetail",props:{purchase:Object,invoices:Object,invoice:Object,paymentStatuses:Array,isCheckingMode:Boolean},setup(s){const r=s,y=i(!1),p=i(null),h=i(!1),f=i(null),C=i(!1),w=i(!1);Z(()=>{r.purchase.status==="diterima"&&!r.invoice.id&&I()});const x=i(r.purchase.items.map(t=>({...t,rejected_quantity:t.rejected_quantity||0,is_valid:t.quantity-(t.rejected_quantity||0)>0}))),v=E(()=>{const t=r.purchase;return t.status!=="checking"||t.items.some(g=>g.item_status==="pending")||t.invoices.length===0?!1:t.invoices.every(g=>{const L=g.status==="validated",F=g.items&&g.items.length>0;return L&&F})}),_=E(()=>["diterima","checking"].includes(r.purchase.status)),$=E(()=>r.purchase.status==="draft"),B=()=>{v.value&&(C.value=!0)},I=()=>{f.value=null,h.value=!0},j=t=>{f.value=t,h.value=!0},M=t=>{const e={title:"Hapus Nota Keuangan",message:`Hapus Nota No. ${t.invoice_number}? Ini akan menghapus file foto dan mengembalikan status transaksi ke RECEIVED jika tidak ada nota lain.`,itemName:t.invoice_number,url:route("purchases.destroyInvoice",{purchase:r.purchase.id,invoice:t.id})};p.value.open(e)},o=()=>{h.value=!1,O.reload({preserveScroll:!0,preserveState:!0})},d=()=>{const t={title:"Hapus Pembelian",message:`Apakah Anda yakin ingin menghapus pembelian #${r.purchase.reference_no}? Tindakan ini tidak dapat dibatalkan.`,url:route("purchases.destroy",r.purchase.id)};p.value.open(t)},H=(t,e)=>{const l={title:"Konfirmasi Perubahan Status",message:`Anda yakin ingin mengubah status transaksi ${t.reference_no} menjadi ${e.toUpperCase()}?`,itemName:t.reference_no,url:route("purchases.update-status",{purchase:t.id}),method:"put",data:{status:e}};w.value.open(l)},R=t=>{const e=[];switch(t.status){case"draft":e.push({label:"Tandai Dipesan",icon:"play",type:"status",newStatus:"dipesan"});break;case"dipesan":e.push({label:"Tandai Dikirim",icon:"truck",type:"status",newStatus:"dikirim"});break;case"dikirim":e.push({label:"Tandai Diterima",icon:"receive",type:"status",newStatus:"diterima"});break;case"diterima":e.push({label:"Batalkan Terima",icon:"undo",type:"status",newStatus:"dikirim"});break}return e},z=[{key:"invoices",label:"Invoice & Pembayaran"},{key:"products",label:"Validasi Item"}];return(t,e)=>(u(),m(P,null,[n(D(U),{title:`Detail - ${s.purchase.reference_no}`},null,8,["title"]),n(G,{ref_key:"deleteModalRef",ref:p,onSuccess:o},null,512),n(ve,{ref_key:"showConfirmModal",ref:w,onSuccess:o},null,512),n(J,{show:C.value,purchase:s.purchase,onClose:e[0]||(e[0]=l=>C.value=!1)},null,8,["show","purchase"]),n(ae,{show:y.value,purchase:s.purchase,"store-name":t.$page.props.auth.user.store_name||"INVENTRA STORE",onClose:e[1]||(e[1]=l=>y.value=!1)},null,8,["show","purchase","store-name"]),n(q,{showSidebar:!1,showHeader:!1},{default:c(()=>[a("div",fe,[n(D(N),{href:t.route("purchases.index"),class:"flex items-center transition hover:text-indigo-600"},{default:c(()=>[...e[5]||(e[5]=[a("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),k(" Riwayat ",-1)])]),_:1},8,["href"]),e[6]||(e[6]=a("span",null,"/",-1)),a("span",null,"Detail Pembelian # "+S(s.purchase.reference_no),1)]),n(te,{data:r.purchase,mode:t.type},null,8,["data","mode"]),n(Q,{show:h.value,purchaseId:s.purchase.id,editingInvoice:f.value,paymentStatuses:s.paymentStatuses,onClose:e[2]||(e[2]=l=>h.value=!1),onInvoiceSaved:o},null,8,["show","purchaseId","editingInvoice","paymentStatuses"]),a("div",ge,[(u(!0),m(P,null,W(R(s.purchase),(l,g)=>(u(),m("button",{key:g,onClick:L=>H(s.purchase,l.newStatus),class:V([{"text-lime-600 font-semibold":l.isPrimary,"border-b-2":l.newStatus==="ordered"},"px-3 py-1 text-sm font-medium text-white transition border rounded-lg shadow-sm bg-lime-500 hover:bg-lime-600 dark:hover:bg-lime-700 dark:text-gray-100 active:scale-95"]),title:l.label},S(l.label),11,ke))),128)),s.purchase.status==="checking"?(u(),A(T,{key:0,disable:!v.value,onClick:B,class:V({"opacity-50 cursor-not-allowed":!v.value})},{default:c(()=>[...e[7]||(e[7]=[k(" Selesaikan Validasi ",-1)])]),_:1},8,["disable","class"])):b("",!0),$.value?(u(),A(D(N),{key:1,class:"flex items-center gap-2 px-4 py-2 text-sm font-bold text-white transition bg-yellow-500 rounded-lg shadow-sm hover:bg-yellow-600 active:scale-95",title:"Edit Order"},{default:c(()=>[...e[8]||(e[8]=[a("svg",{class:"w-3 h-3 sm:w-5 sm:h-5",viewBox:"0 0 24 24",fill:"currentColor"},[a("path",{d:"M19.9902 18.9531C20.5471 18.9534 21 19.4124 21 19.9766C21 20.5418 20.5471 20.9998 19.9902 21H14.2793C13.7224 20.9998 13.2695 20.5419 13.2695 19.9766C13.2696 19.4124 13.7224 18.9533 14.2793 18.9531H19.9902ZM12.2412 3.95703C13.1538 2.78531 14.7463 2.67799 16.0303 3.69922L17.5049 4.87109C18.1097 5.34407 18.5134 5.96737 18.6514 6.62305C18.8105 7.34415 18.6403 8.05244 18.1631 8.66504L9.37598 20.0283C8.97274 20.544 8.37869 20.834 7.74219 20.8447L4.24023 20.8877C4.0493 20.8876 3.89009 20.7589 3.84766 20.5762L3.05176 17.125C2.91398 16.4909 3.05194 15.8352 3.45508 15.3301L9.68457 7.26758C9.79068 7.13908 9.98121 7.11856 10.1084 7.21387L12.7295 9.2998C12.8993 9.43955 13.1329 9.51467 13.377 9.48242C13.8969 9.41792 14.2474 8.94469 14.1943 8.43945C14.1625 8.18164 14.0349 7.96685 13.8652 7.80566C13.8122 7.76267 11.3184 5.7627 11.3184 5.7627C11.1593 5.63368 11.1276 5.39743 11.2549 5.2373L12.2412 3.95703Z",fill:"currentColor"})],-1),k(" Edit ",-1)])]),_:1})):b("",!0),$.value?(u(),m("button",{key:2,onClick:d,class:"flex items-center gap-2 px-4 py-2 text-sm font-bold text-white transition bg-red-500 rounded-lg shadow-sm hover:bg-red-600 active:scale-95"},[...e[9]||(e[9]=[a("svg",{class:"w-3 h-3 sm:w-5 sm:h-5",viewBox:"0 0 24 24",fill:"none"},[a("path",{d:"M18.9395 8.69727C19.1385 8.69738 19.3191 8.78402 19.4619 8.93066C19.5952 9.08766 19.663 9.28326 19.6436 9.48926C19.6429 9.56521 19.1099 16.2984 18.8057 19.1338C18.6151 20.8747 17.493 21.9319 15.8096 21.9609C14.5151 21.9899 13.2497 22 12.0039 22C10.6812 22 9.3874 21.9899 8.13184 21.9609C6.50488 21.9218 5.38206 20.8457 5.20117 19.1338C4.88816 16.2881 4.36472 9.56385 4.35449 9.48926C4.34477 9.28326 4.41071 9.08766 4.54492 8.93066C4.67715 8.78375 4.86811 8.69731 5.06836 8.69727H18.9395ZM14.0645 2C14.9485 2 15.7382 2.61708 15.9668 3.49707L16.1309 4.22656C16.2631 4.82145 16.778 5.24302 17.3711 5.24316H20.2871C20.676 5.24316 20.9998 5.56576 21 5.97656V6.35742C20.9998 6.75821 20.676 7.09082 20.2871 7.09082H3.71387C3.32402 7.09082 3.00025 6.75821 3 6.35742V5.97656C3.00021 5.56576 3.324 5.24316 3.71387 5.24316H6.62988C7.22203 5.24301 7.7369 4.82143 7.87012 4.22754L8.02344 3.5459C8.26078 2.61698 9.04181 2 9.93555 2H14.0645Z",fill:"currentColor"})],-1),k(" Hapus ",-1)])])):b("",!0),a("a",{href:t.route("purchases.print",s.purchase.id),target:"_blank",class:"flex items-center gap-2 px-4 py-2 text-sm font-bold text-white transition bg-gray-500 rounded-lg shadow-sm hover:bg-gray-600 active:scale-95",title:"Cetak Purchase Order (PO)"},[...e[10]||(e[10]=[a("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})],-1),a("span",null,"Cetak Order",-1)])],8,Ce),s.purchase.status==="draft"?(u(),m("button",{key:3,onClick:e[3]||(e[3]=l=>y.value=!0),class:"flex items-center gap-2 px-4 py-2 text-sm font-bold text-white transition bg-green-500 rounded-lg shadow-sm hover:bg-green-600 active:scale-95",title:"Kirim Pesanan via WhatsApp"},[...e[11]||(e[11]=[a("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[a("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"})],-1),a("span",null,"Order via WA",-1)])])):b("",!0)]),a("div",be,[n(Y,{tabs:z,defaultTab:"invoices"},{invoices:c(()=>[_.value?(u(),m("div",ye,[n(T,{onClick:I},{default:c(()=>[...e[12]||(e[12]=[k(" + Tambah Nota Baru ",-1)])]),_:1})])):b("",!0),n(X,{purchase:s.purchase,isCheckingMode:s.isCheckingMode,canEditDelete:_.value,onEditInvoice:j,onDeleteInvoice:e[4]||(e[4]=l=>M(s.invoice))},null,8,["purchase","isCheckingMode","canEditDelete"])]),products:c(()=>[n(ee,{items:x.value},null,8,["items"])]),_:1})])]),_:1})],64))}};export{qe as default};
