import{q as o,J as j,v as B,l as n,o as a,f as t,y as M,z as q,g as h,m as V,F as k,H as w,d as z,a as H}from"./vendor-core-CTIsLlXR.js";import{j as T}from"./vendor-common-GpUWqhKr.js";import L from"./CatalogCard-Cth3vkB2.js";import"./vendor-charts-Bw6UNgWf.js";const N={class:"flex flex-col h-full"},O={class:"sticky top-0 z-20 p-3 bg-white border-b rounded-lg shadow-sm dark:bg-gray-800 dark:border-gray-700"},S={class:"relative"},A={class:"flex-1 py-3 overflow-y-auto md:p-3 custom-scrollbar"},F={key:0,class:"grid grid-cols-2 gap-3 md:grid-cols-3 lg:grid-cols-4"},$={key:1,class:"grid grid-cols-2 gap-3 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5"},D={key:2,class:"flex flex-col items-center justify-center py-10 text-gray-400"},E={key:3,class:"flex justify-center py-4"},U={__name:"CatalogView",props:{supplierId:{type:[Number,String],required:!0},items:Object,stagingItem:Object},emits:["select-product"],setup(m,{emit:x}){const i=m,_=x,l=o([]),d=o(!1),u=o(!1),p=o(1),c=o(!0),g=o(""),v=o(null),f=async(r=!1)=>{if(i.supplierId){r?(d.value=!0,p.value=1,l.value=[],c.value=!0):u.value=!0;try{const e=await H.get(`/purchases/products/${i.supplierId}`,{params:{page:p.value,search:g.value}}),s=e.data.data;r?l.value=s:l.value=[...l.value,...s],c.value=!!e.data.next_page_url,c.value&&p.value++}catch(e){console.error("Gagal load katalog:",e)}finally{d.value=!1,u.value=!1}}};j(()=>i.supplierId,r=>{r?(g.value="",f(!0)):l.value=[]},{immediate:!0});const y=T(()=>{f(!0)},500),I=r=>{r[0].isIntersecting&&c.value&&!d.value&&!u.value&&f(!1)};B(()=>{const r=new IntersectionObserver(I,{threshold:.1});v.value&&r.observe(v.value)});const b=r=>i.items.find(e=>e.product_id===r),C=r=>{_("select-product",r)};return(r,e)=>(a(),n("div",N,[t("div",O,[t("div",S,[e[2]||(e[2]=t("div",{class:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"},[t("svg",{class:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1)),M(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>g.value=s),onInput:e[1]||(e[1]=(...s)=>h(y)&&h(y)(...s)),type:"text",class:"block w-full py-2 pl-10 pr-3 leading-5 placeholder-gray-500 bg-white border border-gray-300 rounded-lg focus:outline-none focus:placeholder-gray-400 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 sm:text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:"Cari nama barang atau kode..."},null,544),[[q,g.value]])])]),t("div",A,[d.value?(a(),n("div",F,[(a(),n(k,null,w(8,s=>t("div",{key:s,class:"flex flex-col p-2 bg-white rounded-lg shadow dark:bg-gray-800 animate-pulse"},[...e[3]||(e[3]=[t("div",{class:"w-full mb-2 bg-gray-200 rounded aspect-square dark:bg-gray-700"},null,-1),t("div",{class:"w-3/4 h-4 mb-2 bg-gray-200 rounded dark:bg-gray-700"},null,-1),t("div",{class:"w-1/2 h-3 mt-auto bg-gray-200 rounded dark:bg-gray-700"},null,-1)])])),64))])):l.value.length>0?(a(),n("div",$,[(a(!0),n(k,null,w(l.value,s=>(a(),z(L,{key:s.id,item:s,"is-selected":m.stagingItem.product_id===s.id,"is-in-cart":!!b(s.id),"cart-qty":b(s.id)?.quantity||0,onSelect:C},null,8,["item","is-selected","is-in-cart","cart-qty"]))),128))])):(a(),n("div",D,[...e[4]||(e[4]=[t("svg",{class:"w-12 h-12 mb-2 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})],-1),t("p",{class:"text-sm"},"Tidak ada produk ditemukan",-1)])])),u.value?(a(),n("div",E,[...e[5]||(e[5]=[t("svg",{class:"w-5 h-5 text-blue-500 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])])):V("",!0),t("div",{ref_key:"observerTarget",ref:v,class:"w-full h-4"},null,512)])]))}};export{U as default};
