import{y as te,x as d,u as ne,C as le,S as ie,z as de,N as ue,j as b,P as ce,g as u,o as c,a as I,b as a,d as l,h as me,i as T,w as ge,l as pe,k as fe,A as ve,W as he,n as X,F as K,q as Z,t as j,p as ye,f as ee}from"./app-B5O1DEgc.js";import{a as J,H as be}from"./html5-qrcode-scanner-Dc90e2ja.js";import"./debounce-Qd2jp9-c.js";import xe from"./ConfirmSubmit-DAjmGfu6.js";import ke from"./ScannerBox-BHG4zOGu.js";import we from"./Cart-D61mfKKi.js";import _e from"./ScannerModeModal-DcfABb0I.js";import"./Modal-BsyCXhxW.js";import"./MoneyInput-BfnfOkYF.js";function Se($){const x=te(),M="POS_REALTIME_DRAFT_V3",k=d(""),f=d("all"),C=d([]),F=d(!1),v=d(8),q=d(""),P=d([]),R=d(!1),w=d(null),m=d(null),z=d(!1),A=d("single"),h=d(null),o=ne({input_type:"realtime",report_date:new Date().toISOString().slice(0,10),items:[],customer_id:null,payment_amount:0,change_amount:0,payment_method:"cash",discount_type:"fixed",discount_value:0,notes:""});le(async()=>{F.value=!0;try{const t=await ie.get(route("sales.products.lite"));C.value=t.data}catch(t){console.error("Gagal load produk:",t),x.error("Gagal memuat database produk")}finally{F.value=!1}const e=localStorage.getItem(M);if(e)try{const t=JSON.parse(e);t.items&&(o.items=t.items),o.payment_amount=t.payment_amount||0,o.payment_method=t.payment_method||"cash",o.notes=t.notes||"",o.discount_type=t.discount_type||"fixed",o.discount_value=t.discount_value||0,t.selectedMember&&(w.value=t.selectedMember,o.customer_id=t.selectedMember.id)}catch{localStorage.removeItem(M)}}),de([()=>o.items,()=>o.customer_id,()=>o.payment_amount,()=>o.discount_value,()=>o.notes],()=>{localStorage.setItem(M,JSON.stringify({items:o.items,customer_id:o.customer_id,payment_amount:o.payment_amount,payment_method:o.payment_method,notes:o.notes,discount_type:o.discount_type,discount_value:o.discount_value,selectedMember:w.value}))},{deep:!0});const E=async(e,t="single")=>{m.value=e,A.value=t,z.value=!0,await ce();const n=[J.CODE_128,J.EAN_13,J.QR_CODE],i=new be("reader");h.value=i,i.start({facingMode:"environment"},{fps:30,qrbox:{width:250,height:150},formatsToSupport:n},S=>{O(S)},S=>{}).catch(S=>{console.log(S),m.value=null,z.value=!1,alert("Gagal membuka kamera. Pastikan izin diberikan.")})},D=()=>{h.value?h.value.stop().then(()=>{h.value.clear(),m.value=null,z.value=!1}).catch(e=>console.log(e)):(m.value=null,z.value=!1)},O=e=>{if(m.value==="product"){const t=$.products.find(n=>n.code==e);t?(_(t),A.value==="single"&&D()):alert(`Produk ${e} tidak ditemukan!`)}else if(m.value==="member"){const t=$.customers.find(n=>n.member_code==e||n.phone==e);t?(Y(t),D(),alert(`Member: ${t.name}`)):alert(`Member ${e} tidak terdaftar!`)}};ue(()=>{h.value&&h.value.isScanning&&h.value.stop()});const L=b(()=>{let e=C.value;if(f.value!=="all"&&(e=e.filter(t=>t.category_id===f.value)),k.value){const t=k.value.toLowerCase();e=e.filter(n=>n.name.toLowerCase().includes(t)||n.code.toLowerCase().includes(t))}return e.slice(0,v.value)}),H=()=>{v.value<C.value.length&&(v.value+=20)};b(()=>{if(!q){P.value=[];return}if(q.value){const e=q.value.toLowerCase();result=$.customers.filter(t=>t.name.toLowerCase().includes(e)||t.code.toLowerCase().includes(e))}P.value=result.slice(0,5)});const g=b(()=>o.items.reduce((e,t)=>e+(parseFloat(t.subtotal)||0),0)),B=b(()=>{const e=parseFloat(o.discount_value)||0;if(e<=0)return 0;if(o.discount_type==="percent"){const t=e>100?100:e;return Math.round(g.value*t/100)}return e>g.value?g.value:e}),y=b(()=>{const e=g.value-B.value,t=e>0?e:0;return t===0&&(o.payment_amount=0,o.discount_value=0),t}),N=b(()=>(parseFloat(o.payment_amount)||0)-y.value),V=b(()=>o.payment_method!=="cash"&&o.payment_method!==""?!0:(parseFloat(o.payment_amount)||0)>=y.value),G=b(()=>o.items.some(e=>e.quantity<=0||isNaN(e.quantity))),p=b(()=>{const e=y.value;if(e<=0)return[];const t=[{label:"Uang Pas",value:e}];if([2e3,5e3,1e4,2e4,5e4,1e5].forEach(i=>{i>e&&!t.find(S=>S.value===i)&&t.push({label:Q(i),value:i})}),e>5e4){const i=Math.ceil(e/5e4)*5e4;t.find(S=>S.value===i)||t.push({label:Q(i),value:i})}return t.slice(0,4)}),s=e=>{o.payment_amount=e.value},r=()=>{o.payment_amount=0},_=e=>{if(parseFloat(e.stock)<=0){x.error("Stok habis!");return}const t=o.items.find(n=>n.product_id===e.id);if(t){if(t.quantity+1>e.stock){x.warning("Stok maksimal!");return}t.quantity++,U(t)}else{const n=parseFloat(e.selling_price||e.price);o.items.push({product_id:e.id,code:e.code,name:e.name,unit:e.unit,stock_max:parseFloat(e.stock),image:e.image_path,selling_price:n,original_price:n,quantity:1,subtotal:n})}},W=e=>o.items.splice(e,1),ae=(e,t)=>{const n=o.items[e],i=parseFloat(n.quantity)+t;if(i>n.stock_max){x.warning(`Stok sisa ${n.stock_max}`);return}if(i<=0){confirm("Hapus item ini?")&&W(e);return}n.quantity=i,U(n)},U=e=>{e.unit?.is_decimal===1||(e.quantity=Math.round(e.quantity),e.quantity<1&&(e.quantity=1)),e.quantity>e.stock_max&&(e.quantity=e.stock_max,x.warning(`Stok sisa ${e.stock_max}`)),e.subtotal=Math.round(e.quantity*e.selling_price)},se=e=>{const t=parseFloat(e.subtotal)||0,n=parseFloat(e.selling_price)||0;if(!(n<=0))if(e.unit?.is_decimal===1){let i=t/n;i>e.stock_max&&(i=e.stock_max,e.subtotal=Math.round(i*n),x.warning("Melebihi sisa stok!")),e.quantity=parseFloat(i.toFixed(4))}else confirm(`âš ï¸ Ubah harga satuan agar sesuai total Rp ${Q(t)}?`)?e.quantity>0&&(e.selling_price=Math.round(t/e.quantity)):e.subtotal=Math.round(e.quantity*e.selling_price)},oe=e=>{e.subtotal=Math.round(e.quantity*e.selling_price)},Y=e=>{w.value=e,o.customer_id=e.id,P.value=[],q.value=""},re=(e=!1,t={})=>{o.change_amount=N.value,o.payment_amount=parseFloat(o.payment_amount),o.transform(n=>({...n,print_invoice:e})).post(route("sales.pos.store"),{onStart:t.onStart,onFinish:t.onFinish,onSuccess:n=>{localStorage.removeItem(M),o.reset(),o.items=[],w.value=null,t.onSuccess&&t.onSuccess(n)},onError:n=>{console.error(n),x.error("Gagal memproses transaksi")}})},Q=e=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(e);return{form:o,allProducts:C,filteredProducts:L,isFetchingData:F,startScanner:E,stopScanner:D,activeScannerType:m,scannerType:A,showScanner:z,searchQuery:k,selectedCategory:f,loadMoreProducts:H,memberSearch:q,memberSearchResults:P,isLoadingMember:R,selectedMember:w,selectMember:Y,removeMember:()=>{w.value=null,o.customer_id=null},subTotal:g,discountAmount:B,grandTotal:y,changeAmount:N,isPaymentSufficient:V,hasInvalidQty:G,moneySuggestions:p,addItem:_,removeItem:W,updateQty:ae,recalcFromQty:U,recalcFromSubtotal:se,recalcFromPrice:oe,handleMoneyClick:s,resetPayment:r,submitTransaction:re,rp:Q}}const Me={class:"flex flex-col lg:flex-row h-[100dvh] w-full bg-gray-100 dark:bg-gray-900 overflow-hidden font-sans transition-colors duration-300"},Ce={class:"relative flex flex-col flex-1 h-full overflow-hidden"},Fe={class:"z-10 flex items-center gap-3 px-4 py-3 bg-white border-b shadow-sm shrink-0 dark:bg-gray-800 dark:border-gray-700"},qe={class:"relative flex-1"},Te={key:0,class:"absolute right-11 top-3.5 flex items-center gap-2"},je={class:"px-4 py-2 overflow-x-auto bg-white border-b shadow-sm shrink-0 dark:bg-gray-800 dark:border-gray-700 whitespace-nowrap scrollbar-hide"},$e=["onClick"],Pe={class:"grid grid-cols-2 gap-3 pb-20 md:grid-cols-3 lg:grid-cols-4"},ze=["onClick"],Be={class:"relative w-full overflow-hidden bg-gray-100 aspect-square dark:bg-gray-700"},Ie=["src"],Ae={key:1,class:"absolute z-10 top-2 right-2"},De={class:"bg-gray-900/70 backdrop-blur text-white text-[10px] font-bold px-2 py-1 rounded-lg shadow-sm"},He={key:2,class:"absolute z-10 top-2 left-2"},Le={class:"bg-red-500 text-white text-[10px] font-bold px-2 py-1 rounded-lg shadow-sm animate-pulse"},Ne={class:"p-3 flex flex-col h-[85px] justify-between"},Qe={class:"text-xs font-bold leading-snug text-gray-800 sm:text-sm dark:text-gray-100 line-clamp-2"},Re={class:"flex items-end justify-between mt-1"},Ee={class:"flex flex-col"},Oe={class:"text-[13px] sm:text-[15px] font-black text-lime-600 dark:text-lime-400 leading-none"},Ve={key:0,class:"py-10 text-center"},Ge={key:1,class:"flex flex-col items-center justify-center px-4 py-16 text-center animate-fade-in"},Ue={key:2,class:"py-4 text-center text-[10px] text-gray-400"},Ke={key:0,class:"absolute z-30 lg:hidden bottom-4 left-4 right-4"},Je={class:"flex items-center gap-3"},We={class:"flex items-center justify-center text-xs font-bold text-white rounded-full shadow-sm bg-lime-500 dark:bg-white dark:text-lime-700 w-7 h-7"},Ye={class:"flex flex-col items-start leading-none gap-0.5"},Xe={class:"text-lg font-bold"},it={__name:"index",props:{categories:Array,customers:Array},setup($){const M=Se($),{form:k,filteredProducts:f,isFetchingData:C,searchQuery:F,selectedCategory:v,loadMoreProducts:q,startScanner:P,stopScanner:R,activeScannerType:w,showScanner:m,scannerType:z,addItem:A,grandTotal:h,changeAmount:o,isPaymentSufficient:E,hasInvalidQty:D,submitTransaction:O,rp:L}=M,H=te(),g=d(!1),B=d(!1),y=d(!1),N=p=>{const{scrollTop:s,clientHeight:r,scrollHeight:_}=p.target;s+r>=_-50&&q()},V=()=>{B.value=!0},G=p=>{if(k.items.length===0)return H.error("Keranjang kosong!");if(D.value)return H.error("Qty tidak valid!");if(k.payment_method==="cash"&&!E.value)return H.error("Uang kurang!");O(p,{onSuccess:s=>{y.value=!1,g.value=!1;const r=s.props.flash?.print_url;p&&r?setTimeout(()=>{window.open(r,"_blank","width=300,height=600")},50):p&&!r&&alert("Gagal mendapatkan URL Print dari server.")}})};return(p,s)=>(c(),u(K,null,[I(l(me),{title:"Kasir POS"}),I(xe,{showConfirmModal:y.value,changeAmount:l(o),onClose:s[0]||(s[0]=r=>y.value=!1),onConfirmTransaction:G},null,8,["showConfirmModal","changeAmount"]),I(ke,{showScanner:l(m),activeScannerType:l(w),onClose:s[1]||(s[1]=r=>m.value=!1),onStopScanner:l(R)},null,8,["showScanner","activeScannerType","onStopScanner"]),I(_e,{show:B.value,onClose:s[2]||(s[2]=r=>B.value=!1),onModeSelected:l(P)},null,8,["show","onModeSelected"]),a("div",Me,[a("div",Ce,[a("div",Fe,[I(l(pe),{href:p.route("dashboard"),class:"p-2 rounded-lg bg-lime-50 dark:bg-gray-700 text-lime-700 dark:text-lime-400"},{default:ge(()=>[...s[10]||(s[10]=[a("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1)])]),_:1},8,["href"]),a("div",qe,[fe(a("input",{"onUpdate:modelValue":s[3]||(s[3]=r=>he(F)?F.value=r:null),type:"text",placeholder:"Cari Nama / Kode...",class:"w-full pl-9 pr-10 py-2.5 bg-gray-100 dark:bg-gray-900 border-none rounded-xl focus:ring-2 focus:ring-lime-500 text-sm dark:text-white transition-all shadow-inner"},null,512),[[ve,l(F)]]),s[13]||(s[13]=a("span",{class:"absolute text-gray-400 left-3 top-3"},"ðŸ”",-1)),l(C)?(c(),u("div",Te,[...s[11]||(s[11]=[a("span",{class:"text-[10px] text-gray-400 italic"},"Syncing...",-1),a("span",{class:"relative flex w-2 h-2"},[a("span",{class:"absolute inline-flex w-full h-full rounded-full opacity-75 animate-ping bg-lime-400"}),a("span",{class:"relative inline-flex w-2 h-2 rounded-full bg-lime-500"})],-1)])])):T("",!0),a("button",{onClick:s[4]||(s[4]=r=>V()),class:"absolute right-1.5 top-1.5 p-1 bg-white dark:bg-gray-700 rounded-lg shadow-sm text-gray-600 dark:text-gray-200 hover:text-lime-600 hover:bg-lime-50 transition border border-gray-200 dark:border-gray-600",title:"Scan Produk"},[...s[12]||(s[12]=[a("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})],-1)])])])]),a("div",je,[a("button",{onClick:s[5]||(s[5]=r=>v.value="all"),class:X([l(v)==="all"?"bg-lime-500 text-white shadow-lime-500/40":"bg-gray-50 dark:bg-gray-700 text-gray-600 dark:text-gray-300 border border-gray-200 dark:border-gray-600","px-5 py-2 mr-2 text-xs font-bold transition-all rounded-full active:scale-95"])}," Semua ",2),(c(!0),u(K,null,Z($.categories,r=>(c(),u("button",{key:r.id,onClick:_=>v.value=r.id,class:X([l(v)===r.id?"bg-lime-500 text-white shadow-lime-500/40":"bg-gray-50 dark:bg-gray-700 text-gray-600 dark:text-gray-300 border border-gray-200 dark:border-gray-600","px-5 py-2 mr-2 text-xs font-bold transition-all rounded-full active:scale-95"])},j(r.name),11,$e))),128))]),a("div",{class:"h-[calc(100vh-220px)] flex-1 p-4 overflow-y-auto bg-gray-100 custom-scroll pb-28 lg:pb-4 dark:bg-gray-900",onScroll:N},[a("div",Pe,[(c(!0),u(K,null,Z(l(f),r=>(c(),u("div",{key:r.id,onClick:_=>l(A)(r),class:"relative overflow-hidden transition-all bg-white border border-gray-200 shadow-sm cursor-pointer group dark:bg-gray-800 rounded-xl dark:border-gray-700 hover:shadow-md hover:border-lime-500 active:scale-95"},[a("div",Be,[r.image_path?(c(),u("img",{key:0,src:r.image_url,loading:"lazy",decoding:"async",alt:"",class:"absolute inset-0 z-10 object-cover w-full h-full transition-opacity duration-500 opacity-0",onload:"this.classList.remove('opacity-0')",onerror:"this.style.display='none'"},null,8,Ie)):T("",!0),s[14]||(s[14]=a("div",{class:"flex flex-col items-center justify-center w-full h-full text-gray-500 bg-gray-300 dark:text-gray-700 dark:bg-gray-400"},[a("svg",{class:"w-10 h-10",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})]),a("span",{class:"text-[9px] font-bold mt-1 opacity-50"},"NO IMG")],-1)),r.unit?(c(),u("div",Ae,[a("span",De,j(r.unit.name),1)])):T("",!0),r.stock<=5?(c(),u("div",He,[a("span",Le," Sisa "+j(parseFloat(r.stock)),1)])):T("",!0),s[15]||(s[15]=a("div",{class:"absolute inset-0 z-20 flex items-center justify-center transition-opacity opacity-0 bg-lime-500/20 group-hover:opacity-100"},[a("div",{class:"p-2 text-white transition-transform duration-300 scale-0 rounded-full shadow-lg bg-lime-500 group-hover:scale-110"},[a("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})])])],-1))]),a("div",Ne,[a("h3",Qe,j(r.name),1),a("div",Re,[a("div",Ee,[a("span",Oe,j(l(L)(r.selling_price||r.price)),1)]),s[16]||(s[16]=a("div",{class:"text-gray-300 transition-colors group-hover:text-lime-500"},[a("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"})])],-1))])])],8,ze))),128))]),l(C)&&l(f).length===0?(c(),u("div",Ve,[...s[17]||(s[17]=[a("div",{class:"w-8 h-8 mx-auto mb-2 border-b-2 rounded-full animate-spin border-lime-500"},null,-1),a("span",{class:"text-xs text-gray-400"},"Memuat database produk...",-1)])])):l(f).length===0?(c(),u("div",Ge,[s[19]||(s[19]=ye('<div class="relative mb-6"><div class="flex items-center justify-center w-24 h-24 rounded-full shadow-inner bg-gray-50 dark:bg-gray-800"><svg class="w-12 h-12 text-gray-300 dark:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></div><div class="absolute -top-2 -right-2 bg-white dark:bg-gray-700 rounded-full p-1.5 shadow-md border border-gray-100 dark:border-gray-600"><div class="p-1 rounded-full bg-lime-100 dark:bg-lime-900/50"><svg class="w-5 h-5 text-lime-500 dark:text-lime-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01"></path></svg></div></div></div><h3 class="mb-2 text-lg font-bold text-gray-900 dark:text-white"> Produk tidak ditemukan </h3><p class="max-w-xs mx-auto mb-6 text-sm leading-relaxed text-gray-500 dark:text-gray-400"> Kami tidak dapat menemukan produk dengan kata kunci atau kategori tersebut. </p>',3)),a("button",{onClick:s[6]||(s[6]=r=>{p.search="",v.value="all"}),class:"inline-flex items-center gap-2 px-5 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 border border-gray-200 dark:border-gray-700 hover:border-lime-500 hover:text-lime-600 dark:hover:border-lime-500 dark:hover:text-lime-400 shadow-sm hover:shadow-md"},[...s[18]||(s[18]=[a("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),ee(" Reset Pencarian ",-1)])])])):T("",!0),l(f).length>0&&l(f).length%20===0?(c(),u("div",Ue," Scroll untuk memuat lebih banyak... ")):T("",!0)],32),l(k).items.length>0?(c(),u("div",Ke,[a("button",{onClick:s[7]||(s[7]=r=>g.value=!0),class:"w-full bg-gray-900 dark:bg-lime-600 text-white p-3.5 rounded-2xl shadow-xl shadow-gray-900/20 flex justify-between items-center animate-bounce-subtle"},[a("div",Je,[a("span",We,j(l(k).items.reduce((r,_)=>r+parseFloat(_.quantity),0)),1),a("div",Ye,[s[20]||(s[20]=a("span",{class:"text-[9px] text-gray-400 dark:text-lime-100 uppercase font-bold tracking-wider"},"Total Belanja",-1)),a("span",Xe,j(l(L)(l(h))),1)])]),s[21]||(s[21]=a("span",{class:"flex items-center gap-1 px-4 py-2 text-xs font-bold bg-gray-700 dark:bg-lime-800/30 rounded-xl"},[ee(" Bayar "),a("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14 5l7 7m0 0l-7 7m7-7H3"})])],-1))])])):T("",!0)]),I(we,{showMobileCart:g.value,reprops:l(M),onShowBayar:s[8]||(s[8]=r=>y.value=!0),onShowDesktop:s[9]||(s[9]=r=>g.value=!1)},null,8,["showMobileCart","reprops"])])],64))}};export{it as default};
