const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/HeadRabMobile-Ci_YynPH.js","assets/vendor-core-BhnropoY.js","assets/vendor-common-pmZ7KOuE.js","assets/vendor-charts-Bw6UNgWf.js","assets/vendor-core-DnojJsHo.css","assets/InputError-CMWgHCqc.js","assets/HeadRabDesktop-hq6ujyEl.js","assets/PrimaryButton-CO53NIUy.js","assets/_plugin-vue_export-helper-DlAUqK2U.js","assets/SecondaryButton-Pyc8zkMX.js"])))=>i.map(i=>d[i]);
import{_ as $}from"./app-BcbqQI1B.js";import{_ as ae}from"./AuthenticatedLayout-DOvg59QG.js";import{p as se,C as g,q as v,u as re,J as ie,v as ne,N as oe,l as f,o as p,e as x,g as a,i as le,w as ue,f as l,d as y,a2 as V,n as q,k as de,m as ce,t as pe,a3 as me,R as ge,F as ve}from"./vendor-core-BhnropoY.js";import{u as he}from"./useActionLoading-Bnt8PnmV.js";import{u as _e}from"./usePurchaseCart-CG2iZusO.js";import fe from"./CatalogView-BZ6Tpoob.js";import ye from"./PurchaseTable-Bw66x-Dd.js";import ke from"./recom-D9t0M5Fm.js";import"./vendor-common-pmZ7KOuE.js";import"./vendor-charts-Bw6UNgWf.js";import"./useSidebar-CFI5mUUz.js";import"./CatalogCard-Cbi9EwN1.js";import"./DataTable-BvrSFI3l.js";import"./BottomSheet-CZ2f5rAY.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const be={class:"w-full min-h-screen space-y-6"},we={class:"p-4 space-y-4 bg-white border border-gray-200 shadow-sm rounded-xl dark:bg-gray-900 dark:border-gray-700"},Se={class:"flex p-1 space-x-1 bg-gray-100 rounded-lg dark:bg-gray-700"},xe={key:0,class:"ml-2 bg-lime-100 text-lime-700 py-0.5 px-2 rounded-full text-xs font-bold"},Ie=["disabled"],je={key:0},Re={key:1},Ce={class:"min-h-[400px]"},k="inventra_draft_supplier_id",Ke={__name:"create",props:{purchase:Object,dropdowns:Object},setup(b){const O=V(()=>$(()=>import("./HeadRabMobile-Ci_YynPH.js"),__vite__mapDeps([0,1,2,3,4,5]))),L=V(()=>$(()=>import("./HeadRabDesktop-hq6ujyEl.js"),__vite__mapDeps([6,1,2,3,4,7,8,9,5]))),n=b,o=se(),{isActionLoading:I}=he(),d=g(()=>!!n.purchase&&!!n.purchase.id),w=g(()=>n.purchase?.status||"draft"),F=g(()=>w.value==="draft"),H=g(()=>w.value==="dipesan"),j=v(window.innerWidth<1024),R=()=>{j.value=window.innerWidth<1024},u=v("table"),m=v(!1),{cartItems:c,addToCart:K,updateCartItem:N,removeItem:U,clearCart:Q,totalUnit:C,totalBelanja:D,totalMacam:M,addMultipleItems:W}=_e(d.value,n.purchase),i=re({supplier_id:n.purchase?.supplier_id||"",transaction_date:n.purchase?.transaction_date||new Date().toISOString().split("T")[0],status:w.value,notes:n.purchase?.notes||"",shipping_cost:n.purchase?.shipping_cost||0,other_costs:n.purchase?.other_costs||0}),h=v(!1),T={product_id:null,name:"",code:"",unit:"",size:"",category:"",brand:"",type:"",image_url:"",current_stock:0,quantity:1,purchase_price:0,restock_recommendation:0},r=v({...T}),_=g({get:()=>r.value.purchase_price?Z(r.value.purchase_price):0,set:e=>r.value.purchase_price=ee(e)});ie(()=>i.supplier_id,e=>{e?(localStorage.setItem(k,e),m.value=!0,u.value="catalog"):(localStorage.removeItem(k),m.value=!1,u.value="table")}),ne(()=>{window.addEventListener("resize",R);const e=localStorage.getItem(k);e&&!i.supplier_id&&!d.value&&(i.supplier_id=e)}),oe(()=>{window.removeEventListener("resize",R)});const E=(e,t=1,s=null)=>{const B=e.insights?.find(te=>te.type==="restock")?.payload?.suggested_qty;r.value={product_id:e.product_id?e.product_id:e.id,name:e.name,code:e.code,category:e.category?.name||e.category||"-",unit:e.unit?.name||e.unit||"-",size:e.size?.name||e.size||"-",brand:e.brand?.name||e.brand||"-",type:e.type_name||e.type_name||"-",image_url:e.image_url,current_stock:e.stock||e.current_stock,quantity:B||t,purchase_price:s!==null?s:e.purchase_price||0,restock_recommendation:B}},S=()=>{r.value={...T},h.value=!1},G=e=>{E(e),u.value="catalog",window.scrollTo({top:0,behavior:"smooth"})},J=e=>{E(e,e.quantity,e.purchase_price),h.value=!0,u.value="table",window.scrollTo({top:0,behavior:"smooth"})},P=()=>{if(!r.value.product_id)return o.error("Mohon pilih produk dari katalog.");if(r.value.quantity<=0)return o.error("Kuantitas minimal harus 1.");c.value.find(t=>t.product_id===r.value.product_id)?(N({product_id:r.value.product_id,quantity:r.value.quantity,purchase_price:r.value.purchase_price}),o.success("Item diperbarui.")):(K(r.value,r.value.quantity,r.value.purchase_price),o.success("Item ditambahkan.")),S()},Y=e=>{if(H.value&&e.id)return o.warning("Item lama tidak boleh dihapus saat status Dipesan! Silakan edit Qty saja.");U(e.product_id)},X=e=>{W(e),o.info(`${e.length} item rekomendasi ditambahkan ke keranjang.`)},z=()=>{if(!i.supplier_id)return o.error("Pilih Supplier dulu!");if(c.value.length===0)return o.error("Keranjang kosong!");I.value=!0;const e=s=>({...s,items:c.value}),t={onSuccess:()=>{o.success(d.value?"Transaksi berhasil diperbarui!":"Transaksi berhasil disimpan!"),d.value||localStorage.removeItem(k);const s=d.value?`inventra_edit_${n.purchase.id}`:"inventra_create_draft";localStorage.removeItem(s),Q(),i.reset()},onError:s=>{console.error(s);const A=Object.values(s)[0]||"Terjadi kesalahan";o.error("Gagal: "+A)},onFinish:()=>{I.value=!1}};d.value?i.transform(e).put(route("purchases.update",n.purchase.id),t):i.transform(e).post(route("purchases.store"),t)};function Z(e){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(e)}function ee(e){return parseInt(String(e).replace(/[^0-9]/g,""))||0}return(e,t)=>(p(),f(ve,null,[x(a(le),{title:"Rancangan Anggaran Belanja"}),x(ae,{headerTitle:"Rancangan Anggaran Belanja",showSidebar:!1},{default:ue(()=>[x(ke,{show:m.value,supplierId:a(i).supplier_id,onClose:t[0]||(t[0]=s=>m.value=!1),onAddItems:X},null,8,["show","supplierId"]),l("div",be,[j.value?(p(),y(a(O),{key:0,"form-header":a(i),dropdowns:b.dropdowns,"staging-item":r.value,"is-edit":d.value,"is-editing-mode":h.value,"cart-items":a(c),"total-unit":a(C),"total-macam":a(M),"total-belanja":a(D),"displayed-price":_.value,"onUpdate:displayedPrice":t[1]||(t[1]=s=>_.value=s),onSaveStaging:P,onResetStaging:S,onSubmitTransaction:z,onOpenRecommendation:t[2]||(t[2]=s=>m.value=!0)},null,8,["form-header","dropdowns","staging-item","is-edit","is-editing-mode","cart-items","total-unit","total-macam","total-belanja","displayed-price"])):(p(),y(a(L),{key:1,"form-header":a(i),dropdowns:b.dropdowns,"staging-item":r.value,"is-edit":d.value,"is-editing-mode":h.value,"cart-items":a(c),"total-unit":a(C),"total-macam":a(M),"total-belanja":a(D),"displayed-price":_.value,"onUpdate:displayedPrice":t[3]||(t[3]=s=>_.value=s),onSaveStaging:P,onResetStaging:S,onSubmitTransaction:z,onOpenRecommendation:t[4]||(t[4]=s=>m.value=!0)},null,8,["form-header","dropdowns","staging-item","is-edit","is-editing-mode","cart-items","total-unit","total-macam","total-belanja","displayed-price"])),l("div",we,[l("div",Se,[l("button",{type:"button",onClick:t[5]||(t[5]=s=>u.value="table"),class:q(["flex items-center justify-center w-1/2 py-2.5 text-sm font-medium rounded-md transition-all duration-200 focus:outline-none",u.value==="table"?"bg-white text-gray-900 shadow dark:bg-gray-600 dark:text-white":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"])},[t[7]||(t[7]=l("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})],-1)),t[8]||(t[8]=de(" Daftar Belanja ",-1)),a(c).length>0?(p(),f("span",xe,pe(a(c).length),1)):ce("",!0)],2),l("button",{type:"button",onClick:t[6]||(t[6]=s=>u.value="catalog"),disabled:!a(i).supplier_id,class:q(["flex items-center justify-center w-1/2 py-2.5 text-sm font-medium rounded-md transition-all duration-200 focus:outline-none",[u.value==="catalog"?"bg-white text-gray-900 shadow dark:bg-gray-600 dark:text-white":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",a(i).supplier_id?"":"opacity-50 cursor-not-allowed"]])},[t[9]||(t[9]=l("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})],-1)),a(i).supplier_id?(p(),f("span",Re,"Katalog Produk")):(p(),f("span",je,"Pilih Supplier Dulu"))],10,Ie)]),l("div",Ce,[(p(),y(me,null,[(p(),y(ge(u.value==="table"?ye:fe),{"supplier-id":a(i).supplier_id,items:a(c),stagingItem:r.value,isDraft:F.value,onRemove:Y,onEdit:J,onSelectProduct:G},null,40,["supplier-id","items","stagingItem","isDraft"]))],1024))])])])]),_:1})],64))}};export{Ke as default};
