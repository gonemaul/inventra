import{p as F,q as L,a0 as U,a3 as V,l as n,o,f as e,n as f,m as v,g as k,y as p,z as x,K as H,x as D,k as l,t as d,e as w,w as _,F as M,H as T,I as c}from"./vendor-core-CJbEklrS.js";import{u as I}from"./useActionLoading-FfnGJtHr.js";import"./vendor-common-GpUWqhKr.js";import"./vendor-charts-Bw6UNgWf.js";const E={class:"space-y-8 animate-fade-in"},N={class:"flex flex-col p-6 space-y-6 bg-white border border-gray-200 shadow-sm dark:bg-gray-800 rounded-2xl dark:border-gray-700"},O={class:"flex items-center justify-between"},P={class:"flex items-center gap-4"},q={class:"flex items-center gap-3"},z=["disabled"],J={key:0,class:"grid grid-cols-1 gap-6 pt-6 border-t border-gray-100 md:grid-cols-2 lg:grid-cols-3 dark:border-gray-700"},G={key:1,class:"flex justify-end"},K=["disabled"],$={class:"grid grid-cols-1 gap-6 md:grid-cols-2"},Z={class:"flex flex-col justify-between p-6 border border-indigo-100 bg-indigo-50 dark:bg-indigo-900/20 rounded-2xl dark:border-indigo-800"},W=["disabled"],Q={key:0,class:"w-4 h-4 animate-spin",viewBox:"0 0 24 24"},X={key:0,class:"flex justify-between mt-1"},Y={class:"text-xs text-indigo-700 dark:text-indigo-300"},ee={class:"text-xs text-indigo-700 dark:text-indigo-300"},te={key:1,class:"text-xs text-center text-indigo-700 dark:text-indigo-300"},ae={class:"flex flex-col justify-between p-6 border border-orange-100 bg-orange-50 dark:bg-orange-900/20 rounded-2xl dark:border-orange-800"},se=["disabled"],re={key:0,class:"flex justify-between mt-1"},ne={class:"text-xs text-orange-700 dark:text-orange-300"},oe={class:"text-xs text-orange-700 dark:text-orange-300"},ie={class:"text-xs text-orange-700 dark:text-orange-300"},le={key:1,class:"mt-3 text-xs text-center text-orange-700 dark:text-orange-300"},de={class:"overflow-hidden bg-white border border-gray-200 shadow-sm dark:bg-gray-800 dark:border-gray-700 rounded-2xl"},ue={class:"overflow-x-auto"},ge={class:"w-full text-sm text-left"},pe={class:"divide-y divide-gray-100 dark:divide-gray-700"},be={class:"px-6 py-4 font-bold text-gray-700 dark:text-gray-300 whitespace-nowrap"},ke={class:"px-6 py-4 font-mono text-xs text-gray-500 dark:text-gray-300"},xe={class:"px-6 py-4"},ce={class:"px-2 py-1 text-xs font-bold text-gray-600 bg-gray-100 rounded dark:bg-gray-700 dark:text-gray-300"},me={class:"flex justify-end gap-2 px-6 py-4 text-right"},ye=["onClick"],fe=["href"],ve=["onClick"],he={key:0},Ae={__name:"BackupRestoreTab",props:{backups:Array,autoBackupEnabled:Boolean,lastRestore:Object,lastBackup:Object,settings:{type:Object,default:()=>({})}},setup(i){const u=i,m=F(),y=L(null),{isActionLoading:r}=I(),a=U({enabled:u.autoBackupEnabled,backup_daily_time:u.settings.backup_daily_time||"22:00",backup_frequency:u.settings.backup_frequency||"3",report_morning_time:u.settings.report_morning_time||"06:30",report_financial_time:u.settings.report_financial_time||"12:30",report_closing_time:u.settings.report_closing_time||"21:00",insight_generate_time:u.settings.insight_generate_time||"21:30"}),h=()=>{c.post(route("backups.update-setting"),{enabled:a.enabled,backup_daily_time:a.backup_daily_time,backup_frequency:a.backup_frequency,report_morning_time:a.report_morning_time,report_financial_time:a.report_financial_time,report_closing_time:a.report_closing_time,insight_generate_time:a.insight_generate_time},{preserveScroll:!0,onStart:()=>r.value=!0,onFinish:()=>r.value=!1,onSuccess:()=>m.success("Pengaturan jadwal berhasil disimpan!"),onError:()=>m.error("Gagal menyimpan pengaturan.")})},B=()=>{confirm("Buat backup database sekarang?")&&(r.value=!0,c.post(route("backups.store"),{},{onFinish:()=>r.value=!1,preserveScroll:!0,onSuccess:()=>m.success("Backup berhasil dibuat!")}))},S=g=>{confirm(`⚠️ PERINGATAN KERAS!

Anda akan me-restore database ke titik waktu file ini dibuat.
Semua data transaksi SETELAH waktu file tersebut akan HILANG dan TIDAK BISA KEMBALI.

Apakah Anda yakin ingin melanjutkan?`)&&(r.value=!0,c.post(route("backups.restore",g),{},{onFinish:()=>r.value=!1,preserveScroll:!0}))},A=()=>y.value.click(),C=g=>{const t=g.target.files[0];if(t&&confirm(`Upload file "${t.name}" dan restore database menggunakan file ini?`)){const b=new FormData;b.append("backup_file",t),r.value=!0,c.post(route("backups.upload-restore"),b,{onFinish:()=>{r.value=!1,y.value.value=null}})}},j=g=>{confirm("Hapus file backup ini permanen?")&&(r.value=!0,c.delete(route("backups.destroy",g),{preserveScroll:!0,onFinish:()=>r.value=!1,onSuccess:()=>m.success("File backup dihapus.")}))};return(g,t)=>{const b=V("Strong");return o(),n("div",E,[e("div",N,[e("div",O,[e("div",P,[e("div",{class:f(["p-3 rounded-full",a.enabled?"bg-green-100 text-green-600":"bg-gray-100 text-gray-400"])},[...t[7]||(t[7]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)])],2),t[8]||(t[8]=e("div",null,[e("h3",{class:"text-lg font-bold text-gray-800 dark:text-white"}," Jadwal Otomatis "),e("p",{class:"text-sm text-gray-500"}," Atur kapan backup dan laporan digenerate secara otomatis. ")],-1))]),e("div",q,[e("button",{onClick:t[0]||(t[0]=s=>a.enabled=!a.enabled),class:f(["relative inline-flex items-center h-6 transition-colors rounded-full w-11 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",a.enabled?"bg-green-500":"bg-gray-200 dark:bg-gray-700"])},[t[9]||(t[9]=e("span",{class:"sr-only"},"Toggle Backup",-1)),e("span",{class:f(["inline-block w-4 h-4 transition-transform transform bg-white rounded-full",a.enabled?"translate-x-6":"translate-x-1"])},null,2)],2),a.enabled?(o(),n("button",{key:0,onClick:h,disabled:k(r).value==!0,class:"px-4 py-2 text-sm font-bold text-white transition bg-indigo-600 rounded-lg shadow-sm hover:bg-indigo-700 disabled:opacity-50"}," Simpan Pengaturan ",8,z)):v("",!0)])]),a.enabled?(o(),n("div",J,[e("div",null,[t[10]||(t[10]=e("label",{class:"block mb-1 text-xs font-bold text-gray-500 uppercase"},"Backup Utama (Harian)",-1)),p(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>a.backup_daily_time=s),type:"time",class:"w-full px-4 py-2 border rounded-lg focus:ring-indigo-500 dark:bg-gray-900 dark:border-gray-600 dark:text-white"},null,512),[[x,a.backup_daily_time]]),t[11]||(t[11]=e("p",{class:"mt-1 text-xs text-gray-400"}," Backup lengkap (DB + File) + Upload Cloud. ",-1))]),e("div",null,[t[13]||(t[13]=e("label",{class:"block mb-1 text-xs font-bold text-gray-500 uppercase"},"Frekuensi Backup Ringan",-1)),p(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>a.backup_frequency=s),class:"w-full px-4 py-2 border rounded-lg focus:ring-indigo-500 dark:bg-gray-900 dark:border-gray-600 dark:text-white"},[...t[12]||(t[12]=[D('<option value="1">Setiap 1 Jam</option><option value="2">Setiap 2 Jam</option><option value="3">Setiap 3 Jam</option><option value="4">Setiap 4 Jam</option><option value="6">Setiap 6 Jam</option><option value="12">Setiap 12 Jam</option>',6)])],512),[[H,a.backup_frequency]]),t[14]||(t[14]=e("p",{class:"mt-1 text-xs text-gray-400"}," Backup Cepat (Hanya DB, Lokal). ",-1))]),e("div",null,[t[15]||(t[15]=e("label",{class:"block mb-1 text-xs font-bold text-gray-500 uppercase"},"Generating Laporan Pagi",-1)),p(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>a.report_morning_time=s),type:"time",class:"w-full px-4 py-2 border rounded-lg focus:ring-indigo-500 dark:bg-gray-900 dark:border-gray-600 dark:text-white"},null,512),[[x,a.report_morning_time]]),t[16]||(t[16]=e("p",{class:"mt-1 text-xs text-gray-400"}," Rencana Restock & Insight Harian. ",-1))]),e("div",null,[t[17]||(t[17]=e("label",{class:"block mb-1 text-xs font-bold text-gray-500 uppercase"},"Laporan Finansial (Siang)",-1)),p(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>a.report_financial_time=s),type:"time",class:"w-full px-4 py-2 border rounded-lg focus:ring-indigo-500 dark:bg-gray-900 dark:border-gray-600 dark:text-white"},null,512),[[x,a.report_financial_time]]),t[18]||(t[18]=e("p",{class:"mt-1 text-xs text-gray-400"}," Cek Omzet & Cash Flow siang hari. ",-1))]),e("div",null,[t[19]||(t[19]=e("label",{class:"block mb-1 text-xs font-bold text-gray-500 uppercase"},"Generate Insight (Analisa)",-1)),p(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>a.insight_generate_time=s),type:"time",class:"w-full px-4 py-2 border rounded-lg focus:ring-indigo-500 dark:bg-gray-900 dark:border-gray-600 dark:text-white"},null,512),[[x,a.insight_generate_time]]),t[20]||(t[20]=e("p",{class:"mt-1 text-xs text-gray-400"}," Analisa berat (Dead Stock, Tren) untuk besok. ",-1))]),e("div",null,[t[21]||(t[21]=e("label",{class:"block mb-1 text-xs font-bold text-gray-500 uppercase"},"Laporan Closing (Malam)",-1)),p(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>a.report_closing_time=s),type:"time",class:"w-full px-4 py-2 border rounded-lg focus:ring-indigo-500 dark:bg-gray-900 dark:border-gray-600 dark:text-white"},null,512),[[x,a.report_closing_time]]),t[22]||(t[22]=e("p",{class:"mt-1 text-xs text-gray-400"}," Rekap Akhir Hari & Laporan Laba. ",-1))])])):(o(),n("div",G,[e("button",{onClick:h,disabled:k(r).value==!0,class:"px-4 py-2 text-sm font-bold text-white transition bg-indigo-600 rounded-lg shadow-sm hover:bg-indigo-700 disabled:opacity-50"}," Simpan Perubahan ",8,K)]))]),e("div",$,[e("div",Z,[t[27]||(t[27]=e("div",null,[e("h4",{class:"mb-1 text-lg font-bold text-indigo-900 dark:text-indigo-100"}," Backup Sekarang "),e("p",{class:"mb-4 text-xs text-indigo-700 dark:text-indigo-300"}," Buat salinan database saat ini secara manual. Disarankan sebelum melakukan perubahan besar. ")],-1)),e("button",{onClick:B,disabled:k(r).value==!0,class:"flex items-center justify-center w-full gap-2 py-2 text-sm font-bold text-white transition bg-indigo-600 rounded-lg shadow-md hover:bg-indigo-700 disabled:opacity-50"},[k(r).value==!0?(o(),n("svg",Q,[...t[23]||(t[23]=[e("path",{fill:"currentColor",d:"M12 2A10 10 0 1 0 22 12A10 10 0 0 0 12 2Zm0 18a8 8 0 1 1 8-8A8 8 0 0 1 12 20Z",opacity:".3"},null,-1),e("path",{fill:"currentColor",d:"M20 12h2A10 10 0 0 0 12 2V4A8 8 0 0 1 20 12Z"},null,-1)])])):v("",!0),t[24]||(t[24]=e("span",null,"+ Buat Backup Baru",-1))],8,W),Object.keys(i.lastBackup).length>0?(o(),n("span",X,[e("p",Y,[t[25]||(t[25]=l(" Terakhir dibakcup tanggal : ",-1)),e("strong",null,d(i.lastBackup.date),1)]),e("p",ee,[t[26]||(t[26]=l(" Oleh : ",-1)),e("strong",null,d(i.lastBackup.user),1)])])):(o(),n("p",te," Belum pernah dibackup "))]),e("div",ae,[t[32]||(t[32]=e("div",null,[e("h4",{class:"mb-1 text-lg font-bold text-orange-900 dark:text-orange-100"}," Restore dari File "),e("p",{class:"mb-4 text-xs text-orange-700 dark:text-orange-300"}," Punya file backup (.zip) dari komputer lain? Upload disini untuk memulihkan database. ")],-1)),e("input",{type:"file",ref_key:"fileInput",ref:y,class:"hidden",accept:".zip",onChange:C},null,544),e("button",{onClick:A,disabled:k(r).value==!0,class:"flex items-center justify-center w-full gap-2 py-2 text-sm font-bold text-white transition bg-orange-600 rounded-lg shadow-md hover:bg-orange-700 disabled:opacity-50"},[...t[28]||(t[28]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})],-1),e("span",null,"Upload & Restore",-1)])],8,se),Object.keys(i.lastRestore).length>0?(o(),n("span",re,[e("p",ne,[t[29]||(t[29]=l(" Terakhir dipulihkan tanggal : ",-1)),w(b,null,{default:_(()=>[l(d(i.lastRestore.date),1)]),_:1})]),e("p",oe,[t[30]||(t[30]=l(" Oleh : ",-1)),w(b,null,{default:_(()=>[l(d(i.lastRestore.user),1)]),_:1})]),e("p",ie,[t[31]||(t[31]=l(" Dari : ",-1)),e("strong",null,d(i.lastRestore.filename),1)])])):(o(),n("p",le," Belum pernah pemulihan "))])]),e("div",de,[t[37]||(t[37]=e("div",{class:"p-4 border-b border-gray-100 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-800"},[e("h4",{class:"text-sm font-bold text-gray-800 dark:text-white"}," Riwayat Backup (Restore Points) ")],-1)),e("div",ue,[e("table",ge,[t[36]||(t[36]=e("thead",{class:"text-xs text-gray-500 uppercase bg-gray-50 dark:bg-gray-700/50 dark:text-gray-300"},[e("tr",null,[e("th",{class:"px-6 py-3"},"Waktu Backup"),e("th",{class:"px-6 py-3"},"Nama File"),e("th",{class:"px-6 py-3"},"Ukuran"),e("th",{class:"px-6 py-3 text-right"},"Aksi")])],-1)),e("tbody",pe,[(o(!0),n(M,null,T(i.backups,s=>(o(),n("tr",{key:s.name,class:"transition hover:bg-gray-50 dark:hover:bg-gray-700/30"},[e("td",be,d(s.date),1),e("td",ke,d(s.name),1),e("td",xe,[e("span",ce,d(s.size),1)]),e("td",me,[e("button",{onClick:R=>S(s.name),class:"flex items-center gap-1 px-3 py-1.5 bg-orange-50 border border-orange-200 text-orange-700 rounded-lg hover:bg-orange-100 transition text-xs font-bold",title:"Pulihkan database ke titik ini"},[...t[33]||(t[33]=[e("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),l(" Restore ",-1)])],8,ye),e("a",{href:g.route("backups.download",s.name),class:"flex items-center gap-1 px-3 py-1.5 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 hover:text-blue-600 transition text-xs font-bold",title:"Download ke Komputer"}," ⬇️ ",8,fe),e("button",{onClick:R=>j(s.name),class:"p-1.5 text-gray-400 hover:text-red-600 rounded transition",title:"Hapus File"},[...t[34]||(t[34]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,ve)])]))),128)),!i.backups||i.backups.length===0?(o(),n("tr",he,[...t[35]||(t[35]=[e("td",{colspan:"4",class:"px-6 py-12 text-center text-gray-400"}," Belum ada file backup tersimpan. ",-1)])])):v("",!0)])])])])])}}};export{Ae as default};
