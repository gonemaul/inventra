import{s as l,j as E,G as K,P as q,g as u,o,b as r,c as j,a as k,w as y,i as O,p as z,r as H,T as Y,Q as G,x as Q,t as _,f as F,d as B,q as D,y as P,h as W,k as X,v as J,F as L,m as Z,l as ee,n as V}from"./app-C_cXePOB.js";import{_ as te}from"./AuthenticatedLayout-DqzYp9rK.js";import{_ as se}from"./DataTable-DQP4LpPT.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as re}from"./Filter-BjaKAa1Z.js";import le from"./modalFilter-DBRSIOnD.js";import{u as M}from"./useActionLoading-Bvh_DZn-.js";import{_ as oe}from"./DeleteConfirm-4y6wL8wG.js";import{_ as ne}from"./Modal-DR4Qf9lZ.js";import{D as ie}from"./DangerButton-fqLmj-k_.js";import{_ as ue}from"./SecondaryButton-ClbDvNQj.js";import{l as I}from"./lodash-B17NO2GL.js";import"./TextInput-PROtXgwY.js";import"./PrimaryButton-D5q8Vryj.js";const de={__name:"OpsiTable",props:{rowId:{type:[Number,String],required:!0},activeId:{type:[Number,String,null],default:null},position:{type:Object,default:()=>({top:0,left:0})}},emits:["toggle","close"],setup(v,{emit:d}){const n=v,f=d,g=l(null),b=l(null),S=E(()=>n.activeId===n.rowId),C=E(()=>({top:n.position?.top+"px",left:n.position?.left+"px",position:"absolute"}));function x(p){f("toggle",n.rowId,p)}function h(p){S.value&&!b.value?.contains(p.target)&&!g.value?.contains(p.target)&&f("close")}return K(()=>{document.addEventListener("click",h)}),q(()=>{document.removeEventListener("click",h)}),(p,c)=>(o(),u("div",{class:"relative inline-block text-left",ref_key:"triggerRef",ref:g},[r("button",{onClick:c[0]||(c[0]=w=>x(w)),class:"p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700"}," â‹® "),(o(),j(G,{to:"body"},[k(Y,{name:"fade"},{default:y(()=>[S.value?(o(),u("div",{key:0,style:z(C.value),ref_key:"menuRef",ref:b,class:"absolute z-[9999] mt-1 min-w-[8rem] rounded-md shadow-lg bg-white dark:bg-gray-800 ring-1 ring-black ring-opacity-5"},[H(p.$slots,"default",{},void 0,!0)],4)):O("",!0)]),_:3})]))],512))}},pe=ae(de,[["__scopeId","data-v-81c228a4"]]),ce={class:"p-6"},me={class:"mb-4 text-xl font-bold text-red-600"},fe={class:"mb-4 text-gray-700 dark:text-gray-300"},ge={key:0,class:"mb-6 text-lg font-semibold"},be={class:"text-red-700 dark:text-red-400"},he={class:"flex justify-end gap-3 mt-4"},ke={key:0},ye={key:1},ve={__name:"ConfirmModal",emits:["close","success"],setup(v,{expose:d,emit:n}){const{isActionLoading:f}=M(),g=Q(),b=l(!1),S=l("Konfirmasi Aksi"),C=l("Anda yakin ingin melanjutkan aksi ini?"),x=l(""),h=l(""),p=l("post"),c=l({});d({open:m=>{S.value=m.title||"Konfirmasi Penghapusan",C.value=m.message||"Anda yakin ingin menghapus data ini?",x.value=m.itemName||"",h.value=m.url||"",p.value=m.method||"post",c.value=m.data||{},b.value=!0}});const T=()=>{b.value=!1,$("close")},A=()=>{if(!h.value){g.error("URL aksi tidak terdefinisi.");return}f.value=!0;const m=p.value.toLowerCase();D[m](h.value,c.value||{},{preserveScroll:!0,only:["flash","purchases","filters"],onSuccess:()=>{T(),$("close")},onError:i=>{g.error(i.message||"Terjadi kesalahan saat menghapus data.")},onFinish:()=>{f.value=!1,h.value=""}})},$=n;return(m,i)=>(o(),j(ne,{show:b.value,onClose:i[1]||(i[1]=N=>$("close")),maxWidth:"md"},{default:y(()=>[r("div",ce,[r("h3",me,_(S.value),1),r("p",fe,_(C.value),1),x.value?(o(),u("p",ge,[i[2]||(i[2]=F(" Item: ",-1)),r("span",be,_(x.value),1)])):O("",!0),r("div",he,[k(ue,{onClick:i[0]||(i[0]=N=>$("close")),type:"button"},{default:y(()=>[...i[3]||(i[3]=[F(" Batal ",-1)])]),_:1}),k(ie,{onClick:A,disabled:B(f)},{default:y(()=>[B(f)?(o(),u("span",ke,"Memproses...")):(o(),u("span",ye,"Ya"))]),_:1},8,["disabled"])])])]),_:1},8,["show"]))}},xe={class:"w-full min-h-screen space-y-6"},_e={class:"p-4 space-y-6 bg-gray-100 border shadow-md rounded-xl dark:bg-customBg-tableDark"},Se={class:"flex items-center space-x-2 cursor-pointer"},Ce={class:"flex flex-col"},$e={class:"font-medium"},we={class:"text-xs text-gray-500"},Te=["onClick"],De=["onClick"],je={key:3,class:"my-1 border-gray-200 dark:border-gray-600"},Oe={key:1},ze={__name:"index",props:{dropdowns:Object,filters:Object,purchases:Object},setup(v){const d=v,n=l(null),f=l({top:0,left:0}),g=l(d.filters.search||""),b=l(!1),{isActionLoading:S}=M(),C=l(null),x=l(!1),h=l(!1),p=[{key:"transaction_date",label:"Tanggal Order",sortable:!0,format:"tanggal"},{key:"reference_no",label:"No. Referensi",sortable:!0},{key:"supplier",label:"Supplier",slot:"supplier"},{key:"items_sum_subtotal",label:"Total Belanja",sortable:!0,format:"rupiah"},{key:"status",label:"Status",sortable:!0,slot:"status"},{key:"aksi",label:"Aksi",width:"120px",slot:"aksi"}],c=l({search:d.filters.search||"",sort:d.filters.sort||"transaction_date",order:d.filters.order||"desc",page:d.purchases.current_page||1});function w(s,e){if(n.value===s)n.value=null;else{const t=e.target.getBoundingClientRect();f.value={top:t.bottom+window.scrollY,left:t.left+window.scrollX},n.value=s}}const T=()=>{D.reload({only:["purchases","filters"],preserveScroll:!0})},A=I.throttle(()=>{const s={...d.filters};s.search=g.value,s.search||delete s.search,D.get(route("purchases.index"),s,{preserveState:!0,replace:!0})},300),$=(s,e)=>{const t={title:"Konfirmasi Perubahan Status",message:`Anda yakin ingin mengubah status transaksi ${s.reference_no} menjadi ${e.toUpperCase()}?`,itemName:s.reference_no,url:route("purchases.update-status",{purchase:s.id}),method:"put",data:{status:e}};h.value.open(t)},m=s=>{const e={title:`Hapus transaksi ${s.reference_no}?`,message:`Aksi ini akan menghapus semua item terkait dan tidak dapat dibatalkan. Status saat ini: ${s.status}`,itemName:s.name,url:route("purchases.destroy",{purchase:s.id,permanen:!1})};C.value.open(e)};P(x,s=>{s===!0?c.value.trashed=!0:delete c.value.trashed}),P(c,I.throttle(s=>{const e=Object.fromEntries(Object.entries(s).filter(([t,a])=>a!=null&&a!==""));S.value=!0,D.get(route("purchases.index"),e,{preserveState:!0,preserveScroll:!0,replace:!0,only:["purchases"],onFinish:()=>{S.value=!1}})},300),{deep:!0}),P(g,A);const i=E(()=>{const s=Object.keys(d.filters),e=["search","page","per_page"];return s.filter(t=>!e.includes(t)).length}),N=s=>{const e=[];switch(e.push({label:"ðŸ“„ Detail",icon:"eye",type:"link",route:route("purchases.show",s.id)}),e.push({label:"ðŸ–¨ï¸ Cetak PO",icon:"print",type:"link",route:route("purchases.index",s.id),target:"_blank"}),s.status){case"draft":e.push({label:"âœï¸ Edit",icon:"edit",type:"link",route:route("purchases.edit",s.id)}),e.push({label:"â–¶ï¸ Tandai Dipesan",icon:"play",type:"status",newStatus:"dipesan"}),e.push({label:"ðŸ—‘ï¸ Hapus",icon:"delete",type:"delete"});break;case"dipesan":e.push({label:"ðŸšš Tandai Dikirim",icon:"truck",type:"status",newStatus:"dikirim"}),e.push({label:"âœï¸ Edit",icon:"edit",type:"link",route:route("purchases.edit",s.id)}),e.push({label:"ðŸ—‘ï¸ Hapus",icon:"delete",type:"delete"});break;case"dikirim":e.push({label:"ðŸ“¦ Tandai Diterima",icon:"receive",type:"status",newStatus:"diterima"});break;case"diterima":e.push({label:"âœ… Validasi Barang",icon:"check",type:"link",route:route("purchases.checking",s.id),isPrimary:!0}),e.push({label:"ðŸ”„ Batalkan Terima",icon:"undo",type:"status",newStatus:"dikirim"});break;case"checking":e.push({label:"âœï¸ Lanjut Checking",icon:"edit",type:"link",route:route("purchases.checking",s.id)});break}return e};return(s,e)=>(o(),u(L,null,[k(B(W),{title:"Pembelian"}),k(te,{headerTitle:"Pembelian"},{default:y(()=>[k(oe,{ref_key:"showConfirmDelete",ref:C,onSuccess:T},null,512),k(ve,{ref_key:"showConfirmModal",ref:h,onSuccess:T},null,512),r("div",xe,[k(re,{filters:v.filters,modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=t=>g.value=t),onShowFilter:e[1]||(e[1]=t=>b.value=!0),filterCount:i.value,actions:[{route:s.route("purchases.create"),buttonText:"RAB"}]},null,8,["filters","modelValue","filterCount","actions"]),k(le,{show:b.value,onClose:e[2]||(e[2]=t=>b.value=!1),filters:v.filters,dropdowns:v.dropdowns},null,8,["show","filters","dropdowns"]),r("div",_e,[r("div",null,[e[7]||(e[7]=r("h2",{class:"text-base font-semibold text-gray-900 dark:text-white sm:text-lg lg:text-xl"}," Daftar Pembelian ",-1)),e[8]||(e[8]=r("p",{class:"mt-1 text-xs text-gray-600 dark:text-gray-300 sm:text-sm lg:text-base"}," Kelola semua pembelian. ",-1)),r("label",Se,[X(r("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=t=>x.value=t),class:"rounded dark:bg-gray-900 border-gray-300 dark:border-gray-700 ..."},null,512),[[J,x.value]]),e[6]||(e[6]=r("span",{class:"text-sm text-gray-600 dark:text-gray-400"}," Tampilkan Sampah ",-1))])]),k(se,{serverSide:"true",data:v.purchases.data,columns:p,perPageOptions:[5,10,25,50,100],params:c.value,"onUpdate:params":e[5]||(e[5]=t=>c.value=t),pagination:v.purchases},{supplier:y(({row:t})=>[r("div",Ce,[r("span",$e,_(t.supplier?t.supplier.name:"Umum/Cash"),1),r("span",we,_(t.supplier?t.supplier.phone:"-"),1)])]),status:y(({row:t})=>[r("span",{class:V(["px-2 py-1 text-xs font-bold uppercase rounded",{"bg-gray-200 text-gray-600":t.status==="draft","bg-blue-100 text-blue-600":t.status==="dipesan","bg-yellow-100 text-yellow-600":t.status==="dikirim","bg-purple-100 text-purple-600":t.status==="diterima","bg-teal-100 text-teal-600":t.status==="checking","bg-green-100 text-green-600":t.status==="selesai","bg-red-100 text-red-600":t.status==="dibatalkan"}])},_(t.status),3)]),aksi:y(({row:t})=>[t.deleted_at==null?(o(),j(pe,{key:0,"row-id":t.id,"active-id":n.value,position:f.value,onToggle:w,onClose:e[4]||(e[4]=a=>n.value=null)},{default:y(()=>[(o(!0),u(L,null,Z(N(t),(a,R)=>(o(),u(L,{key:R},[a.type==="link"?(o(),j(B(ee),{key:0,href:a.route,target:a.target||"_self",class:V([{"text-green-600 font-semibold":a.isPrimary,"border-b-2 border-gray-100":a.label.includes("Detail")},"block w-full px-4 py-2 text-sm text-left text-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-100"])},{default:y(()=>[F(_(a.label),1)]),_:2},1032,["href","target","class"])):a.type==="status"?(o(),u("button",{key:1,onClick:U=>$(t,a.newStatus),class:V([{"text-lime-600 font-semibold":a.isPrimary,"border-b-2":a.newStatus==="ordered"},"block w-full px-4 py-2 text-sm text-left text-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-gray-100"])},_(a.label),11,Te)):a.type==="delete"?(o(),u("button",{key:2,onClick:U=>m(t),class:"block w-full px-4 py-2 text-sm text-left text-red-600 hover:bg-red-100 dark:hover:bg-red-900/30"},_(a.label),9,De)):O("",!0),a.newStatus==="shipped"?(o(),u("hr",je)):O("",!0)],64))),128))]),_:2},1032,["row-id","active-id","position"])):(o(),u("span",Oe,"Sudah dihapus"))]),_:1},8,["data","params","pagination"])])])]),_:1})],64))}};export{ze as default};
