import{_ as B}from"./AuthenticatedLayout-CCTW-xu6.js";import{y as P,x as s,c as H,o as p,w as $,b as S,g as f,i as L,t as M,f as T,a as i,d as A,s as R,C as q,H as K,j as D,h as O,W as z,F as U}from"./app-CHQSHO3f.js";import{_ as W}from"./DeleteConfirm-BQAQwjey.js";import{_ as Y}from"./Modal-B3iekFlk.js";import{D as G}from"./DangerButton-aIKeksip.js";import{_ as J}from"./SecondaryButton-_tqmZGEj.js";import{u as Q}from"./useActionLoading-Bk-hXxe0.js";import X from"./FinalizeModal-BE9FTOpf.js";import Z from"./OrderImageModal-cJGJvII6.js";import ee from"./InvoiceForm-BLbsswJa.js";import ae from"./DesktopDetail-Cjvx6yHK.js";import te from"./MobileDetail-CoWTc-3O.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./PrimaryButton-DaDid8Yi.js";import"./InputLabel-kvmQouLE.js";import"./TextInput-BtDNOho4.js";import"./InputError-WJRs4vMP.js";import"./Tabs-DF6UlT5q.js";import"./HeaderDetail-BwRFqh7W.js";import"./InfoCard-dDka6aKU.js";import"./invoiceTable-BEsa7D7P.js";import"./DataTable-iS5jzXrP.js";import"./ImageModal-C5CzFcDR.js";import"./productTable-CWwZh64f.js";const se={class:"p-6"},ne={class:"mb-4 text-xl font-bold text-red-600"},ie={class:"mb-4 text-gray-700 dark:text-gray-300"},oe={key:0,class:"mb-6 text-lg font-semibold"},le={class:"text-red-700 dark:text-red-400"},re={class:"flex justify-end gap-3 mt-4"},ue={key:0},ce={key:1},de={__name:"ConfirmModal",emits:["close","success"],setup(l,{expose:t,emit:_}){const{isActionLoading:r}=Q(),u=P(),d=s(!1),v=s("Konfirmasi Aksi"),g=s("Anda yakin ingin melanjutkan aksi ini?"),c=s(""),m=s(""),k=s("post"),h=s({});t({open:n=>{v.value=n.title||"Konfirmasi Penghapusan",g.value=n.message||"Anda yakin ingin menghapus data ini?",c.value=n.itemName||"",m.value=n.url||"",k.value=n.method||"post",h.value=n.data||{},d.value=!0}});const w=()=>{d.value=!1,y("close")},x=()=>{if(!m.value){u.error("URL aksi tidak terdefinisi.");return}r.value=!0;const n=k.value.toLowerCase();R[n](m.value,h.value||{},{preserveScroll:!0,onSuccess:()=>{w(),y("close")},onError:o=>{u.error(o.message||"Terjadi kesalahan saat menghapus data.")},onFinish:()=>{r.value=!1,m.value=""}})},y=_;return(n,o)=>(p(),H(Y,{show:d.value,onClose:o[0]||(o[0]=N=>y("close")),maxWidth:"md"},{default:$(()=>[S("div",se,[S("h3",ne,M(v.value),1),S("p",ie,M(g.value),1),c.value?(p(),f("p",oe,[o[1]||(o[1]=T(" Item: ",-1)),S("span",le,M(c.value),1)])):L("",!0),S("div",re,[i(J,{onClick:w,type:"button"},{default:$(()=>[...o[2]||(o[2]=[T(" Batal ",-1)])]),_:1}),i(G,{onClick:x,disabled:A(r)},{default:$(()=>[A(r)?(p(),f("span",ue,"Memproses...")):(p(),f("span",ce,"Ya"))]),_:1},8,["disabled"])])])]),_:1},8,["show"]))}},me={key:0},pe={key:1},Le={__name:"PurchaseDetail",props:{purchase:Object,invoices:Object,invoice:Object,paymentStatuses:Array,isCheckingMode:Boolean},setup(l){const t=l,_=s(!1),r=s(null),u=s(!1),d=s(null),v=s(!1),g=s(!1),c=s(window.innerWidth<1024),m=()=>{c.value=window.innerWidth<1024};q(()=>{window.addEventListener("resize",m),t.purchase.status==="diterima"&&!t.invoice.id&&n()}),K(()=>window.removeEventListener("resize",m));const k=s(t.purchase.items.map(e=>({...e,rejected_quantity:e.rejected_quantity||0,is_valid:e.quantity-(e.rejected_quantity||0)>0}))),h=D(()=>{const e=t.purchase;return e.status!=="checking"||e.items.some(b=>b.item_status==="pending")||e.invoices.length===0?!1:e.invoices.every(b=>{const F=b.status==="validated",V=b.items&&b.items.length>0;return F&&V})}),E=D(()=>["diterima","checking"].includes(t.purchase.status)),w=D(()=>t.purchase.status==="draft"||t.purchase.status==="dipesan"),x=D(()=>t.purchase.status==="draft"),y=()=>{h.value&&(v.value=!0)},n=()=>{d.value=null,u.value=!0},o=e=>{d.value=e,u.value=!0},N=e=>{const a={title:"Hapus Nota Keuangan",message:`Hapus Nota No. ${e.invoice_number}? Ini akan menghapus file foto dan mengembalikan status transaksi ke RECEIVED jika tidak ada nota lain.`,itemName:e.invoice_number,url:route("purchases.destroyInvoice",{purchase:t.purchase.id,invoice:e.id})};r.value.open(a)},C=()=>{u.value=!1,router.reload({preserveScroll:!0,preserveState:!0})},j={openCreateInvoiceModal:n,handleEditInvoice:o,handleDeleteInvoice:N,handleDelete:()=>{const e={title:"Hapus Pembelian",message:`Apakah Anda yakin ingin menghapus pembelian #${t.purchase.reference_no}? Tindakan ini tidak dapat dibatalkan.`,url:route("purchases.destroy",t.purchase.id)};r.value.open(e)},updateStatus:(e,a)=>{const I={title:"Konfirmasi Perubahan Status",message:`Anda yakin ingin mengubah status transaksi ${e.reference_no} menjadi ${a.toUpperCase()}?`,itemName:e.reference_no,url:route("purchases.update-status",{purchase:e.id}),method:"put",data:{status:a}};g.value.open(I)},openFinalizeModal:y,getActions:e=>{const a=[];switch(e.status){case"draft":a.push({label:"Tandai Dipesan",icon:"play",type:"status",newStatus:"dipesan"});break;case"dipesan":a.push({label:"Tandai Dikirim",icon:"truck",type:"status",newStatus:"dikirim"});break;case"dikirim":a.push({label:"Tandai Diterima",icon:"receive",type:"status",newStatus:"diterima"});break;case"diterima":a.push({label:"Batalkan Terima",icon:"undo",type:"status",newStatus:"dikirim"});break}return a},openImageModal:()=>_.value=!0};return(e,a)=>(p(),f(U,null,[i(A(O),{title:`Detail - ${l.purchase.reference_no}`},null,8,["title"]),i(W,{ref_key:"deleteModalRef",ref:r,onSuccess:C},null,512),i(de,{ref_key:"showConfirmModal",ref:g,onSuccess:C},null,512),i(X,{show:v.value,purchase:l.purchase,onClose:a[0]||(a[0]=I=>v.value=!1)},null,8,["show","purchase"]),i(Z,{show:_.value,purchase:l.purchase,"store-name":e.$page.props.auth.user.store_name||"INVENTRA STORE",onClose:a[1]||(a[1]=I=>_.value=!1)},null,8,["show","purchase","store-name"]),i(ee,{show:u.value,purchaseId:l.purchase.id,editingInvoice:d.value,paymentStatuses:l.paymentStatuses,onClose:a[2]||(a[2]=I=>u.value=!1),onInvoiceSaved:C},null,8,["show","purchaseId","editingInvoice","paymentStatuses"]),i(B,{showSidebar:!c.value,showHeader:!c.value,headerTitle:`Detail - ${l.purchase.reference_no}`},{default:$(()=>[c.value?(p(),f("div",me,[i(te,z(t,{actions:j,validationItems:k.value,allowFinalize:h.value,canEditDeleteInvoice:E.value,isEditing:w.value}),null,16,["validationItems","allowFinalize","canEditDeleteInvoice","isEditing"])])):(p(),f("div",pe,[i(ae,z(t,{actions:j,validationItems:k.value,allowFinalize:h.value,canEditDeleteInvoice:E.value,isEditing:w.value,isDeleted:x.value}),null,16,["validationItems","allowFinalize","canEditDeleteInvoice","isEditing","isDeleted"])]))]),_:1},8,["showSidebar","showHeader","headerTitle"])],64))}};export{Le as default};
