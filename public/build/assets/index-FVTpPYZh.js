import{v as c,K as j,J as N,D as C,l as u,o as i,e as v,g as T,i as E,w as h,f as t,p as y,F as b,I as $,n as G,t as d,z as W,B as J,d as B,C as F,W as L}from"./vendor-core-By7Plnkm.js";import{d as U}from"./vendor-common-GpUWqhKr.js";import{_ as K}from"./AuthenticatedLayout-BlgKae2S.js";import{_ as Q}from"./Filter-D5RrVPYj.js";import A from"./modalFilter-C3VL6ctz.js";import{B as X}from"./BottomSheet-WceNnWH3.js";import Y from"./SalesStatsGrid-BCMiKZ4V.js";import Z from"./SalesTransactionList-E2Y34OnC.js";import ee from"./SalesChart-DYqwFTnB.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vendor-charts-Bw6UNgWf.js";import"./useSidebar-CpEDRVzi.js";import"./useActionLoading-BREuot5v.js";import"./TextInput-B-__nwMf.js";import"./PrimaryButton-BZrDt8zt.js";import"./BottomSheetFilter-BLYHt_YO.js";import"./DeleteConfirm-D81PCJRC.js";import"./Modal-CAUBCNUq.js";const se={class:"w-full min-h-screen space-y-6 pb-20"},ae={class:"flex flex-col gap-4"},le={class:"flex flex-col md:flex-row justify-between items-center gap-4"},oe={class:"flex p-1 space-x-1 bg-gray-100 dark:bg-gray-800 rounded-xl overflow-x-auto w-full md:w-auto"},re=["onClick"],ne={class:"flex items-center gap-2 cursor-pointer text-sm text-gray-600 dark:text-gray-300"},ie={key:0,class:"space-y-4"},de={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ue={class:"bg-gradient-to-br from-indigo-600 to-purple-700 rounded-xl p-4 text-white shadow-lg relative overflow-hidden"},ce={class:"space-y-2 relative z-10"},me={class:"w-5 h-5 flex items-center justify-center font-bold text-indigo-700 bg-white rounded-full text-xs shadow-sm"},ve={class:"flex-1 min-w-0"},fe={class:"text-xs font-bold truncate group-hover:text-indigo-200 transition"},ge={class:"text-[10px] text-indigo-200/80"},pe={class:"font-bold text-xs"},xe={class:"bg-gradient-to-br from-orange-500 to-red-600 rounded-xl p-4 text-white shadow-lg relative overflow-hidden"},he={class:"space-y-2 relative z-10"},ye={class:"w-5 h-5 flex items-center justify-center font-bold text-orange-700 bg-white rounded-full text-xs shadow-sm"},be={class:"flex-1 min-w-0"},_e={class:"text-xs font-bold truncate group-hover:text-orange-200 transition"},we={class:"font-bold text-xs bg-white/20 px-1.5 py-0.5 rounded"},ke={class:"mb-4 flex items-center justify-between"},De={class:"text-xs text-gray-500"},je={key:0,class:"flex justify-center mt-8 gap-2"},Ce=["disabled"],Te={class:"px-4 py-2 text-gray-500 text-sm flex items-center"},$e=["disabled"],Pe={key:0,class:"flex-1 flex flex-col items-center justify-center min-h-[300px]"},Ie={key:1,class:"overflow-hidden"},Se={class:"flex-1 mb-4 border rounded overflow-hidden bg-gray-100 h-[300px]"},qe=["srcdoc"],Me={class:"grid grid-cols-2 gap-3 pt-2 mt-auto border-t"},Be=["href"],Fe={__name:"index",props:{filters:Object,sales:Object,summary:Object},setup(x){const r=x,_=c(r.filters.search||""),w=c(!1),k=c(!1),D=c(!1),g=c(""),P=c(null),I=c("-"),n=c("today"),O=[{id:"today",label:"Hari Ini"},{id:"week",label:"Minggu Ini"},{id:"month",label:"Bulan Ini"},{id:"all",label:"Semua Data"}],m=a=>{const e=new Date,s=o=>o.toISOString().split("T")[0];if(a==="today")return{min:s(e),max:s(e)};if(a==="week"){const o=new Date(e);return o.setDate(e.getDate()-6),{min:s(o),max:s(e)}}if(a==="month"){const o=new Date(e);return o.setDate(e.getDate()-29),{min:s(o),max:s(e)}}return{min:null,max:null}},S=a=>{if(console.log(a,n.value),a==="all"&&n.value==="all")n.value="today",l.value.min_date=m("today").min,l.value.max_date=m("today").max;else if(n.value==a)n.value="all",l.value.min_date=null,l.value.max_date=null;else{n.value=a;const{min:e,max:s}=m(a);l.value.min_date=e,l.value.max_date=s}l.value.page=1},l=c({search:r.filters.search||"",sort:r.filters.sort||"transaction_date",order:r.filters.order||"desc",page:r.sales.current_page||1,min_date:r.filters.min_date||m("today").min,max_date:r.filters.max_date||m("today").max,show_deleted:r.filters.show_deleted==="true"||!1}),q=(a,e)=>{if(!a&&!e){n.value="all";return}const s=m("today"),o=m("week"),M=m("month");a===s.min&&e===s.max?n.value="today":a===o.min&&e===o.max?n.value="week":a===M.min&&e===M.max?n.value="month":n.value="all"};(()=>{q(l.value.min_date,l.value.max_date)})(),j(()=>[l.value.min_date,l.value.max_date],([a,e])=>{q(a,e)});const V=U.throttle(()=>{const a=Object.fromEntries(Object.entries(l.value).filter(([e,s])=>s!=null&&s!==""));N.get(route("sales.index"),a,{preserveState:!0,preserveScroll:!0,replace:!0,only:["sales","filters","summary"]})},300);j(l,V,{deep:!0}),j(_,a=>{l.value.search=a,l.value.page=1,a&&a.length>0&&(n.value="all",delete l.value.min_date,delete l.value.max_date)});const p=C(()=>{let a=[],e=[],s={labels:[],values:[]},o="";return n.value==="today"?(a=r.summary.best_selling_revenue_today,e=r.summary.best_selling_qty_today,s=r.summary.chart_today,o="Per Jam"):n.value==="week"?(a=r.summary.best_selling_revenue_week,e=r.summary.best_selling_qty_week,s=r.summary.chart_week,o="7 Hari Terakhir"):n.value==="month"&&(a=r.summary.best_selling_revenue_month,e=r.summary.best_selling_qty_month,s=r.summary.chart_month,o="Mingguan"),{revenue:a,qty:e,chart:s,label:o}}),z=async a=>{P.value=a.id,I.value=a.reference_no,k.value=!0,D.value=!0,g.value="";try{const e=await axios.get(`/sales/${a.id}/print`,{responseType:"text"});g.value=e.data}catch(e){console.error("Gagal load invoice:",e),g.value='<p class="text-center text-red-500 mt-10">Gagal memuat invoice.</p>'}finally{D.value=!1}},R=()=>{if(!g.value)return;const a=window.open("","","height=600,width=400");a.document.write("<html><head><title>Print</title><style>body { margin: 0; padding: 0; }</style></head><body>"),a.document.write(g.value),a.document.write("</body></html>"),a.document.close(),a.focus(),setTimeout(()=>{a.print(),a.close()},500)},H=C(()=>r.sales.data),f=C(()=>r.sales);return(a,e)=>(i(),u(b,null,[v(T(E),{title:"Riwayat Penjualan"}),v(K,{headerTitle:"Dashboard Penjualan"},{default:h(()=>[t("div",se,[v(Y,{summary:x.summary},null,8,["summary"]),t("div",ae,[t("div",le,[t("div",oe,[n.value!=="all"?(i(!0),u(b,{key:0},$(O.filter(s=>s.id!=="all"),s=>(i(),u("button",{key:s.id,onClick:o=>S(s.id),class:G(["px-4 py-2 text-sm font-bold rounded-lg transition-all whitespace-nowrap flex-1",n.value===s.id?"bg-white dark:bg-gray-700 text-blue-600 shadow-sm":"text-gray-500 hover:text-gray-700 dark:text-gray-400"])},d(s.label),11,re))),128)):y("",!0),n.value==="all"?(i(),u("button",{key:1,onClick:e[0]||(e[0]=s=>S("all")),class:"px-4 py-2 text-sm font-bold rounded-lg bg-white dark:bg-gray-700 text-blue-600 shadow-sm whitespace-nowrap"}," Custom / Semua ")):y("",!0)]),t("label",ne,[W(t("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=s=>l.value.show_deleted=s),class:"w-4 h-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,512),[[J,l.value.show_deleted]]),e[8]||(e[8]=t("span",null,"Tampilkan Terhapus",-1))])]),["today","week","month"].includes(n.value)&&(p.value.revenue?.length>0||p.value.qty?.length>0)?(i(),u("div",ie,[v(ee,{data:p.value.chart,title:`Grafik Omset (${p.value.label})`},null,8,["data","title"]),t("div",de,[t("div",ue,[e[9]||(e[9]=t("div",{class:"flex items-center justify-between mb-3 relative z-10"},[t("div",{class:"flex items-center gap-2"},[t("div",{class:"p-1.5 bg-white/20 rounded-lg backdrop-blur-sm"},[t("span",{class:"text-sm"},"ðŸ’Ž")]),t("h3",{class:"font-bold text-base leading-tight"},"Top Omset")]),t("span",{class:"text-[10px] bg-white/20 px-2 py-0.5 rounded-full backdrop-blur-sm"},"Most Valuable")],-1)),t("div",ce,[(i(!0),u(b,null,$(p.value.revenue,(s,o)=>(i(),B(T(F),{key:"rev-"+s.id,href:a.route("products.show",s.slug),class:"flex items-center gap-2 p-1.5 rounded-lg hover:bg-white/10 transition group"},{default:h(()=>[t("div",me,d(o+1),1),t("div",ve,[t("p",fe,d(s.name),1),t("p",ge,d(s.qty)+" items",1)]),t("div",pe,d(new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(s.revenue)),1)]),_:2},1032,["href"]))),128))]),e[10]||(e[10]=t("div",{class:"absolute -right-6 -bottom-6 text-9xl opacity-5 pointer-events-none select-none"},"ðŸ’Ž",-1))]),t("div",xe,[e[11]||(e[11]=t("div",{class:"flex items-center justify-between mb-3 relative z-10"},[t("div",{class:"flex items-center gap-2"},[t("div",{class:"p-1.5 bg-white/20 rounded-lg backdrop-blur-sm"},[t("span",{class:"text-sm"},"ðŸ“¦")]),t("h3",{class:"font-bold text-base leading-tight"},"Terlaris (Qty)")]),t("span",{class:"text-[10px] bg-white/20 px-2 py-0.5 rounded-full backdrop-blur-sm"},"Most Popular")],-1)),t("div",he,[(i(!0),u(b,null,$(p.value.qty,(s,o)=>(i(),B(T(F),{key:"qty-"+s.id,href:a.route("products.show",s.slug),class:"flex items-center gap-2 p-1.5 rounded-lg hover:bg-white/10 transition group"},{default:h(()=>[t("div",ye,d(o+1),1),t("div",be,[t("p",_e,d(s.name),1)]),t("div",we,d(s.qty)+" items ",1)]),_:2},1032,["href"]))),128))]),e[12]||(e[12]=t("div",{class:"absolute -right-6 -bottom-6 text-9xl opacity-5 pointer-events-none select-none"},"ðŸ”¥",-1))])])])):y("",!0),v(Q,{class:"w-full",filters:x.filters,modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=s=>_.value=s),onShowFilter:e[3]||(e[3]=s=>w.value=!0),filterCount:0,actions:[{route:a.route("sales.create"),buttonText:"+ Rekap Manual"}]},null,8,["filters","modelValue","actions"]),v(A,{show:w.value,onClose:e[4]||(e[4]=s=>w.value=!1),filters:x.filters},null,8,["show","filters"]),t("div",null,[t("div",ke,[e[13]||(e[13]=t("h2",{class:"text-lg font-bold text-gray-800 dark:text-white"}," Riwayat Transaksi ",-1)),t("span",De," Total "+d(f.value.total)+" Data ",1)]),v(Z,{sales:H.value,onPreviewInvoice:z},null,8,["sales"]),f.value.last_page>1?(i(),u("div",je,[t("button",L(f.value.links[0],{disabled:!f.value.prev_page_url,onClick:e[5]||(e[5]=s=>l.value.page--),class:"px-4 py-2 bg-white border rounded-lg disabled:opacity-50 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700"})," Prev ",16,Ce),t("span",Te," Hal "+d(f.value.current_page)+" / "+d(f.value.last_page),1),t("button",{disabled:!f.value.next_page_url,onClick:e[6]||(e[6]=s=>l.value.page++),class:"px-4 py-2 bg-white border rounded-lg disabled:opacity-50 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700"}," Next ",8,$e)])):y("",!0)])])])]),_:1}),v(X,{show:k.value,onClose:e[7]||(e[7]=s=>k.value=!1),title:"Preview Invoice #"+I.value},{default:h(()=>[D.value?(i(),u("div",Pe,[...e[14]||(e[14]=[t("svg",{class:"w-10 h-10 mb-3 text-blue-500 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})],-1),t("p",{class:"text-lime-500"},"Memuat Invoice...",-1)])])):(i(),u("div",Ie,[t("div",Se,[t("iframe",{srcdoc:g.value,class:"w-full h-full bg-white border-0",style:{display:"block"}},null,8,qe)]),t("div",Me,[t("a",{href:`/sales/${P.value}/print`,target:"_blank",class:"flex items-center justify-center gap-2 py-3 font-bold text-white transition bg-red-500 rounded-lg hover:bg-red-600"}," ðŸ“¥ Download PDF ",8,Be),t("button",{onClick:R,class:"flex items-center justify-center gap-2 py-3 font-bold text-white transition bg-blue-600 rounded-lg hover:bg-blue-700"}," ðŸ–¨ Print Struk ")])]))]),_:1},8,["show","title"])],64))}},tt=te(Fe,[["__scopeId","data-v-a0184b22"]]);export{tt as default};
