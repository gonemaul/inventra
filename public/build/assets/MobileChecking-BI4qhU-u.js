import{q as g,C as h,l as d,o as n,e as q,f as r,d as m,m as c,n as x,t as s,k as T,w as C,y as I,z as S}from"./vendor-core-I2bf3i2k.js";import{B as U}from"./BottomSheet-DktEwkdi.js";import{_ as H}from"./BarcodeScanner-DQnCBQKK.js";import N from"./UnlinkMobile-Bu9ndbJa.js";import Q from"./LinkedMobile-5swf-qxQ.js";import D from"./SearchMobile-CY23kLNM.js";import E from"./HeaderMobile-DTdmgSzP.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vendor-common-pmZ7KOuE.js";import"./vendor-charts-Bw6UNgWf.js";import"./vendor-scanner-CWCxwXow.js";const K={class:"relative min-h-screen font-sans bg-gray-50 dark:bg-gray-950 pb-28"},G={class:"px-4 py-3 sticky top-[108px] z-20 bg-gray-50/95 dark:bg-gray-950/95 backdrop-blur-sm"},J={class:"flex p-1 bg-gray-200 rounded-lg dark:bg-gray-800"},W={class:"px-4 space-y-3"},X={key:2,class:"fixed z-30 w-full max-w-xs px-4 -translate-x-1/2 bottom-6 left-1/2"},Y={class:"flex gap-3"},Z={class:"space-y-6"},ee={class:"flex items-center gap-4 pb-4 border-b border-gray-100 dark:border-gray-800"},te={class:"flex items-center justify-center w-12 h-12 font-bold text-gray-400 border border-gray-200 rounded-xl bg-gray-50 dark:bg-gray-800 dark:border-gray-700 shrink-0"},ae={class:"flex-1 min-w-0"},re={class:"text-lg font-bold leading-tight text-gray-900 truncate dark:text-white"},oe={class:"text-xs font-medium text-gray-500 truncate dark:text-gray-400"},le={class:"p-1 border border-gray-200 rounded-xl bg-gray-50 dark:bg-gray-800/50 dark:border-gray-700"},se={class:"grid items-center grid-cols-2 px-2 mb-6"},ne={class:"pr-2 text-center border-r border-gray-200 dark:border-gray-700"},ie={key:0,class:"block text-2xl font-bold text-gray-400 dark:text-gray-500"},de={key:1,class:"block text-2xl font-bold text-gray-300 dark:text-gray-600"},ue={class:"block text-[10px] font-bold text-gray-400 uppercase tracking-wider"},ce={class:"pl-2"},pe={class:"flex items-center shadow-sm rounded-xl"},ge={class:"grid items-center grid-cols-2 px-2 pb-2 mb-2"},ve={class:"pr-2 text-center border-r border-gray-200 dark:border-gray-700"},ye={key:0,class:"block text-sm font-bold text-gray-500 dark:text-gray-400"},be={key:1,class:"block text-sm font-bold text-gray-300"},xe={class:"pl-2 space-y-1"},me={class:"relative"},ke={class:"text-[10px] text-right text-gray-400 font-medium"},fe={class:"flex items-center justify-between p-4 border border-gray-100 shadow-sm bg-gray-50 rounded-xl dark:bg-gray-800 dark:border-gray-700"},he={class:"text-xs font-medium text-gray-500 mt-0.5"},we={class:"flex-1 max-w-[160px]"},_e={class:"relative"},qe=["value"],Ce={key:0,class:"text-[10px] text-center text-gray-400 italic px-4"},Ie={class:"flex gap-3"},Se={__name:"MobileChecking",props:{purchase:Object,invoice:Object,unlinkedItems:Array,linkedItems:Array,products:Array,actions:Object},setup(l){const i=l,p=g("unlinked"),v=g(!1),u=g(!1),y=g(!1),b=g(""),a=g({type:"",id:null,product_id:null,name:"",code:"",unit:"",is_po_match:!1,po_qty:0,po_price:0,quantity:0,price:0,total:0}),k=t=>{a.value={type:"link",id:t.id,product_id:t.product_id,name:t.product_snapshot?.name,code:t.product_snapshot?.code,unit:t.product_snapshot.unit,is_po_match:!0,po_qty:t.product_snapshot.quantity,po_price:t.product_snapshot.purchase_price,quantity:t.quantity,price:t.purchase_price,total:t.subtotal,image_url:t.product.image_url},u.value=!0},M=t=>{const e=i.unlinkedItems?.find(o=>o.product_id===t.id);e?k(e):(console.log(t),a.value={type:"create",id:null,product_id:t.id,name:t.name,code:t.code,unit:t.unit?.name||"Pcs",is_po_match:!1,po_qty:0,po_price:0,quantity:1,price:t.purchase_price,total:t.purchase_price},u.value=!0),y.value=!1,b.value=""},$=t=>{console.log(t),a.value={type:"edit",id:t.id,product_id:t.product_id,name:t.product_snapshot?.name,code:t.product_snapshot?.code,unit:t.product_snapshot?.unit,is_po_match:t.product_snapshot.quantity>0,po_qty:t.product_snapshot.quantity,po_price:t.product_snapshot.purchase_price,quantity:t.quantity,price:t.purchase_price,total:t.subtotal},u.value=!0},B=()=>{console.log(a.value),a.value.type==="link"?V():a.value.type==="create"?P():a.value.type==="edit"&&j()},V=()=>{const t=a.value;i.actions.submitLinkage(t.id,t.quantity,t.price)},P=()=>{const t=a.value;i.actions.addNewSubstituteItem({id:t.product_id,newQty:t.quantity,newPrice:t.price})},j=()=>{const t=i.linkedItems.find(e=>e.id===a.value.id);t&&(t.quantity=a.value.quantity,t.purchase_price=a.value.price),i.actions.saveCorrections()},z=()=>{confirm("Lepaskan item ini dari invoice?")&&(i.actions.submitUnlinkage(a.value.id),u.value=!1)},L=h(()=>{if(b.value.length<2)return[];const t=b.value.toLowerCase();return i.products.filter(e=>e.name.toLowerCase().includes(t)||e.code.toLowerCase().includes(t)).slice(0,10)}),R=t=>{v.value=!1;const e=i.unlinkedItems?.find(o=>o.code===t);if(e)k(e);else{const o=i.product.find(f=>f.code===t);a.value={type:"create",id:null,product_id:o.id,name:o.name,code:o.code,unit:o.unit?.name||"Pcs",is_po_match:!1,po_qty:0,po_price:0,quantity:1,price:o.purchase_price,total:o.purchase_price},u.value=!0}},w=h(()=>(a.value.quantity||0)*(a.value.price||0)),A=t=>{const e=parseFloat(t.target.value)||0,o=a.value.quantity||0;if(o>0){const f=e/o;a.value.price=Math.round(f)}else a.value.price=e,a.value.quantity=1;t.target.value=w.value},O=h(()=>{if(!a.value.is_po_match)return"border-gray-200 focus:border-lime-500";const t=a.value.quantity-a.value.po_qty;return t===0?"border-lime-500 bg-lime-50 text-lime-700":t<0?"border-red-300 bg-red-50 text-red-600":"border-yellow-300 bg-yellow-50 text-yellow-700"}),_=t=>{let e=(a.value.quantity||0)+t;e<0&&(e=0),a.value.quantity=e};return(t,e)=>(n(),d("div",K,[q(E,{purchase:l.purchase,invoice:l.invoice,"linked-items":l.linkedItems,validateInvoice:l.actions.validateInvoice},null,8,["purchase","invoice","linked-items","validateInvoice"]),r("div",G,[r("div",J,[r("button",{onClick:e[0]||(e[0]=o=>p.value="unlinked"),class:x(["flex-1 py-2 text-xs font-bold rounded-md transition",p.value==="unlinked"?"bg-white dark:bg-gray-700 shadow text-gray-800 dark:text-white":"text-gray-500"])}," Sisa PO "+s(l.unlinkedItems?"("+l.unlinkedItems?.length+")":""),3),r("button",{onClick:e[1]||(e[1]=o=>p.value="linked"),class:x(["flex-1 py-2 text-xs font-bold rounded-md transition",p.value==="linked"?"bg-white dark:bg-gray-700 shadow text-lime-600 dark:text-lime-400":"text-gray-500"])}," Sudah Masuk ("+s(l.linkedItems.length)+") ",3)])]),r("div",W,[p.value==="unlinked"?(n(),m(N,{key:0,"unlinked-items":l.unlinkedItems,handleProductSelection:k},null,8,["unlinked-items"])):c("",!0),p.value==="linked"?(n(),m(Q,{key:1,linkedItems:l.linkedItems,openEditModal:$},null,8,["linkedItems"])):c("",!0)]),y.value?(n(),m(D,{key:0,modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=o=>b.value=o),"filtered-products":L.value,"unlinked-items":l.unlinkedItems,onClose:e[3]||(e[3]=o=>y.value=!1),onOnSelectSearch:M},null,8,["modelValue","filtered-products","unlinked-items"])):c("",!0),v.value?(n(),m(H,{key:1,onResult:R,onClose:e[4]||(e[4]=o=>v.value=!1)})):c("",!0),!y.value&&!v.value&&l.unlinkedItems?(n(),d("div",X,[r("div",Y,[r("button",{onClick:e[5]||(e[5]=o=>y.value=!0),class:"flex-1 py-4 font-bold text-gray-800 bg-white border border-gray-100 rounded-full shadow-lg dark:bg-gray-800 dark:text-white dark:border-gray-700"}," CARI "),r("button",{onClick:e[6]||(e[6]=o=>v.value=!0),class:"flex-[2] flex items-center justify-center gap-2 bg-gray-900 dark:bg-white text-white dark:text-gray-900 py-4 rounded-full shadow-xl font-bold text-lg active:scale-95 transition"},[...e[13]||(e[13]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})],-1),T(" SCAN ",-1)])])])])):c("",!0),q(U,{show:u.value,onClose:e[12]||(e[12]=o=>u.value=!1),title:"Verifikasi Barang"},{footer:C(()=>[r("div",Ie,[a.value.type==="edit"?(n(),d("button",{key:0,onClick:z,class:"p-3.5 bg-red-50 text-red-600 rounded-xl border border-red-100 hover:bg-red-100 dark:bg-red-900/20 dark:border-red-800 dark:text-red-400"},[...e[21]||(e[21]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])])):c("",!0),r("button",{onClick:e[11]||(e[11]=o=>u.value=!1),class:"flex-1 py-3.5 bg-gray-100 text-gray-600 font-bold rounded-xl dark:bg-gray-800 dark:text-gray-300"}," Batal "),r("button",{onClick:B,class:"flex-[2] py-3.5 bg-lime-500 text-white font-bold rounded-xl shadow-lg shadow-lime-500/30 active:scale-[0.98] transition"},s(a.value.type==="edit"?"Simpan Perubahan":"Tautkan Barang"),1)])]),default:C(()=>[r("div",Z,[r("div",ee,[r("div",te,s(a.value.name?.substring(0,2).toUpperCase()),1),r("div",ae,[r("span",{class:x(["text-[10px] px-2 py-0.5 rounded border font-bold uppercase inline-block mb-1 tracking-wide",a.value.is_po_match?"bg-lime-50 text-lime-700 border-lime-200 dark:bg-lime-900/20 dark:text-lime-400":"bg-purple-50 text-purple-700 border-purple-200 dark:bg-purple-900/20 dark:text-purple-400"])},s(a.value.is_po_match?"Sesuai Purchase Order":"Produk Tambahan / Baru"),3),r("h3",re,s(a.value.name),1),r("p",oe,s(a.value.code||"-"),1)])]),r("div",le,[e[18]||(e[18]=r("div",{class:"grid grid-cols-2 pb-2 mb-3 text-center border-b border-gray-200 dark:border-gray-700"},[r("div",{class:"py-1 text-[10px] font-bold tracking-wider text-gray-400 uppercase"}," Data PO "),r("div",{class:"py-1 text-[10px] font-bold tracking-wider uppercase text-lime-600 dark:text-lime-400"}," Input Fisik ")],-1)),r("div",se,[r("div",ne,[a.value.is_po_match?(n(),d("span",ie,s(a.value.po_qty),1)):(n(),d("span",de," - ")),r("span",ue,s(a.value.unit),1)]),r("div",ce,[r("div",pe,[r("button",{onClick:e[7]||(e[7]=o=>_(-1)),class:"flex items-center justify-center w-10 h-12 text-gray-500 transition bg-white border border-gray-200 rounded-l-xl hover:bg-gray-50 active:bg-gray-100 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-400 dark:hover:bg-gray-700"},[...e[14]||(e[14]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4",viewBox:"0 0 20 20",fill:"currentColor"},[r("path",{"fill-rule":"evenodd",d:"M3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z","clip-rule":"evenodd"})],-1)])]),I(r("input",{"onUpdate:modelValue":e[8]||(e[8]=o=>a.value.quantity=o),type:"number",class:x(["w-full h-12 text-center font-bold text-xl border-y border-x-0 focus:ring-0 z-10",O.value])},null,2),[[S,a.value.quantity,void 0,{number:!0}]]),r("button",{onClick:e[9]||(e[9]=o=>_(1)),class:"flex items-center justify-center w-10 h-12 text-gray-500 transition bg-white border border-gray-200 rounded-r-xl hover:bg-gray-50 active:bg-lime-50 active:text-lime-600 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-400 dark:hover:bg-gray-700"},[...e[15]||(e[15]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4",viewBox:"0 0 20 20",fill:"currentColor"},[r("path",{"fill-rule":"evenodd",d:"M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z","clip-rule":"evenodd"})],-1)])])]),a.value.is_po_match&&a.value.quantity-a.value.po_qty!==0?(n(),d("p",{key:0,class:x(["text-[10px] text-center font-bold mt-1.5 px-2 py-0.5 rounded-md inline-block w-full",a.value.quantity-a.value.po_qty<0?"bg-red-50 text-red-600":"bg-yellow-50 text-yellow-600"])},s(a.value.quantity-a.value.po_qty>0?"Lebih":"Kurang")+" "+s(Math.abs(a.value.quantity-a.value.po_qty)),3)):c("",!0)])]),r("div",ge,[r("div",ve,[a.value.is_po_match?(n(),d("span",ye,s(l.actions.formatRupiah(a.value.po_price)),1)):(n(),d("span",be," - ")),e[16]||(e[16]=r("span",{class:"block text-[9px] font-bold text-gray-400 uppercase tracking-wider mt-0.5"}," Harga Satuan ",-1))]),r("div",xe,[r("div",me,[e[17]||(e[17]=r("span",{class:"absolute text-xs font-bold text-gray-400 -translate-y-1/2 pointer-events-none left-3 top-1/2"}," Rp ",-1)),I(r("input",{"onUpdate:modelValue":e[10]||(e[10]=o=>a.value.price=o),type:"number",class:"w-full h-10 pl-8 pr-3 text-base font-bold text-right transition-all bg-white border border-gray-200 rounded-lg focus:ring-2 focus:ring-lime-500 focus:border-lime-500 dark:bg-gray-900 dark:border-gray-600 dark:text-white",placeholder:"0"},null,512),[[S,a.value.price,void 0,{number:!0}]])]),r("p",ke,s(l.actions.formatRupiah(a.value.price)),1)])])]),r("div",fe,[r("div",null,[e[19]||(e[19]=r("p",{class:"text-[10px] font-bold text-gray-400 uppercase tracking-wider"}," Subtotal ",-1)),r("p",he,s(a.value.quantity)+" x "+s(l.actions.formatRupiah(a.value.price)),1)]),r("div",we,[r("div",_e,[e[20]||(e[20]=r("span",{class:"absolute text-xs font-bold text-gray-400 -translate-y-1/2 pointer-events-none left-3 top-1/2"}," Rp ",-1)),r("input",{value:w.value,onChange:A,type:"number",class:"w-full py-2.5 pr-3 pl-9 text-lg font-black text-right text-gray-800 bg-white border border-gray-200 rounded-lg shadow-sm focus:ring-2 focus:ring-lime-500 focus:border-lime-500 dark:text-white dark:bg-gray-900 dark:border-gray-600 transition-all",placeholder:"0"},null,40,qe)])])]),a.value.type!=="edit"?(n(),d("p",Ce," * Perubahan akan disimpan. Anda dapat mengeditnya kembali nanti. ")):c("",!0)])]),_:1},8,["show"])]))}},Te=F(Se,[["__scopeId","data-v-17f03bca"]]);export{Te as default};
