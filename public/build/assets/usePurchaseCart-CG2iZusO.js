import{q as I,C as c,J as q,v as S}from"./vendor-core-BhnropoY.js";function C(s=!1,n={}){const t=I([]),r=()=>s&&n?.id?`inventra_edit_${n.id}`:"inventra_create_draft",p=()=>{const e=r(),a=localStorage.getItem(e);if(a)try{t.value=JSON.parse(a),console.log("Loaded from LocalStorage (Unsaved Changes)");return}catch{console.error("Local data corrupt, clearing..."),localStorage.removeItem(e)}s&&n&&n.items?(t.value=[],l(n.items)):t.value=[]};function u(e,a,o){const i=e.product_id,d=parseInt(a),_=parseFloat(o);t.value.push({id:i?e.id:"",product_id:i??e.id,name:e.name,code:e.code,category:e.category?.name||e.category||"-",unit:e.unit?.name||e.unit||"-",size:e.size?.name||e.size||"-",current_stock:e.stock||e.current_stock,image_url:e.image_url||"",quantity:d,purchase_price:_,subtotal:d*_})}function g(e){const a=t.value.findIndex(o=>o.product_id===e.product_id);a!==-1&&(t.value[a].quantity=parseInt(e.quantity),t.value[a].purchase_price=parseFloat(e.purchase_price),t.value[a].subtotal=t.value[a].quantity*t.value[a].purchase_price)}function v(e){t.value=t.value.filter(a=>a.product_id!==e)}function f(){t.value=[],localStorage.removeItem(r)}function l(e){e.forEach(a=>{const o={id:a.id??"",product_id:a.product_id,name:a.product_snapshot?.name??a.name,code:a.product_snapshot?.code??a.code,unit:a.product_snapshot?.unit??a.unit,size:a.product_snapshot?.size??a.size,category:a.product_snapshot?.category??a.category,stock:a.product_snapshot?.stock??a.current_stock,image_url:a.product_snapshot?.image_url??""};u(o,a.quantity,a.purchase_price)})}const y=c(()=>t.value.reduce((e,a)=>e+a.quantity,0)),h=c(()=>t.value.reduce((e,a)=>e+a.subtotal,0)),m=c(()=>t.value.length);return q(t,e=>{const a=r();localStorage.setItem(a,JSON.stringify(e))},{deep:!0}),S(()=>{p()}),{cartItems:t,addToCart:u,updateCartItem:g,removeItem:v,clearCart:f,totalUnit:y,totalBelanja:h,totalMacam:m,addMultipleItems:l}}export{C as u};
