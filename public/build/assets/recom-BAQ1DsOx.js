import{q as x,J as S,C as v,d as q,o as n,w as I,f as t,k as c,t as l,n as d,y as h,A as k,l as i,F as M,H as z,j as T,G as D,a as R}from"./vendor-core-ConwodqI.js";import{B as $}from"./BottomSheet-BzLjovBZ.js";import"./vendor-common-GpUWqhKr.js";import"./vendor-charts-Bw6UNgWf.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const A={class:"flex flex-col h-full bg-gray-50 dark:bg-gray-900"},F={class:"px-6 py-4 bg-white border-b shadow-sm dark:bg-gray-800 dark:border-gray-700 shrink-0"},N={class:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between"},V={class:"text-sm text-gray-500 dark:text-gray-400"},E={class:"text-gray-800 dark:text-gray-200"},U={class:"flex items-center gap-2"},G={class:"flex-1 p-4 overflow-y-auto custom-scrollbar"},H={key:0,class:"flex flex-col items-center justify-center py-20 space-y-4"},O={key:1,class:"flex flex-col items-center justify-center py-20 text-center"},J={key:2,class:"space-y-3"},K=["onClick"],L={class:"flex items-start gap-3"},P={class:"pt-1"},Q=["value"],W={class:"flex-1 min-w-0"},X={class:"flex items-center justify-between mb-1"},Y={class:"text-[10px] font-bold tracking-wider text-gray-400 uppercase truncate"},Z={class:"mb-2 text-sm font-bold text-gray-800 dark:text-gray-100 line-clamp-1"},ee={class:"flex items-center gap-3"},te={class:"flex-1"},se={class:"flex justify-between mb-1 text-[10px]"},re={class:"text-gray-500"},ae={class:"text-gray-400"},oe={class:"w-full h-1.5 bg-gray-100 rounded-full dark:bg-gray-700 overflow-hidden"},le={class:"flex flex-col items-end min-w-[80px]"},ne={class:"text-lg font-black text-blue-600 dark:text-blue-400"},de={class:"flex items-center justify-between pt-2 mt-1 border-t border-gray-100 border-dashed dark:border-gray-700"},ie={class:"text-xs font-bold text-gray-700 dark:text-gray-300"},ce={class:"px-6 py-4 bg-white border-t shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)] dark:bg-gray-800 dark:border-gray-700 z-10 shrink-0"},ue={class:"flex items-center justify-between mb-3"},ge={class:"flex flex-col"},pe={class:"text-xs text-gray-500"},xe={class:"text-lg font-black text-lime-600 dark:text-lime-400"},be={class:"flex gap-3"},ye=["disabled"],_e={__name:"recom",props:{show:Boolean,supplierId:[Number,String]},emits:["close","add-items"],setup(b,{emit:_}){const u=b,y=_,o=x([]),g=x(!1),a=x([]),m=r=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(r);async function w(){if(u.supplierId){g.value=!0;try{const r=await R.get(route("purchases.recommendations",u.supplierId));o.value=r.data,a.value=r.data.filter(e=>e.is_critical).map(e=>e.product_id)}catch(r){console.error("Gagal fetch rekomendasi:",r),o.value=[],a.value=[]}finally{g.value=!1}}}S(()=>u.show,r=>{r?w():setTimeout(()=>{o.value=[],a.value=[]},300)});const p=v({get(){return o.value.length>0&&a.value.length===o.value.length},set(r){a.value=r?o.value.map(e=>e.product_id):[]}}),C=v(()=>o.value.filter(r=>a.value.includes(r.product_id)).reduce((r,e)=>r+e.purchase_price*e.quantity,0)),j=r=>{const e=a.value.indexOf(r);e===-1?a.value.push(r):a.value.splice(e,1)};function B(){const r=o.value.filter(e=>a.value.includes(e.product_id)).map(e=>({product_id:e.product_id,code:e.code,name:e.name,unit:e.unit,size:e.size,purchase_price:e.purchase_price,quantity:e.quantity,subtotal:e.purchase_price*e.quantity,current_stock:e.current_stock}));r.length!==0&&(y("add-items",r),y("close"))}return(r,e)=>(n(),q($,{show:b.show,onClose:e[4]||(e[4]=s=>r.$emit("close")),title:"ðŸ’¡ Rekomendasi Restock Cerdas"},{default:I(()=>[t("div",A,[t("div",F,[t("div",N,[t("div",null,[t("p",V,[e[5]||(e[5]=c(" Sistem mendeteksi ",-1)),t("strong",E,l(o.value.length)+" barang",1),e[6]||(e[6]=c(" di bawah stok minimum atau diprediksi habis. ",-1))])]),t("div",U,[t("label",{class:d(["flex items-center gap-2 px-3 py-1.5 text-xs font-bold transition-colors border rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700",p.value?"bg-lime-50 border-lime-200 text-lime-700":"bg-white border-gray-200 text-gray-600 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-300"])},[h(t("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=s=>p.value=s),class:"w-4 h-4 border-gray-300 rounded text-lime-600 focus:ring-lime-500"},null,512),[[k,p.value]]),c(" Pilih Semua ("+l(o.value.length)+") ",1)],2)])])]),t("div",G,[g.value?(n(),i("div",H,[...e[7]||(e[7]=[t("div",{class:"relative w-12 h-12"},[t("div",{class:"absolute w-full h-full border-4 rounded-full border-lime-200 opacity-30"}),t("div",{class:"absolute w-full h-full border-4 border-l-4 rounded-full border-lime-500 animate-spin border-t-transparent border-r-transparent border-b-transparent"})],-1),t("span",{class:"text-sm font-medium text-gray-500 animate-pulse"},"Menganalisa data stok...",-1)])])):o.value.length===0?(n(),i("div",O,[...e[8]||(e[8]=[t("div",{class:"p-4 mb-4 bg-green-100 rounded-full dark:bg-green-900/30"},[t("svg",{class:"w-10 h-10 text-green-600 dark:text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1),t("h3",{class:"text-lg font-bold text-gray-800 dark:text-gray-100"}," Stok Aman! ",-1),t("p",{class:"max-w-xs mt-1 text-sm text-gray-500"}," Tidak ada barang dari supplier ini yang perlu di-restock saat ini. ",-1)])])):(n(),i("div",J,[(n(!0),i(M,null,z(o.value,s=>(n(),i("div",{key:s.product_id,onClick:f=>j(s.product_id),class:d(["relative flex flex-col gap-3 p-4 transition-all bg-white border rounded-xl cursor-pointer dark:bg-gray-800 group hover:shadow-md active:scale-[0.99]",[a.value.includes(s.product_id)?"border-lime-500 ring-1 ring-lime-500 bg-lime-50/10":"border-gray-200 dark:border-gray-700 hover:border-lime-300",s.is_critical?"border-l-4 border-l-red-500":"border-l-4 border-l-transparent"]])},[t("div",L,[t("div",P,[h(t("input",{type:"checkbox",value:s.product_id,"onUpdate:modelValue":e[1]||(e[1]=f=>a.value=f),onClick:e[2]||(e[2]=T(()=>{},["stop"])),class:"w-5 h-5 border-gray-300 rounded cursor-pointer text-lime-600 focus:ring-lime-500"},null,8,Q),[[k,a.value]])]),t("div",W,[t("div",X,[t("span",Y,l(s.brand||"Umum")+" â€¢ #"+l(s.code),1),t("span",{class:d(["inline-flex items-center px-2 py-0.5 rounded text-[10px] font-bold border",s.is_critical?"bg-red-50 text-red-700 border-red-200 dark:bg-red-900/30 dark:text-red-300 dark:border-red-800":"bg-yellow-50 text-yellow-700 border-yellow-200 dark:bg-yellow-900/30 dark:text-yellow-300"])},l(s.reason),3)]),t("h4",Z,l(s.name),1),t("div",ee,[t("div",te,[t("div",se,[t("span",re,[e[9]||(e[9]=c("Stok: ",-1)),t("b",{class:d(s.current_stock<=s.min_stock?"text-red-600":"text-gray-700")},l(s.current_stock),3)]),t("span",ae,"Min: "+l(s.min_stock),1)]),t("div",oe,[t("div",{class:d(["h-full transition-all duration-500 rounded-full",s.is_critical?"bg-red-500":"bg-yellow-400"]),style:D({width:Math.min(s.current_stock/s.min_stock*100,100)+"%"})},null,6)])]),e[11]||(e[11]=t("div",{class:"w-px h-8 bg-gray-200 dark:bg-gray-700"},null,-1)),t("div",le,[e[10]||(e[10]=t("span",{class:"text-[10px] text-gray-400"},"Saran Order",-1)),t("span",ne," +"+l(s.quantity),1)])])])]),t("div",de,[e[12]||(e[12]=t("span",{class:"text-[10px] text-gray-400"},"Estimasi Biaya:",-1)),t("span",ie,l(m(s.purchase_price*s.quantity)),1)])],10,K))),128))]))]),t("div",ce,[t("div",ue,[t("div",ge,[t("span",pe,"Total Estimasi ("+l(a.value.length)+" item)",1),t("span",xe,l(m(C.value)),1)])]),t("div",be,[t("button",{onClick:e[3]||(e[3]=s=>r.$emit("close")),class:"px-4 py-2.5 text-sm font-bold text-gray-600 bg-gray-100 rounded-xl hover:bg-gray-200 transition dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600"}," Batal "),t("button",{onClick:B,disabled:a.value.length===0,class:d(["flex-1 flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-bold text-white transition rounded-xl shadow-lg shadow-lime-500/30",a.value.length>0?"bg-lime-600 hover:bg-lime-700 active:scale-[0.98]":"bg-gray-300 cursor-not-allowed dark:bg-gray-700 text-gray-400 shadow-none"])},[...e[13]||(e[13]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),t("span",null,"Tambahkan ke Keranjang",-1)])],10,ye)])])])]),_:1},8,["show"]))}};export{_e as default};
