import{_ as S}from"./AuthenticatedLayout-DgtTuRzB.js";import{m as i,H as j,j as y,g as u,o as d,a as t,d as D,h as E,w as l,i as I,b as N,n as B,f as _,F as T,q as V}from"./app-DwOZ8O7W.js";import{_ as q}from"./Tabs-B3TlBZ0I.js";import{P as b}from"./PrimaryButton-BQIY3AiW.js";import{_ as x}from"./DeleteConfirm-DDdY3a12.js";import F from"./FinalizeModal-BGRN_OrI.js";import P from"./InvoiceForm-COEttr98.js";import z from"./invoiceTable-B9ZG2uvl.js";import O from"./productTable-JwNHMOKR.js";import H from"./HeaderDetail-YpHlQZTq.js";import"./useSidebar-BYtjcE5l.js";import"./useActionLoading-D41ljnOE.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Modal-DnFGslV2.js";import"./SecondaryButton-J9yOrGUT.js";import"./InputLabel-DbFrkpph.js";import"./TextInput-DSjdPGH_.js";import"./InputError-Y3v5ilY1.js";import"./DataTable-DNYoLFHT.js";import"./ImageModal-BLHTPr2M.js";import"./InfoCard-DOJLceaz.js";const R={key:0,class:"flex justify-end mt-4"},A={class:"w-full mt-4 space-y-6"},K={key:0,class:"flex justify-end mb-4"},me={__name:"PurchaseDetail",props:{purchase:Object,invoices:Object,invoice:Object,paymentStatuses:Array,isCheckingMode:Boolean},setup(n){const s=n,m=i(null),o=i(!1),r=i(null),c=i(!1);j(()=>{s.purchase.status==="diterima"&&!s.invoice.id&&f()});const g=i(s.purchase.items.map(e=>({...e,rejected_quantity:e.rejected_quantity||0,is_valid:e.quantity-(e.rejected_quantity||0)>0}))),p=y(()=>s.purchase.invoices.length>0&&s.purchase.status==="checking"),v=y(()=>["diterima","checking"].includes(s.purchase.status)),C=()=>{c.value=!0},f=()=>{r.value=null,o.value=!0},M=e=>{r.value=e,o.value=!0},w=e=>{const a={title:"Hapus Nota Keuangan",message:`Hapus Nota No. ${e.invoice_number}? Ini akan menghapus file foto dan mengembalikan status transaksi ke RECEIVED jika tidak ada nota lain.`,itemName:e.invoice_number,url:route("purchases.destroyInvoice",{purchase:s.purchase.id,invoice:e.id})};m.value.open(a)},h=()=>{o.value=!1,V.reload({only:["purchase","invoice","flash"],preserveScroll:!0})},$=[{key:"invoices",label:"Invoice & Pembayaran"},{key:"products",label:"Validasi Item"}];return(e,a)=>(d(),u(T,null,[t(D(E),{title:"Detail Transaksi"}),t(x,{ref_key:"deleteModalRef",ref:m,onSuccess:h},null,512),t(F,{show:c.value,purchase:n.purchase,onClose:a[0]||(a[0]=k=>c.value=!1)},null,8,["show","purchase"]),t(S,{headerTitle:"Detail # "+s.purchase.reference_no,showSidebar:!1},{default:l(()=>[t(H,{data:s.purchase,mode:e.type},null,8,["data","mode"]),t(P,{show:o.value,purchaseId:n.purchase.id,editingInvoice:r.value,paymentStatuses:n.paymentStatuses,onClose:a[1]||(a[1]=k=>o.value=!1),onInvoiceSaved:h},null,8,["show","purchaseId","editingInvoice","paymentStatuses"]),n.purchase.status==="checking"?(d(),u("div",R,[t(b,{disable:!p.value,onClick:C,class:B({"opacity-50 cursor-not-allowed":!p.value})},{default:l(()=>[...a[3]||(a[3]=[_(" Selesaikan & Masukkan Stok (Completed) ",-1)])]),_:1},8,["disable","class"])])):I("",!0),N("div",A,[t(q,{tabs:$,defaultTab:"invoices"},{invoices:l(()=>[v.value?(d(),u("div",K,[t(b,{onClick:f},{default:l(()=>[...a[4]||(a[4]=[_(" + Tambah Nota Baru ",-1)])]),_:1})])):I("",!0),t(z,{purchase:n.purchase,isCheckingMode:n.isCheckingMode,canEditDelete:v.value,onEditInvoice:M,onDeleteInvoice:a[2]||(a[2]=k=>w(n.invoice)),onOpenPaymentModal:()=>{}},null,8,["purchase","isCheckingMode","canEditDelete"])]),products:l(()=>[t(O,{items:g.value},null,8,["items"])]),_:1})])]),_:1},8,["headerTitle"])],64))}};export{me as default};
