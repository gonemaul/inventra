import{_ as V}from"./AuthenticatedLayout-BaGcqBdf.js";import{G as L,E as s,d as P,o as p,w as E,f as D,l as f,m as R,t as C,k as T,e as n,g as N,D as H,L as q,N as K,p as $,i as O,$ as j,F as U}from"./vendor-core-n0E2YlDl.js";import{_ as W}from"./DeleteConfirm-CUCz26iu.js";import{_ as G}from"./Modal-DD7XFOIB.js";import{D as Y}from"./DangerButton-DTkTpPy1.js";import{_ as J}from"./SecondaryButton-rX2s91Zz.js";import{u as Q}from"./useActionLoading-De_ETMek.js";import X from"./FinalizeModal-qapYA-6l.js";import Z from"./OrderImageModal-DPpdlPg0.js";import ee from"./InvoiceForm-BWFtgGsV.js";import te from"./DesktopDetail-DSAeCpGn.js";import ae from"./MobileDetail-CZgi_C3G.js";import"./useSidebar-B9fx8wpQ.js";import"./vendor-common-BBegFRNv.js";import"./vendor-charts-Bw6UNgWf.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./PrimaryButton-CtmJntPf.js";import"./InputLabel-DV2mOVFj.js";import"./TextInput-C0L14ct4.js";import"./BottomSheet-CW6tJypf.js";import"./InputError-Q56U9tu7.js";import"./Tabs-V9WnopDj.js";import"./HeaderDetail-u50QLgJy.js";import"./InfoCard-Co59hIrv.js";import"./usePurchaseAnalytics-BiKfC_Gd.js";import"./invoiceTable-D_gCJV6P.js";import"./DataTable-BuMDi14p.js";import"./ImageModal-CrqlRK1M.js";import"./productTable-fJ3q9Qay.js";import"./HeadMobile-D0N8C8o_.js";import"./InvoiceMobile-DhiBmltg.js";import"./ProdukMobile-CHgkeZKO.js";import"./StatusModalMobile-CRT73rAI.js";const se={class:"p-6"},ie={class:"mb-4 text-xl font-bold text-red-600"},ne={class:"mb-4 text-gray-700 dark:text-gray-300"},oe={key:0,class:"mb-6 text-lg font-semibold"},le={class:"text-red-700 dark:text-red-400"},re={class:"flex justify-end gap-3 mt-4"},ue={key:0},de={key:1},ce={__name:"ConfirmModal",emits:["close","success"],setup(r,{expose:a,emit:k}){const{isActionLoading:u}=Q(),d=L(),c=s(!1),v=s("Konfirmasi Aksi"),_=s("Anda yakin ingin melanjutkan aksi ini?"),l=s(""),m=s(""),g=s("post"),h=s({});a({open:i=>{v.value=i.title||"Konfirmasi Penghapusan",_.value=i.message||"Anda yakin ingin menghapus data ini?",l.value=i.itemName||"",m.value=i.url||"",g.value=i.method||"post",h.value=i.data||{},c.value=!0}});const w=()=>{c.value=!1,y("close")},S=()=>{if(!m.value){d.error("URL aksi tidak terdefinisi.");return}u.value=!0;const i=g.value.toLowerCase();H[i](m.value,h.value||{},{preserveScroll:!0,onSuccess:()=>{w(),y("close")},onError:o=>{d.error(o.message||"Terjadi kesalahan saat menghapus data.")},onFinish:()=>{u.value=!1,m.value=""}})},y=k;return(i,o)=>(p(),P(G,{show:c.value,onClose:o[0]||(o[0]=A=>y("close")),maxWidth:"md"},{default:E(()=>[D("div",se,[D("h3",ie,C(v.value),1),D("p",ne,C(_.value),1),l.value?(p(),f("p",oe,[o[1]||(o[1]=T(" Item: ",-1)),D("span",le,C(l.value),1)])):R("",!0),D("div",re,[n(J,{onClick:w,type:"button"},{default:E(()=>[...o[2]||(o[2]=[T(" Batal ",-1)])]),_:1}),n(Y,{onClick:S,disabled:N(u)},{default:E(()=>[N(u)?(p(),f("span",ue,"Memproses...")):(p(),f("span",de,"Ya"))]),_:1},8,["disabled"])])])]),_:1},8,["show"]))}},me={key:0},pe={key:1},Je={__name:"PurchaseDetail",props:{purchase:Object,invoices:Object,invoice:Object,paymentStatuses:Array,isCheckingMode:Boolean},setup(r){const a=r,k=s(!1),u=s(null),d=s(!1),c=s(null),v=s(!1),_=s(!1),l=s(window.innerWidth<1024),m=()=>{l.value=window.innerWidth<1024};q(()=>{window.addEventListener("resize",m),a.purchase.status==="diterima"&&!a.invoice.id&&i()}),K(()=>window.removeEventListener("resize",m));const g=s(a.purchase.items.map(e=>({...e,rejected_quantity:e.rejected_quantity||0,is_valid:e.quantity-(e.rejected_quantity||0)>0}))),h=$(()=>{const e=a.purchase;return e.status!=="checking"||e.items.some(b=>b.item_status==="pending")||e.invoices.length===0?!1:e.invoices.every(b=>{const z=b.status==="validated",F=b.items&&b.items.length>0;return z&&F})}),M=$(()=>["diterima","checking"].includes(a.purchase.status)),w=$(()=>a.purchase.status==="draft"||a.purchase.status==="dipesan"),S=$(()=>a.purchase.status==="draft"),y=()=>{h.value&&(v.value=!0)},i=()=>{c.value=null,d.value=!0},o=e=>{c.value=e,d.value=!0},A=e=>{const t={title:"Hapus Nota Keuangan",message:`Hapus Nota No. ${e.invoice_number}? Ini akan menghapus file foto dan mengembalikan status transaksi ke RECEIVED jika tidak ada nota lain.`,itemName:e.invoice_number,url:route("purchases.destroyInvoice",{purchase:a.purchase.id,invoice:e.id})};u.value.open(t)},x=()=>{d.value=!1,router.reload({preserveScroll:!0,preserveState:!0})},B={openCreateInvoiceModal:i,handleEditInvoice:o,handleDeleteInvoice:A,handleDelete:()=>{const e={title:"Hapus Pembelian",message:`Apakah Anda yakin ingin menghapus pembelian #${a.purchase.reference_no}? Tindakan ini tidak dapat dibatalkan.`,url:route("purchases.destroy",a.purchase.id)};u.value.open(e)},updateStatus:(e,t)=>{const I={title:"Konfirmasi Perubahan Status",message:`Anda yakin ingin mengubah status transaksi ${e.reference_no} menjadi ${t.toUpperCase()}?`,itemName:e.reference_no,url:route("purchases.update-status",{purchase:e.id}),method:"put",data:{status:t}};_.value.open(I)},openFinalizeModal:y,getActions:e=>{const t=[];switch(e.status){case"draft":t.push({label:"Tandai Dipesan",icon:"play",type:"status",newStatus:"dipesan"});break;case"dipesan":t.push({label:"Tandai Dikirim",icon:"truck",type:"status",newStatus:"dikirim"});break;case"dikirim":t.push({label:"Tandai Diterima",icon:"receive",type:"status",newStatus:"diterima"});break;case"diterima":t.push({label:"Batalkan Terima",icon:"undo",type:"status",newStatus:"dikirim"});break}return t},openImageModal:()=>k.value=!0};return(e,t)=>(p(),f(U,null,[n(N(O),{title:`Detail - ${r.purchase.reference_no}`},null,8,["title"]),n(W,{ref_key:"deleteModalRef",ref:u,onSuccess:x},null,512),n(ce,{ref_key:"showConfirmModal",ref:_,onSuccess:x},null,512),n(X,{show:v.value,purchase:r.purchase,onClose:t[0]||(t[0]=I=>v.value=!1)},null,8,["show","purchase"]),n(Z,{show:k.value,purchase:r.purchase,"store-name":e.$page.props.auth.user.store_name||"INVENTRA STORE",onClose:t[1]||(t[1]=I=>k.value=!1)},null,8,["show","purchase","store-name"]),n(ee,{show:d.value,purchaseId:r.purchase.id,editingInvoice:c.value,paymentStatuses:r.paymentStatuses,onClose:t[2]||(t[2]=I=>d.value=!1),onInvoiceSaved:x},null,8,["show","purchaseId","editingInvoice","paymentStatuses"]),n(V,{showSidebar:!l.value,showHeader:!l.value,showBottomBar:!l.value,headerTitle:`Detail - ${r.purchase.reference_no}`},{default:E(()=>[l.value?(p(),f("div",me,[n(ae,j(a,{actions:B,validationItems:g.value,allowFinalize:h.value,canEditDeleteInvoice:M.value,isEditing:w.value,isDeleted:S.value}),null,16,["validationItems","allowFinalize","canEditDeleteInvoice","isEditing","isDeleted"])])):(p(),f("div",pe,[n(te,j(a,{actions:B,validationItems:g.value,allowFinalize:h.value,canEditDeleteInvoice:M.value,isEditing:w.value,isDeleted:S.value}),null,16,["validationItems","allowFinalize","canEditDeleteInvoice","isEditing","isDeleted"])]))]),_:1},8,["showSidebar","showHeader","showBottomBar","headerTitle"])],64))}};export{Je as default};
