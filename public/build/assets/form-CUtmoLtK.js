import{p as U,q as C,v as H,J as A,C as q,u as L,l,o as n,e as j,g as s,i as Q,w as N,f as t,k as $,y as S,Z as O,z as I,n as v,F as T,H as R,t as i,T as B,m as x}from"./vendor-core-BC1dSzkC.js";import{_ as E}from"./AuthenticatedLayout-BqVghQ4K.js";import{_ as M}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vendor-common-GpUWqhKr.js";import"./vendor-charts-Bw6UNgWf.js";import"./useSidebar-B3W3eSlW.js";import"./useActionLoading-BNGSEwHo.js";function J(f){const y=U(),u="POS_RECAP_DRAFT_V2",g=C(""),c=C("all"),b=C("all"),o=C([]),p=C(new Date().toISOString().slice(0,10));H(()=>{const a=localStorage.getItem(u);if(a)try{const e=JSON.parse(a);o.value=e.cart||[],p.value=e.date||new Date().toISOString().slice(0,10)}catch{localStorage.removeItem(u)}}),A([o,p],()=>{localStorage.setItem(u,JSON.stringify({cart:o.value,date:p.value}))},{deep:!0});const V=a=>{if(a.stock<=0){y.error(`Stok ${a.name} Habis!`);return}const e=o.value.find(r=>r.id===a.id);e?e.quantity<a.stock?e.quantity++:y.warning(`Stok maksimal tercapai (${a.stock})`):o.value.push({id:a.id,name:a.name,code:a.code,image:a.image_path,selling_price:a.selling_price,purchase_price:a.purchase_price,stock:a.stock,quantity:1})},h=a=>{o.value.splice(a,1)},z=()=>{confirm("Hapus semua data rekap?")&&(o.value=[],localStorage.removeItem(u))},D=q(()=>{if(c.value==="all")return[];const a=f.categories.find(e=>e.id===c.value);return a?a.product_types:[]});A(c,()=>{b.value="all"});const P=q(()=>{let a=f.products||[];if(c.value!=="all"&&(a=a.filter(e=>e.category_id===c.value)),b.value!=="all"&&(a=a.filter(e=>e.product_type_id===b.value)),g.value){const e=g.value.toLowerCase();a=a.filter(r=>r.name.toLowerCase().includes(e)||r.code&&r.code.toLowerCase().includes(e))}return a}),k=q(()=>o.value.reduce((a,e)=>a+e.selling_price*e.quantity,0)),_=q(()=>o.value.reduce((a,e)=>{const r=e.selling_price-e.purchase_price;return a+r*e.quantity},0)),d=L({input_type:"recap",report_date:null,items:[],total_revenue:0,total_profit:0,payment_method:"cash",payment_amount:0,change_amount:0,customer_id:null,notes:""});return{searchQuery:g,selectedCategory:c,selectedProductType:b,currentProductType:D,cart:o,transactionDate:p,form:d,filteredProducts:P,totalRevenue:k,totalProfit:_,addToCart:V,removeItem:h,clearCart:z,processRecap:()=>{if(o.value.length===0)return y.error("Data masih kosong!");if(!p.value)return y.error("Pilih tanggal rekap!");if(o.value.some(e=>e.quantity<=0))return y.error("Ada produk dengan jumlah 0!");d.report_date=p.value,d.items=o.value.map(e=>({product_id:e.id,quantity:e.quantity,selling_price:e.selling_price,purchase_price:e.purchase_price})),d.total_revenue=parseFloat(k.value),d.total_profit=parseFloat(_.value),d.payment_amount=parseFloat(k.value),d.change_amount=0,d.post(route("sales.pos.store"),{onSuccess:()=>{o.value=[],localStorage.removeItem(u)},onError:e=>{console.error(e),y.error("Gagal menyimpan rekap.")}})}}}const G={class:"flex flex-col w-full gap-4 lg:h-[85vh] h-[100vh] overflow-hidden lg:flex-row"},K={class:"w-full lg:w-[40%] flex flex-col bg-white dark:bg-gray-800 rounded-2xl shadow-md border border-gray-300 dark:border-gray-700 overflow-hidden h-1/2 lg:h-full"},Y={class:"z-10 p-3 space-y-3 bg-white border-b border-gray-100 dark:border-gray-700 shrink-0 dark:bg-gray-800"},Z={class:"flex items-center justify-between"},W={class:"relative w-1/2"},X={class:"mb-4 space-y-2"},ee={class:"flex gap-2 pb-1 overflow-x-auto custom-scroll-x"},te=["onClick"],re={key:0,class:"flex gap-2 pb-1 pl-1 overflow-x-auto custom-scroll-x"},ae=["onClick"],se={class:"flex-1 p-3 overflow-y-auto custom-scroll bg-gray-50 dark:bg-gray-900/50"},oe={key:0,class:"flex flex-col items-center justify-center h-40 text-sm text-gray-400"},le={class:"grid grid-cols-2 gap-2 xl:grid-cols-3"},ne=["onClick"],ie={key:0,class:"absolute z-10 flex items-center justify-center w-6 h-6 text-xs font-bold text-white bg-orange-500 rounded-full shadow-md -top-2 -right-2 animate-bounce-in"},de={class:"h-8 mb-1.5 text-xs font-bold leading-tight text-gray-700 dark:text-gray-200 line-clamp-2 pr-2"},ce={class:"flex flex-wrap gap-1 mb-2"},ge={key:0,class:"px-1.5 py-0.5 text-[10px] font-medium text-gray-600 bg-gray-100 rounded dark:bg-gray-700 dark:text-gray-300 border border-gray-200 dark:border-gray-600"},ue={class:"flex items-end justify-between mt-auto"},pe={class:"flex flex-col"},ye={class:"text-[10px]"},me={class:"relative text-right"},xe={key:0,class:"absolute bottom-0 right-0 flex items-center invisible gap-1 text-xs font-bold transition-all duration-200 opacity-0 group-hover:visible group-hover:opacity-100 text-lime-600"},be={class:"w-full lg:w-[60%] flex flex-col bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden h-1/2 lg:h-full relative"},ve={class:"z-20 flex items-center justify-between p-3 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 shrink-0"},fe={class:"flex items-center gap-3"},he={class:"flex items-center px-2 py-1 bg-white border border-gray-300 rounded-lg shadow-sm dark:bg-gray-700 dark:border-gray-600"},ke={class:"relative flex-1 min-h-0 overflow-auto bg-white custom-scroll custom-scroll-x dark:bg-gray-800"},_e={class:"w-full text-left border-collapse"},we={class:"text-sm divide-y divide-gray-100 dark:divide-gray-700"},Ce={key:0},Se={class:"p-3 align-middle"},Ie={class:"text-xs font-bold text-gray-800 dark:text-gray-200 sm:text-sm line-clamp-2"},Te={class:"text-[10px] text-gray-400"},Pe={class:"p-3 align-middle"},qe=["onUpdate:modelValue"],Re={class:"p-3 text-right align-middle"},Ve=["onUpdate:modelValue"],ze={class:"p-3 text-xs font-bold text-right align-middle text-lime-600 dark:text-lime-400 sm:text-sm"},De={class:"p-3 text-center align-middle"},Fe=["onClick"],je={class:"items-center justify-between gap-4 p-4 border-t border-gray-200 lg:flex dark:border-gray-700 bg-gray-50 dark:bg-gray-900 shrink-0"},$e={class:"mt-1 text-xl font-black leading-none text-gray-900 lg:text-2xl dark:text-white"},Ae={class:"flex items-center gap-3 mt-2 lg:mt-0"},Ne={class:"w-full sm:flex-1"},Oe={class:"relative"},Ue=["disabled"],He={key:0,class:"w-4 h-4 border-2 border-white rounded-full animate-spin border-t-transparent"},Le={__name:"form",props:{products:Array,categories:Array},setup(f){const y=f,{searchQuery:u,selectedCategory:g,selectedProductType:c,currentProductType:b,cart:o,filteredProducts:p,totalRevenue:V,form:h,addToCart:z,removeItem:D,processRecap:P,clearCart:k,transactionDate:_}=J(y),d=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(a),F=a=>{const e=o.value.find(r=>r.id===a);return e?e.quantity:0};return(a,e)=>(n(),l(T,null,[j(s(Q),{title:"Input Rekap"}),j(E,null,{default:N(()=>[t("div",G,[t("div",K,[t("div",Y,[t("div",Z,[e[10]||(e[10]=t("h2",{class:"flex items-center gap-2 text-lg font-bold text-gray-800 dark:text-white"},[t("span",{class:"text-lime-500"},"ðŸ“¦"),$(" Katalog ")],-1)),t("div",W,[S(t("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>O(u)?u.value=r:null),type:"text",placeholder:"Cari...",class:"w-full pl-8 pr-3 py-1.5 bg-gray-100 dark:bg-gray-900 border border-gray-200 rounded-lg text-sm focus:ring-1 focus:ring-lime-500"},null,512),[[I,s(u)]]),e[9]||(e[9]=t("span",{class:"absolute left-2.5 top-2 text-gray-400 text-xs"},"ðŸ”",-1))])]),t("div",X,[t("div",ee,[t("button",{onClick:e[1]||(e[1]=r=>g.value="all"),class:v([s(g)==="all"?"bg-lime-500 text-white shadow-md shadow-lime-500/20":"bg-white border border-gray-200 text-gray-600 hover:border-lime-400","px-3 py-1.5 rounded-xl text-xs font-bold whitespace-nowrap transition-all active:scale-95"])}," Semua ",2),(n(!0),l(T,null,R(f.categories,r=>(n(),l("button",{key:r.id,onClick:w=>g.value=r.id,class:v([s(g)===r.id?"bg-lime-500 text-white shadow-md shadow-lime-500/20":"bg-white border border-gray-200 text-gray-600 hover:border-lime-400","px-3 py-1.5 rounded-xl text-xs font-bold whitespace-nowrap transition-all active:scale-95"])},i(r.name),11,te))),128))]),j(B,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"transform -translate-y-2 opacity-0","enter-to-class":"transform translate-y-0 opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"transform translate-y-0 opacity-100","leave-to-class":"transform -translate-y-2 opacity-0"},{default:N(()=>[s(g)!=="all"&&s(b).length>0?(n(),l("div",re,[t("button",{onClick:e[2]||(e[2]=r=>c.value="all"),class:v([s(c)==="all"?"bg-lime-100 text-lime-700 border border-lime-200":"bg-gray-50 text-gray-500 border border-transparent hover:bg-gray-100","px-2.5 py-1 rounded-lg text-[10px] font-bold whitespace-nowrap transition-all"])}," Semua "+i(f.categories.find(r=>r.id===s(g))?.name),3),(n(!0),l(T,null,R(s(b),r=>(n(),l("button",{key:r.id,onClick:w=>c.value=r.id,class:v([s(c)===r.id?"bg-lime-100 text-lime-700 border border-lime-200":"bg-gray-50 text-gray-500 border border-transparent hover:bg-gray-100","px-2.5 py-1 rounded-lg text-[10px] font-bold whitespace-nowrap transition-all"])},i(r.name),11,ae))),128))])):x("",!0)]),_:1})])]),t("div",se,[s(p).length===0?(n(),l("div",oe,[...e[11]||(e[11]=[t("span",null,"Produk tidak ditemukan",-1)])])):x("",!0),t("div",le,[(n(!0),l(T,null,R(s(p),r=>(n(),l("div",{key:r.id,onClick:w=>s(z)(r),class:v(["relative flex flex-col justify-between p-2.5 transition-all bg-white border cursor-pointer dark:bg-gray-800 rounded-xl dark:border-gray-700 hover:shadow-lg hover:-translate-y-0.5 active:scale-95 group h-full",r.stock===0?"opacity-50 cursor-not-allowed hover:border-red-400 hover:shadow-none hover:-translate-y-0 active:scale-100":"border-gray-200 hover:border-lime-400"]),",":""},[F(r.id)>0?(n(),l("div",ie,i(F(r.id)),1)):x("",!0),t("div",null,[t("div",de,i(r.name),1),t("div",ce,[r.size?(n(),l("span",ge,i(r.size?.name),1)):x("",!0)])]),t("div",ue,[t("div",pe,[e[12]||(e[12]=t("span",{class:"text-[9px] text-gray-400 uppercase tracking-wider"},"Stok",-1)),t("span",{class:v(["text-xs font-semibold",r.stock<=5?"text-red-500":"text-gray-600 dark:text-gray-300"])},[$(i(r.stock)+" ",1),t("span",ye,i(r.unit?.name),1)],2)]),t("div",me,[t("div",{class:v(["text-sm font-black transition-opacity duration-200 text-lime-600 dark:text-lime-400",r.stock>0?"group-hover:opacity-0 group-hover:invisible":""])},i(d(r.selling_price)),3),r.stock>0?(n(),l("div",xe,[...e[13]||(e[13]=[t("span",null,"+ Add",-1),t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z","clip-rule":"evenodd"})],-1)])])):x("",!0)])])],10,ne))),128))])])]),t("div",be,[t("div",ve,[t("div",fe,[e[15]||(e[15]=t("h3",{class:"hidden font-bold text-gray-800 dark:text-white sm:block"}," ðŸ“ Rekap ",-1)),t("div",he,[e[14]||(e[14]=t("label",{class:"text-[10px] font-bold text-gray-500 dark:text-gray-300 uppercase mr-2"},"Tgl:",-1)),S(t("input",{type:"date","onUpdate:modelValue":e[3]||(e[3]=r=>O(_)?_.value=r:null),class:"h-5 p-0 text-sm font-bold text-gray-800 bg-transparent border-none cursor-pointer dark:text-white focus:ring-0"},null,512),[[I,s(_)]])])]),s(o).length?(n(),l("button",{key:0,onClick:e[4]||(e[4]=(...r)=>s(k)&&s(k)(...r)),class:"px-2 py-1 text-xs font-bold text-red-500 transition rounded hover:bg-red-50"}," Reset ")):x("",!0)]),t("div",ke,[t("table",_e,[e[17]||(e[17]=t("thead",{class:"sticky top-0 z-10 bg-gray-100 dark:bg-gray-900 text-[10px] uppercase font-bold text-gray-500 dark:text-gray-400 tracking-wider shadow-sm"},[t("tr",null,[t("th",{class:"p-3 bg-gray-100 min-w-48 lg:min-w-1/2 dark:bg-gray-900"}," Produk "),t("th",{class:"w-20 p-3 text-center bg-gray-100 dark:bg-gray-900"}," Qty "),t("th",{class:"p-3 text-right bg-gray-100 w-28 dark:bg-gray-900"}," Harga "),t("th",{class:"p-3 text-right bg-gray-100 w-28 dark:bg-gray-900"}," Subtotal "),t("th",{class:"w-8 p-3 text-center bg-gray-100 dark:bg-gray-900"})])],-1)),t("tbody",we,[s(o).length===0?(n(),l("tr",Ce,[...e[16]||(e[16]=[t("td",{colspan:"5",class:"p-10 text-center text-gray-400"},[t("div",{class:"mb-2 text-4xl opacity-30"}," ðŸ“¥ "),$(" Pilih produk di katalog sebelah kiri. ")],-1)])])):x("",!0),(n(!0),l(T,null,R(s(o),(r,w)=>(n(),l("tr",{key:w,class:"transition group hover:bg-lime-50 dark:hover:bg-gray-700/50"},[t("td",Se,[t("div",Ie,i(r.name),1),t("div",Te,i(r.code),1)]),t("td",Pe,[S(t("input",{type:"number","onUpdate:modelValue":m=>r.quantity=m,min:"1",class:"w-16 py-1 text-sm font-bold text-center text-gray-800 border border-gray-200 rounded-lg dark:text-white bg-gray-50 dark:bg-gray-900 dark:border-gray-600 focus:ring-lime-500 focus:border-lime-500",onFocus:e[5]||(e[5]=m=>m.target.select())},null,40,qe),[[I,r.quantity]])]),t("td",Re,[S(t("input",{type:"number","onUpdate:modelValue":m=>r.selling_price=m,class:"w-24 p-0 text-sm font-medium text-right text-gray-600 bg-transparent border-b border-gray-300 border-dashed border-none dark:text-gray-300 focus:ring-0 hover:border-gray-400",onFocus:e[6]||(e[6]=m=>m.target.select())},null,40,Ve),[[I,r.selling_price]])]),t("td",ze,i(d(r.quantity*r.selling_price)),1),t("td",De,[t("button",{onClick:m=>s(D)(w),class:"p-1 text-gray-300 hover:text-red-500"}," âœ• ",8,Fe)])]))),128))])])]),t("div",je,[t("div",null,[e[18]||(e[18]=t("span",{class:"text-[10px] font-bold text-gray-500 uppercase"},"Total Omzet",-1)),t("div",$e,i(d(s(V))),1)]),t("div",Ae,[t("div",Ne,[t("div",Oe,[S(t("input",{type:"text","onUpdate:modelValue":e[7]||(e[7]=r=>s(h).notes=r),placeholder:"Tambahkan Catatan Transaksi (Opsional)...",class:"w-full pl-9 pr-4 py-2.5 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl text-sm text-gray-800 dark:text-white placeholder-gray-400 focus:ring-2 focus:ring-lime-500 focus:border-transparent transition-all shadow-inner"},null,512),[[I,s(h).notes]]),e[19]||(e[19]=t("span",{class:"absolute text-gray-400 left-3 top-3"},[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})])],-1))])]),t("button",{onClick:e[8]||(e[8]=(...r)=>s(P)&&s(P)(...r)),disabled:!s(o).length||s(h).processing,class:"flex items-center gap-2 px-4 py-2 font-bold text-white transition shadow-lg lg:px-6 lg:py-3 bg-lime-500 hover:bg-lime-600 rounded-xl shadow-lime-500/30 disabled:opacity-50 active:scale-95"},[s(h).processing?(n(),l("span",He)):x("",!0),e[20]||(e[20]=t("span",null,"SIMPAN",-1))],8,Ue)])])])])]),_:1})],64))}},Ye=M(Le,[["__scopeId","data-v-61120a5f"]]);export{Ye as default};
