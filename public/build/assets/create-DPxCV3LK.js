const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/HeadRabMobile-CynlIQDs.js","assets/vendor-core-B46KUNyc.js","assets/vendor-common-GpUWqhKr.js","assets/vendor-charts-Bw6UNgWf.js","assets/vendor-core-DnojJsHo.css","assets/InputError-U1zUdQKW.js","assets/HeadRabDesktop-C-hq6eJf.js","assets/PrimaryButton-H-fN45pr.js","assets/_plugin-vue_export-helper-DlAUqK2U.js","assets/SecondaryButton-BDyiAFyF.js"])))=>i.map(i=>d[i]);
import{_ as H}from"./app-BV6mevhC.js";import{q as me,D as f,v as c,u as pe,K as ge,x as ve,S as he,d as v,o as d,w as N,e as M,f as o,g as a,i as fe,X as ye,T as _e,l as b,p as U,k as F,t as R,G as Q,n as j,a2 as be,R as ke}from"./vendor-core-B46KUNyc.js";import{_ as we}from"./AuthenticatedLayout-9yD8UcND.js";import{u as xe}from"./useActionLoading-pomD9vky.js";import{u as Se}from"./usePurchaseCart-CN38H3AM.js";import Ie from"./CatalogView-9OhHtjO8.js";import Me from"./PurchaseTable-CGyvBOJt.js";import Re from"./recom-MJn01Ra9.js";import"./vendor-common-GpUWqhKr.js";import"./vendor-charts-Bw6UNgWf.js";import"./useSidebar-DSTl-7Rw.js";import"./CatalogCard-DujJjNJL.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const je={key:0,class:"fixed top-24 left-1/2 transform -translate-x-1/2 z-[100] flex items-center p-4 bg-white/90 backdrop-blur-xl border border-white/50 rounded-2xl shadow-2xl dark:bg-gray-800/95 dark:border-gray-700 min-w-[320px] max-w-[90vw]"},Ce={class:"ml-4 flex-1"},Te={class:"text-xs font-medium text-gray-500 dark:text-gray-400 mt-0.5"},De={class:"font-black text-lime-600 dark:text-lime-400"},ze={class:"w-full min-h-screen space-y-6 py-6 lg:py-10"},Pe={class:"p-4 space-y-5 bg-white shadow-xl bg-opacity-90 backdrop-blur-lg border border-gray-100 rounded-2xl dark:bg-gray-900 dark:border-gray-800 transition-all"},Ae={class:"relative flex p-1.5 bg-gray-100/80 backdrop-blur-md rounded-xl dark:bg-gray-800 border border-gray-200/50 dark:border-gray-700 w-full md:w-fit mx-auto md:mx-0 shadow-inner"},Ee={key:0,class:"ml-2 bg-lime-500 text-white py-[2px] px-2 rounded-full text-[10px] font-black shadow-sm"},Be=["disabled"],Ve={key:0},qe={key:1},Oe={class:"min-h-[400px]"},k="inventra_draft_supplier_id",Ze={__name:"create",props:{purchase:Object,dropdowns:Object,categories:Array,brands:Array},setup(h){const G=Q(()=>H(()=>import("./HeadRabMobile-CynlIQDs.js"),__vite__mapDeps([0,1,2,3,4,5]))),W=Q(()=>H(()=>import("./HeadRabDesktop-C-hq6eJf.js"),__vite__mapDeps([6,1,2,3,4,7,8,9,5]))),n=h,m=me(),{isActionLoading:C}=xe(),p=f(()=>!!n.purchase&&!!n.purchase.id),w=f(()=>n.purchase?.status||"draft"),X=f(()=>w.value==="draft"),Y=f(()=>w.value==="dipesan"),T=c(window.innerWidth<1024),D=()=>{T.value=window.innerWidth<1024},l=c("table"),g=c(!1),{cartItems:u,addToCart:J,updateCartItem:Z,removeItem:ee,clearCart:te,totalUnit:z,totalBelanja:P,totalMacam:A,addMultipleItems:ae,removeMultipleItems:re}=Se(p.value,n.purchase),i=pe({supplier_id:n.purchase?.supplier_id||"",transaction_date:n.purchase?.transaction_date||new Date().toISOString().split("T")[0],status:w.value,notes:n.purchase?.notes||"",shipping_cost:n.purchase?.shipping_cost||0,other_costs:n.purchase?.other_costs||0}),y=c(!1),E={product_id:null,name:"",code:"",unit:"",size:"",category:"",brand:"",type:"",image_url:"",current_stock:0,quantity:1,purchase_price:0,restock_recommendation:0},r=c({...E}),_=f({get:()=>r.value.purchase_price?de(r.value.purchase_price):0,set:e=>r.value.purchase_price=ue(e)});ge(()=>i.supplier_id,e=>{e?(localStorage.setItem(k,e),g.value=!0,l.value="catalog"):(localStorage.removeItem(k),g.value=!1,l.value="table")}),ve(()=>{window.addEventListener("resize",D);const e=localStorage.getItem(k);e&&!i.supplier_id&&!p.value&&(i.supplier_id=e)}),he(()=>{window.removeEventListener("resize",D)});const x=c(!1),B=c(""),V=c(0);let S=null;const se=(e,t)=>{B.value=e,V.value=t,x.value=!0,S&&clearTimeout(S),S=setTimeout(()=>{x.value=!1},3e3)},q=(e,t=1,s=null)=>{const K=e.insights?.find(ce=>ce.type==="restock")?.payload?.suggested_qty;r.value={product_id:e.product_id?e.product_id:e.id,name:e.name,code:e.code,category:e.category?.name||e.category||"-",unit:e.unit?.name||e.unit||"-",size:e.size?.name||e.size||"-",brand:e.brand?.name||e.brand||"-",type:e.type_name||e.type_name||"-",image_url:e.image_url||e.image_path,current_stock:e.stock||e.current_stock,quantity:K||t,purchase_price:s!==null?s:e.purchase_price||0,restock_recommendation:K}},I=()=>{r.value={...E},y.value=!1},oe=e=>{q(e),l.value="catalog",window.scrollTo({top:0,behavior:"smooth"})},ie=e=>{q(e,e.quantity,e.purchase_price),y.value=!0,l.value="table",window.scrollTo({top:0,behavior:"smooth"})},O=()=>{if(!r.value.product_id)return m.error("Mohon pilih produk dari katalog.");if(r.value.quantity<=0)return m.error("Kuantitas minimal harus 1.");u.value.find(t=>t.product_id===r.value.product_id)?(Z({product_id:r.value.product_id,quantity:r.value.quantity,purchase_price:r.value.purchase_price}),m.success("Item diperbarui.")):(J(r.value,r.value.quantity,r.value.purchase_price),se(r.value.name,r.value.quantity)),I()},ne=e=>{if(Y.value&&e.id)return m.warning("Item lama tidak boleh dihapus saat status Dipesan! Silakan edit Qty saja.");ee(e.product_id)},$=()=>{if(!i.supplier_id)return m.error("Pilih Supplier dulu!");if(u.value.length===0)return m.error("Keranjang kosong!");C.value=!0;const e=s=>({...s,items:u.value}),t={onSuccess:()=>{p.value||localStorage.removeItem(k);const s=p.value?`inventra_edit_${n.purchase.id}`:"inventra_create_draft";localStorage.removeItem(s),te(),i.reset()},onError:s=>{console.error(s);const L=Object.values(s)[0]||"Terjadi kesalahan";m.error("Gagal: "+L)},onFinish:()=>{C.value=!1}};p.value?i.transform(e).put(route("purchases.update",n.purchase.id),t):i.transform(e).post(route("purchases.store"),t)},le=e=>{re(e)};function de(e){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(e)}function ue(e){return parseInt(String(e).replace(/[^0-9]/g,""))||0}return(e,t)=>(d(),v(we,null,{default:N(()=>[M(a(fe),{title:"Buat RAB"}),(d(),v(ye,{to:"body"},[M(_e,{"enter-active-class":"transition duration-500 ease-out transform","enter-from-class":"-translate-y-10 opacity-0 scale-95","enter-to-class":"translate-y-0 opacity-100 scale-100","leave-active-class":"transition duration-300 ease-in transform","leave-from-class":"translate-y-0 opacity-100 scale-100","leave-to-class":"-translate-y-10 opacity-0 scale-95"},{default:N(()=>[x.value?(d(),b("div",je,[t[8]||(t[8]=o("div",{class:"flex-shrink-0 w-12 h-12 bg-lime-100 rounded-full flex items-center justify-center dark:bg-lime-900/50 shadow-inner"},[o("svg",{class:"w-6 h-6 text-lime-600 dark:text-lime-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2.5",d:"M5 13l4 4L19 7"})])],-1)),o("div",Ce,[t[7]||(t[7]=o("p",{class:"text-sm font-black text-gray-900 dark:text-white uppercase tracking-wider"},"Item Ditambahkan!",-1)),o("p",Te,[o("span",De,"+"+R(V.value),1),F(" "+R(B.value),1)])])])):U("",!0)]),_:1})])),o("div",ze,[T.value?(d(),v(a(G),{key:0,"form-header":a(i),dropdowns:h.dropdowns,"staging-item":r.value,"is-edit":p.value,"is-editing-mode":y.value,"cart-items":a(u),"total-unit":a(z),"total-macam":a(A),"total-belanja":a(P),"displayed-price":_.value,"onUpdate:displayedPrice":t[0]||(t[0]=s=>_.value=s),onSaveStaging:O,onResetStaging:I,onSubmitTransaction:$,onOpenRecommendation:t[1]||(t[1]=s=>g.value=!0)},null,8,["form-header","dropdowns","staging-item","is-edit","is-editing-mode","cart-items","total-unit","total-macam","total-belanja","displayed-price"])):(d(),v(a(W),{key:1,"form-header":a(i),dropdowns:h.dropdowns,"staging-item":r.value,"is-edit":p.value,"is-editing-mode":y.value,"cart-items":a(u),"total-unit":a(z),"total-macam":a(A),"total-belanja":a(P),"displayed-price":_.value,"onUpdate:displayedPrice":t[2]||(t[2]=s=>_.value=s),onSaveStaging:O,onResetStaging:I,onSubmitTransaction:$,onOpenRecommendation:t[3]||(t[3]=s=>g.value=!0)},null,8,["form-header","dropdowns","staging-item","is-edit","is-editing-mode","cart-items","total-unit","total-macam","total-belanja","displayed-price"])),o("div",Pe,[o("div",Ae,[o("button",{type:"button",onClick:t[4]||(t[4]=s=>l.value="table"),class:j(["relative flex items-center justify-center w-1/2 md:w-48 py-2.5 text-sm font-bold rounded-lg transition-all duration-300 z-10",l.value==="table"?"text-gray-900 dark:text-gray-100":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"])},[t[9]||(t[9]=o("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})],-1)),t[10]||(t[10]=F(" Daftar Belanja ",-1)),a(u).length>0?(d(),b("span",Ee,R(a(u).length),1)):U("",!0)],2),o("button",{type:"button",onClick:t[5]||(t[5]=s=>l.value="catalog"),disabled:!a(i).supplier_id,class:j(["relative flex items-center justify-center w-1/2 md:w-56 py-2.5 text-sm font-bold rounded-lg transition-all duration-300 z-10",[l.value==="catalog"?"text-gray-900 dark:text-gray-100":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",a(i).supplier_id?"":"opacity-50 cursor-not-allowed"]])},[t[11]||(t[11]=o("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})],-1)),a(i).supplier_id?(d(),b("span",qe,"Katalog Produk")):(d(),b("span",Ve,"Pilih Supplier"))],10,Be),o("div",{class:j(["absolute top-1.5 bottom-1.5 w-1/2 transition-transform duration-300 ease-in-out bg-white dark:bg-gray-600 rounded-lg shadow-sm",[l.value==="table"?"left-1.5 md:w-48":"translate-x-full md:translate-x-0 md:left-[200px] md:w-56"]])},null,2)]),o("div",Oe,[(d(),v(be,null,[(d(),v(ke(l.value==="table"?Me:Ie),{"supplier-id":a(i).supplier_id,items:a(u),stagingItem:r.value,isDraft:X.value,categories:h.categories,brands:h.brands,onRemove:ne,onRemoveMultiple:le,onEdit:ie,onSelectProduct:oe},null,40,["supplier-id","items","stagingItem","isDraft","categories","brands"]))],1024))])])]),M(Re,{show:g.value,"supplier-id":a(i).supplier_id,"cart-items":a(u),onClose:t[6]||(t[6]=s=>g.value=!1),onAddItems:a(ae)},null,8,["show","supplier-id","cart-items","onAddItems"])]),_:1}))}};export{Ze as default};
