import{v as f,K as T,D as x,d as D,o as n,w as q,l as i,p as d,f as t,k as c,t as r,z as w,B as j,F as A,I as N,n as C,T as V,a as K}from"./vendor-core-By7Plnkm.js";import"./vendor-common-GpUWqhKr.js";import"./vendor-charts-Bw6UNgWf.js";const O={key:0,class:"fixed inset-0 z-50 flex flex-col bg-gray-50 dark:bg-gray-900"},$={class:"flex-none px-4 py-3 bg-white border-b shadow-sm dark:bg-gray-800 dark:border-gray-700 z-20"},F={class:"max-w-7xl mx-auto flex items-center justify-between"},L={class:"flex items-center gap-3"},H={class:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2"},P={key:0,class:"px-2.5 py-0.5 rounded-full bg-lime-100 text-lime-700 text-xs font-extra-bold"},E={class:"hidden sm:flex items-center gap-3"},U={class:"flex-none bg-white/80 backdrop-blur border-b dark:bg-gray-800/80 dark:border-gray-700 z-10 sticky top-0 sm:hidden"},G={class:"px-4 py-2 flex items-center justify-between"},Q={class:"flex items-center gap-2 text-sm font-bold text-gray-700 dark:text-gray-200"},J={class:"flex-1 overflow-y-auto bg-gray-50 dark:bg-gray-900 p-4 custom-scroll"},W={class:"max-w-7xl mx-auto"},X={key:0,class:"flex flex-col items-center justify-center py-20"},Y={key:1,class:"flex flex-col items-center justify-center py-20 text-center"},Z={key:2,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 pb-20"},ee={class:"col-span-full hidden sm:flex justify-end mb-2"},te={class:"flex items-center gap-2 text-sm font-bold text-gray-600 cursor-pointer hover:bg-white px-3 py-1 rounded transition"},se=["onClick"],oe={key:0,class:"absolute bottom-0 right-0 z-10 bg-blue-500 text-white text-[10px] font-bold px-2 py-1 rounded-tl-lg shadow-sm"},re={class:"flex p-3 gap-3"},le={class:"pt-1"},ae={key:0,class:"w-3.5 h-3.5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ne={class:"w-24 h-24 bg-gray-100 rounded-lg flex-shrink-0 flex items-center justify-center overflow-hidden border border-gray-100 relative"},ie=["src"],de={class:"flex-1 min-w-0 flex flex-col justify-between"},ce={class:"flex justify-between items-start gap-2"},ue=["title"],pe={key:0,class:"px-1.5 py-0.5 rounded text-[9px] font-black bg-red-100 text-red-600 border border-red-200 tracking-wide"},ge={class:"text-[10px] text-gray-500 font-mono mt-0.5 flex flex-wrap gap-1"},xe={key:0,class:"bg-gray-100 px-1 rounded"},ye={class:"mt-2 text-[10px] text-gray-500 bg-gray-50 dark:bg-gray-700/50 p-1.5 rounded border border-dashed border-gray-200 flex justify-between"},be={class:"text-gray-800 dark:text-gray-200"},me={class:"flex items-end justify-between mt-2"},fe={class:"flex flex-col gap-0.5"},ve={class:"text-[10px] text-gray-400 flex items-center gap-1"},he={class:"text-gray-700"},_e={class:"text-gray-700"},ke={class:"text-[10px] text-gray-500"},we={class:"flex flex-col text-right"},je={class:"text-sm font-bold text-lime-600"},Ce={class:"px-3 py-2 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-100 dark:border-gray-700 text-xs flex items-center justify-between gap-2"},ze={class:"flex items-center gap-2"},Ie={class:"font-bold text-gray-600 dark:text-gray-300"},Be={class:"truncate text-gray-500 italic"},Se={class:"flex-none bg-white dark:bg-gray-800 border-t dark:border-gray-700 p-4 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)] z-30"},Me={class:"max-w-7xl mx-auto flex items-center justify-between gap-4"},Re={class:"hidden sm:block"},Te={class:"text-sm text-gray-500"},De={class:"text-gray-900 dark:text-white"},qe={class:"flex-1 flex justify-end items-center gap-4"},Ae={class:"text-right"},Ne={class:"block text-lg font-black text-lime-600 leading-none"},Ve=["disabled"],Ke={class:"sm:hidden"},He={__name:"recom",props:{show:Boolean,supplierId:[Number,String],cartItems:{type:Array,default:()=>[]}},emits:["close","add-items"],setup(v,{emit:z}){const p=v,h=z,a=f([]),y=f(!1),l=f([]),b=o=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(o),I=o=>{const e=p.cartItems.find(s=>s.product_id===o);return e?e.quantity:0},u=o=>p.cartItems.some(e=>e.product_id===o);async function B(){if(p.supplierId){y.value=!0;try{const o=await K.get(route("purchases.recommendations",p.supplierId));a.value=o.data,l.value=o.data.filter(e=>e.is_critical&&!u(e.product_id)).map(e=>e.product_id)}catch(o){console.error("Gagal fetch rekomendasi:",o),a.value=[],l.value=[]}finally{y.value=!1}}}T(()=>p.show,o=>{o?(B(),document.body.style.overflow="hidden"):(document.body.style.overflow="",setTimeout(()=>{a.value=[],l.value=[]},300))});const g=x({get(){return a.value.length>0&&l.value.length===a.value.filter(o=>!u(o.product_id)).length},set(o){l.value=o?a.value.filter(e=>!u(e.product_id)).map(e=>e.product_id):[]}}),_=x(()=>a.value.filter(o=>o.is_critical).length),m=x(()=>l.value.length),S=x(()=>a.value.filter(o=>l.value.includes(o.product_id)).reduce((o,e)=>o+e.purchase_price*e.quantity,0)),M=o=>{const e=l.value.indexOf(o);e===-1?l.value.push(o):l.value.splice(e,1)},k=()=>{l.value=a.value.filter(o=>o.is_critical&&!u(o.product_id)).map(o=>o.product_id)};function R(){const o=a.value.filter(e=>l.value.includes(e.product_id)).map(e=>({product_id:e.product_id,code:e.code,name:e.name,unit:e.unit,size:e.size_name,brand:e.brand,category:e.category,purchase_price:e.purchase_price,quantity:e.quantity,subtotal:e.purchase_price*e.quantity,current_stock:e.current_stock,min_stock:e.min_stock,image_url:e.image_url,image_path:e.image_path}));o.length!==0&&(h("add-items",o),h("close"))}return(o,e)=>(n(),D(V,{"enter-active-class":"transition duration-300 ease-out","enter-from-class":"transform translate-y-10 opacity-0","enter-to-class":"transform translate-y-0 opacity-100","leave-active-class":"transition duration-200 ease-in","leave-from-class":"transform translate-y-0 opacity-100","leave-to-class":"transform translate-y-10 opacity-0"},{default:q(()=>[v.show?(n(),i("div",O,[t("div",$,[t("div",F,[t("div",L,[t("button",{onClick:e[0]||(e[0]=s=>o.$emit("close")),class:"p-2 -ml-2 text-gray-500 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition"},[...e[4]||(e[4]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1)])]),t("div",null,[t("h1",H,[e[5]||(e[5]=c(" Rekomendasi Restock ",-1)),a.value.length>0?(n(),i("span",P,r(a.value.length),1)):d("",!0)]),e[6]||(e[6]=t("p",{class:"text-xs text-gray-500 hidden sm:block"},"Analisis stok menipis berdasarkan data inventory.",-1))])]),t("div",E,[t("button",{onClick:k,class:"px-3 py-1.5 rounded-lg border border-red-200 bg-red-50 text-red-600 text-xs font-bold hover:bg-red-100 transition flex items-center gap-1.5"},[e[7]||(e[7]=t("span",{class:"w-1.5 h-1.5 rounded-full bg-red-500 animate-pulse"},null,-1)),c(" Pilih Kritis ("+r(_.value)+") ",1)])])])]),t("div",U,[t("div",G,[t("label",Q,[w(t("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=s=>g.value=s),class:"w-4 h-4 rounded border-gray-300 text-lime-600 focus:ring-lime-500"},null,512),[[j,g.value]]),e[8]||(e[8]=c(" Pilih Semua ",-1))]),t("button",{onClick:k,class:"text-xs font-bold text-red-600 bg-red-50 px-2 py-1 rounded border border-red-100"}," Kritis ("+r(_.value)+") ",1)])]),t("div",J,[t("div",W,[y.value?(n(),i("div",X,[...e[9]||(e[9]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-4 border-lime-500 border-t-transparent mb-4"},null,-1),t("p",{class:"text-gray-500 font-medium"},"Menganalisa data stok...",-1)])])):a.value.length===0?(n(),i("div",Y,[e[10]||(e[10]=t("div",{class:"w-20 h-20 bg-lime-100 rounded-full flex items-center justify-center mb-4"},[t("svg",{class:"w-10 h-10 text-lime-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e[11]||(e[11]=t("h3",{class:"text-xl font-bold text-gray-900 dark:text-white"},"Stok Aman!",-1)),e[12]||(e[12]=t("p",{class:"text-gray-500 mt-2"},"Semua stok produk aman, tidak ada rekomendasi restock.",-1)),t("button",{onClick:e[2]||(e[2]=s=>o.$emit("close")),class:"mt-6 text-lime-600 font-bold hover:underline"},"Kembali")])):(n(),i("div",Z,[t("div",ee,[t("label",te,[w(t("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=s=>g.value=s),class:"w-4 h-4 rounded border-gray-300 text-lime-600 focus:ring-lime-500"},null,512),[[j,g.value]]),e[13]||(e[13]=c(" Pilih Semua Data ",-1))])]),(n(!0),i(A,null,N(a.value,s=>(n(),i("div",{key:s.product_id,onClick:Oe=>M(s.product_id),class:C(["relative group bg-white dark:bg-gray-800 rounded-xl overflow-hidden border transition-all cursor-pointer hover:shadow-lg select-none",[l.value.includes(s.product_id)?"border-lime-500 ring-1 ring-lime-500 bg-lime-50/5":"border-gray-200 dark:border-gray-700 hover:border-lime-300",u(s.product_id)?"opacity-70 bg-gray-50 dark:bg-gray-900":""]])},[u(s.product_id)?(n(),i("div",oe," Sudah Dipesan: "+r(I(s.product_id)),1)):d("",!0),t("div",re,[t("div",le,[t("div",{class:C(["w-5 h-5 rounded border flex items-center justify-center transition-colors shadow-sm",l.value.includes(s.product_id)?"bg-lime-500 border-lime-500":"bg-white border-gray-300"])},[l.value.includes(s.product_id)?(n(),i("svg",ae,[...e[14]||(e[14]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"3",d:"M5 13l4 4L19 7"},null,-1)])])):d("",!0)],2)]),t("div",ne,[e[15]||(e[15]=t("div",{class:"absolute inset-0 flex items-center justify-center text-gray-300"},[t("svg",{class:"w-10 h-10 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1)),s.image_url||s.image_path?(n(),i("img",{key:0,loading:"lazy",src:s.image_url||s.image_path,class:"absolute inset-0 w-full h-full object-contain p-1 mix-blend-multiply z-10 transition-opacity duration-300",alt:"img",onload:"this.style.opacity='1'",onerror:"this.style.display='none'"},null,8,ie)):d("",!0)]),t("div",de,[t("div",null,[t("div",ce,[t("h4",{class:"text-sm font-bold text-gray-900 dark:text-white leading-tight line-clamp-2",title:s.name},r(s.name),9,ue),s.is_critical?(n(),i("span",pe,"KRITIS")):d("",!0)]),t("div",ge,[t("span",null,r(s.brand),1),e[16]||(e[16]=t("span",null,"â€¢",-1)),t("span",null,r(s.category),1),s.size!=="-"?(n(),i("span",xe,r(s.size),1)):d("",!0)])]),t("div",ye,[e[17]||(e[17]=t("span",null,"Terjual (90H):",-1)),t("strong",be,r(s.sold_90d)+" "+r(s.unit),1)]),t("div",me,[t("div",fe,[t("div",ve,[t("span",null,[e[18]||(e[18]=c("Sisa: ",-1)),t("strong",he,r(s.current_stock),1)]),e[20]||(e[20]=t("span",{class:"text-gray-300"},"|",-1)),t("span",null,[e[19]||(e[19]=c("Min: ",-1)),t("strong",_e,r(s.min_stock),1)])]),t("div",ke," @ "+r(b(s.purchase_price)),1)]),t("div",we,[e[21]||(e[21]=t("span",{class:"text-[10px] text-gray-400"},"Nilai Order",-1)),t("span",je,r(b(s.purchase_price*s.quantity)),1)])])])]),t("div",Ce,[t("div",ze,[t("span",Ie,"Saran: "+r(s.quantity)+" "+r(s.unit),1),e[22]||(e[22]=t("span",{class:"w-px h-3 bg-gray-300"},null,-1)),t("span",Be,r(s.reason||"Restock Reguler"),1)])])],10,se))),128))]))])]),t("div",Se,[t("div",Me,[t("div",Re,[t("span",Te,[e[23]||(e[23]=c("Terpilih: ",-1)),t("strong",De,r(m.value)+" Item",1)])]),t("div",qe,[t("div",Ae,[e[24]||(e[24]=t("span",{class:"block text-[10px] uppercase tracking-wider text-gray-400"},"Estimasi Total",-1)),t("span",Ne,r(b(S.value)),1)]),t("button",{onClick:R,disabled:m.value===0,class:"px-6 py-3 bg-lime-500 hover:bg-lime-600 active:bg-lime-700 text-white font-bold rounded-xl shadow-lg shadow-lime-500/30 transition-all disabled:opacity-50 disabled:grayscale disabled:shadow-none flex items-center gap-2 min-w-[160px] justify-center"},[e[25]||(e[25]=t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)),e[26]||(e[26]=t("span",{class:"hidden sm:inline"},"Masukkan ke RAB",-1)),t("span",Ke,"Masuk RAB ("+r(m.value)+")",1)],8,Ve)])])])])):d("",!0)]),_:1}))}};export{He as default};
