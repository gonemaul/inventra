import{v as g,D as _,l as u,o as n,f as r,d as k,p as c,e as f,n as x,t as s,k as R,w as I,z as U,A as H}from"./vendor-core-By7Plnkm.js";import{B as N}from"./BottomSheet-CbDDnn2t.js";import{_ as D}from"./BarcodeScanner-DKRXhBOH.js";import G from"./UnlinkMobile-DOehTzsv.js";import Q from"./LinkedMobile-Cejwlc8e.js";import E from"./SearchMobile-C2q4DMDb.js";import F from"./HeaderMobile-CirjYz37.js";import{_ as S}from"./InputRupiah-BO9l6Y_n.js";import{u as K}from"./useActionLoading-BREuot5v.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vendor-common-GpUWqhKr.js";import"./vendor-charts-Bw6UNgWf.js";import"./vendor-scanner-og__AIM6.js";const W={class:"relative min-h-screen font-sans bg-gray-50 dark:bg-gray-950 pb-28"},X={class:"sticky top-0 z-20 px-4 py-3 space-y-3 bg-gray-50/95 dark:bg-gray-950/95 backdrop-blur-sm"},Y={class:"flex p-1 bg-gray-200 rounded-lg dark:bg-gray-800"},Z={class:"px-4 space-y-3"},ee={key:2,class:"fixed z-30 w-full max-w-xs px-4 -translate-x-1/2 bottom-6 left-1/2"},te={class:"flex gap-3"},ae={class:"space-y-6"},re={class:"flex items-center gap-4 pb-4 border-b border-gray-100 dark:border-gray-800"},oe={class:"flex items-center justify-center w-12 h-12 font-bold text-gray-400 border border-gray-200 rounded-xl bg-gray-50 dark:bg-gray-800 dark:border-gray-700 shrink-0"},le={class:"flex-1 min-w-0"},se={class:"text-lg font-bold leading-tight text-gray-900 truncate dark:text-white"},ne={class:"text-xs font-medium text-gray-500 truncate dark:text-gray-400"},ie={class:"p-1 border border-gray-200 rounded-xl bg-gray-50 dark:bg-gray-800/50 dark:border-gray-700"},de={class:"grid items-center grid-cols-2 px-2 mb-6"},ue={class:"pr-2 text-center border-r border-gray-200 dark:border-gray-700"},ce={key:0,class:"block text-2xl font-bold text-gray-400 dark:text-gray-500"},pe={key:1,class:"block text-2xl font-bold text-gray-300 dark:text-gray-600"},ge={class:"block text-[10px] font-bold text-gray-400 uppercase tracking-wider"},ye={class:"pl-2"},ve={class:"flex items-center shadow-sm rounded-xl"},be={class:"grid items-center grid-cols-2 px-2 pb-2 mb-2"},me={class:"pr-2 text-center border-r border-gray-200 dark:border-gray-700"},xe={key:0,class:"block text-sm font-bold text-gray-500 dark:text-gray-400"},ke={key:1,class:"block text-sm font-bold text-gray-300"},fe={class:"pl-2 space-y-1"},he={class:"relative"},we={class:"text-[10px] text-right text-gray-400 font-medium"},_e={class:"flex items-center justify-between p-4 border border-gray-100 shadow-sm bg-gray-50 rounded-xl dark:bg-gray-800 dark:border-gray-700"},qe={class:"text-xs font-medium text-gray-500 mt-0.5"},Ce={class:"flex-1 max-w-[160px]"},Ie={class:"relative"},Se={key:0,class:"text-[10px] text-center text-gray-400 italic px-4"},Me={class:"flex gap-3"},Ve={__name:"MobileChecking",props:{purchase:Object,invoice:Object,unlinkedItems:Array,linkedItems:Array,products:Array,actions:Object},setup(l){const i=l,{isActionLoading:y}=K(),p=g("unlinked"),v=g(!1),d=g(!1),b=g(!1),m=g(""),a=g({type:"",id:null,product_id:null,name:"",code:"",unit:"",is_po_match:!1,po_qty:0,po_price:0,quantity:0,price:0,total:0}),h=t=>{a.value={type:"link",id:t.id,product_id:t.product_id,name:t.product_snapshot?.name,code:t.product_snapshot?.code,unit:t.product_snapshot.unit,is_po_match:!0,po_qty:t.product_snapshot.quantity,po_price:t.product_snapshot.purchase_price,quantity:t.quantity,price:t.purchase_price,total:t.subtotal,image_url:t.product.image_url},d.value=!0},M=t=>{const e=i.unlinkedItems?.find(o=>o.product_id===t.id);e?h(e):(a.value={type:"create",id:null,product_id:t.id,name:t.name,code:t.code,unit:t.unit?.name||"Pcs",is_po_match:!1,po_qty:0,po_price:0,quantity:1,price:t.purchase_price,total:t.purchase_price},d.value=!0),b.value=!1,m.value=""},V=t=>{if(i.purchase.status!=="checking"){alert("Purchase Order ini sudah selesai diperiksa. Tidak dapat menambahkan atau mengedit item.");return}if(i.invoice.status==="validated"){alert("Invoice ini sudah divalidasi. Tidak dapat menambahkan atau mengedit item.");return}a.value={type:"edit",id:t.id,product_id:t.product_id,name:t.product_snapshot?.name,code:t.product_snapshot?.code,unit:t.product_snapshot?.unit,is_po_match:t.product_snapshot.quantity>0,po_qty:t.product_snapshot.quantity,po_price:t.product_snapshot.purchase_price,quantity:t.quantity,price:t.purchase_price,total:t.subtotal},d.value=!0},$=()=>{y.value=!0,a.value.type==="link"?B():a.value.type==="create"?P():a.value.type==="edit"&&j(),d.value=!1},B=async()=>{const t=a.value;try{await i.actions.submitLinkage(t.id,t.quantity,t.price)}catch(e){console.error("Gagal link",e)}finally{y.value=!1}},P=async()=>{const t=a.value;try{await i.actions.addNewSubstituteItem({id:t.product_id,newQty:t.quantity,newPrice:t.price})}catch(e){console.error("Gagal membuat",e)}finally{y.value=!1}},j=async()=>{const t=a.value,e=i.linkedItems.find(o=>o.id===a.value.id);e&&(e.quantity=a.value.quantity,e.purchase_price=a.value.price);try{await i.actions.saveCorrections({id:t.id,quantity:t.quantity,purchase_price:t.price})}catch(o){console.error("Gagal edit",o)}finally{y.value=!1}},L=async()=>{if(confirm("Lepaskan item ini dari invoice?")){try{await i.actions.submitUnlinkage(a.value.id)}catch(t){console.error("Gagal unlink",t)}finally{y.value=!1}d.value=!1}},z=_(()=>{if(m.value.length<2)return[];const t=m.value.toLowerCase();return i.products.filter(e=>e.name.toLowerCase().includes(t)||e.code.toLowerCase().includes(t)).slice(0,10)}),A=t=>{v.value=!1;const e=i.unlinkedItems?.find(o=>o.code===t);if(e)h(e);else{const o=i.product.find(w=>w.code===t);a.value={type:"create",id:null,product_id:o.id,name:o.name,code:o.code,unit:o.unit?.name||"Pcs",is_po_match:!1,po_qty:0,po_price:0,quantity:1,price:o.purchase_price,total:o.purchase_price},d.value=!0}},q=_(()=>(a.value.quantity||0)*(a.value.price||0)),T=t=>{const e=parseFloat(t)||0,o=a.value.quantity||0;if(o>0){const w=e/o;a.value.price=Math.round(w)}else a.value.price=e,a.value.quantity=1;t=q.value},O=_(()=>{if(!a.value.is_po_match)return"border-gray-200 focus:border-lime-500";const t=a.value.quantity-a.value.po_qty;return t===0?"border-lime-500 bg-lime-50 text-lime-700":t<0?"border-red-300 bg-red-50 text-red-600":"border-yellow-300 bg-yellow-50 text-yellow-700"}),C=t=>{let e=(a.value.quantity||0)+t;e<0&&(e=0),a.value.quantity=e};return(t,e)=>(n(),u("div",W,[r("div",X,[f(F,{purchase:l.purchase,invoice:l.invoice,"linked-items":l.linkedItems,validateInvoice:l.actions.validateInvoice},null,8,["purchase","invoice","linked-items","validateInvoice"]),r("div",Y,[r("button",{onClick:e[0]||(e[0]=o=>p.value="unlinked"),class:x(["flex-1 py-2 text-xs font-bold rounded-md transition",p.value==="unlinked"?"bg-white dark:bg-gray-700 shadow text-gray-800 dark:text-white":"text-gray-500"])}," Sisa PO "+s(l.unlinkedItems?"("+l.unlinkedItems?.length+")":""),3),r("button",{onClick:e[1]||(e[1]=o=>p.value="linked"),class:x(["flex-1 py-2 text-xs font-bold rounded-md transition",p.value==="linked"?"bg-white dark:bg-gray-700 shadow text-lime-600 dark:text-lime-400":"text-gray-500"])}," Sudah Masuk ("+s(l.linkedItems.length)+") ",3)])]),r("div",Z,[p.value==="unlinked"?(n(),k(G,{key:0,"unlinked-items":l.unlinkedItems,handleProductSelection:h},null,8,["unlinked-items"])):c("",!0),p.value==="linked"?(n(),k(Q,{key:1,linkedItems:l.linkedItems,openEditModal:V},null,8,["linkedItems"])):c("",!0)]),b.value?(n(),k(E,{key:0,modelValue:m.value,"onUpdate:modelValue":e[2]||(e[2]=o=>m.value=o),"filtered-products":z.value,"unlinked-items":l.unlinkedItems,onClose:e[3]||(e[3]=o=>b.value=!1),onOnSelectSearch:M},null,8,["modelValue","filtered-products","unlinked-items"])):c("",!0),v.value?(n(),k(D,{key:1,onResult:A,onClose:e[4]||(e[4]=o=>v.value=!1)})):c("",!0),!b.value&&!v.value&&l.unlinkedItems?(n(),u("div",ee,[r("div",te,[r("button",{onClick:e[5]||(e[5]=o=>b.value=!0),class:"flex-1 py-4 font-bold text-gray-800 bg-white border border-gray-100 rounded-full shadow-lg dark:bg-gray-800 dark:text-white dark:border-gray-700"}," CARI "),r("button",{onClick:e[6]||(e[6]=o=>v.value=!0),class:"flex-[2] flex items-center justify-center gap-2 bg-gray-900 dark:bg-white text-white dark:text-gray-900 py-4 rounded-full shadow-xl font-bold text-lg active:scale-95 transition"},[...e[13]||(e[13]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})],-1),R(" SCAN ",-1)])])])])):c("",!0),f(N,{show:d.value,onClose:e[12]||(e[12]=o=>d.value=!1),title:"Verifikasi Barang"},{footer:I(()=>[r("div",Me,[a.value.type==="edit"?(n(),u("button",{key:0,onClick:L,class:"p-3.5 bg-red-50 text-red-600 rounded-xl border border-red-100 hover:bg-red-100 dark:bg-red-900/20 dark:border-red-800 dark:text-red-400"},[...e[21]||(e[21]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])])):c("",!0),r("button",{onClick:e[11]||(e[11]=o=>d.value=!1),class:"flex-1 py-3.5 bg-gray-100 text-gray-600 font-bold rounded-xl dark:bg-gray-800 dark:text-gray-300"}," Batal "),r("button",{onClick:$,class:"flex-[2] py-3.5 bg-lime-500 text-white font-bold rounded-xl shadow-lg shadow-lime-500/30 active:scale-[0.98] transition"},s(a.value.type==="edit"?"Simpan Perubahan":"Tautkan Barang"),1)])]),default:I(()=>[r("div",ae,[r("div",re,[r("div",oe,s(a.value.name?.substring(0,2).toUpperCase()),1),r("div",le,[r("span",{class:x(["text-[10px] px-2 py-0.5 rounded border font-bold uppercase inline-block mb-1 tracking-wide",a.value.is_po_match?"bg-lime-50 text-lime-700 border-lime-200 dark:bg-lime-900/20 dark:text-lime-400":"bg-purple-50 text-purple-700 border-purple-200 dark:bg-purple-900/20 dark:text-purple-400"])},s(a.value.is_po_match?"Sesuai Purchase Order":"Produk Tambahan / Baru"),3),r("h3",se,s(a.value.name),1),r("p",ne,s(a.value.code||"-"),1)])]),r("div",ie,[e[18]||(e[18]=r("div",{class:"grid grid-cols-2 pb-2 mb-3 text-center border-b border-gray-200 dark:border-gray-700"},[r("div",{class:"py-1 text-[10px] font-bold tracking-wider text-gray-400 uppercase"}," Data PO "),r("div",{class:"py-1 text-[10px] font-bold tracking-wider uppercase text-lime-600 dark:text-lime-400"}," Input Fisik ")],-1)),r("div",de,[r("div",ue,[a.value.is_po_match?(n(),u("span",ce,s(a.value.po_qty),1)):(n(),u("span",pe," - ")),r("span",ge,s(a.value.unit),1)]),r("div",ye,[r("div",ve,[r("button",{onClick:e[7]||(e[7]=o=>C(-1)),class:"flex items-center justify-center w-10 h-12 text-gray-500 transition bg-white border border-gray-200 rounded-l-xl hover:bg-gray-50 active:bg-gray-100 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-400 dark:hover:bg-gray-700"},[...e[14]||(e[14]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4",viewBox:"0 0 20 20",fill:"currentColor"},[r("path",{"fill-rule":"evenodd",d:"M3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z","clip-rule":"evenodd"})],-1)])]),U(r("input",{"onUpdate:modelValue":e[8]||(e[8]=o=>a.value.quantity=o),type:"number",class:x(["w-full h-12 text-center font-bold text-xl border-y border-x-0 focus:ring-0 z-10",O.value])},null,2),[[H,a.value.quantity,void 0,{number:!0}]]),r("button",{onClick:e[9]||(e[9]=o=>C(1)),class:"flex items-center justify-center w-10 h-12 text-gray-500 transition bg-white border border-gray-200 rounded-r-xl hover:bg-gray-50 active:bg-lime-50 active:text-lime-600 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-400 dark:hover:bg-gray-700"},[...e[15]||(e[15]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4",viewBox:"0 0 20 20",fill:"currentColor"},[r("path",{"fill-rule":"evenodd",d:"M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z","clip-rule":"evenodd"})],-1)])])]),a.value.is_po_match&&a.value.quantity-a.value.po_qty!==0?(n(),u("p",{key:0,class:x(["text-[10px] text-center font-bold mt-1.5 px-2 py-0.5 rounded-md inline-block w-full",a.value.quantity-a.value.po_qty<0?"bg-red-50 text-red-600":"bg-yellow-50 text-yellow-600"])},s(a.value.quantity-a.value.po_qty>0?"Lebih":"Kurang")+" "+s(Math.abs(a.value.quantity-a.value.po_qty)),3)):c("",!0)])]),r("div",be,[r("div",me,[a.value.is_po_match?(n(),u("span",xe,s(l.actions.formatRupiah(a.value.po_price)),1)):(n(),u("span",ke," - ")),e[16]||(e[16]=r("span",{class:"block text-[9px] font-bold text-gray-400 uppercase tracking-wider mt-0.5"}," Harga Satuan ",-1))]),r("div",fe,[r("div",he,[e[17]||(e[17]=r("span",{class:"absolute text-xs font-bold text-gray-400 -translate-y-1/2 pointer-events-none left-3 top-1/2"}," Rp ",-1)),f(S,{modelValue:a.value.price,"onUpdate:modelValue":e[10]||(e[10]=o=>a.value.price=o),modelModifiers:{number:!0},min:"1",class:"w-full h-10 pr-3 text-base font-bold text-left transition-all bg-white border border-gray-200 rounded-lg focus:ring-2 focus:ring-lime-500 focus:border-lime-500 dark:bg-gray-900 dark:border-gray-600 dark:text-white",placeholder:"0"},null,8,["modelValue"])]),r("p",we,s(l.actions.formatRupiah(a.value.price)),1)])])]),r("div",_e,[r("div",null,[e[19]||(e[19]=r("p",{class:"text-[10px] font-bold text-gray-400 uppercase tracking-wider"}," Subtotal ",-1)),r("p",qe,s(a.value.quantity)+" x "+s(l.actions.formatRupiah(a.value.price)),1)]),r("div",Ce,[r("div",Ie,[e[20]||(e[20]=r("span",{class:"absolute text-xs font-bold text-gray-400 -translate-y-1/2 pointer-events-none left-3 top-1/2"}," Rp ",-1)),f(S,{"model-value":q.value,"onUpdate:modelValue":T,class:"w-full py-2.5 pr-3 text-lg font-black text-left text-gray-800 bg-white border border-gray-200 rounded-lg shadow-sm focus:ring-2 focus:ring-lime-500 focus:border-lime-500 dark:text-white dark:bg-gray-900 dark:border-gray-600 transition-all",placeholder:"0",min:"0"},null,8,["model-value"])])])]),a.value.type!=="edit"?(n(),u("p",Se," * Perubahan akan disimpan. Anda dapat mengeditnya kembali nanti. ")):c("",!0)])]),_:1},8,["show"])]))}},De=J(Ve,[["__scopeId","data-v-93d34c57"]]);export{De as default};
