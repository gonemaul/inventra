import{y as p,J as S,p as I,d as M,o as n,w as g,f as t,l as d,k as i,t as l,q as f,v,F as j,H as D,n as y,j as N,m as V,e as h,a as $}from"./vendor-core-5xBySu3Y.js";import{P as q}from"./PrimaryButton-Cxy6ePjq.js";import{_ as A}from"./SecondaryButton-bHJ7AARo.js";import{B as F}from"./BottomSheet-Dqr7fYKf.js";import"./vendor-common-pmZ7KOuE.js";import"./vendor-charts-Bw6UNgWf.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const R={class:"px-6 py-3 bg-white dark:bg-gray-800"},P={class:"items-start mb-4"},T={class:"px-3 py-1 text-xs font-bold text-blue-600 border border-blue-100 rounded-lg bg-blue-50"},z={key:0,class:"flex flex-col items-center justify-center py-12 text-gray-500 animate-pulse"},E={key:1,class:"flex flex-col items-center py-12 text-center text-gray-500"},H={key:2,class:"overflow-auto max-h-[60vh] border rounded-lg dark:border-gray-700"},K={class:"min-w-full text-sm text-left divide-y divide-gray-200 dark:divide-gray-700"},L={class:"sticky top-0 z-10 text-xs text-gray-700 uppercase shadow-sm bg-gray-50 dark:bg-gray-700 dark:text-gray-400"},U={class:"w-10 px-4 py-3 bg-gray-50 dark:bg-gray-700"},G={class:"bg-white divide-y divide-gray-200 dark:divide-gray-700 dark:bg-gray-800"},J=["onClick"],O=["value"],Q={class:"px-4 py-3 min-w-80%"},W={class:"flex items-center gap-3"},X=["title"],Y={class:"px-4 py-3"},Z={key:0,class:"mr-1"},ee={class:"px-4 py-3 text-center"},te={class:"flex flex-col items-center"},se={class:"text-[10px] text-gray-400"},ae={class:"px-4 py-3 text-center"},re={class:"px-3 py-1 font-bold text-blue-700 border border-blue-200 rounded-lg shadow-sm bg-blue-50"},oe={class:"px-4 py-3 font-medium text-right text-gray-600 dark:text-gray-300"},le={class:"flex items-center justify-end gap-3 pt-4 mt-6 border-t dark:border-gray-700"},ne={class:"mr-auto text-sm text-gray-500"},me={__name:"recom",props:{show:Boolean,supplierId:[Number,String]},emits:["close","add-items"],setup(m,{emit:_}){const u=m,x=_,o=p([]),c=p(!1),r=p([]),w=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(a);async function C(){if(u.supplierId){c.value=!0;try{const a=await $.get(route("purchases.recommendations",u.supplierId));o.value=a.data,r.value=a.data.filter(e=>e.is_critical).map(e=>e.product_id)}catch(a){console.error("Gagal fetch rekomendasi:",a),o.value=[]}finally{c.value=!1}}}S(()=>u.show,a=>{a?C():o.value=[]});function B(){const a=o.value.filter(e=>r.value.includes(e.product_id)).map(e=>({...e,quantity:e.quantity,purchase_price:e.purchase_price}));a.length!==0&&(x("add-items",a),x("close"))}const b=I({get(){return r.value.length===o.value.length&&o.value.length>0},set(a){r.value=a?o.value.map(e=>e.product_id):[]}});return(a,e)=>(n(),M(F,{show:m.show,onClose:e[4]||(e[4]=s=>a.$emit("close")),title:"ðŸ’¡ Rekomendasi Restok Cerdas"},{default:g(()=>[t("div",R,[t("div",P,[e[5]||(e[5]=t("p",{class:"mt-1 text-sm text-gray-500"},[i(" Daftar barang dari Supplier ini yang perlu dibeli berdasarkan "),t("span",{class:"font-bold text-blue-500"},"Forecasting"),i(" dan "),t("span",{class:"font-bold text-red-500"},"Stok Minimum"),i(". ")],-1)),t("div",T,l(o.value.length)+" Item Ditemukan ",1)]),c.value?(n(),d("div",z,[...e[6]||(e[6]=[t("div",{class:"w-8 h-8 mx-auto mb-2 border-b-2 rounded-full animate-spin border-lime-500"},null,-1),t("span",null,"Menganalisa Kebutuhan Stok...",-1)])])):o.value.length===0?(n(),d("div",E,[...e[7]||(e[7]=[t("div",{class:"flex items-center justify-center w-12 h-12 mb-2 text-green-600 bg-green-100 rounded-full"},[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})])],-1),t("span",{class:"font-medium text-gray-800 dark:text-white"},"Stok Aman!",-1),t("span",{class:"mt-1 text-sm"},"Tidak ada barang yang perlu di-restock dari supplier ini.",-1)])])):(n(),d("div",H,[t("table",K,[t("thead",L,[t("tr",null,[t("th",U,[f(t("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=s=>b.value=s),class:"border-gray-300 rounded cursor-pointer text-lime-600 focus:ring-lime-500"},null,512),[[v,b.value]])]),e[8]||(e[8]=t("th",{class:"w-1/3 px-4 py-3 bg-gray-50 dark:bg-gray-700"}," Produk ",-1)),e[9]||(e[9]=t("th",{class:"w-1/2 px-4 py-3 bg-gray-50 dark:bg-gray-700"}," Analisa / Alasan ",-1)),e[10]||(e[10]=t("th",{class:"px-4 py-3 text-center w-28 bg-gray-50 dark:bg-gray-700"}," Stok ",-1)),e[11]||(e[11]=t("th",{class:"px-4 py-3 text-center w-28 bg-gray-50 dark:bg-gray-700"}," Saran Qty ",-1)),e[12]||(e[12]=t("th",{class:"px-4 py-3 text-right bg-gray-50 dark:bg-gray-700"}," Estimasi ",-1))])]),t("tbody",G,[(n(!0),d(j,null,D(o.value,s=>(n(),d("tr",{key:s.product_id,class:y(["transition cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/50",{"bg-red-50/30 dark:bg-red-900/10":s.is_critical}]),onClick:k=>r.value.includes(s.product_id)?r.value.splice(r.value.indexOf(s.product_id),1):r.value.push(s.product_id)},[t("td",{class:"px-4 py-3",onClick:e[2]||(e[2]=N(()=>{},["stop"]))},[f(t("input",{type:"checkbox",value:s.product_id,"onUpdate:modelValue":e[1]||(e[1]=k=>r.value=k),class:"border-gray-300 rounded cursor-pointer text-lime-600 focus:ring-lime-500"},null,8,O),[[v,r.value]])]),t("td",Q,[t("div",W,[t("p",{class:"font-bold text-gray-800 dark:text-gray-200 line-clamp-1",title:s.name},l(s.name),9,X)])]),t("td",Y,[t("span",{class:y(["inline-flex items-center px-2.5 py-0.5 rounded text-xs font-bold border shadow-sm",s.is_critical?"bg-red-100 text-red-700 border-red-200":"bg-yellow-100 text-yellow-700 border-yellow-200"])},[s.is_critical?(n(),d("span",Z,"ðŸš¨")):V("",!0),i(" "+l(s.reason),1)],2)]),t("td",ee,[t("div",te,[t("span",{class:y(["font-bold",s.current_stock<=s.min_stock?"text-red-600":"text-gray-700"])},l(s.current_stock),3),t("span",se,"Min: "+l(s.min_stock),1)])]),t("td",ae,[t("span",re,l(s.quantity),1)]),t("td",oe,l(w(s.purchase_price*s.quantity)),1)],10,J))),128))])])])),t("div",le,[t("p",ne,l(r.value.length)+" item dipilih ",1),h(A,{onClick:e[3]||(e[3]=s=>a.$emit("close"))},{default:g(()=>[...e[13]||(e[13]=[i("Batal",-1)])]),_:1}),h(q,{onClick:B,disabled:r.value.length===0,class:"flex items-center gap-2"},{default:g(()=>[...e[14]||(e[14]=[t("svg",{class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),i(" Masukkan ke Keranjang ",-1)])]),_:1},8,["disabled"])])])]),_:1},8,["show"]))}};export{me as default};
