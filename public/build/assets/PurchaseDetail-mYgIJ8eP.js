import{_ as V}from"./AuthenticatedLayout-B8DOd1q5.js";import{y as B,x as t,c as P,o as p,w as E,b as S,g as _,i as H,t as M,f as j,a as i,d as A,s as L,E as R,H as U,j as C,h as q,U as z,F as K}from"./app-CojE2Nhg.js";import{_ as O}from"./DeleteConfirm-DfQoQxAi.js";import{_ as W}from"./Modal-DsJVllqe.js";import{D as Y}from"./DangerButton-BNCc5RAK.js";import{_ as G}from"./SecondaryButton-R9Cu_VDx.js";import{u as J}from"./useActionLoading-CfpAqoVk.js";import Q from"./FinalizeModal-B9qxNY01.js";import X from"./OrderImageModal-DeQE11gb.js";import Z from"./InvoiceForm-B_AOPln4.js";import ee from"./DesktopDetail-BgDiEraw.js";import ae from"./MobileDetail-Dwn-es_u.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./PrimaryButton-DUx9qtmT.js";import"./InputLabel-Bs9oX-CB.js";import"./TextInput-C5_XdFB5.js";import"./InputError-C9gxNfQa.js";import"./Tabs-DSb1Xfdi.js";import"./HeaderDetail-B2ghYeS1.js";import"./InfoCard-CGP_UMS7.js";import"./invoiceTable-B4OUmctW.js";import"./DataTable-DPNrsmWV.js";import"./ImageModal-CKLafQ-X.js";import"./productTable-4_MNAvvA.js";const te={class:"p-6"},se={class:"mb-4 text-xl font-bold text-red-600"},ne={class:"mb-4 text-gray-700 dark:text-gray-300"},ie={key:0,class:"mb-6 text-lg font-semibold"},oe={class:"text-red-700 dark:text-red-400"},le={class:"flex justify-end gap-3 mt-4"},re={key:0},ue={key:1},ce={__name:"ConfirmModal",emits:["close","success"],setup(c,{expose:s,emit:g}){const{isActionLoading:l}=J(),r=B(),d=t(!1),v=t("Konfirmasi Aksi"),k=t("Anda yakin ingin melanjutkan aksi ini?"),u=t(""),m=t(""),w=t("post"),h=t({});s({open:n=>{v.value=n.title||"Konfirmasi Penghapusan",k.value=n.message||"Anda yakin ingin menghapus data ini?",u.value=n.itemName||"",m.value=n.url||"",w.value=n.method||"post",h.value=n.data||{},d.value=!0}});const y=()=>{d.value=!1,f("close")},x=()=>{if(!m.value){r.error("URL aksi tidak terdefinisi.");return}l.value=!0;const n=w.value.toLowerCase();L[n](m.value,h.value||{},{preserveScroll:!0,onSuccess:()=>{y(),f("close")},onError:o=>{r.error(o.message||"Terjadi kesalahan saat menghapus data.")},onFinish:()=>{l.value=!1,m.value=""}})},f=g;return(n,o)=>(p(),P(W,{show:d.value,onClose:o[0]||(o[0]=$=>f("close")),maxWidth:"md"},{default:E(()=>[S("div",te,[S("h3",se,M(v.value),1),S("p",ne,M(k.value),1),u.value?(p(),_("p",ie,[o[1]||(o[1]=j(" Item: ",-1)),S("span",oe,M(u.value),1)])):H("",!0),S("div",le,[i(G,{onClick:y,type:"button"},{default:E(()=>[...o[2]||(o[2]=[j(" Batal ",-1)])]),_:1}),i(Y,{onClick:x,disabled:A(l)},{default:E(()=>[A(l)?(p(),_("span",re,"Memproses...")):(p(),_("span",ue,"Ya"))]),_:1},8,["disabled"])])])]),_:1},8,["show"]))}},de={key:0},me={key:1},He={__name:"PurchaseDetail",props:{purchase:Object,invoices:Object,invoice:Object,paymentStatuses:Array,isCheckingMode:Boolean},setup(c){const s=c,g=t(!1),l=t(null),r=t(!1),d=t(null),v=t(!1),k=t(!1),u=t(window.innerWidth<1024),m=()=>{u.value=window.innerWidth<1024};R(()=>{window.addEventListener("resize",m),s.purchase.status==="diterima"&&!s.invoice.id&&f()}),U(()=>window.removeEventListener("resize",m));const w=t(s.purchase.items.map(e=>({...e,rejected_quantity:e.rejected_quantity||0,is_valid:e.quantity-(e.rejected_quantity||0)>0}))),h=C(()=>{const e=s.purchase;return e.status!=="checking"||e.items.some(b=>b.item_status==="pending")||e.invoices.length===0?!1:e.invoices.every(b=>{const F=b.status==="validated",T=b.items&&b.items.length>0;return F&&T})}),D=C(()=>["diterima","checking"].includes(s.purchase.status)),y=C(()=>s.purchase.status==="draft"),x=()=>{h.value&&(v.value=!0)},f=()=>{d.value=null,r.value=!0},n=e=>{d.value=e,r.value=!0},o=e=>{const a={title:"Hapus Nota Keuangan",message:`Hapus Nota No. ${e.invoice_number}? Ini akan menghapus file foto dan mengembalikan status transaksi ke RECEIVED jika tidak ada nota lain.`,itemName:e.invoice_number,url:route("purchases.destroyInvoice",{purchase:s.purchase.id,invoice:e.id})};l.value.open(a)},$=()=>{r.value=!1,router.reload({preserveScroll:!0,preserveState:!0})},N={openCreateInvoiceModal:f,handleEditInvoice:n,handleDeleteInvoice:o,handleDelete:()=>{const e={title:"Hapus Pembelian",message:`Apakah Anda yakin ingin menghapus pembelian #${s.purchase.reference_no}? Tindakan ini tidak dapat dibatalkan.`,url:route("purchases.destroy",s.purchase.id)};l.value.open(e)},updateStatus:(e,a)=>{const I={title:"Konfirmasi Perubahan Status",message:`Anda yakin ingin mengubah status transaksi ${e.reference_no} menjadi ${a.toUpperCase()}?`,itemName:e.reference_no,url:route("purchases.update-status",{purchase:e.id}),method:"put",data:{status:a}};k.value.open(I)},openFinalizeModal:x,getActions:e=>{const a=[];switch(e.status){case"draft":a.push({label:"Tandai Dipesan",icon:"play",type:"status",newStatus:"dipesan"});break;case"dipesan":a.push({label:"Tandai Dikirim",icon:"truck",type:"status",newStatus:"dikirim"});break;case"dikirim":a.push({label:"Tandai Diterima",icon:"receive",type:"status",newStatus:"diterima"});break;case"diterima":a.push({label:"Batalkan Terima",icon:"undo",type:"status",newStatus:"dikirim"});break}return a},openImageModal:()=>g.value=!0};return(e,a)=>(p(),_(K,null,[i(A(q),{title:`Detail - ${c.purchase.reference_no}`},null,8,["title"]),i(O,{ref_key:"deleteModalRef",ref:l,onSuccess:$},null,512),i(ce,{ref_key:"showConfirmModal",ref:k,onSuccess:$},null,512),i(Q,{show:v.value,purchase:c.purchase,onClose:a[0]||(a[0]=I=>v.value=!1)},null,8,["show","purchase"]),i(X,{show:g.value,purchase:c.purchase,"store-name":e.$page.props.auth.user.store_name||"INVENTRA STORE",onClose:a[1]||(a[1]=I=>g.value=!1)},null,8,["show","purchase","store-name"]),i(Z,{show:r.value,purchaseId:c.purchase.id,editingInvoice:d.value,paymentStatuses:c.paymentStatuses,onClose:a[2]||(a[2]=I=>r.value=!1),onInvoiceSaved:$},null,8,["show","purchaseId","editingInvoice","paymentStatuses"]),i(V,{showSidebar:!u.value,showHeader:!u.value},{default:E(()=>[u.value?(p(),_("div",de,[i(ae,z(s,{actions:N,validationItems:w.value,allowFinalize:h.value,canEditDeleteInvoice:D.value,isEditing:y.value}),null,16,["validationItems","allowFinalize","canEditDeleteInvoice","isEditing"])])):(p(),_("div",me,[i(ee,z(s,{actions:N,validationItems:w.value,allowFinalize:h.value,canEditDeleteInvoice:D.value,isEditing:y.value}),null,16,["validationItems","allowFinalize","canEditDeleteInvoice","isEditing"])]))]),_:1},8,["showSidebar","showHeader"])],64))}};export{He as default};
