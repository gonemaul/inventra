import{x as n,z as M,C as B,g as o,o as a,b as e,k as H,A as V,d as m,i as L,F as x,q as k,t as i,R as q}from"./app-CHQSHO3f.js";import{d as D}from"./debounce-BiQHSiTR.js";const N={class:"flex flex-col h-full bg-gray-50 dark:bg-gray-900"},F={class:"sticky top-0 z-20 p-3 bg-white border-b shadow-sm dark:bg-gray-800 dark:border-gray-700"},R={class:"relative"},S={class:"flex-1 p-3 overflow-y-auto custom-scrollbar"},T={key:0,class:"grid grid-cols-2 gap-3 md:grid-cols-3 lg:grid-cols-4"},A={key:1,class:"grid grid-cols-2 gap-3 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5"},P=["onClick"],$={class:"relative w-full overflow-hidden bg-gray-100 aspect-square dark:bg-gray-700"},E=["src"],G={class:"absolute z-20 top-2 left-2"},K={class:"bg-black/60 text-white text-[10px] px-1.5 py-0.5 rounded font-medium backdrop-blur-sm"},O={class:"flex flex-col flex-1 p-3"},U={class:"text-[10px] text-gray-500 mb-1 flex justify-between"},J={class:"px-1 bg-gray-100 rounded dark:bg-gray-700"},Q={class:"text-xs md:text-sm font-semibold text-gray-800 dark:text-gray-200 leading-tight mb-2 line-clamp-2 min-h-[2.5em]"},W={class:"flex items-center justify-between pt-2 mt-auto border-t border-gray-100 border-dashed dark:border-gray-700"},X={class:"flex flex-col"},Y={class:"text-sm font-bold text-blue-600 dark:text-blue-400"},Z={key:2,class:"flex flex-col items-center justify-center py-10 text-gray-400"},ee={key:3,class:"flex justify-center py-4"},re={__name:"CatalogView",props:{supplierId:{type:[Number,String],required:!0}},emits:["select-product"],setup(w,{emit:_}){const p=w,I=_,l=n([]),d=n(!1),c=n(!1),v=n(1),u=n(!0),g=n(""),f=n(null),y=async(r=!1)=>{if(p.supplierId){r?(d.value=!0,v.value=1,l.value=[],u.value=!0):c.value=!0;try{const s=await q.get(`/purchases/products/${p.supplierId}`,{params:{page:v.value,search:g.value}}),t=s.data.data;r?l.value=t:l.value=[...l.value,...t],u.value=!!s.data.next_page_url,u.value&&v.value++}catch(s){console.error("Gagal load katalog:",s)}finally{d.value=!1,c.value=!1}}};M(()=>p.supplierId,r=>{r?(g.value="",y(!0)):l.value=[]},{immediate:!0});const b=D(()=>{y(!0)},500),C=r=>{r[0].isIntersecting&&u.value&&!d.value&&!c.value&&y(!1)};B(()=>{const r=new IntersectionObserver(C,{threshold:.1});f.value&&r.observe(f.value)});const j=r=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(r),z=r=>{I("select-product",r)};return(r,s)=>(a(),o("div",N,[e("div",F,[e("div",R,[s[2]||(s[2]=e("div",{class:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"},[e("svg",{class:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1)),H(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>g.value=t),onInput:s[1]||(s[1]=(...t)=>m(b)&&m(b)(...t)),type:"text",class:"block w-full py-2 pl-10 pr-3 leading-5 placeholder-gray-500 bg-white border border-gray-300 rounded-lg focus:outline-none focus:placeholder-gray-400 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 sm:text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:"Cari nama barang atau kode..."},null,544),[[V,g.value]])])]),e("div",S,[d.value?(a(),o("div",T,[(a(),o(x,null,k(8,t=>e("div",{key:t,class:"flex flex-col p-2 bg-white rounded-lg shadow dark:bg-gray-800 animate-pulse"},[...s[3]||(s[3]=[e("div",{class:"w-full mb-2 bg-gray-200 rounded aspect-square dark:bg-gray-700"},null,-1),e("div",{class:"w-3/4 h-4 mb-2 bg-gray-200 rounded dark:bg-gray-700"},null,-1),e("div",{class:"w-1/2 h-3 mt-auto bg-gray-200 rounded dark:bg-gray-700"},null,-1)])])),64))])):l.value.length>0?(a(),o("div",A,[(a(!0),o(x,null,k(l.value,t=>(a(),o("div",{key:t.id,onClick:h=>z(t),class:"relative flex flex-col overflow-hidden transition-all bg-white border border-gray-200 shadow-sm cursor-pointer group dark:bg-gray-800 dark:border-gray-700 rounded-xl hover:shadow-md"},[e("div",$,[e("img",{src:t.image_url,loading:"lazy",decoding:"async",class:"absolute inset-0 z-10 object-contain w-full h-full transition-transform duration-500 opacity-0 group-hover:scale-110",onload:"this.classList.remove('opacity-0')",onerror:"this.style.display='none'"},null,8,E),s[4]||(s[4]=e("div",{class:"absolute inset-0 z-0 flex flex-col items-center justify-center text-gray-400"},[e("svg",{class:"w-8 h-8 mb-1 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})]),e("span",{class:"text-[10px]"},"No Image")],-1)),e("div",G,[e("span",K," Stok: "+i(t.stock),1)])]),e("div",O,[e("div",U,[e("span",J,i(t.code),1),e("span",null,i(t.unit?.name||"Pcs"),1)]),e("h3",Q,i(t.name),1),e("p",null," Rekomendasi "+i(t.insights.find(h=>h.type==="restock")?.payload?.suggested_qty),1),e("div",W,[e("div",X,[s[5]||(s[5]=e("span",{class:"text-[10px] text-gray-400"},"Harga Beli",-1)),e("span",Y,i(j(t.purchase_price)),1)]),s[6]||(s[6]=e("button",{class:"bg-blue-50 text-blue-600 p-1.5 rounded-lg hover:bg-blue-600 hover:text-white transition-colors"},[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})])],-1))])])],8,P))),128))])):(a(),o("div",Z,[...s[7]||(s[7]=[e("svg",{class:"w-12 h-12 mb-2 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})],-1),e("p",{class:"text-sm"},"Tidak ada produk ditemukan",-1)])])),c.value?(a(),o("div",ee,[...s[8]||(s[8]=[e("svg",{class:"w-5 h-5 text-blue-500 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])])):L("",!0),e("div",{ref_key:"observerTarget",ref:f,class:"w-full h-4"},null,512)])]))}};export{re as default};
