import{v,D as y,K as B,d as V,o as a,w as K,l as n,p,f as t,k as d,t as o,z as h,B as _,g as M,F as L,I as O,n as R,T as U,a as $}from"./vendor-core-B46KUNyc.js";import{d as F}from"./vendor-common-GpUWqhKr.js";import"./vendor-charts-Bw6UNgWf.js";const P={key:0,class:"fixed inset-0 z-50 flex flex-col bg-gray-50 dark:bg-gray-900"},H={class:"flex-none px-4 py-3 bg-white border-b shadow-sm dark:bg-gray-800 dark:border-gray-700 z-20"},G={class:"max-w-7xl mx-auto flex items-center justify-between"},Q={class:"flex items-center gap-3"},J={class:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2"},W={key:0,class:"px-2.5 py-0.5 rounded-full bg-lime-100 text-lime-700 text-xs font-extra-bold"},X={class:"hidden sm:flex items-center gap-4"},Y={class:"flex items-center gap-2 text-xs font-bold text-gray-600 dark:text-gray-300 cursor-pointer"},Z={class:"flex-none bg-white/80 backdrop-blur border-b dark:bg-gray-800/80 dark:border-gray-700 z-10 sticky top-0 sm:hidden"},ee={class:"px-4 py-3 flex flex-col gap-3 justify-between"},te={class:"flex items-center justify-between"},se={class:"flex items-center gap-2 text-sm font-bold text-gray-700 dark:text-gray-200"},re={class:"flex items-center gap-2 text-xs font-bold text-gray-600 dark:text-gray-300 cursor-pointer w-full"},oe={class:"max-w-7xl mx-auto"},le={key:0,class:"flex flex-col items-center justify-center py-20"},ae={key:1,class:"flex flex-col items-center justify-center py-20 text-center"},ne={key:2,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 pb-20"},ie={class:"col-span-full hidden sm:flex justify-end mb-2"},de={class:"flex items-center gap-2 text-sm font-bold text-gray-600 cursor-pointer hover:bg-white px-3 py-1 rounded transition"},ce=["onClick"],ue={key:0,class:"absolute bottom-0 right-0 z-10 bg-blue-500 text-white text-[10px] font-bold px-2 py-1 rounded-tl-lg shadow-sm"},pe={class:"flex p-3 gap-3"},ge={class:"pt-1"},xe={key:0,class:"w-3.5 h-3.5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},me={class:"w-24 h-24 bg-gray-100 rounded-lg flex-shrink-0 flex items-center justify-center overflow-hidden border border-gray-100 relative"},ye=["src"],fe={class:"flex-1 min-w-0 flex flex-col justify-between"},be={class:"flex justify-between items-start gap-2"},ve=["title"],he={key:0,class:"px-1.5 py-0.5 rounded text-[9px] font-black bg-red-100 text-red-600 border border-red-200 tracking-wide"},_e={class:"text-[10px] text-gray-500 font-mono mt-0.5 flex flex-wrap gap-1"},ke={key:0,class:"bg-gray-100 px-1 rounded"},we={class:"mt-2 text-[10px] text-gray-500 bg-gray-50 dark:bg-gray-700/50 p-1.5 rounded border border-dashed border-gray-200 flex justify-between"},je={class:"text-gray-800 dark:text-gray-200"},Ie={class:"flex items-end justify-between mt-2"},Ce={class:"flex flex-col gap-0.5"},Se={class:"text-[10px] text-gray-400 flex items-center gap-1"},ze={class:"text-gray-700"},Be={class:"text-gray-700"},Me={class:"text-[10px] text-gray-500"},Re={class:"flex flex-col text-right"},qe={class:"text-sm font-bold text-lime-600"},Te={class:"px-3 py-2 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-100 dark:border-gray-700 text-xs flex items-center justify-between gap-2"},Ae={class:"flex items-center gap-2"},De={class:"font-bold text-gray-600 dark:text-gray-300"},Ee={class:"truncate text-gray-500 italic"},Ne={class:"flex-none bg-white dark:bg-gray-800 border-t dark:border-gray-700 p-4 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)] z-30"},Ve={class:"max-w-7xl mx-auto flex items-center justify-between gap-4"},Ke={class:"hidden sm:block"},Le={class:"text-sm text-gray-500"},Oe={class:"text-gray-900 dark:text-white"},Ue={class:"flex-1 flex justify-end items-center gap-4"},$e={class:"text-right"},Fe={class:"block text-lg font-black text-lime-600 leading-none"},Pe=["disabled"],He={class:"sm:hidden"},Xe={__name:"recom",props:{show:Boolean,supplierId:[Number,String],cartItems:{type:Array,default:()=>[]}},emits:["close","add-items"],setup(I,{emit:q}){const g=I,C=q,i=v([]),k=v(!1),l=v([]),m=v(!1),w=r=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(r),T=r=>{const e=g.cartItems.find(s=>s.product_id===r);return e?e.quantity:0},u=r=>g.cartItems.some(e=>e.product_id===r);async function A(){if(g.supplierId){k.value=!0;try{const r=await $.get(route("purchases.recommendations",g.supplierId));i.value=r.data,l.value=r.data.filter(e=>e.is_critical&&!u(e.product_id)).map(e=>e.product_id)}catch(r){console.error("Gagal fetch rekomendasi:",r),i.value=[],l.value=[]}finally{k.value=!1}}}const x=y(()=>{let r=i.value;return m.value&&(r=r.filter(e=>!u(e.product_id))),r.slice().sort((e,s)=>{if(e.is_critical&&!s.is_critical)return-1;if(!e.is_critical&&s.is_critical)return 1;const c=(e.min_stock||0)-(e.current_stock||0);return(s.min_stock||0)-(s.current_stock||0)-c})});B(()=>g.show,r=>{r?(A(),document.body.style.overflow="hidden"):(document.body.style.overflow="",setTimeout(()=>{i.value=[],l.value=[]},300))});const f=y({get(){if(x.value.length===0)return!1;const r=x.value.filter(e=>!u(e.product_id));return r.length===0?!1:r.every(e=>l.value.includes(e.product_id))},set(r){if(r){const s=x.value.filter(c=>!u(c.product_id)).map(c=>c.product_id).filter(c=>!l.value.includes(c));l.value.push(...s)}else{const e=x.value.map(s=>s.product_id);l.value=l.value.filter(s=>!e.includes(s))}}}),S=y(()=>x.value.filter(r=>r.is_critical).length),j=y(()=>l.value.length),D=y(()=>i.value.filter(r=>l.value.includes(r.product_id)).reduce((r,e)=>r+e.purchase_price*e.quantity,0)),E=r=>{const e=l.value.indexOf(r);e===-1?l.value.push(r):l.value.splice(e,1)},z=()=>{l.value=i.value.filter(r=>r.is_critical&&!u(r.product_id)).map(r=>r.product_id)};function N(){const r=i.value.filter(e=>l.value.includes(e.product_id)).map(e=>({product_id:e.product_id,code:e.code,name:e.name,unit:e.unit,size:e.size_name,brand:e.brand,category:e.category,purchase_price:e.purchase_price,quantity:e.quantity,subtotal:e.purchase_price*e.quantity,current_stock:e.current_stock,min_stock:e.min_stock,image_url:e.image_url,image_path:e.image_path}));r.length!==0&&(C("add-items",r),C("close"))}const b=F.throttle(()=>{document.activeElement&&document.activeElement.tagName==="INPUT"&&document.activeElement.blur()},150);return B(()=>g.show,r=>{r?window.addEventListener("scroll",b,!0):window.removeEventListener("scroll",b,!0)}),(r,e)=>(a(),V(U,{"enter-active-class":"transition duration-300 ease-out","enter-from-class":"transform translate-y-10 opacity-0","enter-to-class":"transform translate-y-0 opacity-100","leave-active-class":"transition duration-200 ease-in","leave-from-class":"transform translate-y-0 opacity-100","leave-to-class":"transform translate-y-10 opacity-0"},{default:K(()=>[I.show?(a(),n("div",P,[t("div",H,[t("div",G,[t("div",Q,[t("button",{onClick:e[0]||(e[0]=s=>r.$emit("close")),class:"p-2 -ml-2 text-gray-500 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition"},[...e[7]||(e[7]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1)])]),t("div",null,[t("h1",J,[e[8]||(e[8]=d(" Rekomendasi Restock ",-1)),i.value.length>0?(a(),n("span",W,o(i.value.length),1)):p("",!0)]),e[9]||(e[9]=t("p",{class:"text-xs text-gray-500 hidden sm:block"},"Analisis stok menipis berdasarkan data inventory.",-1))])]),t("div",X,[t("label",Y,[h(t("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=s=>m.value=s),class:"w-4 h-4 rounded border-gray-300 text-lime-600 focus:ring-lime-500"},null,512),[[_,m.value]]),e[10]||(e[10]=d(" Sembunyikan Item di Keranjang ",-1))]),t("button",{onClick:z,class:"px-3 py-1.5 rounded-lg border border-red-200 bg-red-50 text-red-600 text-xs font-bold hover:bg-red-100 transition flex items-center gap-1.5"},[e[11]||(e[11]=t("span",{class:"w-1.5 h-1.5 rounded-full bg-red-500 animate-pulse"},null,-1)),d(" Pilih Kritis ("+o(S.value)+") ",1)])])])]),t("div",Z,[t("div",ee,[t("div",te,[t("label",se,[h(t("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=s=>f.value=s),class:"w-4 h-4 rounded border-gray-300 text-lime-600 focus:ring-lime-500"},null,512),[[_,f.value]]),e[12]||(e[12]=d(" Pilih Semua ",-1))]),t("button",{onClick:z,class:"text-xs font-bold text-red-600 bg-red-50 px-2 py-1 rounded border border-red-100"}," Kritis ("+o(S.value)+") ",1)]),t("label",re,[h(t("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=s=>m.value=s),class:"w-4 h-4 rounded border-gray-300 text-lime-600 focus:ring-lime-500"},null,512),[[_,m.value]]),e[13]||(e[13]=d(" Sembunyikan Item di Keranjang ",-1))])])]),t("div",{class:"flex-1 overflow-y-auto bg-gray-50 dark:bg-gray-900 p-4 custom-scroll",onScroll:e[6]||(e[6]=(...s)=>M(b)&&M(b)(...s))},[t("div",oe,[k.value?(a(),n("div",le,[...e[14]||(e[14]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-4 border-lime-500 border-t-transparent mb-4"},null,-1),t("p",{class:"text-gray-500 font-medium"},"Menganalisa data stok...",-1)])])):i.value.length===0?(a(),n("div",ae,[e[15]||(e[15]=t("div",{class:"w-20 h-20 bg-lime-100 rounded-full flex items-center justify-center mb-4"},[t("svg",{class:"w-10 h-10 text-lime-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e[16]||(e[16]=t("h3",{class:"text-xl font-bold text-gray-900 dark:text-white"},"Stok Aman!",-1)),e[17]||(e[17]=t("p",{class:"text-gray-500 mt-2"},"Semua stok produk aman, tidak ada rekomendasi restock.",-1)),t("button",{onClick:e[4]||(e[4]=s=>r.$emit("close")),class:"mt-6 text-lime-600 font-bold hover:underline"},"Kembali")])):(a(),n("div",ne,[t("div",ie,[t("label",de,[h(t("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=s=>f.value=s),class:"w-4 h-4 rounded border-gray-300 text-lime-600 focus:ring-lime-500"},null,512),[[_,f.value]]),e[18]||(e[18]=d(" Pilih Semua Data ",-1))])]),(a(!0),n(L,null,O(x.value,s=>(a(),n("div",{key:s.product_id,onClick:c=>E(s.product_id),class:R(["relative group bg-white dark:bg-gray-800 rounded-xl overflow-hidden border transition-all cursor-pointer hover:shadow-lg select-none",[l.value.includes(s.product_id)?"border-lime-500 ring-1 ring-lime-500 bg-lime-50/5":"border-gray-200 dark:border-gray-700 hover:border-lime-300",u(s.product_id)?"opacity-70 bg-gray-50 dark:bg-gray-900":""]])},[u(s.product_id)?(a(),n("div",ue," Sudah Dipesan: "+o(T(s.product_id)),1)):p("",!0),t("div",pe,[t("div",ge,[t("div",{class:R(["w-5 h-5 rounded border flex items-center justify-center transition-colors shadow-sm",l.value.includes(s.product_id)?"bg-lime-500 border-lime-500":"bg-white border-gray-300"])},[l.value.includes(s.product_id)?(a(),n("svg",xe,[...e[19]||(e[19]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"3",d:"M5 13l4 4L19 7"},null,-1)])])):p("",!0)],2)]),t("div",me,[e[20]||(e[20]=t("div",{class:"absolute inset-0 flex items-center justify-center text-gray-300"},[t("svg",{class:"w-10 h-10 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1)),s.image_url||s.image_path?(a(),n("img",{key:0,loading:"lazy",src:s.image_url||s.image_path,class:"absolute inset-0 w-full h-full object-contain p-1 mix-blend-multiply z-10 transition-opacity duration-300",alt:"img",onload:"this.style.opacity='1'",onerror:"this.style.display='none'"},null,8,ye)):p("",!0)]),t("div",fe,[t("div",null,[t("div",be,[t("h4",{class:"text-sm font-bold text-gray-900 dark:text-white leading-tight line-clamp-2",title:s.name},o(s.name),9,ve),s.is_critical?(a(),n("span",he,"KRITIS")):p("",!0)]),t("div",_e,[t("span",null,o(s.brand),1),e[21]||(e[21]=t("span",null,"â€¢",-1)),t("span",null,o(s.category),1),s.size!=="-"?(a(),n("span",ke,o(s.size),1)):p("",!0)])]),t("div",we,[e[22]||(e[22]=t("span",null,"Terjual (90H):",-1)),t("strong",je,o(s.sold_90d)+" "+o(s.unit),1)]),t("div",Ie,[t("div",Ce,[t("div",Se,[t("span",null,[e[23]||(e[23]=d("Sisa: ",-1)),t("strong",ze,o(s.current_stock),1)]),e[25]||(e[25]=t("span",{class:"text-gray-300"},"|",-1)),t("span",null,[e[24]||(e[24]=d("Min: ",-1)),t("strong",Be,o(s.min_stock),1)])]),t("div",Me," @ "+o(w(s.purchase_price)),1)]),t("div",Re,[e[26]||(e[26]=t("span",{class:"text-[10px] text-gray-400"},"Nilai Order",-1)),t("span",qe,o(w(s.purchase_price*s.quantity)),1)])])])]),t("div",Te,[t("div",Ae,[t("span",De,"Saran: "+o(s.quantity)+" "+o(s.unit),1),e[27]||(e[27]=t("span",{class:"w-px h-3 bg-gray-300"},null,-1)),t("span",Ee,o(s.reason||"Restock Reguler"),1)])])],10,ce))),128))]))])],32),t("div",Ne,[t("div",Ve,[t("div",Ke,[t("span",Le,[e[28]||(e[28]=d("Terpilih: ",-1)),t("strong",Oe,o(j.value)+" Item",1)])]),t("div",Ue,[t("div",$e,[e[29]||(e[29]=t("span",{class:"block text-[10px] uppercase tracking-wider text-gray-400"},"Estimasi Total",-1)),t("span",Fe,o(w(D.value)),1)]),t("button",{onClick:N,disabled:j.value===0,class:"px-6 py-3 bg-lime-500 hover:bg-lime-600 active:bg-lime-700 text-white font-bold rounded-xl shadow-lg shadow-lime-500/30 transition-all disabled:opacity-50 disabled:grayscale disabled:shadow-none flex items-center gap-2 min-w-[160px] justify-center"},[e[30]||(e[30]=t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)),e[31]||(e[31]=t("span",{class:"hidden sm:inline"},"Masukkan ke RAB",-1)),t("span",He,"Masuk RAB ("+o(j.value)+")",1)],8,Pe)])])])])):p("",!0)]),_:1}))}};export{Xe as default};
