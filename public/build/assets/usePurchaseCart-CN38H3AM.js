import{v as b,D as s,K as I,x as q}from"./vendor-core-B46KUNyc.js";function z(c=!1,o={}){const t=b([]),r=()=>c&&o?.id?`inventra_edit_${o.id}`:"inventra_create_draft",p=()=>{const e=r(),a=localStorage.getItem(e);if(a)try{t.value=JSON.parse(a);return}catch{console.error("Local data corrupt, clearing..."),localStorage.removeItem(e)}c&&o&&o.items?(t.value=[],l(o.items)):t.value=[]};function u(e,a,n){console.log(e);const i=e.product_id,_=parseInt(a),d=parseFloat(n);t.value.push({id:i?e.id:"",product_id:i??e.id,name:e.name,code:e.code,brand:e.brand?.name??e.brand??"-",category:e.category?.name??e.category??"-",unit:e.unit?.name??e.unit??"-",size:e.size?.name??e.size??"-",current_stock:e.stock??e.current_stock??0,min_stock:e.min_stock??0,image_url:e.image_url??e.image_path??"",image_path:e.image_path??"",quantity:_,purchase_price:d,subtotal:_*d})}function g(e){const a=t.value.findIndex(n=>n.product_id===e.product_id);a!==-1&&(t.value[a].quantity=parseInt(e.quantity),t.value[a].purchase_price=parseFloat(e.purchase_price),t.value[a].subtotal=t.value[a].quantity*t.value[a].purchase_price)}function v(e){t.value=t.value.filter(a=>a.product_id!==e)}function h(e){console.log("Removing multiple:",e),t.value=t.value.filter(a=>!e.includes(a.product_id))}function m(){t.value=[],localStorage.removeItem(r)}function l(e){e.forEach(a=>{const n={id:a.id??"",product_id:a.product_id,name:a.product_snapshot?.name??a.name,code:a.product_snapshot?.code??a.code,unit:a.product_snapshot?.unit??a.unit,size:a.product_snapshot?.size??a.size,brand:a.product_snapshot?.brand??a.brand,category:a.product_snapshot?.category??a.category,stock:a.product_snapshot?.stock??a.current_stock,image_url:a.product_snapshot?.image_url??a.image_url,image_path:a.product_snapshot?.image_path??a.image_path,min_stock:a.product_snapshot?.min_stock??a.min_stock};u(n,a.quantity,a.purchase_price)})}const f=s(()=>t.value.reduce((e,a)=>e+a.quantity,0)),y=s(()=>t.value.reduce((e,a)=>e+a.subtotal,0)),k=s(()=>t.value.length);return I(t,e=>{const a=r();localStorage.setItem(a,JSON.stringify(e))},{deep:!0}),q(()=>{p()}),{cartItems:t,addToCart:u,updateCartItem:g,removeItem:v,removeMultipleItems:h,clearCart:m,totalUnit:f,totalBelanja:y,totalMacam:k,addMultipleItems:l}}export{z as u};
