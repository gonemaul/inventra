import{_ as I}from"./AuthenticatedLayout-BGPR84hi.js";import{y as r,I as _,J as j,p as T,l as d,o as u,e as l,g as C,i as V,w as c,f as a,B as R,k as f,t as v,m as D,F as N}from"./vendor-core-DNtFhSmw.js";import{_ as E}from"./DataTable-Zf20Q_p-.js";import{_ as L}from"./Filter-BxSPJrZN.js";import M from"./modalFilter-CPHiglBT.js";import{u as A}from"./useActionLoading-5xNm3hIW.js";import{d as S}from"./vendor-common-pmZ7KOuE.js";import{B as K}from"./BottomSheet-CdQ1fCHn.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useSidebar-DWNS5Gp4.js";import"./vendor-charts-Bw6UNgWf.js";import"./TextInput-D8W_klmc.js";import"./PrimaryButton-Bh5CQbrU.js";import"./BottomSheetFilter-ab12Mp0L.js";const q={class:"w-full min-h-screen space-y-6"},G={class:"p-4 space-y-6 bg-gray-100 border shadow-md rounded-xl dark:bg-customBg-tableDark"},H=["onClick"],J=["title"],z={key:0,class:"my-4 text-sm text-gray-600 dark:text-gray-200 whitespace-nowrap"},Q={key:1,class:"text-xs text-gray-400"},W={key:0,class:"flex-1 flex flex-col items-center justify-center min-h-[300px]"},X={key:1,class:"overflow-hidden"},Y={class:"flex-1 mb-4 border rounded overflow-hidden bg-gray-100 h-[300px]"},Z=["srcdoc"],ee={class:"grid grid-cols-2 gap-3 pt-2 mt-auto border-t"},te=["href"],se={__name:"index",props:{filters:Object,sales:Object},setup(m){const o=m,p=r(o.filters.search||""),x=r(!1),{isActionLoading:b}=A(),y=r(!1),h=r(!1),n=r(""),w=r(null),k=r("-"),F=[{key:"transaction_date",label:"Tanggal",sortable:!0,format:"tanggal",width:"130px"},{key:"reference_no",label:"No. Referensi",sortable:!0,slot:"reference",width:"130px"},{key:"summary",label:"Summary",slot:"Summary",width:"130px"},{key:"total_revenue",label:"Total Omset",sortable:!0,format:"rupiah"},{key:"aksi",label:"Aksi",width:"120px",slot:"aksi"}],g=r({search:o.filters.search||"",sort:o.filters.sort||"transaction_date",order:o.filters.order||"desc",page:o.sales.current_page||1}),O=S.throttle(()=>{const t={...o.filters};t.search=p.value,t.search||delete t.search,_.get(route("sales.index"),t,{preserveState:!0,replace:!0})},300);j(g,S.throttle(t=>{const e=Object.fromEntries(Object.entries(t).filter(([s,i])=>i!=null&&i!==""));b.value=!0,_.get(route("sales.index"),e,{preserveState:!0,preserveScroll:!0,replace:!0,only:["sales","filters"],onFinish:()=>{b.value=!1}})},300),{deep:!0}),j(p,O);const P=T(()=>{Object.fromEntries(Object.entries(g).filter(([s,i])=>i!=null&&i!==""));const t=Object.keys(o.filters),e=["search","page","per_page"];return t.filter(s=>!e.includes(s)).length}),$=async t=>{w.value=t.id,k.value=t.reference_no,y.value=!0,h.value=!0,n.value="";try{const e=await axios.get(`/sales/${t.id}/print`,{responseType:"text"});n.value=e.data}catch(e){console.error("Gagal load invoice:",e),n.value='<p class="mt-10 text-center text-red-500">Gagal memuat data invoice.</p>'}finally{h.value=!1}},B=()=>{if(!n.value)return;const t=window.open("","","height=600,width=400");t.document.write("<html><head><title>Print</title>"),t.document.write("<style>body { margin: 0; padding: 0; }</style>"),t.document.write("</head><body>"),t.document.write(n.value),t.document.write("</body></html>"),t.document.close(),t.focus(),setTimeout(()=>{t.print(),t.close()},500)};return(t,e)=>(u(),d(N,null,[l(C(V),{title:"Riwayat Penjualan"}),l(I,{headerTitle:"Riwayat Penjualan"},{default:c(()=>[a("div",q,[l(L,{filters:m.filters,modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=s=>p.value=s),onShowFilter:e[1]||(e[1]=s=>x.value=!0),filterCount:P.value,actions:[{route:t.route("sales.create"),buttonText:"Rekap"}]},null,8,["filters","modelValue","filterCount","actions"]),l(M,{show:x.value,onClose:e[2]||(e[2]=s=>x.value=!1),filters:m.filters},null,8,["show","filters"]),a("div",G,[e[10]||(e[10]=a("div",null,[a("h2",{class:"text-base font-semibold text-gray-900 dark:text-white sm:text-lg lg:text-xl"}," Riwayat Penjualan "),a("p",{class:"mt-1 text-xs text-gray-600 dark:text-gray-300 sm:text-sm lg:text-base"}," Kelola semua riwayat penjualan. ")],-1)),l(E,{serverSide:"true",data:m.sales.data,columns:F,perPageOptions:[5,10,25,50,100],params:g.value,"onUpdate:params":e[3]||(e[3]=s=>g.value=s),pagination:m.sales},{reference:c(({row:s})=>[a("div",{onClick:i=>$(s),class:"font-mono text-sm font-bold text-indigo-600 dark:text-indigo-400"},v(s.reference_no),9,H),s.notes?(u(),d("div",{key:0,class:"text-xs text-gray-500 truncate max-w-[150px]",title:s.notes}," ðŸ“ "+v(s.notes),9,J)):D("",!0)]),Summary:c(({row:s})=>[s.financial_summary?(u(),d("div",z,[a("div",null,[e[5]||(e[5]=f(" Item: ",-1)),a("strong",null,v(s.financial_summary.item_count),1),e[6]||(e[6]=f(" Jenis ",-1))]),a("div",null,[e[7]||(e[7]=f(" Qty: ",-1)),a("strong",null,v(s.financial_summary.total_qty),1),e[8]||(e[8]=f(" Unit ",-1))])])):(u(),d("span",Q,"-"))]),aksi:c(({row:s})=>[l(C(R),{href:t.route("sales.show",s.id),class:"px-3 py-1 text-sm font-medium text-indigo-600 transition border border-indigo-200 rounded hover:text-indigo-900 hover:bg-indigo-300"},{default:c(()=>[...e[9]||(e[9]=[f(" Lihat Detail ",-1)])]),_:2},1032,["href"])]),_:1},8,["data","params","pagination"])])])]),_:1}),l(K,{show:y.value,onClose:e[4]||(e[4]=s=>y.value=!1),title:"Preview Invoice #"+k.value},{default:c(()=>[h.value?(u(),d("div",W,[...e[11]||(e[11]=[a("svg",{class:"w-10 h-10 mb-3 text-blue-500 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[a("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),a("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})],-1),a("p",{class:"text-lime-500"},"Memuat Invoice...",-1)])])):(u(),d("div",X,[a("div",Y,[a("iframe",{srcdoc:n.value,class:"w-full h-full bg-white border-0",style:{display:"block"}},null,8,Z)]),a("div",ee,[a("a",{href:`/sales/${w.value}/print`,target:"_blank",class:"flex items-center justify-center gap-2 py-3 font-bold text-white transition bg-red-500 rounded-lg hover:bg-red-600"}," ðŸ“¥ Download PDF ",8,te),a("button",{onClick:B,class:"flex items-center justify-center gap-2 py-3 font-bold text-white transition bg-blue-600 rounded-lg hover:bg-blue-700"}," ðŸ–¨ Print Struk ")])]))]),_:1},8,["show","title"])],64))}},xe=U(se,[["__scopeId","data-v-5a0cd963"]]);export{xe as default};
