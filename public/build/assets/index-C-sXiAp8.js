import{v as m,K as T,J as E,D as j,l as d,o as i,e as v,g as C,i as G,w as x,f as a,p as y,F as b,I as $,n as L,t as u,z as W,B as J,d as F,C as O,W as U}from"./vendor-core-By7Plnkm.js";import{d as Y}from"./vendor-common-GpUWqhKr.js";import{_ as K}from"./AuthenticatedLayout-BlgKae2S.js";import{_ as Q}from"./Filter-D5RrVPYj.js";import A from"./modalFilter-C3VL6ctz.js";import{B as X}from"./BottomSheet-CbDDnn2t.js";import Z from"./SalesStatsGrid-DRnNxdCR.js";import ee from"./SalesTransactionList-BR_UP2qi.js";import te from"./SalesChart-C5bNf5GX.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vendor-charts-Bw6UNgWf.js";import"./useSidebar-CpEDRVzi.js";import"./useActionLoading-BREuot5v.js";import"./TextInput-B-__nwMf.js";import"./PrimaryButton-BZrDt8zt.js";import"./BottomSheetFilter-BLYHt_YO.js";import"./DeleteConfirm-D81PCJRC.js";import"./Modal-CAUBCNUq.js";const se={class:"w-full min-h-screen space-y-6 pb-20"},le={class:"flex flex-col gap-4"},oe={class:"flex flex-col md:flex-row justify-between items-center gap-4"},re={class:"flex p-1 space-x-1 bg-gray-100 dark:bg-gray-800 rounded-xl overflow-x-auto w-full md:w-auto"},ne=["onClick"],ie={class:"flex items-center gap-2 cursor-pointer text-sm text-gray-600 dark:text-gray-300"},de={key:0,class:"space-y-4"},ue={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ce={class:"bg-gradient-to-br from-lime-600 to-green-700 rounded-xl p-4 text-white shadow-lg relative overflow-hidden"},me={class:"space-y-2 relative z-10"},ve={class:"w-5 h-5 flex items-center justify-center font-bold text-lime-700 bg-white rounded-full text-xs shadow-sm"},fe={class:"flex-1 min-w-0"},pe={class:"text-xs font-bold truncate group-hover:text-lime-200 transition"},ge={class:"text-[10px] text-lime-100/80"},ye={class:"font-bold text-xs"},he={class:"bg-gradient-to-br from-teal-500 to-emerald-600 rounded-xl p-4 text-white shadow-lg relative overflow-hidden"},xe={class:"space-y-2 relative z-10"},be={class:"w-5 h-5 flex items-center justify-center font-bold text-teal-700 bg-white rounded-full text-xs shadow-sm"},_e={class:"flex-1 min-w-0"},we={class:"text-xs font-bold truncate group-hover:text-teal-200 transition"},ke={class:"font-bold text-xs bg-white/20 px-1.5 py-0.5 rounded"},De={class:"mb-4 flex items-center justify-between"},Te={class:"text-xs text-gray-500"},je={key:0,class:"flex justify-center mt-8 gap-2"},Ce=["disabled"],$e={class:"px-4 py-2 text-gray-500 text-sm flex items-center"},Ie=["disabled"],Pe={key:0,class:"flex-1 flex flex-col items-center justify-center min-h-[300px]"},Be={key:1,class:"overflow-hidden"},Se={class:"flex-1 mb-4 border rounded overflow-hidden bg-gray-100 h-[300px]"},qe=["srcdoc"],Me={class:"grid grid-cols-2 gap-3 pt-2 mt-auto border-t"},Fe=["href"],Oe={__name:"index",props:{filters:Object,sales:Object,summary:Object},setup(h){const n=h,_=m(n.filters.search||""),w=m(!1),k=m(!1),D=m(!1),g=m(""),I=m(null),P=m("-"),o=m("today"),V=[{id:"today",label:"Hari Ini"},{id:"week",label:"Minggu Ini"},{id:"month",label:"Bulan Ini"},{id:"year",label:"Tahun Ini"},{id:"all",label:"Semua Data"}],c=s=>{const e=new Date,t=l=>l.toISOString().split("T")[0];if(s==="today")return{min:t(e),max:t(e)};if(s==="week"){const l=new Date(e);return l.setDate(e.getDate()-6),{min:t(l),max:t(e)}}if(s==="month"){const l=new Date(e);return l.setDate(e.getDate()-29),{min:t(l),max:t(e)}}if(s==="year"){const l=new Date(e.getFullYear(),0,1);return{min:t(l),max:t(e)}}return{min:null,max:null}},B=s=>{if(console.log(s,o.value),s==="all"&&o.value==="all")o.value="today",r.value.min_date=c("today").min,r.value.max_date=c("today").max;else if(o.value==s)o.value="all",r.value.min_date=null,r.value.max_date=null;else{o.value=s;const{min:e,max:t}=c(s);r.value.min_date=e,r.value.max_date=t}r.value.page=1},r=m({search:n.filters.search||"",sort:n.filters.sort||"transaction_date",order:n.filters.order||"desc",page:n.sales.current_page||1,min_date:n.filters.min_date||c("today").min,max_date:n.filters.max_date||c("today").max,show_deleted:n.filters.show_deleted==="true"||!1}),S=(s,e)=>{if(!s&&!e){o.value="all";return}const t=c("today"),l=c("week"),q=c("month"),M=c("year");s===t.min&&e===t.max?o.value="today":s===l.min&&e===l.max?o.value="week":s===q.min&&e===q.max?o.value="month":s===M.min&&e===M.max?o.value="year":o.value="all"};(()=>{S(r.value.min_date,r.value.max_date)})(),T(()=>[r.value.min_date,r.value.max_date],([s,e])=>{S(s,e)});const z=Y.throttle(()=>{const s=Object.fromEntries(Object.entries(r.value).filter(([e,t])=>t!=null&&t!==""));E.get(route("sales.index"),s,{preserveState:!0,preserveScroll:!0,replace:!0,only:["sales","filters","summary"]})},300);T(r,z,{deep:!0}),T(_,s=>{r.value.search=s,r.value.page=1,s&&s.length>0&&(o.value="all",delete r.value.min_date,delete r.value.max_date)});const f=j(()=>{let s=[],e=[],t={labels:[],values:[]},l="";return o.value==="today"?(s=n.summary.best_selling_revenue_today,e=n.summary.best_selling_qty_today,t=n.summary.chart_today,l="Per Jam"):o.value==="week"?(s=n.summary.best_selling_revenue_week,e=n.summary.best_selling_qty_week,t=n.summary.chart_week,l="7 Hari Terakhir"):o.value==="month"?(s=n.summary.best_selling_revenue_month,e=n.summary.best_selling_qty_month,t=n.summary.chart_month,l="Mingguan"):o.value==="year"&&(t=n.summary.chart_year,l="Bulanan"),{revenue:s,qty:e,chart:t,label:l}}),R=async s=>{I.value=s.id,P.value=s.reference_no,k.value=!0,D.value=!0,g.value="";try{const e=await axios.get(`/sales/${s.id}/print`,{responseType:"text"});g.value=e.data}catch(e){console.error("Gagal load invoice:",e),g.value='<p class="text-center text-red-500 mt-10">Gagal memuat invoice.</p>'}finally{D.value=!1}},H=()=>{if(!g.value)return;const s=window.open("","","height=600,width=400");s.document.write("<html><head><title>Print</title><style>body { margin: 0; padding: 0; }</style></head><body>"),s.document.write(g.value),s.document.write("</body></html>"),s.document.close(),s.focus(),setTimeout(()=>{s.print(),s.close()},500)},N=j(()=>n.sales.data),p=j(()=>n.sales);return(s,e)=>(i(),d(b,null,[v(C(G),{title:"Riwayat Penjualan"}),v(K,{headerTitle:"Dashboard Penjualan"},{default:x(()=>[a("div",se,[v(Z,{summary:h.summary},null,8,["summary"]),a("div",le,[a("div",oe,[a("div",re,[o.value!=="all"?(i(!0),d(b,{key:0},$(V.filter(t=>t.id!=="all"),t=>(i(),d("button",{key:t.id,onClick:l=>B(t.id),class:L(["px-4 py-2 text-sm font-bold rounded-lg transition-all whitespace-nowrap flex-1",o.value===t.id?"bg-white dark:bg-gray-700 text-blue-600 shadow-sm":"text-gray-500 hover:text-gray-700 dark:text-gray-400"])},u(t.label),11,ne))),128)):y("",!0),o.value==="all"?(i(),d("button",{key:1,onClick:e[0]||(e[0]=t=>B("all")),class:"px-4 py-2 text-sm font-bold rounded-lg bg-white dark:bg-gray-700 text-blue-600 shadow-sm whitespace-nowrap"}," Custom / Semua ")):y("",!0)]),a("label",ie,[W(a("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=t=>r.value.show_deleted=t),class:"w-4 h-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,512),[[J,r.value.show_deleted]]),e[8]||(e[8]=a("span",null,"Tampilkan Terhapus",-1))])]),["today","week","month","year"].includes(o.value)&&(f.value.revenue?.length>0||f.value.qty?.length>0||f.value.chart?.revenues?.length>0)?(i(),d("div",de,[v(te,{data:f.value.chart,title:`Grafik Omset & Laba Bersih (${f.value.label})`},null,8,["data","title"]),o.value!=="year"?(i(),d("div",ue,[a("div",ce,[e[9]||(e[9]=a("div",{class:"flex items-center justify-between mb-3 relative z-10"},[a("div",{class:"flex items-center gap-2"},[a("div",{class:"p-1.5 bg-white/20 rounded-lg backdrop-blur-sm"},[a("span",{class:"text-sm"},"ðŸ’Ž")]),a("h3",{class:"font-bold text-base leading-tight"},"Top Omset")]),a("span",{class:"text-[10px] bg-white/20 px-2 py-0.5 rounded-full backdrop-blur-sm"},"Most Valuable")],-1)),a("div",me,[(i(!0),d(b,null,$(f.value.revenue,(t,l)=>(i(),F(C(O),{key:"rev-"+t.id,href:s.route("products.show",t.slug),class:"flex items-center gap-2 p-1.5 rounded-lg hover:bg-white/10 transition group"},{default:x(()=>[a("div",ve,u(l+1),1),a("div",fe,[a("p",pe,u(t.name),1),a("p",ge,u(t.qty)+" items",1)]),a("div",ye,u(new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(t.revenue)),1)]),_:2},1032,["href"]))),128))]),e[10]||(e[10]=a("div",{class:"absolute -right-6 -bottom-6 text-9xl opacity-5 pointer-events-none select-none"},"ðŸ’Ž",-1))]),a("div",he,[e[11]||(e[11]=a("div",{class:"flex items-center justify-between mb-3 relative z-10"},[a("div",{class:"flex items-center gap-2"},[a("div",{class:"p-1.5 bg-white/20 rounded-lg backdrop-blur-sm"},[a("span",{class:"text-sm"},"ðŸ“¦")]),a("h3",{class:"font-bold text-base leading-tight"},"Terlaris (Qty)")]),a("span",{class:"text-[10px] bg-white/20 px-2 py-0.5 rounded-full backdrop-blur-sm"},"Most Popular")],-1)),a("div",xe,[(i(!0),d(b,null,$(f.value.qty,(t,l)=>(i(),F(C(O),{key:"qty-"+t.id,href:s.route("products.show",t.slug),class:"flex items-center gap-2 p-1.5 rounded-lg hover:bg-white/10 transition group"},{default:x(()=>[a("div",be,u(l+1),1),a("div",_e,[a("p",we,u(t.name),1)]),a("div",ke,u(t.qty)+" items ",1)]),_:2},1032,["href"]))),128))]),e[12]||(e[12]=a("div",{class:"absolute -right-6 -bottom-6 text-9xl opacity-5 pointer-events-none select-none"},"ðŸ”¥",-1))])])):y("",!0)])):y("",!0),v(Q,{class:"w-full",filters:h.filters,modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=t=>_.value=t),onShowFilter:e[3]||(e[3]=t=>w.value=!0),filterCount:0,actions:[{route:s.route("sales.create"),buttonText:"+ Rekap Manual"}]},null,8,["filters","modelValue","actions"]),v(A,{show:w.value,onClose:e[4]||(e[4]=t=>w.value=!1),filters:h.filters},null,8,["show","filters"]),a("div",null,[a("div",De,[e[13]||(e[13]=a("h2",{class:"text-lg font-bold text-gray-800 dark:text-white"}," Riwayat Transaksi ",-1)),a("span",Te," Total "+u(p.value.total)+" Data ",1)]),v(ee,{sales:N.value,onPreviewInvoice:R},null,8,["sales"]),p.value.last_page>1?(i(),d("div",je,[a("button",U(p.value.links[0],{disabled:!p.value.prev_page_url,onClick:e[5]||(e[5]=t=>r.value.page--),class:"px-4 py-2 bg-white border rounded-lg disabled:opacity-50 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700"})," Prev ",16,Ce),a("span",$e," Hal "+u(p.value.current_page)+" / "+u(p.value.last_page),1),a("button",{disabled:!p.value.next_page_url,onClick:e[6]||(e[6]=t=>r.value.page++),class:"px-4 py-2 bg-white border rounded-lg disabled:opacity-50 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700"}," Next ",8,Ie)])):y("",!0)])])])]),_:1}),v(X,{show:k.value,onClose:e[7]||(e[7]=t=>k.value=!1),title:"Preview Invoice #"+P.value},{default:x(()=>[D.value?(i(),d("div",Pe,[...e[14]||(e[14]=[a("svg",{class:"w-10 h-10 mb-3 text-blue-500 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[a("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),a("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})],-1),a("p",{class:"text-lime-500"},"Memuat Invoice...",-1)])])):(i(),d("div",Be,[a("div",Se,[a("iframe",{srcdoc:g.value,class:"w-full h-full bg-white border-0",style:{display:"block"}},null,8,qe)]),a("div",Me,[a("a",{href:`/sales/${I.value}/print`,target:"_blank",class:"flex items-center justify-center gap-2 py-3 font-bold text-white transition bg-red-500 rounded-lg hover:bg-red-600"}," ðŸ“¥ Download PDF ",8,Fe),a("button",{onClick:H,class:"flex items-center justify-center gap-2 py-3 font-bold text-white transition bg-blue-600 rounded-lg hover:bg-blue-700"}," ðŸ–¨ Print Struk ")])]))]),_:1},8,["show","title"])],64))}},at=ae(Oe,[["__scopeId","data-v-0f520702"]]);export{at as default};
