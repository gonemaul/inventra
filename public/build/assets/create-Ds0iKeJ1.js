const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/HeadRabMobile-DSHdfU6f.js","assets/vendor-core-BC1dSzkC.js","assets/vendor-common-GpUWqhKr.js","assets/vendor-charts-Bw6UNgWf.js","assets/vendor-core-DnojJsHo.css","assets/InputError-DGYw8hC3.js","assets/HeadRabDesktop-DvfuKk4a.js","assets/PrimaryButton-DmXwG_T0.js","assets/_plugin-vue_export-helper-DlAUqK2U.js","assets/SecondaryButton-BQvEs_0a.js"])))=>i.map(i=>d[i]);
import{_ as $}from"./app-E6sxr_WX.js";import{_ as ae}from"./AuthenticatedLayout-BqVghQ4K.js";import{p as re,C as g,q as v,u as se,J as ne,v as ie,N as oe,l as f,o as c,e as x,g as a,i as le,w as ue,f as o,d as y,a1 as V,n as q,k as de,m as ce,t as pe,a2 as me,R as ge,F as ve}from"./vendor-core-BC1dSzkC.js";import{u as he}from"./useActionLoading-BNGSEwHo.js";import{u as _e}from"./usePurchaseCart-RXRh8bnd.js";import fe from"./CatalogView-CSqx0Kle.js";import ye from"./PurchaseTable-CtRMoJPV.js";import ke from"./recom-z80emDmU.js";import"./vendor-common-GpUWqhKr.js";import"./vendor-charts-Bw6UNgWf.js";import"./useSidebar-B3W3eSlW.js";import"./CatalogCard-yAG2IscF.js";import"./DataTable-CjQA3uo8.js";import"./BottomSheet-fL7Cjms_.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const be={class:"w-full min-h-screen space-y-6"},we={class:"p-4 space-y-4 bg-white border border-gray-200 shadow-sm rounded-xl dark:bg-gray-900 dark:border-gray-700"},Se={class:"flex p-1 space-x-1 bg-gray-100 rounded-lg dark:bg-gray-700"},xe={key:0,class:"ml-2 bg-lime-100 text-lime-700 py-0.5 px-2 rounded-full text-xs font-bold"},Ie=["disabled"],je={key:0},Re={key:1},Ce={class:"min-h-[400px]"},k="inventra_draft_supplier_id",Ke={__name:"create",props:{purchase:Object,dropdowns:Object},setup(b){const O=V(()=>$(()=>import("./HeadRabMobile-DSHdfU6f.js"),__vite__mapDeps([0,1,2,3,4,5]))),L=V(()=>$(()=>import("./HeadRabDesktop-DvfuKk4a.js"),__vite__mapDeps([6,1,2,3,4,7,8,9,5]))),i=b,l=re(),{isActionLoading:I}=he(),p=g(()=>!!i.purchase&&!!i.purchase.id),w=g(()=>i.purchase?.status||"draft"),F=g(()=>w.value==="draft"),H=g(()=>w.value==="dipesan"),j=v(window.innerWidth<1024),R=()=>{j.value=window.innerWidth<1024},u=v("table"),m=v(!1),{cartItems:d,addToCart:K,updateCartItem:N,removeItem:U,clearCart:Q,totalUnit:C,totalBelanja:D,totalMacam:M,addMultipleItems:W}=_e(p.value,i.purchase),n=se({supplier_id:i.purchase?.supplier_id||"",transaction_date:i.purchase?.transaction_date||new Date().toISOString().split("T")[0],status:w.value,notes:i.purchase?.notes||"",shipping_cost:i.purchase?.shipping_cost||0,other_costs:i.purchase?.other_costs||0}),h=v(!1),E={product_id:null,name:"",code:"",unit:"",size:"",category:"",brand:"",type:"",image_url:"",current_stock:0,quantity:1,purchase_price:0,restock_recommendation:0},s=v({...E}),_=g({get:()=>s.value.purchase_price?Z(s.value.purchase_price):0,set:e=>s.value.purchase_price=ee(e)});ne(()=>n.supplier_id,e=>{e?(localStorage.setItem(k,e),m.value=!0,u.value="catalog"):(localStorage.removeItem(k),m.value=!1,u.value="table")}),ie(()=>{window.addEventListener("resize",R);const e=localStorage.getItem(k);e&&!n.supplier_id&&!p.value&&(n.supplier_id=e)}),oe(()=>{window.removeEventListener("resize",R)});const P=(e,t=1,r=null)=>{const B=e.insights?.find(te=>te.type==="restock")?.payload?.suggested_qty;s.value={product_id:e.product_id?e.product_id:e.id,name:e.name,code:e.code,category:e.category?.name||e.category||"-",unit:e.unit?.name||e.unit||"-",size:e.size?.name||e.size||"-",brand:e.brand?.name||e.brand||"-",type:e.type_name||e.type_name||"-",image_url:e.image_url,current_stock:e.stock||e.current_stock,quantity:B||t,purchase_price:r!==null?r:e.purchase_price||0,restock_recommendation:B}},S=()=>{s.value={...E},h.value=!1},G=e=>{P(e),u.value="catalog",window.scrollTo({top:0,behavior:"smooth"})},J=e=>{P(e,e.quantity,e.purchase_price),h.value=!0,u.value="table",window.scrollTo({top:0,behavior:"smooth"})},T=()=>{if(!s.value.product_id)return l.error("Mohon pilih produk dari katalog.");if(s.value.quantity<=0)return l.error("Kuantitas minimal harus 1.");d.value.find(t=>t.product_id===s.value.product_id)?(N({product_id:s.value.product_id,quantity:s.value.quantity,purchase_price:s.value.purchase_price}),l.success("Item diperbarui.")):(K(s.value,s.value.quantity,s.value.purchase_price),l.success("Item ditambahkan.")),S()},Y=e=>{if(H.value&&e.id)return l.warning("Item lama tidak boleh dihapus saat status Dipesan! Silakan edit Qty saja.");U(e.product_id)},X=e=>{W(e),l.info(`${e.length} item rekomendasi ditambahkan ke keranjang.`)},z=()=>{if(!n.supplier_id)return l.error("Pilih Supplier dulu!");if(d.value.length===0)return l.error("Keranjang kosong!");I.value=!0;const e=r=>({...r,items:d.value}),t={onSuccess:()=>{p.value||localStorage.removeItem(k);const r=p.value?`inventra_edit_${i.purchase.id}`:"inventra_create_draft";localStorage.removeItem(r),Q(),n.reset()},onError:r=>{console.error(r);const A=Object.values(r)[0]||"Terjadi kesalahan";l.error("Gagal: "+A)},onFinish:()=>{I.value=!1}};p.value?n.transform(e).put(route("purchases.update",i.purchase.id),t):n.transform(e).post(route("purchases.store"),t)};function Z(e){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(e)}function ee(e){return parseInt(String(e).replace(/[^0-9]/g,""))||0}return(e,t)=>(c(),f(ve,null,[x(a(le),{title:"Rancangan Anggaran Belanja"}),x(ae,{headerTitle:"Rancangan Anggaran Belanja",showSidebar:!1},{default:ue(()=>[x(ke,{show:m.value,supplierId:a(n).supplier_id,onClose:t[0]||(t[0]=r=>m.value=!1),onAddItems:X},null,8,["show","supplierId"]),o("div",be,[j.value?(c(),y(a(O),{key:0,"form-header":a(n),dropdowns:b.dropdowns,"staging-item":s.value,"is-edit":p.value,"is-editing-mode":h.value,"cart-items":a(d),"total-unit":a(C),"total-macam":a(M),"total-belanja":a(D),"displayed-price":_.value,"onUpdate:displayedPrice":t[1]||(t[1]=r=>_.value=r),onSaveStaging:T,onResetStaging:S,onSubmitTransaction:z,onOpenRecommendation:t[2]||(t[2]=r=>m.value=!0)},null,8,["form-header","dropdowns","staging-item","is-edit","is-editing-mode","cart-items","total-unit","total-macam","total-belanja","displayed-price"])):(c(),y(a(L),{key:1,"form-header":a(n),dropdowns:b.dropdowns,"staging-item":s.value,"is-edit":p.value,"is-editing-mode":h.value,"cart-items":a(d),"total-unit":a(C),"total-macam":a(M),"total-belanja":a(D),"displayed-price":_.value,"onUpdate:displayedPrice":t[3]||(t[3]=r=>_.value=r),onSaveStaging:T,onResetStaging:S,onSubmitTransaction:z,onOpenRecommendation:t[4]||(t[4]=r=>m.value=!0)},null,8,["form-header","dropdowns","staging-item","is-edit","is-editing-mode","cart-items","total-unit","total-macam","total-belanja","displayed-price"])),o("div",we,[o("div",Se,[o("button",{type:"button",onClick:t[5]||(t[5]=r=>u.value="table"),class:q(["flex items-center justify-center w-1/2 py-2.5 text-sm font-medium rounded-md transition-all duration-200 focus:outline-none",u.value==="table"?"bg-white text-gray-900 shadow dark:bg-gray-600 dark:text-white":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"])},[t[7]||(t[7]=o("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})],-1)),t[8]||(t[8]=de(" Daftar Belanja ",-1)),a(d).length>0?(c(),f("span",xe,pe(a(d).length),1)):ce("",!0)],2),o("button",{type:"button",onClick:t[6]||(t[6]=r=>u.value="catalog"),disabled:!a(n).supplier_id,class:q(["flex items-center justify-center w-1/2 py-2.5 text-sm font-medium rounded-md transition-all duration-200 focus:outline-none",[u.value==="catalog"?"bg-white text-gray-900 shadow dark:bg-gray-600 dark:text-white":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",a(n).supplier_id?"":"opacity-50 cursor-not-allowed"]])},[t[9]||(t[9]=o("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})],-1)),a(n).supplier_id?(c(),f("span",Re,"Katalog Produk")):(c(),f("span",je,"Pilih Supplier Dulu"))],10,Ie)]),o("div",Ce,[(c(),y(me,null,[(c(),y(ge(u.value==="table"?ye:fe),{"supplier-id":a(n).supplier_id,items:a(d),stagingItem:s.value,isDraft:F.value,onRemove:Y,onEdit:J,onSelectProduct:G},null,40,["supplier-id","items","stagingItem","isDraft"]))],1024))])])])]),_:1})],64))}};export{Ke as default};
