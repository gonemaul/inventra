import{_ as B}from"./AuthenticatedLayout-DnsbiX89.js";import{E as r,D as k,H as j,p as I,l as d,o as u,e as l,g as C,i as V,w as c,f as a,x as D,k as f,t as x,m as L,F as M}from"./vendor-core-D38XQ_w0.js";import{_ as R}from"./DataTable-DMQ1hfOw.js";import{_ as E}from"./Filter-DrrKjkQi.js";import H from"./modalFilter-D4Yt7BoD.js";import{u as N}from"./useActionLoading-s7e1gqkt.js";import{d as S}from"./vendor-common-BBegFRNv.js";import{B as A}from"./BottomSheet-CCD1ZQZl.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useSidebar-BzR847ej.js";import"./vendor-charts-Bw6UNgWf.js";import"./TextInput-lw9tkZ28.js";import"./PrimaryButton-BaxuxEfe.js";import"./Modal-DrnPoAKc.js";const U={class:"w-full min-h-screen space-y-6"},q={class:"p-4 space-y-6 bg-gray-100 border shadow-md rounded-xl dark:bg-customBg-tableDark"},G=["onClick"],z=["title"],J={key:0,class:"my-4 text-sm text-gray-600 dark:text-gray-200 whitespace-nowrap"},Q={key:1,class:"text-xs text-gray-400"},W={class:"flex flex-col h-full px-4"},X={key:0,class:"flex-1 flex flex-col items-center justify-center min-h-[300px]"},Y={key:1,class:"flex flex-col flex-1 overflow-hidden"},Z={class:"flex-1 p-2 mb-4 overflow-y-auto bg-gray-100 border rounded"},ee={class:"bg-white shadow-sm p-2 min-h-[200px] receipt-preview-wrapper"},te=["innerHTML"],se={class:"grid grid-cols-2 gap-3 pt-2 mt-auto border-t"},ae=["href"],re={__name:"index",props:{filters:Object,sales:Object},setup(m){const o=m,p=r(o.filters.search||""),g=r(!1),{isActionLoading:b}=N(),y=r(!1),h=r(!1),n=r(""),w=r(null),_=r("-"),F=[{key:"transaction_date",label:"Tanggal",sortable:!0,format:"tanggal",width:"130px"},{key:"reference_no",label:"No. Referensi",sortable:!0,slot:"reference",width:"130px"},{key:"summary",label:"Summary",slot:"Summary",width:"130px"},{key:"total_revenue",label:"Total Omset",sortable:!0,format:"rupiah"},{key:"aksi",label:"Aksi",width:"120px",slot:"aksi"}],v=r({search:o.filters.search||"",sort:o.filters.sort||"transaction_date",order:o.filters.order||"desc",page:o.sales.current_page||1}),O=S.throttle(()=>{const t={...o.filters};t.search=p.value,t.search||delete t.search,k.get(route("sales.index"),t,{preserveState:!0,replace:!0})},300);j(v,S.throttle(t=>{const e=Object.fromEntries(Object.entries(t).filter(([s,i])=>i!=null&&i!==""));b.value=!0,k.get(route("sales.index"),e,{preserveState:!0,preserveScroll:!0,replace:!0,only:["sales","filters"],onFinish:()=>{b.value=!1}})},300),{deep:!0}),j(p,O);const P=I(()=>{Object.fromEntries(Object.entries(v).filter(([s,i])=>i!=null&&i!==""));const t=Object.keys(o.filters),e=["search","page","per_page"];return t.filter(s=>!e.includes(s)).length}),T=async t=>{w.value=t.id,_.value=t.reference_no,y.value=!0,h.value=!0,n.value="";try{const e=await axios.get(`/sales/${t.id}/print`,{responseType:"text"});n.value=e.data}catch(e){console.error("Gagal load invoice:",e),n.value='<p class="mt-10 text-center text-red-500">Gagal memuat data invoice.</p>'}finally{h.value=!1}},$=()=>{if(!n.value)return;const t=window.open("","","height=600,width=400");t.document.write("<html><head><title>Print</title>"),t.document.write("<style>body { margin: 0; padding: 0; }</style>"),t.document.write("</head><body>"),t.document.write(n.value),t.document.write("</body></html>"),t.document.close(),t.focus(),setTimeout(()=>{t.print(),t.close()},500)};return(t,e)=>(u(),d(M,null,[l(C(V),{title:"Riwayat Penjualan"}),l(B,{headerTitle:"Riwayat Penjualan"},{default:c(()=>[a("div",U,[l(E,{filters:m.filters,modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=s=>p.value=s),onShowFilter:e[1]||(e[1]=s=>g.value=!0),filterCount:P.value,actions:[{route:t.route("sales.create"),buttonText:"Rekap"}]},null,8,["filters","modelValue","filterCount","actions"]),l(H,{show:g.value,onClose:e[2]||(e[2]=s=>g.value=!1),filters:m.filters},null,8,["show","filters"]),a("div",q,[e[10]||(e[10]=a("div",null,[a("h2",{class:"text-base font-semibold text-gray-900 dark:text-white sm:text-lg lg:text-xl"}," Riwayat Penjualan "),a("p",{class:"mt-1 text-xs text-gray-600 dark:text-gray-300 sm:text-sm lg:text-base"}," Kelola semua riwayat penjualan. ")],-1)),l(R,{serverSide:"true",data:m.sales.data,columns:F,perPageOptions:[5,10,25,50,100],params:v.value,"onUpdate:params":e[3]||(e[3]=s=>v.value=s),pagination:m.sales},{reference:c(({row:s})=>[a("div",{onClick:i=>T(s),class:"font-mono text-sm font-bold text-indigo-600 dark:text-indigo-400"},x(s.reference_no),9,G),s.notes?(u(),d("div",{key:0,class:"text-xs text-gray-500 truncate max-w-[150px]",title:s.notes}," ðŸ“ "+x(s.notes),9,z)):L("",!0)]),Summary:c(({row:s})=>[s.financial_summary?(u(),d("div",J,[a("div",null,[e[5]||(e[5]=f(" Item: ",-1)),a("strong",null,x(s.financial_summary.item_count),1),e[6]||(e[6]=f(" Jenis ",-1))]),a("div",null,[e[7]||(e[7]=f(" Qty: ",-1)),a("strong",null,x(s.financial_summary.total_qty),1),e[8]||(e[8]=f(" Unit ",-1))])])):(u(),d("span",Q,"-"))]),aksi:c(({row:s})=>[l(C(D),{href:t.route("sales.show",s.id),class:"px-3 py-1 text-sm font-medium text-indigo-600 transition border border-indigo-200 rounded hover:text-indigo-900 hover:bg-indigo-300"},{default:c(()=>[...e[9]||(e[9]=[f(" Lihat Detail ",-1)])]),_:2},1032,["href"])]),_:1},8,["data","params","pagination"])])])]),_:1}),l(A,{show:y.value,onClose:e[4]||(e[4]=s=>y.value=!1),title:"Preview Invoice #"+_.value},{default:c(()=>[a("div",W,[h.value?(u(),d("div",X,[...e[11]||(e[11]=[a("svg",{class:"w-10 h-10 mb-3 text-blue-500 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[a("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),a("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})],-1),a("p",{class:"text-lime-500"},"Memuat Invoice...",-1)])])):(u(),d("div",Y,[a("div",Z,[a("div",ee,[a("div",{innerHTML:n.value},null,8,te)])]),a("div",se,[a("a",{href:`/sales/${w.value}/print`,target:"_blank",class:"flex items-center justify-center gap-2 py-3 font-bold text-white transition bg-red-500 rounded-lg hover:bg-red-600"}," ðŸ“¥ Download PDF ",8,ae),a("button",{onClick:$,class:"flex items-center justify-center gap-2 py-3 font-bold text-white transition bg-blue-600 rounded-lg hover:bg-blue-700"}," ðŸ–¨ Print Struk ")])]))])]),_:1},8,["show","title"])],64))}},he=K(re,[["__scopeId","data-v-7058b844"]]);export{he as default};
