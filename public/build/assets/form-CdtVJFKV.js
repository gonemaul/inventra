import{q as z,v as w,x as A,u as H,D as F,K as T,l as d,o as c,e as B,g as o,i as N,w as L,f as e,k as M,z as _,_ as P,A as C,n as j,F as R,I as D,t as g,p as S}from"./vendor-core-By7Plnkm.js";import{_ as O}from"./AuthenticatedLayout-BlgKae2S.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vendor-common-GpUWqhKr.js";import"./vendor-charts-Bw6UNgWf.js";import"./useSidebar-CpEDRVzi.js";import"./useActionLoading-BREuot5v.js";function Q(n){const u=z(),y="POS_RECAP_DRAFT_V2",h=w(""),x=w("all"),I=w("all"),s=w([]),i=w(new Date().toISOString().slice(0,10));A(()=>{if(n.mode==="edit"&&n.sale)i.value=n.sale.transaction_date,s.value=n.sale.items.map(t=>({id:t.product.id,name:t.product.name,code:t.product.code,image:t.product.image_path,selling_price:parseFloat(t.selling_price),purchase_price:parseFloat(t.purchase_price||0),stock:parseFloat(t.product.stock)+parseFloat(t.quantity),quantity:parseFloat(t.quantity)})),l.notes=n.sale.notes||"";else{const t=localStorage.getItem(y);if(t)try{const r=JSON.parse(t);s.value=r.cart||[],i.value=r.date||new Date().toISOString().slice(0,10)}catch{localStorage.removeItem(y)}}});const V=F(()=>{let t=n.products||[];x.value!=="all"&&(t=t.filter(a=>a.category_id===x.value));const r=h.value.toLowerCase().trim();return r&&(t=t.filter(a=>a.name&&a.name.toLowerCase().includes(r)||a.code&&a.code.toLowerCase().includes(r))),t}),b=F(()=>s.value.reduce((t,r)=>t+r.selling_price*r.quantity,0)),m=F(()=>s.value.reduce((t,r)=>{const a=r.selling_price*r.quantity,p=(r.purchase_price||0)*r.quantity;return t+(a-p)},0));F(()=>[]);const q=t=>{if(t.stock<=0)return u.warning("Stok Habis!");const r=s.value.find(a=>a.id===t.id);if(r){if(r.quantity>=t.stock)return u.warning("Stok tidak cukup!");r.quantity++}else s.value.push({id:t.id,name:t.name,code:t.code,selling_price:parseFloat(t.selling_price),purchase_price:parseFloat(t.purchase_price),stock:t.stock,quantity:1})},f=t=>{s.value.splice(t,1)},k=()=>{s.value=[],localStorage.removeItem(y)},l=H({input_type:"recap",report_date:null,items:[],total_revenue:0,total_profit:0,payment_method:"cash",payment_amount:0,change_amount:0,customer_id:null,notes:""});return T([s,i,()=>l.notes],()=>{n.mode!=="edit"&&localStorage.setItem(y,JSON.stringify({cart:s.value,date:i.value,notes:l.notes}))},{deep:!0}),{searchQuery:h,selectedCategory:x,selectedProductType:I,cart:s,transactionDate:i,form:l,filteredProducts:V,totalRevenue:b,totalProfit:m,addToCart:q,removeItem:f,clearCart:k,processRecap:()=>{if(s.value.length===0)return u.error("Data masih kosong!");if(!i.value)return u.error("Pilih tanggal rekap!");if(s.value.some(a=>a.quantity<=0))return u.error("Ada produk dengan jumlah 0!");l.report_date=i.value,l.items=s.value.map(a=>({product_id:a.id,quantity:a.quantity,selling_price:a.selling_price,purchase_price:a.purchase_price})),l.total_revenue=parseFloat(b.value),l.total_profit=parseFloat(m.value),l.payment_amount=parseFloat(b.value),l.change_amount=0;const r={onSuccess:a=>{if(a.props.flash.error){u.error(a.props.flash.error);return}n.mode!=="edit"&&(s.value=[],localStorage.removeItem(y)),u.success("Rekap Berhasil Disimpan!")},onError:a=>{console.error(a),u.error("Gagal menyimpan rekap.")}};n.mode==="edit"?l.put(route("sales.update",n.sale.id),r):l.post(route("sales.pos.store"),r)}}}const E={class:"flex flex-col h-[calc(100vh-4rem)] lg:flex-row gap-4 lg:gap-6 p-2 lg:p-4 overflow-hidden"},K={class:"flex flex-col w-full lg:w-[45%] h-[50%] lg:h-full bg-white dark:bg-gray-800 rounded-3xl shadow-2xl border border-gray-100 dark:border-gray-700/50 overflow-hidden relative"},$={class:"shrink-0 p-4 bg-white/80 dark:bg-gray-800/90 backdrop-blur-md z-10 border-b border-gray-100 dark:border-gray-700"},G={class:"relative group"},J={class:"shrink-0 px-4 pb-2"},Y={class:"flex gap-2 overflow-x-auto custom-scroll-x pb-2"},W=["onClick"],X={class:"flex-1 overflow-y-auto p-4 custom-scroll bg-gray-50/50 dark:bg-gray-900/20"},Z={key:0,class:"flex flex-col items-center justify-center h-48 text-gray-400 animate-fade-in"},ee={class:"grid grid-cols-2 md:grid-cols-3 xl:grid-cols-3 gap-3"},te=["onClick"],re={key:0,class:"absolute top-2 right-2 bg-gray-900 text-white dark:bg-white dark:text-gray-900 text-[10px] font-bold w-6 h-6 flex items-center justify-center rounded-full shadow-lg z-10 animate-bounce-short"},ae={class:"relative z-10"},oe={class:"flex items-start justify-between mb-2"},se={class:"text-[9px] font-bold tracking-wider text-gray-400 uppercase bg-gray-100 dark:bg-gray-700 px-1.5 py-0.5 rounded-md"},le={class:"text-sm font-bold text-gray-800 dark:text-gray-100 leading-snug line-clamp-2 min-h-[2.5rem] mb-1 group-hover:text-lime-600 dark:group-hover:text-lime-400 transition-colors"},ne={class:"flex items-center gap-1.5 mb-3"},ie={class:"relative z-10 pt-2 border-t border-gray-50 dark:border-gray-700/50 flex items-center justify-between"},de={class:"font-black text-gray-900 dark:text-white group-hover:text-lime-600 transition-colors"},ce={class:"flex flex-col w-full lg:w-[55%] h-[50%] lg:h-full bg-white dark:bg-gray-800 rounded-3xl shadow-2xl border border-gray-100 dark:border-gray-700/50 overflow-hidden relative"},ge={class:"shrink-0 p-5 border-b border-gray-100 dark:border-gray-700 bg-white/80 dark:bg-gray-800/90 backdrop-blur-md z-20 flex justify-between items-center"},ue={class:"flex items-center gap-3"},pe={class:"relative"},ye={class:"flex-1 overflow-auto bg-white custom-scroll dark:bg-gray-800 relative"},xe={class:"w-full text-left border-collapse"},he={class:"divide-y divide-gray-50 dark:divide-gray-700/50"},be={key:0},me={class:"p-4 align-top"},fe={class:"font-bold text-gray-800 dark:text-white text-sm leading-tight mb-0.5"},ke={class:"text-[10px] text-gray-400 font-mono"},ve={class:"p-4 align-top"},we=["onUpdate:modelValue"],_e={class:"p-4 align-top text-right"},Ce=["onUpdate:modelValue"],je={class:"p-4 align-top text-right font-black text-gray-800 dark:text-white text-sm"},Se={class:"p-4 align-middle text-center"},Ie=["onClick"],qe={class:"shrink-0 bg-gray-50/50 dark:bg-gray-900/50 border-t border-gray-100 dark:border-gray-700 p-5 space-y-4 shadow-inner-sm"},Fe={class:"flex flex-col sm:flex-row gap-4"},Re={class:"flex-1 relative"},Ve={class:"flex flex-col gap-2 min-w-[200px]"},De={class:"flex justify-between items-end"},Be={class:"text-3xl font-black text-gray-900 dark:text-white tracking-tight"},Me=["disabled"],Pe={key:0,class:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"},ze={__name:"form",props:{products:Array,categories:Array,sale:Object,mode:String},setup(n){const u=n,{searchQuery:y,selectedCategory:h,cart:x,filteredProducts:I,totalRevenue:s,form:i,addToCart:V,removeItem:b,processRecap:m,clearCart:q,transactionDate:f}=Q(u),k=v=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(v),l=v=>{const t=x.value.find(r=>r.id===v);return t?t.quantity:0};return(v,t)=>(c(),d(R,null,[B(o(N),{title:"Input Rekap"}),B(O,null,{default:L(()=>[e("div",E,[e("div",K,[e("div",$,[t[9]||(t[9]=e("div",{class:"flex items-center justify-between mb-4"},[e("div",null,[e("h2",{class:"text-xl font-black text-gray-800 dark:text-white tracking-tight flex items-center gap-2"},[e("span",{class:"bg-lime-500 text-white w-8 h-8 flex items-center justify-center rounded-lg shadow-lime-500/30 shadow-md text-sm"},"ðŸ“¦"),M(" Katalog Produk ")]),e("p",{class:"text-xs text-gray-400 font-medium ml-10"},"Pilih produk untuk ditambahkan")])],-1)),e("div",G,[t[8]||(t[8]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("svg",{class:"w-5 h-5 text-gray-400 group-focus-within:text-lime-500 transition-colors",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1)),_(e("input",{"onUpdate:modelValue":t[0]||(t[0]=r=>P(y)?y.value=r:null),type:"text",placeholder:"Cari nama, kode, atau scan barcode...",class:"w-full pl-10 pr-4 py-3 bg-gray-50 dark:bg-gray-900/50 border-none ring-1 ring-gray-200 dark:ring-gray-700 rounded-xl text-sm font-medium focus:ring-2 focus:ring-lime-500 transition-all shadow-inner placeholder-gray-400"},null,512),[[C,o(y)]])])]),e("div",J,[e("div",Y,[e("button",{onClick:t[1]||(t[1]=r=>h.value="all"),class:j(["px-4 py-2 rounded-xl text-xs font-bold whitespace-nowrap transition-all duration-300 border",o(h)==="all"?"bg-gray-900 text-white border-gray-900 shadow-lg shadow-gray-900/20 dark:bg-white dark:text-gray-900":"bg-white text-gray-500 border-gray-200 hover:border-gray-300 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400"])}," Semua ",2),(c(!0),d(R,null,D(n.categories,r=>(c(),d("button",{key:r.id,onClick:a=>h.value=r.id,class:j(["px-4 py-2 rounded-xl text-xs font-bold whitespace-nowrap transition-all duration-300 border",o(h)===r.id?"bg-gray-900 text-white border-gray-900 shadow-lg shadow-gray-900/20 dark:bg-white dark:text-gray-900":"bg-white text-gray-500 border-gray-200 hover:border-gray-300 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400"])},g(r.name),11,W))),128))])]),e("div",X,[o(I).length===0?(c(),d("div",Z,[...t[10]||(t[10]=[e("div",{class:"w-16 h-16 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mb-3"},[e("svg",{class:"w-8 h-8 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})])],-1),e("p",{class:"text-sm font-medium"},"Produk tidak ditemukan",-1)])])):S("",!0),e("div",ee,[(c(!0),d(R,null,D(o(I),r=>(c(),d("div",{key:r.id,onClick:a=>o(V)(r),class:j(["group relative flex flex-col justify-between bg-white dark:bg-gray-800 rounded-2xl p-3 border border-gray-100 dark:border-gray-700/50 shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all duration-300 cursor-pointer overflow-hidden",{"opacity-60 grayscale":r.stock===0}])},[t[12]||(t[12]=e("div",{class:"absolute inset-0 bg-gradient-to-br from-transparent to-gray-50/50 dark:to-gray-700/20 opacity-0 group-hover:opacity-100 transition-opacity"},null,-1)),l(r.id)>0?(c(),d("div",re,g(l(r.id)),1)):S("",!0),e("div",ae,[e("div",oe,[e("span",se,g(r.code),1)]),e("h3",le,g(r.name),1),e("div",ne,[e("div",{class:j(["w-1.5 h-1.5 rounded-full",r.stock>0?"bg-green-500":"bg-red-500"])},null,2),e("span",{class:j(["text-[10px] font-medium",r.stock>0?"text-gray-500":"text-red-500"])}," Stok: "+g(r.stock)+" "+g(r.unit?.name),3)])]),e("div",ie,[e("span",de,g(k(r.selling_price)),1),t[11]||(t[11]=e("button",{class:"w-6 h-6 rounded-full bg-gray-50 dark:bg-gray-700 text-gray-400 flex items-center justify-center group-hover:bg-lime-500 group-hover:text-white transition-all"},[e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2.5",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})])],-1))])],10,te))),128))])])]),e("div",ce,[e("div",ge,[t[15]||(t[15]=e("div",null,[e("h2",{class:"text-xl font-black text-gray-800 dark:text-white tracking-tight flex items-center gap-2"},[e("span",{class:"bg-blue-500 text-white w-8 h-8 flex items-center justify-center rounded-lg shadow-blue-500/30 shadow-md text-sm"},"ðŸ“"),M(" Detail Rekap ")])],-1)),e("div",ue,[e("div",pe,[_(e("input",{type:"date","onUpdate:modelValue":t[2]||(t[2]=r=>P(f)?f.value=r:null),class:"pl-8 pr-3 py-1.5 text-xs font-bold bg-gray-50 dark:bg-gray-900 border-none rounded-lg focus:ring-1 focus:ring-blue-500 cursor-pointer shadow-sm"},null,512),[[C,o(f)]]),t[13]||(t[13]=e("span",{class:"absolute left-2.5 top-1.5 text-gray-400"},"ðŸ“…",-1))]),o(x).length?(c(),d("button",{key:0,onClick:t[3]||(t[3]=(...r)=>o(q)&&o(q)(...r)),class:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-all",title:"Reset Keranjang"},[...t[14]||(t[14]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])])):S("",!0)])]),e("div",ye,[e("table",xe,[t[18]||(t[18]=e("thead",{class:"sticky top-0 z-10 bg-gray-50/95 dark:bg-gray-900/95 backdrop-blur shadow-sm"},[e("tr",null,[e("th",{class:"py-3 px-4 text-[10px] uppercase font-bold text-gray-400 dark:text-gray-500 tracking-wider"},"Produk"),e("th",{class:"py-3 px-4 text-[10px] uppercase font-bold text-gray-400 dark:text-gray-500 tracking-wider text-center w-24"},"Qty"),e("th",{class:"py-3 px-4 text-[10px] uppercase font-bold text-gray-400 dark:text-gray-500 tracking-wider text-right w-32"},"Harga"),e("th",{class:"py-3 px-4 text-[10px] uppercase font-bold text-gray-400 dark:text-gray-500 tracking-wider text-right w-32"},"Subtotal"),e("th",{class:"py-3 px-4 w-10"})])],-1)),e("tbody",he,[o(x).length===0?(c(),d("tr",be,[...t[16]||(t[16]=[e("td",{colspan:"5",class:"py-20 text-center"},[e("div",{class:"flex flex-col items-center justify-center text-gray-300 dark:text-gray-600"},[e("svg",{class:"w-20 h-20 mb-4 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})]),e("p",{class:"text-sm font-medium"},"Belum ada item ditambahkan")])],-1)])])):S("",!0),(c(!0),d(R,null,D(o(x),(r,a)=>(c(),d("tr",{key:a,class:"group hover:bg-blue-50/30 dark:hover:bg-gray-700/30 transition-colors"},[e("td",me,[e("div",fe,g(r.name),1),e("div",ke,g(r.code),1)]),e("td",ve,[_(e("input",{type:"number","onUpdate:modelValue":p=>r.quantity=p,min:"1",class:"w-full py-1.5 px-0 text-center text-sm font-bold bg-gray-100 dark:bg-gray-900 border-none rounded-lg focus:ring-2 focus:ring-blue-500 transition-all text-gray-800 dark:text-white",onFocus:t[4]||(t[4]=p=>p.target.select())},null,40,we),[[C,r.quantity]])]),e("td",_e,[_(e("input",{type:"number","onUpdate:modelValue":p=>r.selling_price=p,class:"w-full py-1.5 px-0 text-right text-sm font-medium bg-transparent border-b border-gray-200 dark:border-gray-700 focus:border-blue-500 border-dashed focus:ring-0 transition-colors text-gray-600 dark:text-gray-300",onFocus:t[5]||(t[5]=p=>p.target.select())},null,40,Ce),[[C,r.selling_price]])]),e("td",je,g(k(r.quantity*r.selling_price)),1),e("td",Se,[e("button",{onClick:p=>o(b)(a),class:"text-gray-300 hover:text-red-500 transition-colors p-1"},[...t[17]||(t[17]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Ie)])]))),128))])])]),e("div",qe,[e("div",Fe,[e("div",Re,[_(e("textarea",{"onUpdate:modelValue":t[6]||(t[6]=r=>o(i).notes=r),rows:"2",placeholder:"Catatan transaksi (opsional)...",class:"w-full pl-10 pr-4 py-3 bg-white dark:bg-gray-800 border-none rounded-xl text-sm shadow-sm focus:ring-2 focus:ring-blue-500 resize-none placeholder-gray-400"},null,512),[[C,o(i).notes]]),t[19]||(t[19]=e("span",{class:"absolute left-3.5 top-3.5 text-gray-400"},[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})])],-1))]),e("div",Ve,[e("div",De,[t[20]||(t[20]=e("span",{class:"text-xs font-bold text-gray-400 uppercase tracking-wider"},"Total",-1)),e("span",Be,g(k(o(s))),1)]),e("button",{onClick:t[7]||(t[7]=(...r)=>o(m)&&o(m)(...r)),disabled:!o(x).length||o(i).processing,class:"w-full py-3.5 px-6 bg-gradient-to-r from-gray-900 to-gray-800 hover:from-black hover:to-gray-900 text-white rounded-xl font-bold shadow-lg shadow-gray-900/20 active:scale-[0.98] transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[o(i).processing?(c(),d("span",Pe)):S("",!0),t[21]||(t[21]=e("span",null,"SIMPAN TRANSAKSI",-1)),t[22]||(t[22]=e("svg",{class:"w-5 h-5 opacity-70",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14 5l7 7m0 0l-7 7m7-7H3"})],-1))],8,Me)])])])])])]),_:1})],64))}},Qe=U(ze,[["__scopeId","data-v-81f22d37"]]);export{Qe as default};
