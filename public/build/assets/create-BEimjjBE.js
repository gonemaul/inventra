import{y as X,u as Z,x as p,z as k,E as ee,j as P,g as w,o as S,a as n,d as o,h as te,w as f,b as e,e as se,k as h,F as A,q as ae,t as i,B as le,A as I,l as re,f as j}from"./app-B5rTaDJp.js";import{_ as oe}from"./AuthenticatedLayout-COSFxDbx.js";import{l as ie}from"./lodash-Bz1lD_ia.js";import{u as ne}from"./useActionLoading-CWOZxe8A.js";import{P as D}from"./PrimaryButton-CRP7o437.js";import{_ as ue}from"./SecondaryButton-Cs9fOXEB.js";import{_ as U}from"./InputError-Bxszp81j.js";import de from"./tableCreate-CmHIk265.js";import ce from"./recom-Jx-MRXrL.js";import pe from"./search--kBAh8MD.js";import{u as me}from"./usePurchaseCart-ClxXMalX.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DataTable-CkQ2dAoJ.js";import"./Modal-BWroHRpH.js";import"./TextInput-h87erl3t.js";const fe={class:"w-full min-h-screen space-y-6"},ge={class:"space-y-6"},be={class:"flex flex-col w-full gap-4 md:flex-row"},ve={class:"flex flex-col gap-4 p-4 bg-gray-200 rounded-lg lg:w-1/2 dark:bg-customBg-tableDark"},_e={class:"flex flex-row gap-4"},he={class:"flex flex-col w-full gap-3"},ye={class:"flex flex-col justify-start gap-3 md:flex-row"},xe={class:"w-full lg:w-2/3"},ke=["value"],we={class:"lg:block"},Se={class:"flex flex-col justify-between gap-3 md:flex-row"},Ie={class:"flex justify-between gap-3"},je={class:"lg:w-1/2"},Be=["disabled"],qe={class:"md:w-1/2"},Ce=["disabled"],Re={class:"flex-col items-center justify-center hidden w-1/5 rounded lg:flex"},Me=["src"],Te={class:"flex flex-wrap justify-center gap-2 lg:justify-start"},Pe={class:"flex flex-col justify-between p-4 text-sm bg-gray-200 rounded-lg dark:bg-customBg-tableDark"},Ae={class:"text-base border-b-2 border-gray-400 text-semibold"},De={class:"space-y-2"},Ue={class:"flex justify-between"},Ve={class:"grid grid-cols-3 gap-4 pt-2 border-t-2 border-gray-400"},$e={class:"flex flex-col justify-between flex-1 w-full p-4 bg-gray-200 rounded-lg dark:bg-customBg-tableDark"},Ee={class:"flex justify-between"},Le={class:"text-lg font-bold"},Fe={class:"text-lg font-bold"},ze={class:"mt-8 text-left"},Ke={class:"text-3xl font-extrabold"},He={class:"p-4 space-y-6 bg-gray-100 border shadow-md rounded-xl dark:bg-customBg-tableDark"},y="inventra_draft_supplier_id",ot={__name:"create",props:{dropdowns:Object,products:Array},setup(B){const{isActionLoading:q}=ne(),d=X(),u=B,{cartItems:g,addToCart:V,updateCartItem:$,removeItem:E,clearCart:L,totalUnit:F,totalBelanja:z,totalMacam:K,addMultipleItems:H}=me(),r=Z({supplier_id:u.purchase?.supplier_id||"",transaction_date:u.purchase?.transaction_date||new Date().toISOString().split("T")[0],status:u.purchase?.status||"draft",notes:u.purchase?.notes||"",shipping_cost:u.purchase?.shipping_cost||0,other_costs:u.purchase?.other_costs||0}),a=p({product_id:null,name:"",code:"",unit:"",size:"",category:"",image_path:null,current_stock:0,quantity:1,purchase_price:0,restock_recommendation:0}),m=p(!1),c=p(""),b=p([]),x=p(!1),v=p(!1);k(()=>r.supplier_id,t=>{t?localStorage.setItem(y,t):localStorage.removeItem(y)}),ee(()=>{const t=localStorage.getItem(y);t&&!r.supplier_id&&(r.supplier_id=t)}),k(()=>r.supplier_id,t=>{t&&(v.value=!0)});const N=t=>{H(t),d.info(`${t.length} item rekomendasi ditambahkan ke keranjang.`)},O=ie.throttle(()=>{if(c.value.length<2){b.value=[];return}x.value=!0,b.value=Q.value.filter(t=>t.name.toLowerCase().includes(c.value.toLowerCase())||t.code.toLowerCase().includes(c.value.toLowerCase())).slice(0,10),x.value=!1},300);k(c,t=>O(t));const Q=P(()=>{const t=r.supplier_id;return t?u.products.filter(s=>s.supplier_id==t):[]}),G=t=>{m.value=!1,C(t),c.value="",b.value=[]},C=(t,s=1,l=null)=>{a.value={product_id:t.id,name:t.name,code:t.code,category:t.category?.name||"-",unit:t.unit?.name||"-",size:t.size?.name||"-",brand:t.brand?.name||"-",type:t.product_type?.name||"-",image_path:t.image_path,current_stock:t.stock,quantity:s,purchase_price:l!==null?l:t.purchase_price,restock_recommendation:Math.max(0,t.min_stock-t.stock)}},Y=()=>{if(!a.value.product_id){d.error("Mohon pilih produk terlebih dahulu.");return}if(a.value.quantity<=0){d.error("Kuantitas minimal harus 1.");return}if(m.value)$({product_id:a.value.product_id,quantity:a.value.quantity,purchase_price:a.value.purchase_price}),d.success("Item berhasil diperbarui.");else{const t=u.products.find(s=>s.id===a.value.product_id);V(t,a.value.quantity,a.value.purchase_price),d.success("Item ditambahkan ke keranjang.")}R()},J=t=>{const s=u.products.find(l=>l.id===t.product_id);s&&(C(s,t.quantity,t.purchase_price),m.value=!0,window.scrollTo({top:0,behavior:"smooth"}))},R=()=>{a.value={product_id:null,name:"",code:"",unit:"",size:"",category:"",brand:"",type:"",image_path:null,current_stock:0,restock_recommendation:0,quantity:1,purchase_price:0},m.value=!1},M=()=>{if(!r.supplier_id){d.error("Mohon pilih Supplier terlebih dahulu!");return}if(g.value.length===0){d.error("Keranjang belanja masih kosong!");return}q.value=!0,r.transform(t=>({...t,items:g.value})).post(route("purchases.store"),{onSuccess:()=>{L(),r.reset()},onError:t=>{d.error("Gagal menyimpan transaksi. Harap periksa input Anda."),console.error(t)},onFinish:()=>{localStorage.removeItem(y),q.value=!1}})};function _(t){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(t)}const W=t=>parseInt(String(t).replace(/[^0-9]/g,""))||0,T=P({get(){return a.value.purchase_price?_(a.value.purchase_price):0},set(t){a.value.purchase_price=W(t)}});return(t,s)=>(S(),w(A,null,[n(o(te),{title:"Rancangan Anggaran Belanja"}),n(oe,{headerTitle:"Rancangan Anggaran Belanja",showSidebar:!1},{default:f(()=>[n(ce,{show:v.value,supplierId:o(r).supplier_id,onClose:s[0]||(s[0]=l=>v.value=!1),onAddItems:N},null,8,["show","supplierId"]),e("form",{onSubmit:se(M,["prevent"]),class:""},[e("div",fe,[e("div",ge,[e("div",be,[e("div",ve,[e("div",_e,[e("div",he,[e("div",ye,[e("div",xe,[s[8]||(s[8]=e("label",{class:"block mb-1 text-sm font-medium"},"Supplier",-1)),h(e("select",{"onUpdate:modelValue":s[1]||(s[1]=l=>o(r).supplier_id=l),class:"w-full px-2 focus:border-lime-500 focus:ring-lime-500 py-1.5 border border-gray-400 rounded-md dark:border-gray-700 bg-white dark:bg-gray-600 dark:text-white"},[s[7]||(s[7]=e("option",{value:""}," Pilih Supplier ",-1)),(S(!0),w(A,null,ae(B.dropdowns.suppliers,l=>(S(),w("option",{key:l.id,value:l.id},i(l.name),9,ke))),128))],512),[[le,o(r).supplier_id]]),n(U,{message:o(r).errors.supplier_id,class:"mt-1"},null,8,["message"])]),e("div",we,[s[9]||(s[9]=e("label",{class:"block mb-1 text-sm font-medium"},"Tanggal",-1)),h(e("input",{"onUpdate:modelValue":s[2]||(s[2]=l=>o(r).transaction_date=l),type:"date",class:"w-full px-2 focus:border-lime-500 focus:ring-lime-500 py-1.5 border border-gray-400 rounded-md dark:border-gray-700 dark:bg-gray-600 dark:text-white"},null,512),[[I,o(r).transaction_date]]),n(U,{message:o(r).errors.transaction_date,class:"mt-1"},null,8,["message"])])]),e("div",Se,[n(pe,{modelValue:c.value,"onUpdate:modelValue":s[3]||(s[3]=l=>c.value=l),results:b.value,isSearching:x.value,onSelect:G},null,8,["modelValue","results","isSearching"]),e("div",Ie,[e("div",je,[s[10]||(s[10]=e("label",{class:"block mb-1 text-sm font-medium"},"Qty",-1)),h(e("input",{"onUpdate:modelValue":s[4]||(s[4]=l=>a.value.quantity=l),type:"number",placeholder:"Qty",disabled:!a.value.product_id,class:"w-full px-2 focus:border-lime-500 focus:ring-lime-500 py-1.5 border border-gray-400 rounded-md dark:border-gray-700 dark:bg-gray-600 dark:text-white"},null,8,Be),[[I,a.value.quantity,void 0,{number:!0}]])]),e("div",qe,[s[11]||(s[11]=e("label",{class:"block mb-1 text-sm font-medium"},"Harga Beli",-1)),h(e("input",{"onUpdate:modelValue":s[5]||(s[5]=l=>T.value=l),type:"text",placeholder:"Rp",disabled:!a.value.product_id,class:"w-full px-2 py-1.5 border border-gray-400 rounded-md dark:border-gray-700 dark:bg-gray-600 dark:text-white focus:border-lime-500"},null,8,Ce),[[I,T.value]])])])])]),e("div",Re,[e("img",{alt:"Produk",class:"object-cover w-32 h-32 rounded-md aspect-square",src:a.value.image_path?`/storage/${a.value.image_path}`:"/no-image.png"},null,8,Me)])]),e("div",Te,[n(o(re),{href:t.route("purchases.index")},{default:f(()=>[n(ue,{type:"button"},{default:f(()=>[...s[12]||(s[12]=[j(" Kembali ",-1)])]),_:1})]),_:1},8,["href"]),n(D,{type:"button",onClick:Y,disabled:!a.value.product_id},{default:f(()=>[j(i(m.value?"Update Item":"Tambah Item"),1)]),_:1},8,["disabled"]),e("button",{onClick:R,type:"button",class:"inline-flex items-center px-4 py-2 text-xs font-semibold tracking-widest text-white uppercase transition duration-150 ease-in-out bg-red-500 border border-transparent rounded-md hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2"}," Reset "),n(D,{type:"button",onClick:M,disabled:o(r).processing||o(g).length===0},{default:f(()=>[j(i(o(r).processing?"Menyimpan...":"Simpan"),1)]),_:1},8,["disabled"]),e("button",{onClick:s[6]||(s[6]=l=>v.value=!0),type:"button",class:"inline-flex items-center px-4 py-2 text-xs font-semibold tracking-widest text-white uppercase transition duration-150 ease-in-out bg-yellow-500 border border-transparent rounded-md hover:bg-yellow-600 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:ring-offset-2"}," Rekomendasi ")])]),e("div",Pe,[e("div",Ae,i(a.value.name?a.value.name+" ( "+a.value.code+" )":"Belum ada barang dipilih"),1),e("div",De,[s[13]||(s[13]=e("div",{class:"flex justify-between"},[e("strong",null,"Kategori"),e("strong",null,"Satuan"),e("strong",null,"Ukuran")],-1)),e("div",Ue,[e("span",null,i(a.value.category||"-"),1),e("span",null,i(a.value.unit||"-"),1),e("span",null,i(a.value.size||"-"),1)])]),e("div",Ve,[e("div",null,[s[14]||(s[14]=e("p",{class:"font-semibold"},"Sisa Stok",-1)),e("p",null,i(a.value.current_stock||"0"),1)]),e("div",null,[s[15]||(s[15]=e("p",{class:"font-semibold"},"Rekom Restok",-1)),e("p",null,i(a.value.restock_recommendation||"0"),1)]),e("div",null,[s[16]||(s[16]=e("p",{class:"font-semibold"},"Stok Masuk",-1)),e("p",null,i(a.value.quantity||"0"),1)]),e("div",null,[s[17]||(s[17]=e("p",{class:"font-semibold"},"Total Stok",-1)),e("p",null,i((a.value.current_stock||0)+(a.value.quantity||0)),1)]),e("div",null,[s[18]||(s[18]=e("p",{class:"font-semibold"},"Harga Beli",-1)),e("p",null,i(_(a.value.purchase_price||0)),1)]),e("div",null,[s[19]||(s[19]=e("p",{class:"font-semibold"},"Total",-1)),e("p",null,i(_((a.value.quantity||0)*(a.value.purchase_price||0))),1)])])]),e("div",$e,[e("div",Ee,[e("p",Le,i(o(F))+" Unit ",1),e("p",Fe,i(o(K))+" Macam ",1)]),e("div",ze,[s[20]||(s[20]=e("p",{class:"text-gray-500 uppercase dark:text-gray-400"}," Total Belanja ",-1)),e("p",Ke,i(_(o(z))),1)])])])]),e("div",He,[n(de,{items:o(g),onRemove:o(E),onEdit:J},null,8,["items","onRemove"])])])],32)]),_:1})],64))}};export{ot as default};
