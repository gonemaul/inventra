const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/HeadRabMobile-CA-wS7tt.js","assets/vendor-core-I2bf3i2k.js","assets/vendor-common-pmZ7KOuE.js","assets/vendor-charts-Bw6UNgWf.js","assets/vendor-core-DnojJsHo.css","assets/InputError-CqpCZYJY.js","assets/HeadRabDesktop-D1xd0EJQ.js","assets/PrimaryButton-CkMvIs6v.js","assets/_plugin-vue_export-helper-DlAUqK2U.js","assets/SecondaryButton-BeePuk04.js"])))=>i.map(i=>d[i]);
import{_ as $}from"./app-KMQGhBDD.js";import{_ as ae}from"./AuthenticatedLayout-CjXofMt8.js";import{p as se,C as g,q as v,u as re,J as oe,v as ie,N as ne,l as f,o as p,e as x,g as a,i as le,w as ue,f as l,d as y,a2 as V,n as q,k as de,m as ce,t as pe,a3 as me,R as ge,F as ve}from"./vendor-core-I2bf3i2k.js";import{u as he}from"./useActionLoading-x-0YPKo7.js";import{u as _e}from"./usePurchaseCart-Md_HIZ-E.js";import fe from"./CatalogView-CYqidwCD.js";import ye from"./PurchaseTable-DseRc-yq.js";import be from"./recom-BMIQIyUv.js";import"./vendor-common-pmZ7KOuE.js";import"./vendor-charts-Bw6UNgWf.js";import"./useSidebar-D2EQGyo5.js";import"./CatalogCard-B2txuZ3m.js";import"./DataTable-DMPdSvXO.js";import"./PrimaryButton-CkMvIs6v.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./SecondaryButton-BeePuk04.js";import"./BottomSheet-DktEwkdi.js";const ke={class:"w-full min-h-screen space-y-6"},we={class:"p-4 space-y-4 bg-white border border-gray-200 shadow-sm rounded-xl dark:bg-gray-900 dark:border-gray-700"},Se={class:"flex p-1 space-x-1 bg-gray-100 rounded-lg dark:bg-gray-700"},xe={key:0,class:"ml-2 bg-lime-100 text-lime-700 py-0.5 px-2 rounded-full text-xs font-bold"},Ie=["disabled"],je={key:0},Re={key:1},Ce={class:"min-h-[400px]"},b="inventra_draft_supplier_id",Ue={__name:"create",props:{purchase:Object,dropdowns:Object},setup(k){const O=V(()=>$(()=>import("./HeadRabMobile-CA-wS7tt.js"),__vite__mapDeps([0,1,2,3,4,5]))),L=V(()=>$(()=>import("./HeadRabDesktop-D1xd0EJQ.js"),__vite__mapDeps([6,1,2,3,4,7,8,9,5]))),i=k,n=se(),{isActionLoading:I}=he(),d=g(()=>!!i.purchase&&!!i.purchase.id),w=g(()=>i.purchase?.status||"draft"),F=g(()=>w.value==="draft"),H=g(()=>w.value==="dipesan"),j=v(window.innerWidth<1024),R=()=>{j.value=window.innerWidth<1024},u=v("table"),m=v(!1),{cartItems:c,addToCart:K,updateCartItem:N,removeItem:U,clearCart:Q,totalUnit:C,totalBelanja:D,totalMacam:M,addMultipleItems:W}=_e(d.value,i.purchase),o=re({supplier_id:i.purchase?.supplier_id||"",transaction_date:i.purchase?.transaction_date||new Date().toISOString().split("T")[0],status:w.value,notes:i.purchase?.notes||"",shipping_cost:i.purchase?.shipping_cost||0,other_costs:i.purchase?.other_costs||0}),h=v(!1),T={product_id:null,name:"",code:"",unit:"",size:"",category:"",brand:"",type:"",image_url:null,current_stock:0,quantity:1,purchase_price:0,restock_recommendation:0},s=v({...T}),_=g({get:()=>s.value.purchase_price?Z(s.value.purchase_price):0,set:e=>s.value.purchase_price=ee(e)});oe(()=>o.supplier_id,e=>{e?(localStorage.setItem(b,e),m.value=!0,u.value="catalog"):(localStorage.removeItem(b),m.value=!1,u.value="table")}),ie(()=>{window.addEventListener("resize",R);const e=localStorage.getItem(b);e&&!o.supplier_id&&!d.value&&(o.supplier_id=e)}),ne(()=>{window.removeEventListener("resize",R)});const E=(e,t=1,r=null)=>{const B=e.insights?.find(te=>te.type==="restock")?.payload?.suggested_qty;s.value={product_id:e.product_id?e.product_id:e.id,name:e.name,code:e.code,category:e.category?.name||e.category||"-",unit:e.unit?.name||e.unit||"-",size:e.size?.name||e.size||"-",brand:e.brand?.name||e.brand||"-",type:e.type_name||e.type_name||"-",image_url:e.image_url,current_stock:e.stock||e.current_stock,quantity:B||t,purchase_price:r!==null?r:e.purchase_price||0,restock_recommendation:B},console.log(e),console.log(s.value)},S=()=>{s.value={...T},h.value=!1},G=e=>{E(e),u.value="catalog",window.scrollTo({top:0,behavior:"smooth"})},J=e=>{E(e,e.quantity,e.purchase_price),h.value=!0,u.value="table",window.scrollTo({top:0,behavior:"smooth"})},P=()=>{if(!s.value.product_id)return n.error("Mohon pilih produk dari katalog.");if(s.value.quantity<=0)return n.error("Kuantitas minimal harus 1.");c.value.find(t=>t.product_id===s.value.product_id)?(console.log("update"),N({product_id:s.value.product_id,quantity:s.value.quantity,purchase_price:s.value.purchase_price}),n.success("Item diperbarui.")):(console.log("baru"),K(s.value,s.value.quantity,s.value.purchase_price),n.success("Item ditambahkan.")),S()},Y=e=>{if(H.value&&e.id)return n.warning("Item lama tidak boleh dihapus saat status Dipesan! Silakan edit Qty saja.");U(e.product_id)},X=e=>{W(e),n.info(`${e.length} item rekomendasi ditambahkan ke keranjang.`)},z=()=>{if(!o.supplier_id)return n.error("Pilih Supplier dulu!");if(c.value.length===0)return n.error("Keranjang kosong!");I.value=!0;const e=r=>({...r,items:c.value}),t={onSuccess:()=>{n.success(d.value?"Transaksi berhasil diperbarui!":"Transaksi berhasil disimpan!"),d.value||localStorage.removeItem(b);const r=d.value?`inventra_edit_${i.purchase.id}`:"inventra_create_draft";localStorage.removeItem(r),Q(),o.reset()},onError:r=>{console.error(r);const A=Object.values(r)[0]||"Terjadi kesalahan";n.error("Gagal: "+A)},onFinish:()=>{I.value=!1}};d.value?o.transform(e).put(route("purchases.update",i.purchase.id),t):o.transform(e).post(route("purchases.store"),t)};function Z(e){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(e)}function ee(e){return parseInt(String(e).replace(/[^0-9]/g,""))||0}return(e,t)=>(p(),f(ve,null,[x(a(le),{title:"Rancangan Anggaran Belanja"}),x(ae,{headerTitle:"Rancangan Anggaran Belanja",showSidebar:!1},{default:ue(()=>[x(be,{show:m.value,supplierId:a(o).supplier_id,onClose:t[0]||(t[0]=r=>m.value=!1),onAddItems:X},null,8,["show","supplierId"]),l("div",ke,[j.value?(p(),y(a(O),{key:0,"form-header":a(o),dropdowns:k.dropdowns,"staging-item":s.value,"is-edit":d.value,"is-editing-mode":h.value,"cart-items":a(c),"total-unit":a(C),"total-macam":a(M),"total-belanja":a(D),"displayed-price":_.value,"onUpdate:displayedPrice":t[1]||(t[1]=r=>_.value=r),onSaveStaging:P,onResetStaging:S,onSubmitTransaction:z,onOpenRecommendation:t[2]||(t[2]=r=>m.value=!0)},null,8,["form-header","dropdowns","staging-item","is-edit","is-editing-mode","cart-items","total-unit","total-macam","total-belanja","displayed-price"])):(p(),y(a(L),{key:1,"form-header":a(o),dropdowns:k.dropdowns,"staging-item":s.value,"is-edit":d.value,"is-editing-mode":h.value,"cart-items":a(c),"total-unit":a(C),"total-macam":a(M),"total-belanja":a(D),"displayed-price":_.value,"onUpdate:displayedPrice":t[3]||(t[3]=r=>_.value=r),onSaveStaging:P,onResetStaging:S,onSubmitTransaction:z,onOpenRecommendation:t[4]||(t[4]=r=>m.value=!0)},null,8,["form-header","dropdowns","staging-item","is-edit","is-editing-mode","cart-items","total-unit","total-macam","total-belanja","displayed-price"])),l("div",we,[l("div",Se,[l("button",{type:"button",onClick:t[5]||(t[5]=r=>u.value="table"),class:q(["flex items-center justify-center w-1/2 py-2.5 text-sm font-medium rounded-md transition-all duration-200 focus:outline-none",u.value==="table"?"bg-white text-gray-900 shadow dark:bg-gray-600 dark:text-white":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"])},[t[7]||(t[7]=l("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})],-1)),t[8]||(t[8]=de(" Daftar Belanja ",-1)),a(c).length>0?(p(),f("span",xe,pe(a(c).length),1)):ce("",!0)],2),l("button",{type:"button",onClick:t[6]||(t[6]=r=>u.value="catalog"),disabled:!a(o).supplier_id,class:q(["flex items-center justify-center w-1/2 py-2.5 text-sm font-medium rounded-md transition-all duration-200 focus:outline-none",[u.value==="catalog"?"bg-white text-gray-900 shadow dark:bg-gray-600 dark:text-white":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",a(o).supplier_id?"":"opacity-50 cursor-not-allowed"]])},[t[9]||(t[9]=l("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})],-1)),a(o).supplier_id?(p(),f("span",Re,"Katalog Produk")):(p(),f("span",je,"Pilih Supplier Dulu"))],10,Ie)]),l("div",Ce,[(p(),y(me,null,[(p(),y(ge(u.value==="table"?ye:fe),{"supplier-id":a(o).supplier_id,items:a(c),stagingItem:s.value,isDraft:F.value,onRemove:Y,onEdit:J,onSelectProduct:G},null,40,["supplier-id","items","stagingItem","isDraft"]))],1024))])])])]),_:1})],64))}};export{Ue as default};
